!function(b){if("object"==typeof exports){module.exports=b()}else{if("function"==typeof define&&false){define(b)}else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.p2=b()}}}(function(){var d,b,a;return(function c(f,k,h){function g(n,l){if(!k[n]){if(!f[n]){var i=typeof require=="function"&&require;if(!l&&i){return i(n,!0)}if(e){return e(n,!0)}throw new Error("Cannot find module '"+n+"'")}var m=k[n]={exports:{}};f[n][0].call(m.exports,function(o){var p=f[n][1][o];return g(p?p:o)},m,m.exports,c,f,k,h)}return k[n].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(h,g,f){var e=h("./Scalar");g.exports=i;function i(){}i.lineInt=function(m,l,q){q=q||0;var p=[0,0];var k,t,o,j,s,n,r;k=m[1][1]-m[0][1];t=m[0][0]-m[1][0];o=k*m[0][0]+t*m[0][1];j=l[1][1]-l[0][1];s=l[0][0]-l[1][0];n=j*l[0][0]+s*l[0][1];r=k*s-j*t;if(!e.eq(r,0,q)){p[0]=(s*o-t*n)/r;p[1]=(k*n-j*o)/r}return p};i.segmentsIntersect=function(m,l,k,j){var u=l[0]-m[0];var p=l[1]-m[1];var r=j[0]-k[0];var o=j[1]-k[1];if(r*p-o*u==0){return false}var q=(u*(k[1]-m[1])+p*(m[0]-k[0]))/(r*p-o*u);var n=(r*(m[1]-k[1])+o*(k[0]-m[0]))/(o*u-r*p);return(q>=0&&q<=1&&n>=0&&n<=1)}},{"./Scalar":4}],2:[function(j,h,g){h.exports=i;function i(){}i.area=function(l,k,m){return(((k[0]-l[0])*(m[1]-l[1]))-((m[0]-l[0])*(k[1]-l[1])))};i.left=function(l,k,m){return i.area(l,k,m)>0};i.leftOn=function(l,k,m){return i.area(l,k,m)>=0};i.right=function(l,k,m){return i.area(l,k,m)<0};i.rightOn=function(l,k,m){return i.area(l,k,m)<=0};var f=[],e=[];i.collinear=function(q,p,n,o){if(!o){return i.area(q,p,n)==0}else{var t=f,m=e;t[0]=p[0]-q[0];t[1]=p[1]-q[1];m[0]=n[0]-p[0];m[1]=n[1]-p[1];var k=t[0]*m[0]+t[1]*m[1],s=Math.sqrt(t[0]*t[0]+t[1]*t[1]),r=Math.sqrt(m[0]*m[0]+m[1]*m[1]),l=Math.acos(k/(s*r));return l<o}};i.sqdist=function(m,k){var n=k[0]-m[0];var l=k[1]-m[1];return n*n+l*l}},{}],3:[function(e,f,j){var i=e("./Line"),n=e("./Point"),k=e("./Scalar");f.exports=l;function l(){this.vertices=[]}l.prototype.at=function(p){var o=this.vertices,q=o.length;return o[p<0?p%q+q:p%q]};l.prototype.first=function(){return this.vertices[0]};l.prototype.last=function(){return this.vertices[this.vertices.length-1]};l.prototype.clear=function(){this.vertices.length=0};l.prototype.append=function(p,r,q){if(typeof(r)=="undefined"){throw new Error("From is not given!")}if(typeof(q)=="undefined"){throw new Error("To is not given!")}if(q-1<r){throw new Error("lol1")}if(q>p.vertices.length){throw new Error("lol2")}if(r<0){throw new Error("lol3")}for(var o=r;o<q;o++){this.vertices.push(p.vertices[o])}};l.prototype.makeCCW=function(){var q=0,o=this.vertices;for(var p=1;p<this.vertices.length;++p){if(o[p][1]<o[q][1]||(o[p][1]==o[q][1]&&o[p][0]>o[q][0])){q=p}}if(!n.left(this.at(q-1),this.at(q),this.at(q+1))){this.reverse()}};l.prototype.reverse=function(){var p=[];for(var o=0,q=this.vertices.length;o!==q;o++){p.push(this.vertices.pop())}this.vertices=p};l.prototype.isReflex=function(o){return n.right(this.at(o-1),this.at(o),this.at(o+1))};var h=[],g=[];l.prototype.canSee=function(s,q){var u,v,r=h,o=g;if(n.leftOn(this.at(s+1),this.at(s),this.at(q))&&n.rightOn(this.at(s-1),this.at(s),this.at(q))){return false}v=n.sqdist(this.at(s),this.at(q));for(var t=0;t!==this.vertices.length;++t){if((t+1)%this.vertices.length===s||t===s){continue}if(n.leftOn(this.at(s),this.at(q),this.at(t+1))&&n.rightOn(this.at(s),this.at(q),this.at(t))){r[0]=this.at(s);r[1]=this.at(q);o[0]=this.at(t);o[1]=this.at(t+1);u=i.lineInt(r,o);if(n.sqdist(this.at(s),u)<v){return false}}}return true};l.prototype.copy=function(r,q,t){var s=t||new l();s.clear();if(r<q){for(var o=r;o<=q;o++){s.vertices.push(this.vertices[o])}}else{for(var o=0;o<=q;o++){s.vertices.push(this.vertices[o])}for(var o=r;o<this.vertices.length;o++){s.vertices.push(this.vertices[o])}}return s};l.prototype.getCutEdges=function(){var r=[],v=[],s=[],u=new l();var t=Number.MAX_VALUE;for(var q=0;q<this.vertices.length;++q){if(this.isReflex(q)){for(var p=0;p<this.vertices.length;++p){if(this.canSee(q,p)){v=this.copy(q,p,u).getCutEdges();s=this.copy(p,q,u).getCutEdges();for(var o=0;o<s.length;o++){v.push(s[o])}if(v.length<t){r=v;t=v.length;r.push([this.at(q),this.at(p)])}}}}}return r};l.prototype.decomp=function(){var o=this.getCutEdges();if(o.length>0){return this.slice(o)}else{return[this]}};l.prototype.slice=function(q){if(q.length==0){return[this]}if(q instanceof Array&&q.length&&q[0] instanceof Array&&q[0].length==2&&q[0][0] instanceof Array){var p=[this];for(var s=0;s<q.length;s++){var t=q[s];for(var r=0;r<p.length;r++){var u=p[r];var o=u.slice(t);if(o){p.splice(r,1);p.push(o[0],o[1]);break}}}return p}else{var t=q;var s=this.vertices.indexOf(t[0]);var r=this.vertices.indexOf(t[1]);if(s!=-1&&r!=-1){return[this.copy(s,r),this.copy(r,s)]}else{return false}}};l.prototype.isSimple=function(){var q=this.vertices;for(var p=0;p<q.length-1;p++){for(var o=0;o<p-1;o++){if(i.segmentsIntersect(q[p],q[p+1],q[o],q[o+1])){return false}}}for(var p=1;p<q.length-2;p++){if(i.segmentsIntersect(q[0],q[q.length-1],q[p],q[p+1])){return false}}return true};function m(z,y,u,s,x){x=x||0;var p=y[1]-z[1];var w=z[0]-y[0];var r=(p*z[0])+(w*z[1]);var o=s[1]-u[1];var v=u[0]-s[0];var q=(o*u[0])+(v*u[1]);var t=(p*v)-(o*w);if(!k.eq(t,0,x)){return[((v*r)-(w*q))/t,((p*q)-(o*r))/t]}else{return[0,0]}}l.prototype.quickDecomp=function(y,u,x,K,L,q){L=L||100;q=q||0;K=K||25;y=typeof(y)!="undefined"?y:[];u=u||[];x=x||[];var D=[0,0],o=[0,0],C=[0,0];var A=0,H=0,J=0,s=0;var E=0,B=0,I=0;var w=new l(),r=new l();var t=this,z=this.vertices;if(z.length<3){return y}q++;if(q>L){console.warn("quickDecomp: max level ("+L+") reached.");return y}for(var G=0;G<this.vertices.length;++G){if(t.isReflex(G)){u.push(t.vertices[G]);A=H=Number.MAX_VALUE;for(var F=0;F<this.vertices.length;++F){if(n.left(t.at(G-1),t.at(G),t.at(F))&&n.rightOn(t.at(G-1),t.at(G),t.at(F-1))){C=m(t.at(G-1),t.at(G),t.at(F),t.at(F-1));if(n.right(t.at(G+1),t.at(G),C)){J=n.sqdist(t.vertices[G],C);if(J<H){H=J;o=C;B=F}}}if(n.left(t.at(G+1),t.at(G),t.at(F+1))&&n.rightOn(t.at(G+1),t.at(G),t.at(F))){C=m(t.at(G+1),t.at(G),t.at(F),t.at(F+1));if(n.left(t.at(G-1),t.at(G),C)){J=n.sqdist(t.vertices[G],C);if(J<A){A=J;D=C;E=F}}}}if(B==(E+1)%this.vertices.length){C[0]=(o[0]+D[0])/2;C[1]=(o[1]+D[1])/2;x.push(C);if(G<E){w.append(t,G,E+1);w.vertices.push(C);r.vertices.push(C);if(B!=0){r.append(t,B,t.vertices.length)}r.append(t,0,G+1)}else{if(G!=0){w.append(t,G,t.vertices.length)}w.append(t,0,E+1);w.vertices.push(C);r.vertices.push(C);r.append(t,B,G+1)}}else{if(B>E){E+=this.vertices.length}s=Number.MAX_VALUE;if(E<B){return y}for(var F=B;F<=E;++F){if(n.leftOn(t.at(G-1),t.at(G),t.at(F))&&n.rightOn(t.at(G+1),t.at(G),t.at(F))){J=n.sqdist(t.at(G),t.at(F));if(J<s){s=J;I=F%this.vertices.length}}}if(G<I){w.append(t,G,I+1);if(I!=0){r.append(t,I,z.length)}r.append(t,0,G+1)}else{if(G!=0){w.append(t,G,z.length)}w.append(t,0,I+1);r.append(t,I,G+1)}}if(w.vertices.length<r.vertices.length){w.quickDecomp(y,u,x,K,L,q);r.quickDecomp(y,u,x,K,L,q)}else{r.quickDecomp(y,u,x,K,L,q);w.quickDecomp(y,u,x,K,L,q)}return y}}y.push(this);return y};l.prototype.removeCollinearPoints=function(o){var p=0;for(var q=this.vertices.length-1;this.vertices.length>3&&q>=0;--q){if(n.collinear(this.at(q-1),this.at(q),this.at(q+1),o)){this.vertices.splice(q%this.vertices.length,1);q--;p++}}return p}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(h,g,f){g.exports=e;function e(){}e.eq=function(k,i,j){j=j||0;return Math.abs(k-i)<j}},{}],5:[function(g,f,e){f.exports={Polygon:g("./Polygon"),Point:g("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(g,f,e){f.exports={name:"p2",version:"0.7.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{}],7:[function(j,g,e){var h=j("../math/vec2"),k=j("../utils/Utils");g.exports=i;function i(l){this.lowerBound=h.create();if(l&&l.lowerBound){h.copy(this.lowerBound,l.lowerBound)}this.upperBound=h.create();if(l&&l.upperBound){h.copy(this.upperBound,l.upperBound)}}var f=h.create();i.prototype.setFromPoints=function(B,v,q,o){var r=this.lowerBound,C=this.upperBound;if(typeof(q)!=="number"){q=0}if(q!==0){h.rotate(r,B[0],q)}else{h.copy(r,B[0])}h.copy(C,r);var z=Math.cos(q),n=Math.sin(q);for(var t=1;t<B.length;t++){var m=B[t];if(q!==0){var A=m[0],w=m[1];f[0]=z*A-n*w;f[1]=n*A+z*w;m=f}for(var s=0;s<2;s++){if(m[s]>C[s]){C[s]=m[s]}if(m[s]<r[s]){r[s]=m[s]}}}if(v){h.add(this.lowerBound,this.lowerBound,v);h.add(this.upperBound,this.upperBound,v)}if(o){this.lowerBound[0]-=o;this.lowerBound[1]-=o;this.upperBound[0]+=o;this.upperBound[1]+=o}};i.prototype.copy=function(l){h.copy(this.lowerBound,l.lowerBound);h.copy(this.upperBound,l.upperBound)};i.prototype.extend=function(n){var p=2;while(p--){var m=n.lowerBound[p];if(this.lowerBound[p]>m){this.lowerBound[p]=m}var o=n.upperBound[p];if(this.upperBound[p]<o){this.upperBound[p]=o}}};i.prototype.overlaps=function(n){var m=this.lowerBound,p=this.upperBound,l=n.lowerBound,o=n.upperBound;return((l[0]<=p[0]&&p[0]<=o[0])||(m[0]<=o[0]&&o[0]<=p[0]))&&((l[1]<=p[1]&&p[1]<=o[1])||(m[1]<=o[1]&&o[1]<=p[1]))};i.prototype.containsPoint=function(m){var n=this.lowerBound,o=this.upperBound;return n[0]<=m[0]&&m[0]<=o[0]&&n[1]<=m[1]&&m[1]<=o[1]};i.prototype.overlapsRay=function(u){var v=0;var m=1/u.direction[0];var l=1/u.direction[1];var s=(this.lowerBound[0]-u.from[0])*m;var r=(this.upperBound[0]-u.from[0])*m;var p=(this.lowerBound[1]-u.from[1])*l;var o=(this.upperBound[1]-u.from[1])*l;var n=Math.max(Math.max(Math.min(s,r),Math.min(p,o)));var q=Math.min(Math.min(Math.max(s,r),Math.max(p,o)));if(q<0){return -1}if(n>q){return -1}return n}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(i,g,f){var h=i("../math/vec2");var j=i("../objects/Body");g.exports=e;function e(l){this.type=l;this.result=[];this.world=null;this.boundingVolumeType=e.AABB}e.AABB=1;e.BOUNDING_CIRCLE=2;e.prototype.setWorld=function(l){this.world=l};e.prototype.getCollisionPairs=function(l){};var k=h.create();e.boundingRadiusCheck=function(o,n){h.sub(k,o.position,n.position);var m=h.squaredLength(k),l=o.boundingRadius+n.boundingRadius;return m<=l*l};e.aabbCheck=function(m,l){return m.getAABB().overlaps(l.getAABB())};e.prototype.boundingVolumeCheck=function(n,m){var l;switch(this.boundingVolumeType){case e.BOUNDING_CIRCLE:l=e.boundingRadiusCheck(n,m);break;case e.AABB:l=e.aabbCheck(n,m);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return l};e.canCollide=function(o,n){var m=j.KINEMATIC;var l=j.STATIC;if(o.type===l&&n.type===l){return false}if((o.type===m&&n.type===l)||(o.type===l&&n.type===m)){return false}if(o.type===m&&n.type===m){return false}if(o.sleepState===j.SLEEPING&&n.sleepState===j.SLEEPING){return false}if((o.sleepState===j.SLEEPING&&n.type===l)||(n.sleepState===j.SLEEPING&&o.type===l)){return false}return true};e.NAIVE=1;e.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(f,g,k){var e=f("../shapes/Circle"),h=f("../shapes/Plane"),j=f("../shapes/Shape"),i=f("../shapes/Particle"),m=f("../collision/Broadphase"),l=f("../math/vec2");g.exports=n;function n(){m.call(this,m.NAIVE)}n.prototype=new m();n.prototype.constructor=n;n.prototype.getCollisionPairs=function(v){var r=v.bodies,o=this.result;o.length=0;for(var u=0,t=r.length;u!==t;u++){var q=r[u];for(var s=0;s<u;s++){var p=r[s];if(m.canCollide(q,p)&&this.boundingVolumeCheck(q,p)){o.push(q,p)}}}return o};n.prototype.aabbQuery=function(t,q,p){p=p||[];var r=t.bodies;for(var s=0;s<r.length;s++){var o=r[s];if(o.aabbNeedsUpdate){o.updateAABB()}if(o.aabb.overlaps(q)){p.push(o)}}return p}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(ao,aD,U){var al=ao("../math/vec2"),ax=al.sub,z=al.add,D=al.dot,am=ao("../utils/Utils"),an=ao("../utils/ContactEquationPool"),o=ao("../utils/FrictionEquationPool"),f=ao("../utils/TupleDictionary"),k=ao("../equations/Equation"),aA=ao("../equations/ContactEquation"),ak=ao("../equations/FrictionEquation"),aj=ao("../shapes/Circle"),au=ao("../shapes/Convex"),R=ao("../shapes/Shape"),T=ao("../objects/Body"),N=ao("../shapes/Box");aD.exports=ay;var Z=al.fromValues(0,1);var y=al.fromValues(0,0),x=al.fromValues(0,0),v=al.fromValues(0,0),t=al.fromValues(0,0),s=al.fromValues(0,0),r=al.fromValues(0,0),q=al.fromValues(0,0),p=al.fromValues(0,0),m=al.fromValues(0,0),K=al.fromValues(0,0),J=al.fromValues(0,0),I=al.fromValues(0,0),H=al.fromValues(0,0),G=al.fromValues(0,0),F=al.fromValues(0,0),E=al.fromValues(0,0),C=al.fromValues(0,0),B=al.fromValues(0,0),aC=[];function ay(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=true;this.enabledEquations=true;this.slipForce=10;this.frictionCoefficient=0.3;this.surfaceVelocity=0;this.contactEquationPool=new an({size:32});this.frictionEquationPool=new o({size:64});this.restitution=0;this.stiffness=k.DEFAULT_STIFFNESS;this.relaxation=k.DEFAULT_RELAXATION;this.frictionStiffness=k.DEFAULT_STIFFNESS;this.frictionRelaxation=k.DEFAULT_RELAXATION;this.enableFrictionReduction=true;this.collidingBodiesLastStep=new f();this.contactSkinSize=0.01}var i=al.create();var h=al.create();ay.prototype.bodiesOverlap=function(aL,aI){var aO=i;var aN=h;for(var aM=0,aG=aL.shapes.length;aM!==aG;aM++){var aJ=aL.shapes[aM];aL.toWorldFrame(aO,aJ.position);for(var aK=0,aF=aI.shapes.length;aK!==aF;aK++){var aH=aI.shapes[aK];aI.toWorldFrame(aN,aH.position);if(this[aJ.type|aH.type](aL,aJ,aO,aJ.angle+aL.angle,aI,aH,aN,aH.angle+aI.angle,true)){return true}}}return false};ay.prototype.collidedLastStep=function(aI,aH){var aG=aI.id|0,aF=aH.id|0;return !!this.collidingBodiesLastStep.get(aG,aF)};ay.prototype.reset=function(){this.collidingBodiesLastStep.reset();var aI=this.contactEquations;var aG=aI.length;while(aG--){var aF=aI[aG],aL=aF.bodyA.id,aK=aF.bodyB.id;this.collidingBodiesLastStep.set(aL,aK,true)}var aM=this.contactEquations,aH=this.frictionEquations;for(var aJ=0;aJ<aM.length;aJ++){this.contactEquationPool.release(aM[aJ])}for(var aJ=0;aJ<aH.length;aJ++){this.frictionEquationPool.release(aH[aJ])}this.contactEquations.length=this.frictionEquations.length=0};ay.prototype.createContactEquation=function(aI,aH,aG,aF){var aJ=this.contactEquationPool.get();aJ.bodyA=aI;aJ.bodyB=aH;aJ.shapeA=aG;aJ.shapeB=aF;aJ.restitution=this.restitution;aJ.firstImpact=!this.collidedLastStep(aI,aH);aJ.stiffness=this.stiffness;aJ.relaxation=this.relaxation;aJ.needsUpdate=true;aJ.enabled=this.enabledEquations;aJ.offset=this.contactSkinSize;return aJ};ay.prototype.createFrictionEquation=function(aI,aH,aG,aF){var aJ=this.frictionEquationPool.get();aJ.bodyA=aI;aJ.bodyB=aH;aJ.shapeA=aG;aJ.shapeB=aF;aJ.setSlipForce(this.slipForce);aJ.frictionCoefficient=this.frictionCoefficient;aJ.relativeVelocity=this.surfaceVelocity;aJ.enabled=this.enabledEquations;aJ.needsUpdate=true;aJ.stiffness=this.frictionStiffness;aJ.relaxation=this.frictionRelaxation;aJ.contactEquations.length=0;return aJ};ay.prototype.createFrictionFromContact=function(aG){var aF=this.createFrictionEquation(aG.bodyA,aG.bodyB,aG.shapeA,aG.shapeB);al.copy(aF.contactPointA,aG.contactPointA);al.copy(aF.contactPointB,aG.contactPointB);al.rotate90cw(aF.t,aG.normalA);aF.contactEquations.push(aG);return aF};ay.prototype.createFrictionFromAverage=function(aG){var aL=this.contactEquations[this.contactEquations.length-1];var aF=this.createFrictionEquation(aL.bodyA,aL.bodyB,aL.shapeA,aL.shapeB);var aK=aL.bodyA;var aJ=aL.bodyB;al.set(aF.contactPointA,0,0);al.set(aF.contactPointB,0,0);al.set(aF.t,0,0);for(var aI=0;aI!==aG;aI++){aL=this.contactEquations[this.contactEquations.length-1-aI];if(aL.bodyA===aK){al.add(aF.t,aF.t,aL.normalA);al.add(aF.contactPointA,aF.contactPointA,aL.contactPointA);al.add(aF.contactPointB,aF.contactPointB,aL.contactPointB)}else{al.sub(aF.t,aF.t,aL.normalA);al.add(aF.contactPointA,aF.contactPointA,aL.contactPointB);al.add(aF.contactPointB,aF.contactPointB,aL.contactPointA)}aF.contactEquations.push(aL)}var aH=1/aG;al.scale(aF.contactPointA,aF.contactPointA,aH);al.scale(aF.contactPointB,aF.contactPointB,aH);al.normalize(aF.t,aF.t);al.rotate90cw(aF.t,aF.t);return aF};ay.prototype[R.LINE|R.CONVEX]=ay.prototype.convexLine=function(aG,aF,aI,aM,aJ,aN,aH,aL,aK){if(aK){return false}else{return 0}};ay.prototype[R.LINE|R.BOX]=ay.prototype.lineBox=function(aH,aN,aG,aK,aL,aM,aF,aJ,aI){if(aI){return false}else{return 0}};function Q(aG,aF){al.set(aG.vertices[0],-aF.length*0.5,-aF.radius);al.set(aG.vertices[1],aF.length*0.5,-aF.radius);al.set(aG.vertices[2],aF.length*0.5,aF.radius);al.set(aG.vertices[3],-aF.length*0.5,aF.radius)}var g=new N({width:1,height:1}),S=al.create();ay.prototype[R.CAPSULE|R.CONVEX]=ay.prototype[R.CAPSULE|R.BOX]=ay.prototype.convexCapsule=function(aK,aG,aO,aQ,aN,aR,aH,aP,aM){var aJ=S;al.set(aJ,aR.length/2,0);al.rotate(aJ,aJ,aP);al.add(aJ,aJ,aH);var aL=this.circleConvex(aN,aR,aJ,aP,aK,aG,aO,aQ,aM,aR.radius);al.set(aJ,-aR.length/2,0);al.rotate(aJ,aJ,aP);al.add(aJ,aJ,aH);var aI=this.circleConvex(aN,aR,aJ,aP,aK,aG,aO,aQ,aM,aR.radius);if(aM&&(aL||aI)){return true}var aF=g;Q(aF,aR);var aS=this.convexConvex(aK,aG,aO,aQ,aN,aF,aH,aP,aM);return aS+aL+aI};ay.prototype[R.CAPSULE|R.LINE]=ay.prototype.lineCapsule=function(aH,aN,aF,aL,aJ,aM,aG,aK,aI){if(aI){return false}else{return 0}};var P=al.create();var O=al.create();var av=new N({width:1,height:1});ay.prototype[R.CAPSULE|R.CAPSULE]=ay.prototype.capsuleCapsule=function(aJ,aW,aO,aS,aI,aV,aN,aQ,aL){var aK;var aU=P,aT=O;var aX=0;for(var aR=0;aR<2;aR++){al.set(aU,(aR===0?-1:1)*aW.length/2,0);al.rotate(aU,aU,aS);al.add(aU,aU,aO);for(var aP=0;aP<2;aP++){al.set(aT,(aP===0?-1:1)*aV.length/2,0);al.rotate(aT,aT,aQ);al.add(aT,aT,aN);if(this.enableFrictionReduction){aK=this.enableFriction;this.enableFriction=false}var aM=this.circleCircle(aJ,aW,aU,aS,aI,aV,aT,aQ,aL,aW.radius,aV.radius);if(this.enableFrictionReduction){this.enableFriction=aK}if(aL&&aM){return true}aX+=aM}}if(this.enableFrictionReduction){aK=this.enableFriction;this.enableFriction=false}var aH=av;Q(aH,aW);var aG=this.convexCapsule(aJ,aH,aO,aS,aI,aV,aN,aQ,aL);if(this.enableFrictionReduction){this.enableFriction=aK}if(aL&&aG){return true}aX+=aG;if(this.enableFrictionReduction){var aK=this.enableFriction;this.enableFriction=false}Q(aH,aV);var aF=this.convexCapsule(aI,aH,aN,aQ,aJ,aW,aO,aS,aL);if(this.enableFrictionReduction){this.enableFriction=aK}if(aL&&aF){return true}aX+=aF;if(this.enableFrictionReduction){if(aX&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(aX))}}return aX};ay.prototype[R.LINE|R.LINE]=ay.prototype.lineLine=function(aI,aH,aL,aN,aG,aF,aK,aM,aJ){if(aJ){return false}else{return 0}};ay.prototype[R.PLANE|R.LINE]=ay.prototype.planeLine=function(aR,aU,aZ,aQ,aH,aO,aV,aI,aG){var aL=y,aJ=x,a0=v,aM=t,aK=s,a2=r,aS=q,aN=p,aF=m,aY=aC,a1=0;al.set(aL,-aO.length/2,0);al.set(aJ,aO.length/2,0);al.rotate(a0,aL,aI);al.rotate(aM,aJ,aI);z(a0,a0,aV);z(aM,aM,aV);al.copy(aL,a0);al.copy(aJ,aM);ax(aK,aJ,aL);al.normalize(a2,aK);al.rotate90cw(aF,a2);al.rotate(aN,Z,aQ);aY[0]=aL;aY[1]=aJ;for(var aT=0;aT<aY.length;aT++){var aP=aY[aT];ax(aS,aP,aZ);var aW=D(aS,aN);if(aW<0){if(aG){return true}var aX=this.createContactEquation(aR,aH,aU,aO);a1++;al.copy(aX.normalA,aN);al.normalize(aX.normalA,aX.normalA);al.scale(aS,aN,aW);ax(aX.contactPointA,aP,aS);ax(aX.contactPointA,aX.contactPointA,aR.position);ax(aX.contactPointB,aP,aV);z(aX.contactPointB,aX.contactPointB,aV);ax(aX.contactPointB,aX.contactPointB,aH.position);this.contactEquations.push(aX);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aX))}}}}if(aG){return false}if(!this.enableFrictionReduction){if(a1&&this.enableFriction){this.frictionEquations.push(this.createFrictionFromAverage(a1))}}return a1};ay.prototype[R.PARTICLE|R.CAPSULE]=ay.prototype.particleCapsule=function(aN,aL,aF,aJ,aI,aM,aG,aK,aH){return this.circleLine(aN,aL,aF,aJ,aI,aM,aG,aK,aH,aM.radius,0)};ay.prototype[R.CIRCLE|R.LINE]=ay.prototype.circleLine=function(aV,aG,aJ,a2,aM,aX,a3,aO,aL,a1,aF){var a1=a1||0,aF=typeof(aF)!=="undefined"?aF:aG.radius,a9=y,aH=x,a6=v,aI=t,aK=s,aR=r,bc=q,aT=p,aQ=m,bb=K,aW=J,aZ=I,aS=H,a8=G,ba=aC;al.set(aT,-aX.length/2,0);al.set(aQ,aX.length/2,0);al.rotate(bb,aT,aO);al.rotate(aW,aQ,aO);z(bb,bb,a3);z(aW,aW,a3);al.copy(aT,bb);al.copy(aQ,aW);ax(aR,aQ,aT);al.normalize(bc,aR);al.rotate90cw(aK,bc);ax(aZ,aJ,aT);var a4=D(aZ,aK);ax(aI,aT,a3);ax(aS,aJ,a3);var a7=aF+a1;if(Math.abs(a4)<a7){al.scale(a9,aK,a4);ax(a6,aJ,a9);al.scale(aH,aK,D(aK,aS));al.normalize(aH,aH);al.scale(aH,aH,a1);z(a6,a6,aH);var aU=D(bc,a6);var aP=D(bc,aT);var aN=D(bc,aQ);if(aU>aP&&aU<aN){if(aL){return true}var a5=this.createContactEquation(aV,aM,aG,aX);al.scale(a5.normalA,a9,-1);al.normalize(a5.normalA,a5.normalA);al.scale(a5.contactPointA,a5.normalA,aF);z(a5.contactPointA,a5.contactPointA,aJ);ax(a5.contactPointA,a5.contactPointA,aV.position);ax(a5.contactPointB,a6,a3);z(a5.contactPointB,a5.contactPointB,a3);ax(a5.contactPointB,a5.contactPointB,aM.position);this.contactEquations.push(a5);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a5))}return 1}}ba[0]=aT;ba[1]=aQ;for(var a0=0;a0<ba.length;a0++){var aY=ba[a0];ax(aZ,aY,aJ);if(al.squaredLength(aZ)<Math.pow(a7,2)){if(aL){return true}var a5=this.createContactEquation(aV,aM,aG,aX);al.copy(a5.normalA,aZ);al.normalize(a5.normalA,a5.normalA);al.scale(a5.contactPointA,a5.normalA,aF);z(a5.contactPointA,a5.contactPointA,aJ);ax(a5.contactPointA,a5.contactPointA,aV.position);ax(a5.contactPointB,aY,a3);al.scale(a8,a5.normalA,-a1);z(a5.contactPointB,a5.contactPointB,a8);z(a5.contactPointB,a5.contactPointB,a3);ax(a5.contactPointB,a5.contactPointB,aM.position);this.contactEquations.push(a5);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a5))}return 1}}return 0};ay.prototype[R.CIRCLE|R.CAPSULE]=ay.prototype.circleCapsule=function(aG,aI,aM,aN,aF,aH,aL,aK,aJ){return this.circleLine(aG,aI,aM,aN,aF,aH,aL,aK,aJ,aH.radius)};ay.prototype[R.CIRCLE|R.CONVEX]=ay.prototype[R.CIRCLE|R.BOX]=ay.prototype.circleConvex=function(ba,a7,be,a6,aP,aZ,aQ,a0,aM,aF){var aF=typeof(aF)==="number"?aF:a7.radius;var aU=y,aT=x,aG=v,a5=t,aV=s,aR=r,aY=q,a3=p,aK=m,aI=K,aL=J,a8=-1,aW=null,bc=I,a2=H,a4=G,aS=F,aX=E,aJ=false,a1=Number.MAX_VALUE;var aN=0;var bb=aZ.vertices;for(var a9=0;a9!==bb.length+1;a9++){var bg=bb[a9%bb.length],bf=bb[(a9+1)%bb.length];al.rotate(aU,bg,a0);al.rotate(aT,bf,a0);z(aU,aU,aQ);z(aT,aT,aQ);ax(aG,aT,aU);al.normalize(a5,aG);al.rotate90cw(aV,a5);al.scale(a4,aV,-a7.radius);z(a4,a4,be);if(e(a4,aZ,aQ,a0)){al.sub(aS,aU,a4);var aO=Math.abs(al.dot(aS,aV));if(aO<a1){al.copy(aX,a4);a1=aO;al.scale(a2,aV,aO);al.add(a2,a2,a4);aJ=true}}}if(aJ){if(aM){return true}var bd=this.createContactEquation(ba,aP,a7,aZ);al.sub(bd.normalA,aX,be);al.normalize(bd.normalA,bd.normalA);al.scale(bd.contactPointA,bd.normalA,aF);z(bd.contactPointA,bd.contactPointA,be);ax(bd.contactPointA,bd.contactPointA,ba.position);ax(bd.contactPointB,a2,aQ);z(bd.contactPointB,bd.contactPointB,aQ);ax(bd.contactPointB,bd.contactPointB,aP.position);this.contactEquations.push(bd);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bd))}return 1}if(aF>0){for(var a9=0;a9<bb.length;a9++){var aH=bb[a9];al.rotate(aL,aH,a0);z(aL,aL,aQ);ax(aI,aL,be);if(al.squaredLength(aI)<Math.pow(aF,2)){if(aM){return true}var bd=this.createContactEquation(ba,aP,a7,aZ);al.copy(bd.normalA,aI);al.normalize(bd.normalA,bd.normalA);al.scale(bd.contactPointA,bd.normalA,aF);z(bd.contactPointA,bd.contactPointA,be);ax(bd.contactPointA,bd.contactPointA,ba.position);ax(bd.contactPointB,aL,aQ);z(bd.contactPointB,bd.contactPointB,aQ);ax(bd.contactPointB,bd.contactPointB,aP.position);this.contactEquations.push(bd);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bd))}return 1}}}return 0};var ar=al.create(),aq=al.create(),ai=al.create(),ah=al.create();function e(aJ,aF,aI,aP){var aM=ar,aL=aq,aH=ai,aG=ah,aS=aJ,aR=aF.vertices,aN=null;for(var aK=0;aK!==aR.length+1;aK++){var aT=aR[aK%aR.length],aQ=aR[(aK+1)%aR.length];al.rotate(aM,aT,aP);al.rotate(aL,aQ,aP);z(aM,aM,aI);z(aL,aL,aI);ax(aH,aM,aS);ax(aG,aL,aS);var aO=al.crossLength(aH,aG);if(aN===null){aN=aO}if(aO*aN<=0){return false}aN=aO}return true}ay.prototype[R.PARTICLE|R.CONVEX]=ay.prototype[R.PARTICLE|R.BOX]=ay.prototype.particleConvex=function(a3,aY,a0,aZ,aP,a1,aQ,a2,aK){var aU=y,aT=x,aF=v,a9=t,a6=s,aR=r,bg=q,a7=p,aI=m,aG=K,aJ=J,ba=-1,aW=null,be=I,a5=H,aN=G,aM=F,a8=E,aS=C,aV=B,a4=Number.MAX_VALUE;var aL=0,aH=false,bc=a1.vertices;if(!e(a0,a1,aQ,a2)){return 0}if(aK){return true}var aX=null;for(var bb=0;bb!==bc.length+1;bb++){var bi=bc[bb%bc.length],bh=bc[(bb+1)%bc.length];al.rotate(aU,bi,a2);al.rotate(aT,bh,a2);z(aU,aU,aQ);z(aT,aT,aQ);ax(aF,aT,aU);al.normalize(a9,aF);al.rotate90cw(a6,a9);ax(aG,a0,aU);var bd=D(aG,a6);ax(aR,aU,aQ);ax(bg,a0,aQ);al.sub(aS,aU,a0);var aO=Math.abs(al.dot(aS,a6));if(aO<a4){a4=aO;al.scale(a5,a6,aO);al.add(a5,a5,a0);al.copy(aV,a6);aH=true}}if(aH){var bf=this.createContactEquation(a3,aP,aY,a1);al.scale(bf.normalA,aV,-1);al.normalize(bf.normalA,bf.normalA);al.set(bf.contactPointA,0,0);z(bf.contactPointA,bf.contactPointA,a0);ax(bf.contactPointA,bf.contactPointA,a3.position);ax(bf.contactPointB,a5,aQ);z(bf.contactPointB,bf.contactPointB,aQ);ax(bf.contactPointB,bf.contactPointB,aP.position);this.contactEquations.push(bf);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bf))}return 1}return 0};ay.prototype[R.CIRCLE]=ay.prototype.circleCircle=function(aL,aK,aN,aS,aJ,aI,aM,aR,aO,aH,aG){var aQ=y,aH=aH||aK.radius,aG=aG||aI.radius;ax(aQ,aN,aM);var aF=aH+aG;if(al.squaredLength(aQ)>Math.pow(aF,2)){return 0}if(aO){return true}var aP=this.createContactEquation(aL,aJ,aK,aI);ax(aP.normalA,aM,aN);al.normalize(aP.normalA,aP.normalA);al.scale(aP.contactPointA,aP.normalA,aH);al.scale(aP.contactPointB,aP.normalA,-aG);z(aP.contactPointA,aP.contactPointA,aN);ax(aP.contactPointA,aP.contactPointA,aL.position);z(aP.contactPointB,aP.contactPointB,aM);ax(aP.contactPointB,aP.contactPointB,aJ.position);this.contactEquations.push(aP);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aP))}return 1};ay.prototype[R.PLANE|R.CONVEX]=ay.prototype[R.PLANE|R.BOX]=ay.prototype.planeConvex=function(aM,aL,aQ,aF,aI,aG,aK,aU,aP){var aJ=y,aO=x,aT=v;var aH=0;al.rotate(aO,Z,aF);for(var aN=0;aN!==aG.vertices.length;aN++){var aV=aG.vertices[aN];al.rotate(aJ,aV,aU);z(aJ,aJ,aK);ax(aT,aJ,aQ);if(D(aT,aO)<=0){if(aP){return true}aH++;var aS=this.createContactEquation(aM,aI,aL,aG);ax(aT,aJ,aQ);al.copy(aS.normalA,aO);var aR=D(aT,aS.normalA);al.scale(aT,aS.normalA,aR);ax(aS.contactPointB,aJ,aI.position);ax(aS.contactPointA,aJ,aT);ax(aS.contactPointA,aS.contactPointA,aM.position);this.contactEquations.push(aS);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aS))}}}}if(this.enableFrictionReduction){if(this.enableFriction&&aH){this.frictionEquations.push(this.createFrictionFromAverage(aH))}}return aH};ay.prototype[R.PARTICLE|R.PLANE]=ay.prototype.particlePlane=function(aR,aQ,aG,aM,aI,aH,aL,aF,aK){var aP=y,aJ=x;aF=aF||0;ax(aP,aG,aL);al.rotate(aJ,Z,aF);var aN=D(aP,aJ);if(aN>0){return 0}if(aK){return true}var aO=this.createContactEquation(aI,aR,aH,aQ);al.copy(aO.normalA,aJ);al.scale(aP,aO.normalA,aN);ax(aO.contactPointA,aG,aP);ax(aO.contactPointA,aO.contactPointA,aI.position);ax(aO.contactPointB,aG,aR.position);this.contactEquations.push(aO);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aO))}return 1};ay.prototype[R.CIRCLE|R.PARTICLE]=ay.prototype.circleParticle=function(aI,aK,aN,aG,aP,aO,aF,aJ,aH){var aM=y;ax(aM,aF,aN);if(al.squaredLength(aM)>Math.pow(aK.radius,2)){return 0}if(aH){return true}var aL=this.createContactEquation(aI,aP,aK,aO);al.copy(aL.normalA,aM);al.normalize(aL.normalA,aL.normalA);al.scale(aL.contactPointA,aL.normalA,aK.radius);z(aL.contactPointA,aL.contactPointA,aN);ax(aL.contactPointA,aL.contactPointA,aI.position);ax(aL.contactPointB,aF,aP.position);this.contactEquations.push(aL);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aL))}return 1};var at=new aj({radius:1}),n=al.create(),l=al.create(),j=al.create();ay.prototype[R.PLANE|R.CAPSULE]=ay.prototype.planeCapsule=function(aJ,aI,aL,aG,aM,aV,aH,aP,aK){var aR=n,aO=l,aF=at,aT=j;al.set(aR,-aV.length/2,0);al.rotate(aR,aR,aP);z(aR,aR,aH);al.set(aO,aV.length/2,0);al.rotate(aO,aO,aP);z(aO,aO,aH);aF.radius=aV.radius;var aN;if(this.enableFrictionReduction){aN=this.enableFriction;this.enableFriction=false}var aS=this.circlePlane(aM,aF,aR,0,aJ,aI,aL,aG,aK),aQ=this.circlePlane(aM,aF,aO,0,aJ,aI,aL,aG,aK);if(this.enableFrictionReduction){this.enableFriction=aN}if(aK){return aS||aQ}else{var aU=aS+aQ;if(this.enableFrictionReduction){if(aU){this.frictionEquations.push(this.createFrictionFromAverage(aU))}}return aU}};ay.prototype[R.CIRCLE|R.PLANE]=ay.prototype.circlePlane=function(aI,aY,aQ,aU,aG,aX,aP,aT,aJ){var aL=aI,aF=aY,aH=aQ,aO=aG,aR=aX,aZ=aP,aN=aT;aN=aN||0;var aK=y,aM=x,aW=v;ax(aK,aH,aZ);al.rotate(aM,Z,aN);var aV=D(aM,aK);if(aV>aF.radius){return 0}if(aJ){return true}var aS=this.createContactEquation(aO,aL,aX,aY);al.copy(aS.normalA,aM);al.scale(aS.contactPointB,aS.normalA,-aF.radius);z(aS.contactPointB,aS.contactPointB,aH);ax(aS.contactPointB,aS.contactPointB,aL.position);al.scale(aW,aS.normalA,aV);ax(aS.contactPointA,aK,aW);z(aS.contactPointA,aS.contactPointA,aZ);ax(aS.contactPointA,aS.contactPointA,aO.position);this.contactEquations.push(aS);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(aS))}return 1};ay.prototype[R.CONVEX]=ay.prototype[R.CONVEX|R.BOX]=ay.prototype[R.BOX]=ay.prototype.convexConvex=function(bc,aZ,a5,aW,bb,aX,a4,aV,aU,bd){var aG=y,aT=x,aS=v,aR=t,aL=s,aO=r,a1=q,aM=p,a2=m,a3=0,bd=typeof(bd)==="number"?bd:0;var aN=ay.findSeparatingAxis(aZ,a5,aW,aX,a4,aV,aG);if(!aN){return 0}ax(aM,a4,a5);if(D(aG,aM)>0){al.scale(aG,aG,-1)}var a0=ay.getClosestEdge(aZ,aW,aG,true),aY=ay.getClosestEdge(aX,aV,aG);if(a0===-1||aY===-1){return 0}for(var a8=0;a8<2;a8++){var aQ=a0,aP=aY,aK=aZ,aI=aX,bl=a5,bh=a4,aJ=aW,aH=aV,bn=bc,bm=bb;if(a8===0){var a7;a7=aQ;aQ=aP;aP=a7;a7=aK;aK=aI;aI=a7;a7=bl;bl=bh;bh=a7;a7=aJ;aJ=aH;aH=a7;a7=bn;bn=bm;bm=a7}for(var a9=aP;a9<aP+2;a9++){var a6=aI.vertices[(a9+aI.vertices.length)%aI.vertices.length];al.rotate(aT,a6,aH);z(aT,aT,bh);var aF=0;for(var ba=aQ-1;ba<aQ+2;ba++){var bk=aK.vertices[(ba+aK.vertices.length)%aK.vertices.length],bg=aK.vertices[(ba+1+aK.vertices.length)%aK.vertices.length];al.rotate(aS,bk,aJ);al.rotate(aR,bg,aJ);z(aS,aS,bl);z(aR,aR,bl);ax(aL,aR,aS);al.rotate90cw(a2,aL);al.normalize(a2,a2);ax(aM,aT,aS);var be=D(a2,aM);if((ba===aQ&&be<=bd)||(ba!==aQ&&be<=0)){aF++}}if(aF>=3){if(aU){return true}var bf=this.createContactEquation(bn,bm,aK,aI);a3++;var bk=aK.vertices[(aQ)%aK.vertices.length],bg=aK.vertices[(aQ+1)%aK.vertices.length];al.rotate(aS,bk,aJ);al.rotate(aR,bg,aJ);z(aS,aS,bl);z(aR,aR,bl);ax(aL,aR,aS);al.rotate90cw(bf.normalA,aL);al.normalize(bf.normalA,bf.normalA);ax(aM,aT,aS);var be=D(bf.normalA,aM);al.scale(a1,bf.normalA,be);ax(bf.contactPointA,aT,bl);ax(bf.contactPointA,bf.contactPointA,a1);z(bf.contactPointA,bf.contactPointA,bl);ax(bf.contactPointA,bf.contactPointA,bn.position);ax(bf.contactPointB,aT,bh);z(bf.contactPointB,bf.contactPointB,bh);ax(bf.contactPointB,bf.contactPointB,bm.position);this.contactEquations.push(bf);if(!this.enableFrictionReduction){if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(bf))}}}}}if(this.enableFrictionReduction){if(this.enableFriction&&a3){this.frictionEquations.push(this.createFrictionFromAverage(a3))}}return a3};var L=al.fromValues(0,0);ay.projectConvexOntoAxis=function(aF,aH,aN,aK,aR){var aM=null,aI=null,aP,aO,aL=L;al.rotate(aL,aK,-aN);for(var aJ=0;aJ<aF.vertices.length;aJ++){aP=aF.vertices[aJ];aO=D(aP,aL);if(aM===null||aO>aM){aM=aO}if(aI===null||aO<aI){aI=aO}}if(aI>aM){var aQ=aI;aI=aM;aM=aQ}var aG=D(aH,aK);al.set(aR,aI+aG,aM+aG)};var af=al.fromValues(0,0),ae=al.fromValues(0,0),ac=al.fromValues(0,0),ab=al.fromValues(0,0),aa=al.fromValues(0,0),Y=al.fromValues(0,0);ay.findSeparatingAxis=function(aP,aS,aH,aN,aQ,aG,aZ){var aI=null,aF=false,aK=false,aJ=af,aM=ae,aL=ac,a2=ab,aT=aa,aR=Y;if(aP instanceof N&&aN instanceof N){for(var aU=0;aU!==2;aU++){var aX=aP,aW=aH;if(aU===1){aX=aN;aW=aG}for(var aV=0;aV!==2;aV++){if(aV===0){al.set(a2,0,1)}else{if(aV===1){al.set(a2,1,0)}}if(aW!==0){al.rotate(a2,a2,aW)}ay.projectConvexOntoAxis(aP,aS,aH,a2,aT);ay.projectConvexOntoAxis(aN,aQ,aG,a2,aR);var a1=aT,aY=aR,a0=false;if(aT[0]>aR[0]){aY=aT;a1=aR;a0=true}var aO=aY[0]-a1[1];aF=(aO<=0);if(aI===null||aO>aI){al.copy(aZ,a2);aI=aO;aK=aF}}}}else{for(var aU=0;aU!==2;aU++){var aX=aP,aW=aH;if(aU===1){aX=aN;aW=aG}for(var aV=0;aV!==aX.vertices.length;aV++){al.rotate(aM,aX.vertices[aV],aW);al.rotate(aL,aX.vertices[(aV+1)%aX.vertices.length],aW);ax(aJ,aL,aM);al.rotate90cw(a2,aJ);al.normalize(a2,a2);ay.projectConvexOntoAxis(aP,aS,aH,a2,aT);ay.projectConvexOntoAxis(aN,aQ,aG,a2,aR);var a1=aT,aY=aR,a0=false;if(aT[0]>aR[0]){aY=aT;a1=aR;a0=true}var aO=aY[0]-a1[1];aF=(aO<=0);if(aI===null||aO>aI){al.copy(aZ,a2);aI=aO;aK=aF}}}}return aK};var X=al.fromValues(0,0),W=al.fromValues(0,0),V=al.fromValues(0,0);ay.getClosestEdge=function(aP,aH,aG,aK){var aL=X,aF=W,aN=V;al.rotate(aL,aG,-aH);if(aK){al.scale(aL,aL,-1)}var aI=-1,aM=aP.vertices.length,aQ=-1;for(var aJ=0;aJ!==aM;aJ++){ax(aF,aP.vertices[(aJ+1)%aM],aP.vertices[aJ%aM]);al.rotate90cw(aN,aF);al.normalize(aN,aN);var aO=D(aN,aL);if(aI===-1||aO>aQ){aI=aJ%aM;aQ=aO}}return aI};var ap=al.create(),aw=al.create(),w=al.create(),u=al.create(),aE=al.create(),M=al.create(),ag=al.create();ay.prototype[R.CIRCLE|R.HEIGHTFIELD]=ay.prototype.circleHeightfield=function(aL,aF,aV,a1,aO,aW,a4,aN,aI,aJ){var a5=aW.heights,aJ=aJ||aF.radius,aT=aW.elementWidth,aX=aw,aM=ap,aQ=aE,aK=ag,aP=M,aH=w,aG=u;var aS=Math.floor((aV[0]-aJ-a4[0])/aT),aR=Math.ceil((aV[0]+aJ-a4[0])/aT);if(aS<0){aS=0}if(aR>=a5.length){aR=a5.length-1}var a0=a5[aS],aY=a5[aR];for(var aZ=aS;aZ<aR;aZ++){if(a5[aZ]<aY){aY=a5[aZ]}if(a5[aZ]>a0){a0=a5[aZ]}}if(aV[1]-aJ>a0){return aI?false:0}var aU=false;for(var aZ=aS;aZ<aR;aZ++){al.set(aH,aZ*aT,a5[aZ]);al.set(aG,(aZ+1)*aT,a5[aZ+1]);al.add(aH,aH,a4);al.add(aG,aG,a4);al.sub(aP,aG,aH);al.rotate(aP,aP,Math.PI/2);al.normalize(aP,aP);al.scale(aM,aP,-aJ);al.add(aM,aM,aV);al.sub(aX,aM,aH);var a2=al.dot(aX,aP);if(aM[0]>=aH[0]&&aM[0]<aG[0]&&a2<=0){if(aI){return true}aU=true;al.scale(aX,aP,-a2);al.add(aQ,aM,aX);al.copy(aK,aP);var a3=this.createContactEquation(aO,aL,aW,aF);al.copy(a3.normalA,aK);al.scale(a3.contactPointB,a3.normalA,-aJ);z(a3.contactPointB,a3.contactPointB,aV);ax(a3.contactPointB,a3.contactPointB,aL.position);al.copy(a3.contactPointA,aQ);al.sub(a3.contactPointA,a3.contactPointA,aO.position);this.contactEquations.push(a3);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a3))}}}aU=false;if(aJ>0){for(var aZ=aS;aZ<=aR;aZ++){al.set(aH,aZ*aT,a5[aZ]);al.add(aH,aH,a4);al.sub(aX,aV,aH);if(al.squaredLength(aX)<Math.pow(aJ,2)){if(aI){return true}aU=true;var a3=this.createContactEquation(aO,aL,aW,aF);al.copy(a3.normalA,aX);al.normalize(a3.normalA,a3.normalA);al.scale(a3.contactPointB,a3.normalA,-aJ);z(a3.contactPointB,a3.contactPointB,aV);ax(a3.contactPointB,a3.contactPointB,aL.position);ax(a3.contactPointA,aH,a4);z(a3.contactPointA,a3.contactPointA,a4);ax(a3.contactPointA,a3.contactPointA,aO.position);this.contactEquations.push(a3);if(this.enableFriction){this.frictionEquations.push(this.createFrictionFromContact(a3))}}}}if(aU){return 1}return 0};var aB=al.create(),az=al.create(),ad=al.create(),A=new au({vertices:[al.create(),al.create(),al.create(),al.create()]});ay.prototype[R.BOX|R.HEIGHTFIELD]=ay.prototype[R.CONVEX|R.HEIGHTFIELD]=ay.prototype.convexHeightfield=function(aK,aQ,aJ,aH,aM,aT,aZ,aL,aI){var a0=aT.heights,aR=aT.elementWidth,aG=aB,aF=az,aU=ad,aY=A;var aP=Math.floor((aK.aabb.lowerBound[0]-aZ[0])/aR),aO=Math.ceil((aK.aabb.upperBound[0]-aZ[0])/aR);if(aP<0){aP=0}if(aO>=a0.length){aO=a0.length-1}var aX=a0[aP],aV=a0[aO];for(var aW=aP;aW<aO;aW++){if(a0[aW]<aV){aV=a0[aW]}if(a0[aW]>aX){aX=a0[aW]}}if(aK.aabb.lowerBound[1]>aX){return aI?false:0}var aS=false;var a1=0;for(var aW=aP;aW<aO;aW++){al.set(aG,aW*aR,a0[aW]);al.set(aF,(aW+1)*aR,a0[aW+1]);al.add(aG,aG,aZ);al.add(aF,aF,aZ);var aN=100;al.set(aU,(aF[0]+aG[0])*0.5,(aF[1]+aG[1]-aN)*0.5);al.sub(aY.vertices[0],aF,aU);al.sub(aY.vertices[1],aG,aU);al.copy(aY.vertices[2],aY.vertices[1]);al.copy(aY.vertices[3],aY.vertices[0]);aY.vertices[2][1]-=aN;aY.vertices[3][1]-=aN;a1+=this.convexConvex(aK,aQ,aJ,aH,aM,aY,aU,0,aI)}return a1}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(e,f,l){f.exports=o;var m=e("../math/vec2");var n=e("../collision/RaycastResult");var k=e("../shapes/Shape");var j=e("../collision/AABB");function o(r){r=r||{};this.from=r.from?m.fromValues(r.from[0],r.from[1]):m.create();this.to=r.to?m.fromValues(r.to[0],r.to[1]):m.create();this.checkCollisionResponse=r.checkCollisionResponse!==undefined?r.checkCollisionResponse:true;this.skipBackfaces=!!r.skipBackfaces;this.collisionMask=r.collisionMask!==undefined?r.collisionMask:-1;this.collisionGroup=r.collisionGroup!==undefined?r.collisionGroup:-1;this.mode=r.mode!==undefined?r.mode:o.ANY;this.callback=r.callback||function(s){};this.direction=m.create();this.length=1;this.update()}o.prototype.constructor=o;o.CLOSEST=1;o.ANY=2;o.ALL=4;o.prototype.update=function(){var r=this.direction;m.sub(r,this.to,this.from);this.length=m.length(r);m.normalize(r,r)};o.prototype.intersectBodies=function(s,v){for(var w=0,u=v.length;!s.shouldStop(this)&&w<u;w++){var r=v[w];var t=r.getAABB();if(t.overlapsRay(this)>=0||t.containsPoint(this.from)){this.intersectBody(s,r)}}};var i=m.create();o.prototype.intersectBody=function(s,r){var w=this.checkCollisionResponse;if(w&&!r.collisionResponse){return}var x=i;for(var v=0,y=r.shapes.length;v<y;v++){var t=r.shapes[v];if(w&&!t.collisionResponse){continue}if((this.collisionGroup&t.collisionMask)===0||(t.collisionGroup&this.collisionMask)===0){continue}m.rotate(x,t.position,r.angle);m.add(x,x,r.position);var u=t.angle+r.angle;this.intersectShape(s,t,u,x,r);if(s.shouldStop(this)){break}}};o.prototype.intersectShape=function(t,u,v,s,r){var x=this.from;var w=q(x,this.direction,s);if(w>u.boundingRadius*u.boundingRadius){return}this._currentBody=r;this._currentShape=u;u.raycast(t,this,s,v);this._currentBody=this._currentShape=null};o.prototype.getAABB=function(r){var t=this.to;var s=this.from;m.set(r.lowerBound,Math.min(t[0],s[0]),Math.min(t[1],s[1]));m.set(r.upperBound,Math.max(t[0],s[0]),Math.max(t[1],s[1]))};var h=m.create();o.prototype.reportIntersection=function(s,u,w,v){var y=this.from;var x=this.to;var t=this._currentShape;var r=this._currentBody;if(this.skipBackfaces&&m.dot(w,this.direction)>0){return}switch(this.mode){case o.ALL:s.set(w,t,r,u,v);this.callback(s);break;case o.CLOSEST:if(u<s.fraction||!s.hasHit()){s.set(w,t,r,u,v)}break;case o.ANY:s.set(w,t,r,u,v);break}};var p=m.create(),g=m.create();function q(u,t,r){m.sub(p,r,u);var s=m.dot(p,t);m.scale(g,t,s);m.add(g,g,u);return m.squaredDistance(r,g)}},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(i,g,f){var h=i("../math/vec2");var j=i("../collision/Ray");g.exports=e;function e(){this.normal=h.create();this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false}e.prototype.reset=function(){h.set(this.normal,0,0);this.shape=null;this.body=null;this.faceIndex=-1;this.fraction=-1;this.isStopped=false};e.prototype.getHitDistance=function(k){return h.distance(k.from,k.to)*this.fraction};e.prototype.hasHit=function(){return this.fraction!==-1};e.prototype.getHitPoint=function(l,k){h.lerp(l,k.from,k.to,this.fraction)};e.prototype.stop=function(){this.isStopped=true};e.prototype.shouldStop=function(k){return this.isStopped||(this.fraction!==-1&&k.mode===j.ANY)};e.prototype.set=function(o,l,k,m,n){h.copy(this.normal,o);this.shape=l;this.body=k;this.fraction=m;this.faceIndex=n}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(i,g,f){var j=i("../utils/Utils"),e=i("../collision/Broadphase");g.exports=h;function h(){e.call(this,e.SAP);this.axisList=[];this.axisIndex=0;var k=this;this._addBodyHandler=function(l){k.axisList.push(l.body)};this._removeBodyHandler=function(m){var l=k.axisList.indexOf(m.body);if(l!==-1){k.axisList.splice(l,1)}}}h.prototype=new e();h.prototype.constructor=h;h.prototype.setWorld=function(k){this.axisList.length=0;j.appendArray(this.axisList,k.bodies);k.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);k.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=k};h.sortAxisList=function(m,q){q=q|0;for(var p=1,k=m.length;p<k;p++){var n=m[p];for(var o=p-1;o>=0;o--){if(m[o].aabb.lowerBound[q]<=n.aabb.lowerBound[q]){break}m[o+1]=m[o]}m[o+1]=n}return m};h.prototype.sortList=function(){var k=this.axisList,l=this.axisIndex;h.sortAxisList(k,l)};h.prototype.getCollisionPairs=function(s){var k=this.axisList,w=this.result,v=this.axisIndex;w.length=0;var o=k.length;while(o--){var u=k[o];if(u.aabbNeedsUpdate){u.updateAABB()}}this.sortList();for(var r=0,t=k.length|0;r!==t;r++){var p=k[r];for(var q=r+1;q<t;q++){var n=k[q];var m=(n.aabb.lowerBound[v]<=p.aabb.upperBound[v]);if(!m){break}if(e.canCollide(p,n)&&this.boundingVolumeCheck(p,n)){w.push(p,n)}}}return w};h.prototype.aabbQuery=function(o,n,t){t=t||[];this.sortList();var s=this.axisIndex;var k="x";if(s===1){k="y"}if(s===2){k="z"}var q=this.axisList;var m=n.lowerBound[k];var r=n.upperBound[k];for(var l=0;l<q.length;l++){var p=q[l];if(p.aabbNeedsUpdate){p.updateAABB()}if(p.aabb.overlaps(n)){t.push(p)}}return t}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(h,g,e){g.exports=f;var i=h("../utils/Utils");function f(m,l,k,j){this.type=k;j=i.defaults(j,{collideConnected:true,wakeUpBodies:true});this.equations=[];this.bodyA=m;this.bodyB=l;this.collideConnected=j.collideConnected;if(j.wakeUpBodies){if(m){m.wakeUp()}if(l){l.wakeUp()}}}f.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")};f.DISTANCE=1;f.GEAR=2;f.LOCK=3;f.PRISMATIC=4;f.REVOLUTE=5;f.prototype.setStiffness=function(k){var l=this.equations;for(var m=0;m!==l.length;m++){var j=l[m];j.stiffness=k;j.needsUpdate=true}};f.prototype.setRelaxation=function(m){var k=this.equations;for(var l=0;l!==k.length;l++){var j=k[l];j.relaxation=m;j.needsUpdate=true}}},{"../utils/Utils":57}],15:[function(e,f,h){var p=e("./Constraint"),k=e("../equations/Equation"),i=e("../math/vec2"),j=e("../utils/Utils");f.exports=o;function o(s,q,C){C=j.defaults(C,{localAnchorA:[0,0],localAnchorB:[0,0]});p.call(this,s,q,p.DISTANCE,C);this.localAnchorA=i.fromValues(C.localAnchorA[0],C.localAnchorA[1]);this.localAnchorB=i.fromValues(C.localAnchorB[0],C.localAnchorB[1]);var w=this.localAnchorA;var u=this.localAnchorB;this.distance=0;if(typeof(C.distance)==="number"){this.distance=C.distance}else{var A=i.create(),z=i.create(),n=i.create();i.rotate(A,w,s.angle);i.rotate(z,u,q.angle);i.add(n,q.position,z);i.sub(n,n,A);i.sub(n,n,s.position);this.distance=i.length(n)}var B;if(typeof(C.maxForce)==="undefined"){B=Number.MAX_VALUE}else{B=C.maxForce}var v=new k(s,q,-B,B);this.equations=[v];this.maxForce=B;var n=i.create();var y=i.create();var x=i.create();var t=this;v.computeGq=function(){var F=this.bodyA,E=this.bodyB,D=F.position,r=E.position;i.rotate(y,w,F.angle);i.rotate(x,u,E.angle);i.add(n,r,x);i.sub(n,n,y);i.sub(n,n,D);return i.length(n)-t.distance};this.setMaxForce(B);this.upperLimitEnabled=false;this.upperLimit=1;this.lowerLimitEnabled=false;this.lowerLimit=0;this.position=0}o.prototype=new p();o.prototype.constructor=o;var g=i.create();var m=i.create();var l=i.create();o.prototype.update=function(){var u=this.equations[0],s=this.bodyA,r=this.bodyB,n=this.distance,w=s.position,v=r.position,q=this.equations[0],y=u.G;i.rotate(m,this.localAnchorA,s.angle);i.rotate(l,this.localAnchorB,r.angle);i.add(g,v,l);i.sub(g,g,m);i.sub(g,g,w);this.position=i.length(g);var z=false;if(this.upperLimitEnabled){if(this.position>this.upperLimit){q.maxForce=0;q.minForce=-this.maxForce;this.distance=this.upperLimit;z=true}}if(this.lowerLimitEnabled){if(this.position<this.lowerLimit){q.maxForce=this.maxForce;q.minForce=0;this.distance=this.lowerLimit;z=true}}if((this.lowerLimitEnabled||this.upperLimitEnabled)&&!z){q.enabled=false;return}q.enabled=true;i.normalize(g,g);var t=i.crossLength(m,g),x=i.crossLength(l,g);y[0]=-g[0];y[1]=-g[1];y[2]=-t;y[3]=g[0];y[4]=g[1];y[5]=x};o.prototype.setMaxForce=function(q){var n=this.equations[0];n.minForce=-q;n.maxForce=q};o.prototype.getMaxForce=function(){var n=this.equations[0];return n.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(k,g,e){var f=k("./Constraint"),i=k("../equations/Equation"),j=k("../equations/AngleLockEquation"),h=k("../math/vec2");g.exports=l;function l(o,n,m){m=m||{};f.call(this,o,n,f.GEAR,m);this.ratio=m.ratio!==undefined?m.ratio:1;this.angle=m.angle!==undefined?m.angle:n.angle-this.ratio*o.angle;m.angle=this.angle;m.ratio=this.ratio;this.equations=[new j(o,n,m)];if(m.maxTorque!==undefined){this.setMaxTorque(m.maxTorque)}}l.prototype=new f();l.prototype.constructor=l;l.prototype.update=function(){var m=this.equations[0];if(m.ratio!==this.ratio){m.setRatio(this.ratio)}m.angle=this.angle};l.prototype.setMaxTorque=function(m){this.equations[0].setMaxTorque(m)};l.prototype.getMaxTorque=function(m){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(h,i,k){var q=h("./Constraint"),m=h("../math/vec2"),n=h("../equations/Equation");i.exports=o;function o(A,w,H){H=H||{};q.call(this,A,w,q.LOCK,H);var F=(typeof(H.maxForce)==="undefined"?Number.MAX_VALUE:H.maxForce);var z=H.localAngleB||0;var E=new n(A,w,-F,F),D=new n(A,w,-F,F),u=new n(A,w,-F,F);var v=m.create(),B=m.create(),C=this;E.computeGq=function(){m.rotate(v,C.localOffsetB,A.angle);m.sub(B,w.position,A.position);m.sub(B,B,v);return B[0]};D.computeGq=function(){m.rotate(v,C.localOffsetB,A.angle);m.sub(B,w.position,A.position);m.sub(B,B,v);return B[1]};var s=m.create(),G=m.create();u.computeGq=function(){m.rotate(s,C.localOffsetB,w.angle-C.localAngleB);m.scale(s,s,-1);m.sub(B,A.position,w.position);m.add(B,B,s);m.rotate(G,s,-Math.PI/2);m.normalize(G,G);return m.dot(B,G)};this.localOffsetB=m.create();if(H.localOffsetB){m.copy(this.localOffsetB,H.localOffsetB)}else{m.sub(this.localOffsetB,w.position,A.position);m.rotate(this.localOffsetB,this.localOffsetB,-A.angle)}this.localAngleB=0;if(typeof(H.localAngleB)==="number"){this.localAngleB=H.localAngleB}else{this.localAngleB=w.angle-A.angle}this.equations.push(E,D,u);this.setMaxForce(F)}o.prototype=new q();o.prototype.constructor=o;o.prototype.setMaxForce=function(s){var l=this.equations;for(var r=0;r<this.equations.length;r++){l[r].maxForce=s;l[r].minForce=-s}};o.prototype.getMaxForce=function(){return this.equations[0].maxForce};var j=m.create();var e=m.create();var p=m.create();var g=m.fromValues(1,0);var f=m.fromValues(0,1);o.prototype.update=function(){var l=this.equations[0],u=this.equations[1],r=this.equations[2],t=this.bodyA,s=this.bodyB;m.rotate(j,this.localOffsetB,t.angle);m.rotate(e,this.localOffsetB,s.angle-this.localAngleB);m.scale(e,e,-1);m.rotate(p,e,Math.PI/2);m.normalize(p,p);l.G[0]=-1;l.G[1]=0;l.G[2]=-m.crossLength(j,g);l.G[3]=1;u.G[0]=0;u.G[1]=-1;u.G[2]=-m.crossLength(j,f);u.G[4]=1;r.G[0]=-p[0];r.G[1]=-p[1];r.G[3]=p[0];r.G[4]=p[1];r.G[5]=m.crossLength(e,p)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(g,h,k){var s=g("./Constraint"),m=g("../equations/ContactEquation"),o=g("../equations/Equation"),n=g("../math/vec2"),e=g("../equations/RotationalLockEquation");h.exports=j;function j(x,w,J){J=J||{};s.call(this,x,w,s.PRISMATIC,J);var C=n.fromValues(0,0),y=n.fromValues(1,0),B=n.fromValues(0,0);if(J.localAnchorA){n.copy(C,J.localAnchorA)}if(J.localAxisA){n.copy(y,J.localAxisA)}if(J.localAnchorB){n.copy(B,J.localAnchorB)}this.localAnchorA=C;this.localAnchorB=B;this.localAxisA=y;var G=this.maxForce=typeof(J.maxForce)!=="undefined"?J.maxForce:Number.MAX_VALUE;var I=new o(x,w,-G,G);var F=new n.create(),E=new n.create(),D=new n.create(),H=new n.create();I.computeGq=function(){return n.dot(D,H)};I.updateJacobian=function(){var L=this.G,K=x.position,t=w.position;n.rotate(F,C,x.angle);n.rotate(E,B,w.angle);n.add(D,t,E);n.sub(D,D,K);n.sub(D,D,F);n.rotate(H,y,x.angle+Math.PI/2);L[0]=-H[0];L[1]=-H[1];L[2]=-n.crossLength(F,H)+n.crossLength(H,D);L[3]=H[0];L[4]=H[1];L[5]=n.crossLength(E,H)};this.equations.push(I);if(!J.disableRotationalLock){var u=new e(x,w,-G,G);this.equations.push(u)}this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof(J.lowerLimit)!=="undefined"?true:false;this.upperLimitEnabled=typeof(J.upperLimit)!=="undefined"?true:false;this.lowerLimit=typeof(J.lowerLimit)!=="undefined"?J.lowerLimit:0;this.upperLimit=typeof(J.upperLimit)!=="undefined"?J.upperLimit:1;this.upperLimitEquation=new m(x,w);this.lowerLimitEquation=new m(x,w);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=G;this.motorEquation=new o(x,w);this.motorEnabled=false;this.motorSpeed=0;var A=this;var z=this.motorEquation;var v=z.computeGW;z.computeGq=function(){return 0};z.computeGW=function(){var M=this.G,L=this.bodyA,K=this.bodyB,O=L.velocity,N=K.velocity,t=L.angularVelocity,P=K.angularVelocity;return this.gmult(M,O,t,N,P)+A.motorSpeed}}j.prototype=new s();j.prototype.constructor=j;var r=n.create(),q=n.create(),p=n.create(),i=n.create(),f=n.create(),l=n.create();j.prototype.update=function(){var B=this.equations,H=B[0],w=this.upperLimit,E=this.lowerLimit,F=this.upperLimitEquation,A=this.lowerLimitEquation,u=this.bodyA,t=this.bodyB,v=this.localAxisA,z=this.localAnchorA,y=this.localAnchorB;H.updateJacobian();n.rotate(r,v,u.angle);n.rotate(i,z,u.angle);n.add(q,i,u.position);n.rotate(f,y,t.angle);n.add(p,f,t.position);var x=this.position=n.dot(p,r)-n.dot(q,r);if(this.motorEnabled){var D=this.motorEquation.G;D[0]=r[0];D[1]=r[1];D[2]=n.crossLength(r,f);D[3]=-r[0];D[4]=-r[1];D[5]=-n.crossLength(r,i)}if(this.upperLimitEnabled&&x>w){n.scale(F.normalA,r,-1);n.sub(F.contactPointA,q,u.position);n.sub(F.contactPointB,p,t.position);n.scale(l,r,w);n.add(F.contactPointA,F.contactPointA,l);if(B.indexOf(F)===-1){B.push(F)}}else{var C=B.indexOf(F);if(C!==-1){B.splice(C,1)}}if(this.lowerLimitEnabled&&x<E){n.scale(A.normalA,r,1);n.sub(A.contactPointA,q,u.position);n.sub(A.contactPointB,p,t.position);n.scale(l,r,E);n.sub(A.contactPointB,A.contactPointB,l);if(B.indexOf(A)===-1){B.push(A)}}else{var C=B.indexOf(A);if(C!==-1){B.splice(C,1)}}};j.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};j.prototype.disableMotor=function(){if(!this.motorEnabled){return}var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1);this.motorEnabled=false};j.prototype.setLimits=function(t,u){if(typeof(t)==="number"){this.lowerLimit=t;this.lowerLimitEnabled=true}else{this.lowerLimit=t;this.lowerLimitEnabled=false}if(typeof(u)==="number"){this.upperLimit=u;this.upperLimitEnabled=true}else{this.upperLimit=u;this.upperLimitEnabled=false}}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(j,k,n){var s=j("./Constraint"),q=j("../equations/Equation"),r=j("../equations/RotationalVelocityEquation"),f=j("../equations/RotationalLockEquation"),p=j("../math/vec2");k.exports=m;var l=p.create(),i=p.create(),h=p.fromValues(1,0),e=p.fromValues(0,1),o=p.create();function m(A,z,u){u=u||{};s.call(this,A,z,s.REVOLUTE,u);var w=this.maxForce=typeof(u.maxForce)!=="undefined"?u.maxForce:Number.MAX_VALUE;this.pivotA=p.create();this.pivotB=p.create();if(u.worldPivot){p.sub(this.pivotA,u.worldPivot,A.position);p.sub(this.pivotB,u.worldPivot,z.position);p.rotate(this.pivotA,this.pivotA,-A.angle);p.rotate(this.pivotB,this.pivotB,-z.angle)}else{p.copy(this.pivotA,u.localPivotA);p.copy(this.pivotB,u.localPivotB)}var t=this.equations=[new q(A,z,-w,w),new q(A,z,-w,w)];var g=t[0];var B=t[1];var v=this;g.computeGq=function(){p.rotate(l,v.pivotA,A.angle);p.rotate(i,v.pivotB,z.angle);p.add(o,z.position,i);p.sub(o,o,A.position);p.sub(o,o,l);return p.dot(o,h)};B.computeGq=function(){p.rotate(l,v.pivotA,A.angle);p.rotate(i,v.pivotB,z.angle);p.add(o,z.position,i);p.sub(o,o,A.position);p.sub(o,o,l);return p.dot(o,e)};B.minForce=g.minForce=-w;B.maxForce=g.maxForce=w;this.motorEquation=new r(A,z);this.motorEnabled=false;this.angle=0;this.lowerLimitEnabled=false;this.upperLimitEnabled=false;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new f(A,z);this.lowerLimitEquation=new f(A,z);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}m.prototype=new s();m.prototype.constructor=m;m.prototype.setLimits=function(g,t){if(typeof(g)==="number"){this.lowerLimit=g;this.lowerLimitEnabled=true}else{this.lowerLimit=g;this.lowerLimitEnabled=false}if(typeof(t)==="number"){this.upperLimit=t;this.upperLimitEnabled=true}else{this.upperLimit=t;this.upperLimitEnabled=false}};m.prototype.update=function(){var t=this.bodyA,g=this.bodyB,w=this.pivotA,u=this.pivotB,C=this.equations,A=C[0],H=C[1],E=C[0],D=C[1],v=this.upperLimit,G=this.lowerLimit,I=this.upperLimitEquation,B=this.lowerLimitEquation;var z=this.angle=g.angle-t.angle;if(this.upperLimitEnabled&&z>v){I.angle=v;if(C.indexOf(I)===-1){C.push(I)}}else{var F=C.indexOf(I);if(F!==-1){C.splice(F,1)}}if(this.lowerLimitEnabled&&z<G){B.angle=G;if(C.indexOf(B)===-1){C.push(B)}}else{var F=C.indexOf(B);if(F!==-1){C.splice(F,1)}}p.rotate(l,w,t.angle);p.rotate(i,u,g.angle);E.G[0]=-1;E.G[1]=0;E.G[2]=-p.crossLength(l,h);E.G[3]=1;E.G[4]=0;E.G[5]=p.crossLength(i,h);D.G[0]=0;D.G[1]=-1;D.G[2]=-p.crossLength(l,e);D.G[3]=0;D.G[4]=1;D.G[5]=p.crossLength(i,e)};m.prototype.enableMotor=function(){if(this.motorEnabled){return}this.equations.push(this.motorEquation);this.motorEnabled=true};m.prototype.disableMotor=function(){if(!this.motorEnabled){return}var g=this.equations.indexOf(this.motorEquation);this.equations.splice(g,1);this.motorEnabled=false};m.prototype.motorIsEnabled=function(){return !!this.motorEnabled};m.prototype.setMotorSpeed=function(t){if(!this.motorEnabled){return}var g=this.equations.indexOf(this.motorEquation);this.equations[g].relativeVelocity=t};m.prototype.getMotorSpeed=function(){if(!this.motorEnabled){return false}return this.motorEquation.relativeVelocity}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(j,f,e){var h=j("./Equation"),g=j("../math/vec2");f.exports=i;function i(m,l,k){k=k||{};h.call(this,m,l,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=k.angle||0;this.ratio=typeof(k.ratio)==="number"?k.ratio:1;this.setRatio(this.ratio)}i.prototype=new h();i.prototype.constructor=i;i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};i.prototype.setRatio=function(l){var k=this.G;k[2]=l;k[5]=-1;this.ratio=l};i.prototype.setMaxTorque=function(k){this.maxForce=k;this.minForce=-k}},{"../math/vec2":30,"./Equation":22}],21:[function(j,g,f){var i=j("./Equation"),h=j("../math/vec2");g.exports=e;function e(l,k){i.call(this,l,k,0,Number.MAX_VALUE);this.contactPointA=h.create();this.penetrationVec=h.create();this.contactPointB=h.create();this.normalA=h.create();this.restitution=0;this.firstImpact=false;this.shapeA=null;this.shapeB=null}e.prototype=new i();e.prototype.constructor=e;e.prototype.computeB=function(D,C,z){var m=this.bodyA,k=this.bodyB,r=this.contactPointA,q=this.contactPointB,v=m.position,u=k.position;var A=this.penetrationVec,w=this.normalA,p=this.G;var s=h.crossLength(r,w),l=h.crossLength(q,w);p[0]=-w[0];p[1]=-w[1];p[2]=-s;p[3]=w[0];p[4]=w[1];p[5]=l;h.add(A,u,q);h.sub(A,A,v);h.sub(A,A,r);var o,y;if(this.firstImpact&&this.restitution!==0){y=0;o=(1/C)*(1+this.restitution)*this.computeGW()}else{y=h.dot(w,A)+this.offset;o=this.computeGW()}var x=this.computeGiMf();var t=-y*D-o*C-z*x;return t}},{"../math/vec2":30,"./Equation":22}],22:[function(i,j,m){j.exports=p;var n=i("../math/vec2"),o=i("../utils/Utils"),q=i("../objects/Body");function p(z,y,w,x){this.minForce=typeof(w)==="undefined"?-Number.MAX_VALUE:w;this.maxForce=typeof(x)==="undefined"?Number.MAX_VALUE:x;this.bodyA=z;this.bodyB=y;this.stiffness=p.DEFAULT_STIFFNESS;this.relaxation=p.DEFAULT_RELAXATION;this.G=new o.ARRAY_TYPE(6);for(var v=0;v<6;v++){this.G[v]=0}this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=true;this.multiplier=0;this.relativeVelocity=0;this.enabled=true}p.prototype.constructor=p;p.DEFAULT_STIFFNESS=1000000;p.DEFAULT_RELAXATION=4;p.prototype.update=function(){var v=this.stiffness,x=this.relaxation,w=this.timeStep;this.a=4/(w*(1+4*x));this.b=(4*x)/(1+4*x);this.epsilon=4/(w*w*v*(1+4*x));this.needsUpdate=false};p.prototype.gmult=function(w,y,v,x,z){return w[0]*y[0]+w[1]*y[1]+w[2]*v+w[3]*x[0]+w[4]*x[1]+w[5]*z};p.prototype.computeB=function(x,v,y){var A=this.computeGW();var z=this.computeGq();var w=this.computeGiMf();return -z*x-A*v-w*y};var h=n.create(),g=n.create();p.prototype.computeGq=function(){var A=this.G,z=this.bodyA,x=this.bodyB,y=z.position,w=x.position,v=z.angle,B=x.angle;return this.gmult(A,h,v,g,B)+this.offset};p.prototype.computeGW=function(){var y=this.G,x=this.bodyA,w=this.bodyB,A=x.velocity,z=w.velocity,v=x.angularVelocity,B=w.angularVelocity;return this.gmult(y,A,v,z,B)+this.relativeVelocity};p.prototype.computeGWlambda=function(){var y=this.G,x=this.bodyA,w=this.bodyB,A=x.vlambda,z=w.vlambda,v=x.wlambda,B=w.wlambda;return this.gmult(y,A,v,z,B)};var l=n.create(),k=n.create();p.prototype.computeGiMf=function(){var y=this.bodyA,x=this.bodyB,F=y.force,w=y.angularForce,E=x.force,v=x.angularForce,A=y.invMassSolve,z=x.invMassSolve,C=y.invInertiaSolve,B=x.invInertiaSolve,D=this.G;n.scale(l,F,A);n.multiply(l,y.massMultiplier,l);n.scale(k,E,z);n.multiply(k,x.massMultiplier,k);return this.gmult(D,l,w*C,k,v*B)};p.prototype.computeGiMGt=function(){var z=this.bodyA,x=this.bodyB,y=z.invMassSolve,w=x.invMassSolve,v=z.invInertiaSolve,B=x.invInertiaSolve,A=this.G;return A[0]*A[0]*y*z.massMultiplier[0]+A[1]*A[1]*y*z.massMultiplier[1]+A[2]*A[2]*v+A[3]*A[3]*w*x.massMultiplier[0]+A[4]*A[4]*w*x.massMultiplier[1]+A[5]*A[5]*B};var r=n.create(),u=n.create(),s=n.create(),e=n.create(),t=n.create(),f=n.create();p.prototype.addToWlambda=function(v){var x=this.bodyA,w=this.bodyB,J=r,B=u,A=s,D=e,C=t,z=x.invMassSolve,y=w.invMassSolve,H=x.invInertiaSolve,F=w.invInertiaSolve,E=f,I=this.G;B[0]=I[0];B[1]=I[1];A[0]=I[3];A[1]=I[4];n.scale(J,B,z*v);n.multiply(J,J,x.massMultiplier);n.add(x.vlambda,x.vlambda,J);x.wlambda+=H*I[2]*v;n.scale(J,A,y*v);n.multiply(J,J,w.massMultiplier);n.add(w.vlambda,w.vlambda,J);w.wlambda+=F*I[5]*v};p.prototype.computeInvC=function(v){return 1/(this.computeGiMGt()+v)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(j,g,e){var i=j("../math/vec2"),h=j("./Equation"),k=j("../utils/Utils");g.exports=f;function f(n,m,l){h.call(this,n,m,-l,l);this.contactPointA=i.create();this.contactPointB=i.create();this.t=i.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=0.3}f.prototype=new h();f.prototype.constructor=f;f.prototype.setSlipForce=function(l){this.maxForce=l;this.minForce=-l};f.prototype.getSlipForce=function(){return this.maxForce};f.prototype.computeB=function(u,r,p){var o=this.bodyA,n=this.bodyB,v=this.contactPointA,s=this.contactPointB,x=this.t,w=this.G;w[0]=-x[0];w[1]=-x[1];w[2]=-i.crossLength(v,x);w[3]=x[0];w[4]=x[1];w[5]=i.crossLength(s,x);var q=this.computeGW(),l=this.computeGiMf();var m=-q*r-p*l;return m}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(h,i,k){var n=h("./Equation"),m=h("../math/vec2");i.exports=f;function f(r,q,o){o=o||{};n.call(this,r,q,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=o.angle||0;var p=this.G;p[2]=1;p[5]=-1}f.prototype=new n();f.prototype.constructor=f;var l=m.create(),j=m.create(),g=m.fromValues(1,0),e=m.fromValues(0,1);f.prototype.computeGq=function(){m.rotate(l,g,this.bodyA.angle+this.angle);m.rotate(j,e,this.bodyB.angle);return m.dot(l,j)}},{"../math/vec2":30,"./Equation":22}],25:[function(j,f,e){var h=j("./Equation"),g=j("../math/vec2");f.exports=i;function i(l,k){h.call(this,l,k,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}i.prototype=new h();i.prototype.constructor=i;i.prototype.computeB=function(m,k,o){var n=this.G;n[2]=-1;n[5]=this.ratio;var l=this.computeGiMf();var q=this.computeGW();var p=-q*k-o*l;return p}},{"../math/vec2":30,"./Equation":22}],26:[function(h,f,e){var g=function(){};f.exports=g;g.prototype={constructor:g,on:function(k,l,i){l.context=i||this;if(this._listeners===undefined){this._listeners={}}var j=this._listeners;if(j[k]===undefined){j[k]=[]}if(j[k].indexOf(l)===-1){j[k].push(l)}return this},has:function(j,k){if(this._listeners===undefined){return false}var i=this._listeners;if(k){if(i[j]!==undefined&&i[j].indexOf(k)!==-1){return true}}else{if(i[j]!==undefined){return true}}return false},off:function(k,l){if(this._listeners===undefined){return this}var j=this._listeners;var i=j[k].indexOf(l);if(i!==-1){j[k].splice(i,1)}return this},emit:function(o){if(this._listeners===undefined){return this}var n=this._listeners;var j=n[o.type];if(j!==undefined){o.target=this;for(var m=0,k=j.length;m<k;m++){var p=j[m];p.call(p.context,o)}}return this}}},{}],27:[function(j,g,f){var i=j("./Material");var h=j("../equations/Equation");g.exports=e;function e(m,l,k){k=k||{};if(!(m instanceof i)||!(l instanceof i)){throw new Error("First two arguments must be Material instances.")}this.id=e.idCounter++;this.materialA=m;this.materialB=l;this.friction=typeof(k.friction)!=="undefined"?Number(k.friction):0.3;this.restitution=typeof(k.restitution)!=="undefined"?Number(k.restitution):0;this.stiffness=typeof(k.stiffness)!=="undefined"?Number(k.stiffness):h.DEFAULT_STIFFNESS;this.relaxation=typeof(k.relaxation)!=="undefined"?Number(k.relaxation):h.DEFAULT_RELAXATION;this.frictionStiffness=typeof(k.frictionStiffness)!=="undefined"?Number(k.frictionStiffness):h.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof(k.frictionRelaxation)!=="undefined"?Number(k.frictionRelaxation):h.DEFAULT_RELAXATION;this.surfaceVelocity=typeof(k.surfaceVelocity)!=="undefined"?Number(k.surfaceVelocity):0;this.contactSkinSize=0.005}e.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(h,f,e){f.exports=g;function g(i){this.id=i||g.idCounter++}g.idCounter=0},{}],29:[function(h,g,f){var e={};e.GetArea=function(n){if(n.length<6){return 0}var j=n.length-2;var m=0;for(var k=0;k<j;k+=2){m+=(n[k+2]-n[k])*(n[k+1]+n[k+3])}m+=(n[0]-n[j])*(n[j+1]+n[1]);return -m*0.5};e.Triangulate=function(s){var t=s.length>>1;if(t<3){return[]}var B=[];var r=[];for(var z=0;z<t;z++){r.push(z)}var z=0;var w=t;while(w>3){var x=r[(z+0)%w];var v=r[(z+1)%w];var u=r[(z+2)%w];var q=s[2*x],m=s[2*x+1];var C=s[2*v],A=s[2*v+1];var l=s[2*u],k=s[2*u+1];var o=false;if(e._convex(q,m,C,A,l,k)){o=true;for(var y=0;y<w;y++){var D=r[y];if(D==x||D==v||D==u){continue}if(e._PointInTriangle(s[2*D],s[2*D+1],q,m,C,A,l,k)){o=false;break}}}if(o){B.push(x,v,u);r.splice((z+1)%w,1);w--;z=0}else{if(z++>3*w){break}}}B.push(r[0],r[1],r[2]);return B};e._PointInTriangle=function(y,x,s,r,F,E,o,m){var l=o-s;var k=m-r;var q=F-s;var p=E-r;var D=y-s;var B=x-r;var C=l*l+k*k;var A=l*q+k*p;var z=l*D+k*B;var j=q*q+p*p;var i=q*D+p*B;var n=1/(C*j-A*A);var w=(j*z-A*i)*n;var t=(C*i-A*z)*n;return(w>=0)&&(t>=0)&&(w+t<1)};e._convex=function(k,j,m,l,i,n){return(j-l)*(i-m)+(m-k)*(n-l)>=0};g.exports=e},{}],30:[function(h,f,e){var g=f.exports={};var i=h("../utils/Utils");g.crossLength=function(k,j){return k[0]*j[1]-k[1]*j[0]};g.crossVZ=function(j,k,l){g.rotate(j,k,-Math.PI/2);g.scale(j,j,l);return j};g.crossZV=function(j,l,k){g.rotate(j,k,Math.PI/2);g.scale(j,j,l);return j};g.rotate=function(l,k,n){if(n!==0){var p=Math.cos(n),m=Math.sin(n),j=k[0],o=k[1];l[0]=p*j-m*o;l[1]=m*j+p*o}else{l[0]=k[0];l[1]=k[1]}};g.rotate90cw=function(l,k){var j=k[0];var m=k[1];l[0]=m;l[1]=-j};g.toLocalFrame=function(j,m,k,l){g.copy(j,m);g.sub(j,j,k);g.rotate(j,j,-l)};g.toGlobalFrame=function(j,m,k,l){g.copy(j,m);g.rotate(j,j,l);g.add(j,j,k)};g.vectorToLocalFrame=function(k,j,l){g.rotate(k,j,-l)};g.vectorToGlobalFrame=function(k,j,l){g.rotate(k,j,l)};g.centroid=function(l,k,j,m){g.add(l,k,j);g.add(l,l,m);g.scale(l,l,1/3);return l};g.create=function(){var j=new i.ARRAY_TYPE(2);j[0]=0;j[1]=0;return j};g.clone=function(j){var k=new i.ARRAY_TYPE(2);k[0]=j[0];k[1]=j[1];return k};g.fromValues=function(j,l){var k=new i.ARRAY_TYPE(2);k[0]=j;k[1]=l;return k};g.copy=function(k,j){k[0]=j[0];k[1]=j[1];return k};g.set=function(k,j,l){k[0]=j;k[1]=l;return k};g.add=function(l,k,j){l[0]=k[0]+j[0];l[1]=k[1]+j[1];return l};g.subtract=function(l,k,j){l[0]=k[0]-j[0];l[1]=k[1]-j[1];return l};g.sub=g.subtract;g.multiply=function(l,k,j){l[0]=k[0]*j[0];l[1]=k[1]*j[1];return l};g.mul=g.multiply;g.divide=function(l,k,j){l[0]=k[0]/j[0];l[1]=k[1]/j[1];return l};g.div=g.divide;g.scale=function(l,k,j){l[0]=k[0]*j;l[1]=k[1]*j;return l};g.distance=function(l,k){var j=k[0]-l[0],m=k[1]-l[1];return Math.sqrt(j*j+m*m)};g.dist=g.distance;g.squaredDistance=function(l,k){var j=k[0]-l[0],m=k[1]-l[1];return j*j+m*m};g.sqrDist=g.squaredDistance;g.length=function(k){var j=k[0],l=k[1];return Math.sqrt(j*j+l*l)};g.len=g.length;g.squaredLength=function(k){var j=k[0],l=k[1];return j*j+l*l};g.sqrLen=g.squaredLength;g.negate=function(k,j){k[0]=-j[0];k[1]=-j[1];return k};g.normalize=function(m,l){var k=l[0],n=l[1];var j=k*k+n*n;if(j>0){j=1/Math.sqrt(j);m[0]=l[0]*j;m[1]=l[1]*j}return m};g.dot=function(k,j){return k[0]*j[0]+k[1]*j[1]};g.str=function(j){return"vec2("+j[0]+", "+j[1]+")"};g.lerp=function(l,k,j,m){var o=k[0],n=k[1];l[0]=o+m*(j[0]-o);l[1]=n+m*(j[1]-n);return l};g.reflect=function(l,j,m){var k=j[0]*m[0]+j[1]*m[1];l[0]=j[0]-2*m[0]*k;l[1]=j[1]-2*m[1]*k};g.getLineSegmentsIntersection=function(j,o,n,m,l){var k=g.getLineSegmentsIntersectionFraction(o,n,m,l);if(k<0){return false}else{j[0]=o[0]+(k*(n[0]-o[0]));j[1]=o[1]+(k*(n[1]-o[1]));return true}};g.getLineSegmentsIntersectionFraction=function(r,p,o,n){var k=p[0]-r[0];var j=p[1]-r[1];var m=n[0]-o[0];var l=n[1]-o[1];var u,q;u=(-j*(r[0]-o[0])+k*(r[1]-o[1]))/(-m*j+k*l);q=(m*(r[1]-o[1])-l*(r[0]-o[0]))/(-m*j+k*l);if(u>=0&&u<=1&&q>=0&&q<=1){return q}return -1}},{"../utils/Utils":57}],31:[function(l,h,K){var g=l("../math/vec2"),t=l("poly-decomp"),x=l("../shapes/Convex"),G=l("../collision/RaycastResult"),F=l("../collision/Ray"),B=l("../collision/AABB"),r=l("../events/EventEmitter");h.exports=A;function A(L){L=L||{};r.call(this);this.id=L.id||++A._idCounter;this.world=null;this.shapes=[];this.mass=L.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!L.fixedRotation;this.fixedX=!!L.fixedX;this.fixedY=!!L.fixedY;this.massMultiplier=g.create();this.position=g.fromValues(0,0);if(L.position){g.copy(this.position,L.position)}this.interpolatedPosition=g.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=g.fromValues(0,0);this.previousAngle=0;this.velocity=g.fromValues(0,0);if(L.velocity){g.copy(this.velocity,L.velocity)}this.vlambda=g.fromValues(0,0);this.wlambda=0;this.angle=L.angle||0;this.angularVelocity=L.angularVelocity||0;this.force=g.create();if(L.force){g.copy(this.force,L.force)}this.angularForce=L.angularForce||0;this.damping=typeof(L.damping)==="number"?L.damping:0.1;this.angularDamping=typeof(L.angularDamping)==="number"?L.angularDamping:0.1;this.type=A.STATIC;if(typeof(L.type)!=="undefined"){this.type=L.type}else{if(!L.mass){this.type=A.STATIC}else{this.type=A.DYNAMIC}}this.boundingRadius=0;this.aabb=new B();this.aabbNeedsUpdate=true;this.allowSleep=L.allowSleep!==undefined?L.allowSleep:true;this.wantsToSleep=false;this.sleepState=A.AWAKE;this.sleepSpeedLimit=L.sleepSpeedLimit!==undefined?L.sleepSpeedLimit:0.2;this.sleepTimeLimit=L.sleepTimeLimit!==undefined?L.sleepTimeLimit:1;this.gravityScale=L.gravityScale!==undefined?L.gravityScale:1;this.collisionResponse=L.collisionResponse!==undefined?L.collisionResponse:true;this.idleTime=0;this.timeLastSleepy=0;this.ccdSpeedThreshold=L.ccdSpeedThreshold!==undefined?L.ccdSpeedThreshold:-1;this.ccdIterations=L.ccdIterations!==undefined?L.ccdIterations:10;this.concavePath=null;this._wakeUpAfterNarrowphase=false;this.updateMassProperties()}A.prototype=new r();A.prototype.constructor=A;A._idCounter=0;A.prototype.updateSolveMassProperties=function(){if(this.sleepState===A.SLEEPING||this.type===A.KINEMATIC){this.invMassSolve=0;this.invInertiaSolve=0}else{this.invMassSolve=this.invMass;this.invInertiaSolve=this.invInertia}};A.prototype.setDensity=function(L){var M=this.getArea();this.mass=M*L;this.updateMassProperties()};A.prototype.getArea=function(){var L=0;for(var M=0;M<this.shapes.length;M++){L+=this.shapes[M].area}return L};A.prototype.getAABB=function(){if(this.aabbNeedsUpdate){this.updateAABB()}return this.aabb};var m=new B(),I=g.create();A.prototype.updateAABB=function(){var L=this.shapes,S=L.length,R=I,P=this.angle;for(var O=0;O!==S;O++){var M=L[O],Q=M.angle+P;g.rotate(R,M.position,P);g.add(R,R,this.position);M.computeAABB(m,R,Q);if(O===0){this.aabb.copy(m)}else{this.aabb.extend(m)}}this.aabbNeedsUpdate=false};A.prototype.updateBoundingRadius=function(){var M=this.shapes,S=M.length,L=0;for(var P=0;P!==S;P++){var O=M[P],R=g.length(O.position),Q=O.boundingRadius;if(R+Q>L){L=R+Q}}this.boundingRadius=L};A.prototype.addShape=function(L,N,M){if(L.body){throw new Error("A shape can only be added to one body.")}L.body=this;if(N){g.copy(L.position,N)}else{g.set(L.position,0,0)}L.angle=M||0;this.shapes.push(L);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=true};A.prototype.removeShape=function(M){var L=this.shapes.indexOf(M);if(L!==-1){this.shapes.splice(L,1);this.aabbNeedsUpdate=true;M.body=null;return true}else{return false}};A.prototype.updateMassProperties=function(){if(this.type===A.STATIC||this.type===A.KINEMATIC){this.mass=Number.MAX_VALUE;this.invMass=0;this.inertia=Number.MAX_VALUE;this.invInertia=0}else{var O=this.shapes,T=O.length,L=this.mass/T,Q=0;if(!this.fixedRotation){for(var R=0;R<T;R++){var P=O[R],M=g.squaredLength(P.position),S=P.computeMomentOfInertia(L);Q+=S+L*M}this.inertia=Q;this.invInertia=Q>0?1/Q:0}else{this.inertia=Number.MAX_VALUE;this.invInertia=0}this.invMass=1/this.mass;g.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};var y=g.create();A.prototype.applyForce=function(N,M){g.add(this.force,this.force,N);if(M){var L=g.crossLength(M,N);this.angularForce+=L}};var s=g.create();var D=g.create();var C=g.create();A.prototype.applyForceLocal=function(M,O){O=O||C;var L=s;var N=D;this.vectorToWorldFrame(L,M);this.vectorToWorldFrame(N,O);this.applyForce(L,N)};var k=g.create();A.prototype.applyImpulse=function(O,L){if(this.type!==A.DYNAMIC){return}var M=k;g.scale(M,O,this.invMass);g.multiply(M,this.massMultiplier,M);g.add(this.velocity,M,this.velocity);if(L){var N=g.crossLength(L,O);N*=this.invInertia;this.angularVelocity+=N}};var E=g.create();var f=g.create();var e=g.create();A.prototype.applyImpulseLocal=function(M,O){O=O||e;var L=E;var N=f;this.vectorToWorldFrame(L,M);this.vectorToWorldFrame(N,O);this.applyImpulse(L,N)};A.prototype.toLocalFrame=function(L,M){g.toLocalFrame(L,M,this.position,this.angle)};A.prototype.toWorldFrame=function(L,M){g.toGlobalFrame(L,M,this.position,this.angle)};A.prototype.vectorToLocalFrame=function(M,L){g.vectorToLocalFrame(M,L,this.angle)};A.prototype.vectorToWorldFrame=function(M,L){g.vectorToGlobalFrame(M,L,this.angle)};A.prototype.fromPolygon=function(S,T){T=T||{};for(var N=this.shapes.length;N>=0;--N){this.removeShape(this.shapes[N])}var L=new t.Polygon();L.vertices=S;L.makeCCW();if(typeof(T.removeCollinearPoints)==="number"){L.removeCollinearPoints(T.removeCollinearPoints)}if(typeof(T.skipSimpleCheck)==="undefined"){if(!L.isSimple()){return false}}this.concavePath=L.vertices.slice(0);for(var N=0;N<this.concavePath.length;N++){var R=[0,0];g.copy(R,this.concavePath[N]);this.concavePath[N]=R}var O;if(T.optimalDecomp){O=L.decomp()}else{O=L.quickDecomp()}var Q=g.create();for(var N=0;N!==O.length;N++){var P=new x({vertices:O[N].vertices});for(var M=0;M!==P.vertices.length;M++){var R=P.vertices[M];g.sub(R,R,P.centerOfMass)}g.scale(Q,P.centerOfMass,1);P.updateTriangles();P.updateCenterOfMass();P.updateBoundingRadius();this.addShape(P,Q)}this.adjustCenterOfMass();this.aabbNeedsUpdate=true;return true};var q=g.fromValues(0,0),p=g.fromValues(0,0),o=g.fromValues(0,0),n=g.fromValues(0,0);A.prototype.adjustCenterOfMass=function(){var Q=p,P=o,L=n,M=0;g.set(P,0,0);for(var N=0;N!==this.shapes.length;N++){var O=this.shapes[N];g.scale(Q,O.position,O.area);g.add(P,P,Q);M+=O.area}g.scale(L,P,1/M);for(var N=0;N!==this.shapes.length;N++){var O=this.shapes[N];g.sub(O.position,O.position,L)}g.add(this.position,this.position,L);for(var N=0;this.concavePath&&N<this.concavePath.length;N++){g.sub(this.concavePath[N],this.concavePath[N],L)}this.updateMassProperties();this.updateBoundingRadius()};A.prototype.setZeroForce=function(){g.set(this.force,0,0);this.angularForce=0};A.prototype.resetConstraintVelocity=function(){var L=this,M=L.vlambda;g.set(M,0,0);L.wlambda=0};A.prototype.addConstraintVelocity=function(){var L=this,M=L.velocity;g.add(M,M,L.vlambda);L.angularVelocity+=L.wlambda};A.prototype.applyDamping=function(M){if(this.type===A.DYNAMIC){var L=this.velocity;g.scale(L,L,Math.pow(1-this.damping,M));this.angularVelocity*=Math.pow(1-this.angularDamping,M)}};A.prototype.wakeUp=function(){var L=this.sleepState;this.sleepState=A.AWAKE;this.idleTime=0;if(L!==A.AWAKE){this.emit(A.wakeUpEvent)}};A.prototype.sleep=function(){this.sleepState=A.SLEEPING;this.angularVelocity=0;this.angularForce=0;g.set(this.velocity,0,0);g.set(this.force,0,0);this.emit(A.sleepEvent)};A.prototype.sleepTick=function(Q,M,O){if(!this.allowSleep||this.type===A.SLEEPING){return}this.wantsToSleep=false;var N=this.sleepState,L=g.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),P=Math.pow(this.sleepSpeedLimit,2);if(L>=P){this.idleTime=0;this.sleepState=A.AWAKE}else{this.idleTime+=O;this.sleepState=A.SLEEPY}if(this.idleTime>this.sleepTimeLimit){if(!M){this.sleep()}else{this.wantsToSleep=true}}};A.prototype.overlaps=function(L){return this.world.overlapKeeper.bodiesAreOverlapping(this,L)};var i=g.create();var H=g.create();A.prototype.integrate=function(N){var L=this.invMass,O=this.force,P=this.position,M=this.velocity;g.copy(this.previousPosition,this.position);this.previousAngle=this.angle;if(!this.fixedRotation){this.angularVelocity+=this.angularForce*this.invInertia*N}g.scale(i,O,N*L);g.multiply(i,this.massMultiplier,i);g.add(M,i,M);if(!this.integrateToTimeOfImpact(N)){g.scale(H,M,N);g.add(P,P,H);if(!this.fixedRotation){this.angle+=this.angularVelocity*N}}this.aabbNeedsUpdate=true};var u=new G();var w=new F({mode:F.ALL});var J=g.create();var j=g.create();var v=g.create();var z=g.create();A.prototype.integrateToTimeOfImpact=function(P){if(this.ccdSpeedThreshold<0||g.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2)){return false}g.normalize(J,this.velocity);g.scale(j,this.velocity,P);g.add(j,j,this.position);g.sub(v,j,this.position);var V=this.angularVelocity*P;var U=g.length(v);var N=1;var L;var T=this;u.reset();w.callback=function(X){if(X.body===T){return}L=X.body;X.getHitPoint(j,w);g.sub(v,j,T.position);N=g.length(v)/U;X.stop()};g.copy(w.from,this.position);g.copy(w.to,j);w.update();this.world.raycast(u,w);if(!L){return false}var Q=this.angle;g.copy(z,this.position);var W=0;var M=0;var S=0;var R=N;while(R>=M&&W<this.ccdIterations){W++;S=(R-M)/2;g.scale(H,v,N);g.add(this.position,z,H);this.angle=Q+V*N;this.updateAABB();var O=this.aabb.overlaps(L.aabb)&&this.world.narrowphase.bodiesOverlap(this,L);if(O){M=S}else{R=S}}N=S;g.copy(this.position,z);this.angle=Q;g.scale(H,v,N);g.add(this.position,this.position,H);if(!this.fixedRotation){this.angle+=V*N}return true};A.prototype.getVelocityAtPoint=function(L,M){g.crossVZ(L,M,this.angularVelocity);g.subtract(L,this.velocity,L);return L};A.sleepyEvent={type:"sleepy"};A.sleepEvent={type:"sleep"};A.wakeUpEvent={type:"wakeup"};A.DYNAMIC=1;A.STATIC=2;A.KINEMATIC=4;A.AWAKE=0;A.SLEEPY=1;A.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(g,h,k){var m=g("../math/vec2");var e=g("./Spring");var o=g("../utils/Utils");h.exports=f;function f(z,y,v){v=v||{};e.call(this,z,y,v);this.localAnchorA=m.fromValues(0,0);this.localAnchorB=m.fromValues(0,0);if(v.localAnchorA){m.copy(this.localAnchorA,v.localAnchorA)}if(v.localAnchorB){m.copy(this.localAnchorB,v.localAnchorB)}if(v.worldAnchorA){this.setWorldAnchorA(v.worldAnchorA)}if(v.worldAnchorB){this.setWorldAnchorB(v.worldAnchorB)}var w=m.create();var u=m.create();this.getWorldAnchorA(w);this.getWorldAnchorB(u);var x=m.distance(w,u);this.restLength=typeof(v.restLength)==="number"?v.restLength:x}f.prototype=new e();f.prototype.constructor=f;f.prototype.setWorldAnchorA=function(u){this.bodyA.toLocalFrame(this.localAnchorA,u)};f.prototype.setWorldAnchorB=function(u){this.bodyB.toLocalFrame(this.localAnchorB,u)};f.prototype.getWorldAnchorA=function(u){this.bodyA.toWorldFrame(u,this.localAnchorA)};f.prototype.getWorldAnchorB=function(u){this.bodyB.toWorldFrame(u,this.localAnchorB)};var t=m.create(),j=m.create(),r=m.create(),i=m.create(),s=m.create(),q=m.create(),p=m.create(),n=m.create(),l=m.create();f.prototype.applyForce=function(){var z=this.stiffness,F=this.damping,x=this.restLength,y=this.bodyA,w=this.bodyB,v=t,B=j,L=r,D=i,A=l;var K=s,I=q,H=p,G=n;this.getWorldAnchorA(K);this.getWorldAnchorB(I);m.sub(H,K,y.position);m.sub(G,I,w.position);m.sub(v,I,K);var J=m.len(v);m.normalize(B,v);m.sub(L,w.velocity,y.velocity);m.crossZV(A,w.angularVelocity,G);m.add(L,L,A);m.crossZV(A,y.angularVelocity,H);m.sub(L,L,A);m.scale(D,B,-z*(J-x)-F*m.dot(L,B));m.sub(y.force,y.force,D);m.add(w.force,w.force,D);var E=m.crossLength(H,D);var C=m.crossLength(G,D);y.angularForce-=E;w.angularForce+=C}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(j,h,g){var i=j("../math/vec2");var f=j("./Spring");h.exports=e;function e(m,l,k){k=k||{};f.call(this,m,l,k);this.restAngle=typeof(k.restAngle)==="number"?k.restAngle:l.angle-m.angle}e.prototype=new f();e.prototype.constructor=e;e.prototype.applyForce=function(){var p=this.stiffness,t=this.damping,o=this.restAngle,s=this.bodyA,r=this.bodyB,n=r.angle-s.angle,q=r.angularVelocity-s.angularVelocity;var m=-p*(n-o)-t*q*0;s.angularForce-=m;r.angularForce+=m}},{"../math/vec2":30,"./Spring":34}],34:[function(i,g,f){var h=i("../math/vec2");var j=i("../utils/Utils");g.exports=e;function e(m,l,k){k=j.defaults(k,{stiffness:100,damping:1});this.stiffness=k.stiffness;this.damping=k.damping;this.bodyA=m;this.bodyB=l}e.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(h,i,k){var l=h("../math/vec2");var m=h("../utils/Utils");var q=h("../constraints/Constraint");var p=h("../equations/FrictionEquation");var o=h("../objects/Body");i.exports=f;function f(s,r){r=r||{};this.chassisBody=s;this.wheels=[];this.groundBody=new o({mass:0});this.world=null;var t=this;this.preStepCallback=function(){t.update()}}f.prototype.addToWorld=function(t){this.world=t;t.addBody(this.groundBody);t.on("preStep",this.preStepCallback);for(var s=0;s<this.wheels.length;s++){var r=this.wheels[s];t.addConstraint(r)}};f.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody);t.off("preStep",this.preStepCallback);for(var s=0;s<this.wheels.length;s++){var r=this.wheels[s];t.removeConstraint(r)}this.world=null};f.prototype.addWheel=function(s){var r=new e(this,s);this.wheels.push(r);return r};f.prototype.update=function(){for(var r=0;r<this.wheels.length;r++){this.wheels[r].update()}};function e(s,r){r=r||{};this.vehicle=s;this.forwardEquation=new p(s.chassisBody,s.groundBody);this.sideEquation=new p(s.chassisBody,s.groundBody);this.steerValue=0;this.engineForce=0;this.setSideFriction(r.sideFriction!==undefined?r.sideFriction:5);this.localForwardVector=l.fromValues(0,1);if(r.localForwardVector){l.copy(this.localForwardVector,r.localForwardVector)}this.localPosition=l.fromValues(0,0);if(r.localPosition){l.copy(this.localPosition,r.localPosition)}q.apply(this,s.chassisBody,s.groundBody);this.equations.push(this.forwardEquation,this.sideEquation);this.setBrakeForce(0)}e.prototype=new q();e.prototype.setBrakeForce=function(r){this.forwardEquation.setSlipForce(r)};e.prototype.setSideFriction=function(r){this.sideEquation.setSlipForce(r)};var n=l.create();var j=l.create();e.prototype.getSpeed=function(){this.vehicle.chassisBody.vectorToWorldFrame(j,this.localForwardVector);this.vehicle.chassisBody.getVelocityAtPoint(n,j);return l.dot(n,j)};var g=l.create();e.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector);l.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2);this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t);l.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue);l.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue);this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition);l.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB);this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition);l.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA);l.normalize(g,this.forwardEquation.t);l.scale(g,g,this.engineForce);this.vehicle.chassisBody.applyForce(g,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(g,f,e){var h=f.exports={AABB:g("./collision/AABB"),AngleLockEquation:g("./equations/AngleLockEquation"),Body:g("./objects/Body"),Broadphase:g("./collision/Broadphase"),Capsule:g("./shapes/Capsule"),Circle:g("./shapes/Circle"),Constraint:g("./constraints/Constraint"),ContactEquation:g("./equations/ContactEquation"),ContactEquationPool:g("./utils/ContactEquationPool"),ContactMaterial:g("./material/ContactMaterial"),Convex:g("./shapes/Convex"),DistanceConstraint:g("./constraints/DistanceConstraint"),Equation:g("./equations/Equation"),EventEmitter:g("./events/EventEmitter"),FrictionEquation:g("./equations/FrictionEquation"),FrictionEquationPool:g("./utils/FrictionEquationPool"),GearConstraint:g("./constraints/GearConstraint"),GSSolver:g("./solver/GSSolver"),Heightfield:g("./shapes/Heightfield"),Line:g("./shapes/Line"),LockConstraint:g("./constraints/LockConstraint"),Material:g("./material/Material"),Narrowphase:g("./collision/Narrowphase"),NaiveBroadphase:g("./collision/NaiveBroadphase"),Particle:g("./shapes/Particle"),Plane:g("./shapes/Plane"),Pool:g("./utils/Pool"),RevoluteConstraint:g("./constraints/RevoluteConstraint"),PrismaticConstraint:g("./constraints/PrismaticConstraint"),Ray:g("./collision/Ray"),RaycastResult:g("./collision/RaycastResult"),Box:g("./shapes/Box"),RotationalVelocityEquation:g("./equations/RotationalVelocityEquation"),SAPBroadphase:g("./collision/SAPBroadphase"),Shape:g("./shapes/Shape"),Solver:g("./solver/Solver"),Spring:g("./objects/Spring"),TopDownVehicle:g("./objects/TopDownVehicle"),LinearSpring:g("./objects/LinearSpring"),RotationalSpring:g("./objects/RotationalSpring"),Utils:g("./utils/Utils"),World:g("./world/World"),vec2:g("./math/vec2"),version:g("../package.json").version};Object.defineProperty(h,"Rectangle",{get:function(){console.warn("The Rectangle class has been renamed to Box.");return this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(e,f,m){var o=e("../math/vec2"),l=e("./Shape"),j=e("./Convex");f.exports=n;function n(q){if(typeof(arguments[0])==="number"&&typeof(arguments[1])==="number"){q={width:arguments[0],height:arguments[1]};console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")}q=q||{};var r=this.width=q.width||1;var p=this.height=q.height||1;var t=[o.fromValues(-r/2,-p/2),o.fromValues(r/2,-p/2),o.fromValues(r/2,p/2),o.fromValues(-r/2,p/2)];var s=[o.fromValues(1,0),o.fromValues(0,1)];q.vertices=t;q.axes=s;q.type=l.BOX;j.call(this,q)}n.prototype=new j();n.prototype.constructor=n;n.prototype.computeMomentOfInertia=function(q){var p=this.width,r=this.height;return q*(r*r+p*p)/12};n.prototype.updateBoundingRadius=function(){var p=this.width,q=this.height;this.boundingRadius=Math.sqrt(p*p+q*q)/2};var k=o.create(),i=o.create(),h=o.create(),g=o.create();n.prototype.computeAABB=function(q,p,r){q.setFromPoints(this.vertices,p,r,0)};n.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(i,j,m){var l=i("./Shape"),n=i("../math/vec2");j.exports=p;function p(q){if(typeof(arguments[0])==="number"&&typeof(arguments[1])==="number"){q={length:arguments[0],radius:arguments[1]};console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")}q=q||{};this.length=q.length||1;this.radius=q.radius||1;q.type=l.CAPSULE;l.call(this,q)}p.prototype=new l();p.prototype.constructor=p;p.prototype.computeMomentOfInertia=function(s){var u=this.radius,q=this.length+u,t=u*2;return s*(t*t+q*q)/12};p.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};p.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};var f=n.create();p.prototype.computeAABB=function(s,r,t){var q=this.radius;n.set(f,this.length/2,0);if(t!==0){n.rotate(f,f,t)}n.set(s.upperBound,Math.max(f[0]+q,-f[0]+q),Math.max(f[1]+q,-f[1]+q));n.set(s.lowerBound,Math.min(f[0]-q,-f[0]-q),Math.min(f[1]-q,-f[1]-q));n.add(s.lowerBound,s.lowerBound,r);n.add(s.upperBound,s.upperBound,r)};var o=n.create();var e=n.create();var h=n.create();var g=n.create();var k=n.fromValues(0,1);p.prototype.raycast=function(v,w,M,E){var z=w.from;var r=w.to;var I=w.direction;var s=o;var L=e;var B=h;var A=g;var x=this.length/2;for(var C=0;C<2;C++){var u=this.radius*(C*2-1);n.set(B,-x,u);n.set(A,x,u);n.toGlobalFrame(B,B,M,E);n.toGlobalFrame(A,A,M,E);var H=n.getLineSegmentsIntersectionFraction(z,r,B,A);if(H>=0){n.rotate(L,k,E);n.scale(L,L,(C*2-1));w.reportIntersection(v,H,L,-1);if(v.shouldStop(w)){return}}}var q=Math.pow(this.radius,2)+Math.pow(x,2);for(var C=0;C<2;C++){n.set(B,x*(C*2-1),0);n.toGlobalFrame(B,B,M,E);var J=Math.pow(r[0]-z[0],2)+Math.pow(r[1]-z[1],2);var G=2*((r[0]-z[0])*(z[0]-B[0])+(r[1]-z[1])*(z[1]-B[1]));var F=Math.pow(z[0]-B[0],2)+Math.pow(z[1]-B[1],2)-Math.pow(this.radius,2);var H=Math.pow(G,2)-4*J*F;if(H<0){continue}else{if(H===0){n.lerp(s,z,r,H);if(n.squaredDistance(s,M)>q){n.sub(L,s,B);n.normalize(L,L);w.reportIntersection(v,H,L,-1);if(v.shouldStop(w)){return}}}else{var D=Math.sqrt(H);var t=1/(2*J);var N=(-G-D)*t;var K=(-G+D)*t;if(N>=0&&N<=1){n.lerp(s,z,r,N);if(n.squaredDistance(s,M)>q){n.sub(L,s,B);n.normalize(L,L);w.reportIntersection(v,N,L,-1);if(v.shouldStop(w)){return}}}if(K>=0&&K<=1){n.lerp(s,z,r,K);if(n.squaredDistance(s,M)>q){n.sub(L,s,B);n.normalize(L,L);w.reportIntersection(v,K,L,-1);if(v.shouldStop(w)){return}}}}}}}},{"../math/vec2":30,"./Shape":45}],39:[function(k,h,f){var l=k("./Shape"),j=k("../math/vec2");h.exports=i;function i(m){if(typeof(arguments[0])==="number"){m={radius:arguments[0]};console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")}m=m||{};this.radius=m.radius||1;m.type=l.CIRCLE;l.call(this,m)}i.prototype=new l();i.prototype.constructor=i;i.prototype.computeMomentOfInertia=function(m){var n=this.radius;return m*n*n/2};i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};i.prototype.computeAABB=function(n,m,p){var o=this.radius;j.set(n.upperBound,o,o);j.set(n.lowerBound,-o,-o);if(m){j.add(n.lowerBound,n.lowerBound,m);j.add(n.upperBound,n.upperBound,m)}};var e=j.create();var g=j.create();i.prototype.raycast=function(D,x,s,q){var z=x.from,A=x.to,n=this.radius;var y=Math.pow(A[0]-z[0],2)+Math.pow(A[1]-z[1],2);var w=2*((A[0]-z[0])*(z[0]-s[0])+(A[1]-z[1])*(z[1]-s[1]));var v=Math.pow(z[0]-s[0],2)+Math.pow(z[1]-s[1],2)-Math.pow(n,2);var B=Math.pow(w,2)-4*y*v;var C=e;var u=g;if(B<0){return}else{if(B===0){j.lerp(C,z,A,B);j.sub(u,C,s);j.normalize(u,u);x.reportIntersection(D,B,u,-1)}else{var t=Math.sqrt(B);var p=1/(2*y);var o=(-w-t)*p;var m=(-w+t)*p;if(o>=0&&o<=1){j.lerp(C,z,A,o);j.sub(u,C,s);j.normalize(u,u);x.reportIntersection(D,o,u,-1);if(D.shouldStop(x)){return}}if(m>=0&&m<=1){j.lerp(C,z,A,m);j.sub(u,C,s);j.normalize(u,u);x.reportIntersection(D,m,u,-1)}}}}},{"../math/vec2":30,"./Shape":45}],40:[function(k,h,y){var o=k("./Shape"),g=k("../math/vec2"),m=k("../math/polyk"),p=k("poly-decomp");h.exports=s;function s(C){if(Array.isArray(arguments[0])){C={vertices:arguments[0],axes:arguments[1]};console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")}C=C||{};this.vertices=[];var B=C.vertices!==undefined?C.vertices:[];for(var D=0;D<B.length;D++){var A=g.create();g.copy(A,B[D]);this.vertices.push(A)}this.axes=[];if(C.axes){for(var D=0;D<C.axes.length;D++){var F=g.create();g.copy(F,C.axes[D]);this.axes.push(F)}}else{for(var D=0;D<this.vertices.length;D++){var G=this.vertices[D];var E=this.vertices[(D+1)%this.vertices.length];var H=g.create();g.sub(H,E,G);g.rotate90cw(H,H);g.normalize(H,H);this.axes.push(H)}}this.centerOfMass=g.fromValues(0,0);this.triangles=[];if(this.vertices.length){this.updateTriangles();this.updateCenterOfMass()}this.boundingRadius=0;C.type=o.CONVEX;o.call(this,C);this.updateBoundingRadius();this.updateArea();if(this.area<0){throw new Error("Convex vertices must be given in conter-clockwise winding.")}}s.prototype=new o();s.prototype.constructor=s;var n=g.create();var l=g.create();s.prototype.projectOntoLocalAxis=function(G,B){var A=null,F=null,C,H,G=n;for(var E=0;E<this.vertices.length;E++){C=this.vertices[E];H=g.dot(C,G);if(A===null||H>A){A=H}if(F===null||H<F){F=H}}if(F>A){var D=F;F=A;A=D}g.set(B,F,A)};s.prototype.projectOntoWorldAxis=function(D,C,F,A){var B=l;this.projectOntoLocalAxis(D,A);if(F!==0){g.rotate(B,D,F)}else{B=D}var E=g.dot(C,B);g.set(A,A[0]+E,A[1]+E)};s.prototype.updateTriangles=function(){this.triangles.length=0;var G=[];for(var D=0;D<this.vertices.length;D++){var A=this.vertices[D];G.push(A[0],A[1])}var F=m.Triangulate(G);for(var D=0;D<F.length;D+=3){var E=F[D],C=F[D+1],B=F[D+2];this.triangles.push([E,C,B])}};var q=g.create(),j=g.create(),z=g.create(),x=g.create(),w=g.create(),f=g.create(),v=g.create(),u=g.create(),t=g.create();s.prototype.updateCenterOfMass=function(){var E=this.triangles,L=this.vertices,M=this.centerOfMass,A=q,B=t,K=z,J=x,I=w,P=f,F=v,D=u,H=j;g.set(M,0,0);var O=0;for(var G=0;G!==E.length;G++){var N=E[G],K=L[N[0]],J=L[N[1]],I=L[N[2]];g.centroid(A,K,J,I);var C=s.triangleArea(K,J,I);O+=C;g.scale(H,A,C);g.add(M,M,H)}g.scale(M,M,1/O)};s.prototype.computeMomentOfInertia=function(F){var D=0,C=0,E=this.vertices.length;for(var A=E-1,B=0;B<E;A=B,B++){var J=this.vertices[A];var I=this.vertices[B];var H=Math.abs(g.crossLength(J,I));var G=g.dot(I,I)+g.dot(I,J)+g.dot(J,J);D+=H*G;C+=H}return(F/6)*(D/C)};s.prototype.updateBoundingRadius=function(){var D=this.vertices,B=0;for(var C=0;C!==D.length;C++){var A=g.squaredLength(D[C]);if(A>B){B=A}}this.boundingRadius=Math.sqrt(B)};s.triangleArea=function(B,A,C){return(((A[0]-B[0])*(C[1]-B[1]))-((C[0]-B[0])*(A[1]-B[1])))*0.5};s.prototype.updateArea=function(){this.updateTriangles();this.area=0;var F=this.triangles,H=this.vertices;for(var E=0;E!==F.length;E++){var D=F[E],C=H[D[0]],B=H[D[1]],G=H[D[2]];var A=s.triangleArea(C,B,G);this.area+=A}};s.prototype.computeAABB=function(B,A,C){B.setFromPoints(this.vertices,A,C,0)};var e=g.create();var r=g.create();var i=g.create();s.prototype.raycast=function(M,K,F,C){var B=e;var D=r;var I=i;var J=this.vertices;g.toLocalFrame(B,K.from,F,C);g.toLocalFrame(D,K.to,F,C);var A=J.length;for(var E=0;E<A&&!M.shouldStop(K);E++){var H=J[E];var G=J[(E+1)%A];var L=g.getLineSegmentsIntersectionFraction(B,D,H,G);if(L>=0){g.sub(I,G,H);g.rotate(I,I,-Math.PI/2+C);g.normalize(I,I);K.reportIntersection(M,L,I,E)}}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(f,g,j){var i=f("./Shape"),n=f("../math/vec2"),p=f("../utils/Utils");g.exports=k;function k(u){if(Array.isArray(arguments[0])){u={heights:arguments[0]};if(typeof(arguments[1])==="object"){for(var v in arguments[1]){u[v]=arguments[1][v]}}console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}u=u||{};this.heights=u.heights?u.heights.slice(0):[];this.maxValue=u.maxValue||null;this.minValue=u.minValue||null;this.elementWidth=u.elementWidth||0.1;if(u.maxValue===undefined||u.minValue===undefined){this.updateMaxMinValues()}u.type=i.HEIGHTFIELD;i.call(this,u)}k.prototype=new i();k.prototype.constructor=k;k.prototype.updateMaxMinValues=function(){var y=this.heights;var z=y[0];var x=y[0];for(var w=0;w!==y.length;w++){var u=y[w];if(u>z){z=u}if(u<x){x=u}}this.maxValue=z;this.minValue=x};k.prototype.computeMomentOfInertia=function(u){return Number.MAX_VALUE};k.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};k.prototype.updateArea=function(){var w=this.heights,v=0;for(var u=0;u<w.length-1;u++){v+=(w[u]+w[u+1])/2*this.elementWidth}this.area=v};var s=[n.create(),n.create(),n.create(),n.create()];k.prototype.computeAABB=function(v,u,w){n.set(s[0],0,this.maxValue);n.set(s[1],this.elementWidth*this.heights.length,this.maxValue);n.set(s[2],this.elementWidth*this.heights.length,this.minValue);n.set(s[3],0,this.minValue);v.setFromPoints(s,u,w)};k.prototype.getLineSegment=function(y,u,v){var x=this.heights;var w=this.elementWidth;n.set(y,v*w,x[v]);n.set(u,(v+1)*w,x[v+1])};k.prototype.getSegmentIndex=function(u){return Math.floor(u[0]/this.elementWidth)};k.prototype.getClampedSegmentIndex=function(u){var v=this.getSegmentIndex(u);v=Math.min(this.heights.length,Math.max(v,0));return v};var r=n.create();var o=n.create();var m=n.create();var l=n.create();var h=n.create();var t=n.create();var q=n.fromValues(0,1);function e(x,F,D,C,B){var y,w,A,z;y=D[0]-F[0];w=D[1]-F[1];A=B[0]-C[0];z=B[1]-C[1];var G,E;G=(-w*(F[0]-C[0])+y*(F[1]-C[1]))/(-A*w+y*z);E=(A*(F[1]-C[1])-z*(F[0]-C[0]))/(-A*w+y*z);if(G>=0&&G<=1&&E>=0&&E<=1){var v=F[0]+(E*y);var u=F[1]+(E*w);x[0]=v;x[1]=u;return E}return -1}k.prototype.raycast=function(x,y,L,H){var C=y.from;var u=y.to;var J=y.direction;var v=r;var w=o;var F=m;var E=l;var K=h;var A=t;n.toLocalFrame(K,C,L,H);n.toLocalFrame(A,u,L,H);var D=this.getClampedSegmentIndex(K);var B=this.getClampedSegmentIndex(A);if(D>B){var I=D;D=B;B=I}for(var G=0;G<this.heights.length-1;G++){this.getLineSegment(F,E,G);var z=n.getLineSegmentsIntersectionFraction(K,A,F,E);if(z>=0){n.sub(w,E,F);n.rotate(w,w,H+Math.PI/2);n.normalize(w,w);y.reportIntersection(x,z,w,-1);if(x.shouldStop(y)){return}}}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(e,f,l){var k=e("./Shape"),o=e("../math/vec2");f.exports=j;function j(q){if(typeof(arguments[0])==="number"){q={length:arguments[0]};console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")}q=q||{};this.length=q.length||1;q.type=k.LINE;k.call(this,q)}j.prototype=new k();j.prototype.constructor=j;j.prototype.computeMomentOfInertia=function(q){return q*Math.pow(this.length,2)/12};j.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var p=[o.create(),o.create()];j.prototype.computeAABB=function(s,r,t){var q=this.length/2;o.set(p[0],-q,0);o.set(p[1],q,0);s.setFromPoints(p,r,t,0)};var n=o.create();var h=o.create();var i=o.create();var g=o.create();var m=o.fromValues(0,1);j.prototype.raycast=function(A,v,t,q){var x=v.from;var y=v.to;var s=i;var r=g;var w=this.length/2;o.set(s,-w,0);o.set(r,w,0);o.toGlobalFrame(s,s,t,q);o.toGlobalFrame(r,r,t,q);var z=o.getLineSegmentsIntersectionFraction(s,r,x,y);if(z>=0){var u=h;o.rotate(u,m,q);v.reportIntersection(A,z,u,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(i,g,f){var j=i("./Shape"),h=i("../math/vec2");g.exports=e;function e(k){k=k||{};k.type=j.PARTICLE;j.call(this,k)}e.prototype=new j();e.prototype.constructor=e;e.prototype.computeMomentOfInertia=function(k){return 0};e.prototype.updateBoundingRadius=function(){this.boundingRadius=0};e.prototype.computeAABB=function(l,k,m){h.copy(l.lowerBound,k);h.copy(l.upperBound,k)}},{"../math/vec2":30,"./Shape":45}],44:[function(e,f,k){var j=e("./Shape"),l=e("../math/vec2"),m=e("../utils/Utils");f.exports=g;function g(q){q=q||{};q.type=j.PLANE;j.call(this,q)}g.prototype=new j();g.prototype.constructor=g;g.prototype.computeMomentOfInertia=function(q){return 0};g.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};g.prototype.computeAABB=function(t,r,w){var s=w%(2*Math.PI);var x=l.set;var q=Number.MAX_VALUE;var v=t.lowerBound;var u=t.upperBound;if(s===0){x(v,-q,-q);x(u,q,0)}else{if(s===Math.PI/2){x(v,0,-q);x(u,q,q)}else{if(s===Math.PI){x(v,-q,0);x(u,q,q)}else{if(s===3*Math.PI/2){x(v,-q,-q);x(u,0,q)}else{x(v,-q,-q);x(u,q,q)}}}}l.add(v,v,r);l.add(u,u,r)};g.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var n=l.create();var h=l.create();var p=l.create();var i=l.create();var o=l.create();g.prototype.raycast=function(G,A,u,s){var C=A.from;var D=A.to;var z=A.direction;var E=n;var B=h;var v=p;var x=i;var w=o;l.set(x,0,1);l.rotate(x,x,s);l.sub(w,C,u);var q=l.dot(w,x);l.sub(w,D,u);var y=l.dot(w,x);if(q*y>0){return}if(l.squaredDistance(C,D)<q*q){return}var r=l.dot(x,z);l.sub(E,C,u);var F=-l.dot(x,E)/r/A.length;A.reportIntersection(G,F,x,-1)}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(h,f,e){f.exports=i;var g=h("../math/vec2");function i(j){j=j||{};this.body=null;this.position=g.fromValues(0,0);if(j.position){g.copy(this.position,j.position)}this.angle=j.angle||0;this.type=j.type||0;this.id=i.idCounter++;this.boundingRadius=0;this.collisionGroup=j.collisionGroup!==undefined?j.collisionGroup:1;this.collisionResponse=j.collisionResponse!==undefined?j.collisionResponse:true;this.collisionMask=j.collisionMask!==undefined?j.collisionMask:1;this.material=j.material||null;this.area=0;this.sensor=j.sensor!==undefined?j.sensor:false;if(this.type){this.updateBoundingRadius()}this.updateArea()}i.idCounter=0;i.CIRCLE=1;i.PARTICLE=2;i.PLANE=4;i.CONVEX=8;i.LINE=16;i.BOX=32;Object.defineProperty(i,"RECTANGLE",{get:function(){console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead.");return i.BOX}});i.CAPSULE=64;i.HEIGHTFIELD=128;i.prototype.computeMomentOfInertia=function(j){};i.prototype.updateBoundingRadius=function(){};i.prototype.updateArea=function(){};i.prototype.computeAABB=function(k,j,l){};i.prototype.raycast=function(k,l,j,m){}},{"../math/vec2":30}],46:[function(e,f,h){var j=e("../math/vec2"),g=e("./Solver"),k=e("../utils/Utils"),m=e("../equations/FrictionEquation");f.exports=i;function i(n){g.call(this,n,g.GS);n=n||{};this.iterations=n.iterations||10;this.tolerance=n.tolerance||1e-7;this.arrayStep=30;this.lambda=new k.ARRAY_TYPE(this.arrayStep);this.Bs=new k.ARRAY_TYPE(this.arrayStep);this.invCs=new k.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=false;this.frictionIterations=0;this.usedIterations=0}i.prototype=new g();i.prototype.constructor=i;function l(o){var n=o.length;while(n--){o[n]=+0}}i.prototype.solve=function(K,C){this.sortEquations();var H=0,r=this.iterations,y=this.frictionIterations,u=this.equations,p=u.length,G=Math.pow(this.tolerance*p,2),t=C.bodies,s=C.bodies.length,x=j.add,w=j.set,o=this.useZeroRHS,v=this.lambda;this.usedIterations=0;if(p){for(var I=0;I!==s;I++){var O=t[I];O.updateSolveMassProperties()}}if(v.length<p){v=this.lambda=new k.ARRAY_TYPE(p+this.arrayStep);this.Bs=new k.ARRAY_TYPE(p+this.arrayStep);this.invCs=new k.ARRAY_TYPE(p+this.arrayStep)}l(v);var L=this.invCs,n=this.Bs,v=this.lambda;for(var I=0;I!==u.length;I++){var N=u[I];if(N.timeStep!==K||N.needsUpdate){N.timeStep=K;N.update()}n[I]=N.computeB(N.a,N.b,K);L[I]=N.computeInvC(N.epsilon)}var A,z,N,J,I,F;if(p!==0){for(I=0;I!==s;I++){var O=t[I];O.resetConstraintVelocity()}if(y){for(H=0;H!==y;H++){J=0;for(F=0;F!==p;F++){N=u[F];var E=i.iterateEquation(F,N,N.epsilon,n,L,v,o,K,H);J+=Math.abs(E)}this.usedIterations++;if(J*J<=G){break}}i.updateMultipliers(u,v,1/K);for(F=0;F!==p;F++){var P=u[F];if(P instanceof m){var M=0;for(var D=0;D!==P.contactEquations.length;D++){M+=P.contactEquations[D].multiplier}M*=P.frictionCoefficient/P.contactEquations.length;P.maxForce=M;P.minForce=-M}}}for(H=0;H!==r;H++){J=0;for(F=0;F!==p;F++){N=u[F];var E=i.iterateEquation(F,N,N.epsilon,n,L,v,o,K,H);J+=Math.abs(E)}this.usedIterations++;if(J*J<=G){break}}for(I=0;I!==s;I++){t[I].addConstraintVelocity()}i.updateMultipliers(u,v,1/K)}};i.updateMultipliers=function(n,q,p){var o=n.length;while(o--){n[o].multiplier=q[o]*p}};i.iterateEquation=function(t,D,E,n,u,x,C,r,y){var q=n[t],w=u[t],v=x[t],p=D.computeGWlambda();var A=D.maxForce,o=D.minForce;if(C){q=0}var s=w*(q-p-E*v);var z=v+s;if(z<o*r){s=o*r-v}else{if(z>A*r){s=A*r-v}}x[t]+=s;D.addToWlambda(s);return s}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(i,f,e){var j=i("../utils/Utils"),h=i("../events/EventEmitter");f.exports=k;function k(l,m){l=l||{};h.call(this);this.type=m;this.equations=[];this.equationSortFunction=l.equationSortFunction||false}k.prototype=new h();k.prototype.constructor=k;k.prototype.solve=function(l,m){throw new Error("Solver.solve should be implemented by subclasses!")};var g={bodies:[]};k.prototype.solveIsland=function(m,l){this.removeAllEquations();if(l.equations.length){this.addEquations(l.equations);g.bodies.length=0;l.getBodies(g.bodies);if(g.bodies.length){this.solve(m,g)}}};k.prototype.sortEquations=function(){if(this.equationSortFunction){this.equations.sort(this.equationSortFunction)}};k.prototype.addEquation=function(l){if(l.enabled){this.equations.push(l)}};k.prototype.addEquations=function(m){for(var n=0,o=m.length;n!==o;n++){var l=m[n];if(l.enabled){this.equations.push(l)}}};k.prototype.removeEquation=function(l){var m=this.equations.indexOf(l);if(m!==-1){this.equations.splice(m,1)}};k.prototype.removeAllEquations=function(){this.equations.length=0};k.GS=1;k.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(j,i,h){var e=j("../equations/ContactEquation");var g=j("./Pool");i.exports=f;function f(){g.apply(this,arguments)}f.prototype=new g();f.prototype.constructor=f;f.prototype.create=function(){return new e()};f.prototype.destroy=function(k){k.bodyA=k.bodyB=null;return this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(j,i,f){var h=j("../equations/FrictionEquation");var e=j("./Pool");i.exports=g;function g(){e.apply(this,arguments)}g.prototype=new e();g.prototype.constructor=g;g.prototype.create=function(){return new h()};g.prototype.destroy=function(k){k.bodyA=k.bodyB=null;return this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(j,h,g){var i=j("../world/IslandNode");var f=j("./Pool");h.exports=e;function e(){f.apply(this,arguments)}e.prototype=new f();e.prototype.constructor=e;e.prototype.create=function(){return new i()};e.prototype.destroy=function(k){k.reset();return this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(j,i,f){var h=j("../world/Island");var e=j("./Pool");i.exports=g;function g(){e.apply(this,arguments)}g.prototype=new e();g.prototype.constructor=g;g.prototype.create=function(){return new h()};g.prototype.destroy=function(k){k.reset();return this}},{"../world/Island":58,"./Pool":55}],52:[function(j,h,e){var i=j("./TupleDictionary");var l=j("./OverlapKeeperRecord");var g=j("./OverlapKeeperRecordPool");var k=j("./Utils");h.exports=f;function f(){this.overlappingShapesLastState=new i();this.overlappingShapesCurrentState=new i();this.recordPool=new g({size:16});this.tmpDict=new i();this.tmpArray1=[]}f.prototype.tick=function(){var p=this.overlappingShapesLastState;var q=this.overlappingShapesCurrentState;var n=p.keys.length;while(n--){var o=p.keys[n];var r=p.getByKey(o);var m=q.getByKey(o);if(r){this.recordPool.release(r)}}p.reset();p.copy(q);q.reset()};f.prototype.setOverlapping=function(s,p,r,n){var m=this.overlappingShapesLastState;var q=this.overlappingShapesCurrentState;if(!q.get(p.id,n.id)){var o=this.recordPool.get();o.set(s,p,r,n);q.set(p.id,n.id,o)}};f.prototype.getNewOverlaps=function(m){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,m)};f.prototype.getEndOverlaps=function(m){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,m)};f.prototype.bodiesAreOverlapping=function(r,q){var p=this.overlappingShapesCurrentState;var m=p.keys.length;while(m--){var n=p.keys[m];var o=p.data[n];if((o.bodyA===r&&o.bodyB===q)||o.bodyA===q&&o.bodyB===r){return true}}return false};f.prototype.getDiff=function(o,m,u){var u=u||[];var s=o;var r=m;u.length=0;var p=r.keys.length;while(p--){var t=r.keys[p];var q=r.data[t];if(!q){throw new Error("Key "+t+" had no data!")}var n=s.data[t];if(!n){u.push(q)}}return u};f.prototype.isNewOverlap=function(p,o){var m=p.id|0,r=o.id|0;var n=this.overlappingShapesLastState;var q=this.overlappingShapesCurrentState;return !!!n.get(m,r)&&!!q.get(m,r)};f.prototype.getNewBodyOverlaps=function(m){this.tmpArray1.length=0;var n=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(n,m)};f.prototype.getEndBodyOverlaps=function(m){this.tmpArray1.length=0;var n=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(n,m)};f.prototype.getBodyDiff=function(q,m){m=m||[];var o=this.tmpDict;var n=q.length;while(n--){var p=q[n];o.set(p.bodyA.id|0,p.bodyB.id|0,p)}n=o.keys.length;while(n--){var p=o.getByKey(o.keys[n]);if(p){m.push(p.bodyA,p.bodyB)}}o.reset();return m}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(g,f,e){f.exports=h;function h(l,j,k,i){this.shapeA=j;this.shapeB=i;this.bodyA=l;this.bodyB=k}h.prototype.set=function(l,j,k,i){h.call(this,l,j,k,i)}},{}],54:[function(i,h,f){var j=i("./OverlapKeeperRecord");var e=i("./Pool");h.exports=g;function g(){e.apply(this,arguments)}g.prototype=new e();g.prototype.constructor=g;g.prototype.create=function(){return new j()};g.prototype.destroy=function(k){k.bodyA=k.bodyB=k.shapeA=k.shapeB=null;return this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(h,g,f){g.exports=e;function e(i){i=i||{};this.objects=[];if(i.size!==undefined){this.resize(i.size)}}e.prototype.resize=function(i){var j=this.objects;while(j.length>i){j.pop()}while(j.length<i){j.push(this.create())}return this};e.prototype.get=function(){var i=this.objects;return i.length?i.pop():this.create()};e.prototype.release=function(i){this.destroy(i);this.objects.push(i);return this}},{}],56:[function(h,f,e){var i=h("./Utils");f.exports=g;function g(){this.data={};this.keys=[]}g.prototype.getKey=function(k,j){k=k|0;j=j|0;if((k|0)===(j|0)){return -1}return((k|0)>(j|0)?(k<<16)|(j&65535):(j<<16)|(k&65535))|0};g.prototype.getByKey=function(j){j=j|0;return this.data[j]};g.prototype.get=function(l,k){return this.data[this.getKey(l,k)]};g.prototype.set=function(m,k,n){if(!n){throw new Error("No data!")}var l=this.getKey(m,k);if(!this.data[l]){this.keys.push(l)}this.data[l]=n;return l};g.prototype.reset=function(){var m=this.data,k=this.keys;var j=k.length;while(j--){delete m[k[j]]}k.length=0};g.prototype.copy=function(m){this.reset();i.appendArray(this.keys,m.keys);var j=m.keys.length;while(j--){var k=m.keys[j];this.data[k]=m.data[k]}}},{"./Utils":57}],57:[function(g,f,e){f.exports=h;function h(){}h.appendArray=function(l,k){if(k.length<150000){l.push.apply(l,k)}else{for(var m=0,j=k.length;m!==j;++m){l.push(k[m])}}};h.splice=function(n,k,m){m=m||1;for(var l=k,j=n.length-m;l<j;l++){n[l]=n[l+m]}n.length=j};if(typeof P2_ARRAY_TYPE!=="undefined"){h.ARRAY_TYPE=P2_ARRAY_TYPE}else{if(typeof Float32Array!=="undefined"){h.ARRAY_TYPE=Float32Array}else{h.ARRAY_TYPE=Array}}h.extend=function(j,i){for(var k in i){j[k]=i[k]}};h.defaults=function(i,k){i=i||{};for(var j in k){if(!(j in i)){i[j]=k[j]}}return i}},{}],58:[function(i,h,f){var j=i("../objects/Body");h.exports=g;function g(){this.equations=[];this.bodies=[]}g.prototype.reset=function(){this.equations.length=this.bodies.length=0};var e=[];g.prototype.getBodies=function(l){var m=l||[],n=this.equations;e.length=0;for(var o=0;o!==n.length;o++){var k=n[o];if(e.indexOf(k.bodyA.id)===-1){m.push(k.bodyA);e.push(k.bodyA.id)}if(e.indexOf(k.bodyB.id)===-1){m.push(k.bodyB);e.push(k.bodyB.id)}}return m};g.prototype.wantsToSleep=function(){for(var l=0;l<this.bodies.length;l++){var k=this.bodies[l];if(k.type===j.DYNAMIC&&!k.wantsToSleep){return false}}return true};g.prototype.sleep=function(){for(var l=0;l<this.bodies.length;l++){var k=this.bodies[l];k.sleep()}return true}},{"../objects/Body":31}],59:[function(e,f,i){var j=e("../math/vec2"),l=e("./Island"),k=e("./IslandNode"),g=e("./../utils/IslandNodePool"),n=e("./../utils/IslandPool"),m=e("../objects/Body");f.exports=h;function h(o){this.nodePool=new g({size:16});this.islandPool=new n({size:8});this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}h.getUnvisitedNode=function(o){var p=o.length;for(var q=0;q!==p;q++){var r=o[q];if(!r.visited&&r.body.type===m.DYNAMIC){return r}}return false};h.prototype.visit=function(t,q,r){q.push(t.body);var p=t.equations.length;for(var s=0;s!==p;s++){var o=t.equations[s];if(r.indexOf(o)===-1){r.push(o)}}};h.prototype.bfs=function(q,p,r){var o=this.queue;o.length=0;o.push(q);q.visited=true;this.visit(q,p,r);while(o.length){var s=o.pop();var t;while((t=h.getUnvisitedNode(s.neighbors))){t.visited=true;this.visit(t,p,r);if(t.body.type===m.DYNAMIC){o.push(t)}}}};h.prototype.split=function(A){var o=A.bodies,q=this.nodes,p=this.equations;while(q.length){this.nodePool.release(q.pop())}for(var x=0;x!==o.length;x++){var u=this.nodePool.get();u.body=o[x];q.push(u)}for(var v=0;v!==p.length;v++){var B=p[v],x=o.indexOf(B.bodyA),w=o.indexOf(B.bodyB),t=q[x],r=q[w];t.neighbors.push(r);r.neighbors.push(t);t.equations.push(B);r.equations.push(B)}var z=this.islands;for(var x=0;x<z.length;x++){this.islandPool.release(z[x])}z.length=0;var s;while((s=h.getUnvisitedNode(q))){var y=this.islandPool.get();this.bfs(s,y.bodies,y.equations);z.push(y)}return z}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(h,f,e){f.exports=g;function g(i){this.body=i;this.neighbors=[];this.equations=[];this.visited=false}g.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=false;this.body=null}},{}],61:[function(D,l,S){var M=D("../solver/GSSolver"),ad=D("../solver/Solver"),H=D("../collision/Ray"),Y=D("../math/vec2"),V=D("../shapes/Circle"),E=D("../shapes/Convex"),m=D("../shapes/Line"),t=D("../shapes/Plane"),ac=D("../shapes/Capsule"),Z=D("../shapes/Particle"),A=D("../events/EventEmitter"),z=D("../objects/Body"),o=D("../shapes/Shape"),C=D("../objects/LinearSpring"),B=D("../material/Material"),s=D("../material/ContactMaterial"),L=D("../constraints/DistanceConstraint"),y=D("../constraints/Constraint"),K=D("../constraints/LockConstraint"),G=D("../constraints/RevoluteConstraint"),r=D("../constraints/PrismaticConstraint"),ab=D("../constraints/GearConstraint"),k=D("../../package.json"),j=D("../collision/Broadphase"),aa=D("../collision/AABB"),p=D("../collision/SAPBroadphase"),J=D("../collision/Narrowphase"),N=D("../utils/Utils"),e=D("../utils/OverlapKeeper"),f=D("./IslandManager"),u=D("../objects/RotationalSpring");l.exports=w;function w(ae){A.apply(this);ae=ae||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=ae.solver||new M();this.narrowphase=new J(this);this.islandManager=new f();this.gravity=Y.fromValues(0,-9.78);if(ae.gravity){Y.copy(this.gravity,ae.gravity)}this.frictionGravity=Y.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=true;this.useFrictionGravityOnZeroGravity=true;this.broadphase=ae.broadphase||new p();this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new B();this.defaultContactMaterial=new s(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=true;this.applyDamping=true;this.applyGravity=true;this.solveConstraints=true;this.contactMaterials=[];this.time=0;this.accumulator=0;this.stepping=false;this.bodiesToBeRemoved=[];this.islandSplit=typeof(ae.islandSplit)!=="undefined"?!!ae.islandSplit:true;this.emitImpactEvent=true;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=w.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new e()}w.prototype=new Object(A.prototype);w.prototype.constructor=w;w.NO_SLEEPING=1;w.BODY_SLEEPING=2;w.ISLAND_SLEEPING=4;w.prototype.addConstraint=function(ae){this.constraints.push(ae)};w.prototype.addContactMaterial=function(ae){this.contactMaterials.push(ae)};w.prototype.removeContactMaterial=function(af){var ae=this.contactMaterials.indexOf(af);if(ae!==-1){N.splice(this.contactMaterials,ae,1)}};w.prototype.getContactMaterial=function(ai,ah){var ag=this.contactMaterials;for(var af=0,aj=ag.length;af!==aj;af++){var ae=ag[af];if((ae.materialA.id===ai.id)&&(ae.materialB.id===ah.id)||(ae.materialA.id===ah.id)&&(ae.materialB.id===ai.id)){return ae}}return false};w.prototype.removeConstraint=function(af){var ae=this.constraints.indexOf(af);if(ae!==-1){N.splice(this.constraints,ae,1)}};var X=Y.create(),n=Y.create(),W=Y.create(),h=Y.create(),R=Y.create(),q=Y.create(),U=Y.create(),I=Y.fromValues(0,0),v=Y.fromValues(0,0),g=Y.fromValues(0,0),F=Y.fromValues(0,0);w.prototype.step=function(ah,aj,ak){ak=ak||10;aj=aj||0;if(aj===0){this.internalStep(ah);this.time+=ah}else{this.accumulator+=aj;var ai=0;while(this.accumulator>=ah&&ai<ak){this.internalStep(ah);this.time+=ah;this.accumulator-=ah;ai++}var ag=(this.accumulator%ah)/ah;for(var af=0;af!==this.bodies.length;af++){var ae=this.bodies[af];Y.lerp(ae.interpolatedPosition,ae.previousPosition,ae.position,ag);ae.interpolatedAngle=ae.previousAngle+ag*(ae.angle-ae.previousAngle)}}};var x=[];w.prototype.internalStep=function(al){this.stepping=true;var aK=this,aD=this.springs.length,aw=this.springs,a2=this.bodies,aZ=this.gravity,az=this.solver,ak=this.bodies.length,aJ=this.broadphase,a3=this.narrowphase,ag=this.constraints,aI,aH,aA=R,aV=q,ar=U,aG=Y.scale,ah=Y.add,a1=Y.rotate,ax=this.islandManager;this.overlapKeeper.tick();this.lastTimeStep=al;if(this.useWorldGravityAsFrictionGravity){var ae=Y.length(this.gravity);if(!(ae===0&&this.useFrictionGravityOnZeroGravity)){this.frictionGravity=ae}}if(this.applyGravity){for(var aX=0;aX!==ak;aX++){var a7=a2[aX],aF=a7.force;if(a7.type!==z.DYNAMIC||a7.sleepState===z.SLEEPING){continue}Y.scale(ar,aZ,a7.mass*a7.gravityScale);ah(aF,aF,ar)}}if(this.applySpringForces){for(var aX=0;aX!==aD;aX++){var aN=aw[aX];aN.applyForce()}}if(this.applyDamping){for(var aX=0;aX!==ak;aX++){var a7=a2[aX];if(a7.type===z.DYNAMIC){a7.applyDamping(al)}}}var av=aJ.getCollisionPairs(this);var aQ=this.disabledBodyCollisionPairs;for(var aX=aQ.length-2;aX>=0;aX-=2){for(var aW=av.length-2;aW>=0;aW-=2){if((aQ[aX]===av[aW]&&aQ[aX+1]===av[aW+1])||(aQ[aX+1]===av[aW]&&aQ[aX]===av[aW+1])){av.splice(aW,2)}}}var af=ag.length;for(aX=0;aX!==af;aX++){var a6=ag[aX];if(!a6.collideConnected){for(var aW=av.length-2;aW>=0;aW-=2){if((a6.bodyA===av[aW]&&a6.bodyB===av[aW+1])||(a6.bodyB===av[aW]&&a6.bodyA===av[aW+1])){av.splice(aW,2)}}}}this.postBroadphaseEvent.pairs=av;this.emit(this.postBroadphaseEvent);this.postBroadphaseEvent.pairs=null;a3.reset(this);for(var aX=0,aB=av.length;aX!==aB;aX+=2){var a0=av[aX],aY=av[aX+1];for(var aU=0,ao=a0.shapes.length;aU!==ao;aU++){var au=a0.shapes[aU],aM=au.position,aq=au.angle;for(var aS=0,an=aY.shapes.length;aS!==an;aS++){var at=aY.shapes[aS],aL=at.position,ap=at.angle;var aC=this.defaultContactMaterial;if(au.material&&at.material){var aP=this.getContactMaterial(au.material,at.material);if(aP){aC=aP}}this.runNarrowphase(a3,a0,au,aM,aq,aY,at,aL,ap,aC,this.frictionGravity)}}}for(var aX=0;aX!==ak;aX++){var ay=a2[aX];if(ay._wakeUpAfterNarrowphase){ay.wakeUp();ay._wakeUpAfterNarrowphase=false}}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(x);var a4=this.endContactEvent;var aS=x.length;while(aS--){var a5=x[aS];a4.shapeA=a5.shapeA;a4.shapeB=a5.shapeB;a4.bodyA=a5.bodyA;a4.bodyB=a5.bodyB;this.emit(a4)}x.length=0}var am=this.preSolveEvent;am.contactEquations=a3.contactEquations;am.frictionEquations=a3.frictionEquations;this.emit(am);am.contactEquations=am.frictionEquations=null;var af=ag.length;for(aX=0;aX!==af;aX++){ag[aX].update()}if(a3.contactEquations.length||a3.frictionEquations.length||af){if(this.islandSplit){ax.equations.length=0;N.appendArray(ax.equations,a3.contactEquations);N.appendArray(ax.equations,a3.frictionEquations);for(aX=0;aX!==af;aX++){N.appendArray(ax.equations,ag[aX].equations)}ax.split(this);for(var aX=0;aX!==ax.islands.length;aX++){var aT=ax.islands[aX];if(aT.equations.length){az.solveIsland(al,aT)}}}else{az.addEquations(a3.contactEquations);az.addEquations(a3.frictionEquations);for(aX=0;aX!==af;aX++){az.addEquations(ag[aX].equations)}if(this.solveConstraints){az.solve(al,this)}az.removeAllEquations()}}for(var aX=0;aX!==ak;aX++){var ay=a2[aX];ay.integrate(al)}for(var aX=0;aX!==ak;aX++){a2[aX].setZeroForce()}if(this.emitImpactEvent&&this.has("impact")){var aO=this.impactEvent;for(var aX=0;aX!==a3.contactEquations.length;aX++){var aR=a3.contactEquations[aX];if(aR.firstImpact){aO.bodyA=aR.bodyA;aO.bodyB=aR.bodyB;aO.shapeA=aR.shapeA;aO.shapeB=aR.shapeB;aO.contactEquation=aR;this.emit(aO)}}}if(this.sleepMode===w.BODY_SLEEPING){for(aX=0;aX!==ak;aX++){a2[aX].sleepTick(this.time,false,al)}}else{if(this.sleepMode===w.ISLAND_SLEEPING&&this.islandSplit){for(aX=0;aX!==ak;aX++){a2[aX].sleepTick(this.time,true,al)}for(var aX=0;aX<this.islandManager.islands.length;aX++){var aT=this.islandManager.islands[aX];if(aT.wantsToSleep()){aT.sleep()}}}}this.stepping=false;var aE=this.bodiesToBeRemoved;for(var aX=0;aX!==aE.length;aX++){this.removeBody(aE[aX])}aE.length=0;this.emit(this.postStepEvent)};w.prototype.runNarrowphase=function(ae,ah,aE,au,ax,af,aD,at,aw,ao,ag){if(!((aE.collisionGroup&aD.collisionMask)!==0&&(aD.collisionGroup&aE.collisionMask)!==0)){return}Y.rotate(I,au,ah.angle);Y.rotate(v,at,af.angle);Y.add(I,I,ah.position);Y.add(v,v,af.position);var aC=ax+ah.angle;var al=aw+af.angle;ae.enableFriction=ao.friction>0;ae.frictionCoefficient=ao.friction;var ak;if(ah.type===z.STATIC||ah.type===z.KINEMATIC){ak=af.mass}else{if(af.type===z.STATIC||af.type===z.KINEMATIC){ak=ah.mass}else{ak=(ah.mass*af.mass)/(ah.mass+af.mass)}}ae.slipForce=ao.friction*ag*ak;ae.restitution=ao.restitution;ae.surfaceVelocity=ao.surfaceVelocity;ae.frictionStiffness=ao.frictionStiffness;ae.frictionRelaxation=ao.frictionRelaxation;ae.stiffness=ao.stiffness;ae.relaxation=ao.relaxation;ae.contactSkinSize=ao.contactSkinSize;ae.enabledEquations=ah.collisionResponse&&af.collisionResponse&&aE.collisionResponse&&aD.collisionResponse;var am=ae[aE.type|aD.type],aG=0;if(am){var ay=aE.sensor||aD.sensor;var aB=ae.frictionEquations.length;if(aE.type<aD.type){aG=am.call(ae,ah,aE,I,aC,af,aD,v,al,ay)}else{aG=am.call(ae,af,aD,v,al,ah,aE,I,aC,ay)}var aF=ae.frictionEquations.length-aB;if(aG){if(ah.allowSleep&&ah.type===z.DYNAMIC&&ah.sleepState===z.SLEEPING&&af.sleepState===z.AWAKE&&af.type!==z.STATIC){var an=Y.squaredLength(af.velocity)+Math.pow(af.angularVelocity,2);var aq=Math.pow(af.sleepSpeedLimit,2);if(an>=aq*2){ah._wakeUpAfterNarrowphase=true}}if(af.allowSleep&&af.type===z.DYNAMIC&&af.sleepState===z.SLEEPING&&ah.sleepState===z.AWAKE&&ah.type!==z.STATIC){var ap=Y.squaredLength(ah.velocity)+Math.pow(ah.angularVelocity,2);var ar=Math.pow(ah.sleepSpeedLimit,2);if(ap>=ar*2){af._wakeUpAfterNarrowphase=true}}this.overlapKeeper.setOverlapping(ah,aE,af,aD);if(this.has("beginContact")&&this.overlapKeeper.isNewOverlap(aE,aD)){var aA=this.beginContactEvent;aA.shapeA=aE;aA.shapeB=aD;aA.bodyA=ah;aA.bodyB=af;aA.contactEquations.length=0;if(typeof(aG)==="number"){for(var av=ae.contactEquations.length-aG;av<ae.contactEquations.length;av++){aA.contactEquations.push(ae.contactEquations[av])}}this.emit(aA)}if(typeof(aG)==="number"&&aF>1){for(var av=ae.frictionEquations.length-aF;av<ae.frictionEquations.length;av++){var az=ae.frictionEquations[av];az.setSlipForce(az.getSlipForce()/aF)}}}}};w.prototype.addSpring=function(af){this.springs.push(af);var ae=this.addSpringEvent;ae.spring=af;this.emit(ae);ae.spring=null};w.prototype.removeSpring=function(af){var ae=this.springs.indexOf(af);if(ae!==-1){N.splice(this.springs,ae,1)}};w.prototype.addBody=function(ae){if(this.bodies.indexOf(ae)===-1){this.bodies.push(ae);ae.world=this;var af=this.addBodyEvent;af.body=ae;this.emit(af);af.body=null}};w.prototype.removeBody=function(af){if(this.stepping){this.bodiesToBeRemoved.push(af)}else{af.world=null;var ae=this.bodies.indexOf(af);if(ae!==-1){N.splice(this.bodies,ae,1);this.removeBodyEvent.body=af;af.resetConstraintVelocity();this.emit(this.removeBodyEvent);this.removeBodyEvent.body=null}}};w.prototype.getBodyById=function(ah){var af=this.bodies;for(var ag=0;ag<af.length;ag++){var ae=af[ag];if(ae.id===ah){return ae}}return false};w.prototype.disableBodyCollision=function(af,ae){this.disabledBodyCollisionPairs.push(af,ae)};w.prototype.enableBodyCollision=function(ah,ag){var af=this.disabledBodyCollisionPairs;for(var ae=0;ae<af.length;ae+=2){if((af[ae]===ah&&af[ae+1]===ag)||(af[ae+1]===ah&&af[ae]===ag)){af.splice(ae,2);return}}};w.prototype.clear=function(){this.time=0;if(this.solver&&this.solver.equations.length){this.solver.removeAllEquations()}var ai=this.constraints;for(var ah=ai.length-1;ah>=0;ah--){this.removeConstraint(ai[ah])}var ae=this.bodies;for(var ah=ae.length-1;ah>=0;ah--){this.removeBody(ae[ah])}var ag=this.springs;for(var ah=ag.length-1;ah>=0;ah--){this.removeSpring(ag[ah])}var af=this.contactMaterials;for(var ah=af.length-1;ah>=0;ah--){this.removeContactMaterial(af[ah])}w.apply(this)};var P=Y.create(),T=Y.fromValues(0,0),O=Y.fromValues(0,0);w.prototype.hitTest=function(ag,ai,au){au=au||0;var ae=new z({position:ag}),ap=new Z(),an=ag,af=0,aj=P,al=T,av=O;ae.addShape(ap);var ao=this.narrowphase,ak=[];for(var ar=0,ah=ai.length;ar!==ah;ar++){var aw=ai[ar];for(var aq=0,at=aw.shapes.length;aq!==at;aq++){var am=aw.shapes[aq];Y.rotate(aj,am.position,aw.angle);Y.add(aj,aj,aw.position);var ax=am.angle+aw.angle;if((am instanceof V&&ao.circleParticle(aw,am,aj,ax,ae,ap,an,af,true))||(am instanceof E&&ao.particleConvex(ae,ap,an,af,aw,am,aj,ax,true))||(am instanceof t&&ao.particlePlane(ae,ap,an,af,aw,am,aj,ax,true))||(am instanceof ac&&ao.particleCapsule(ae,ap,an,af,aw,am,aj,ax,true))||(am instanceof Z&&Y.squaredLength(Y.sub(av,aj,ag))<au*au)){ak.push(aw)}}}return ak};w.prototype.setGlobalStiffness=function(af){var ak=this.constraints;for(var ah=0;ah!==ak.length;ah++){var aj=ak[ah];for(var ag=0;ag!==aj.equations.length;ag++){var ae=aj.equations[ag];ae.stiffness=af;ae.needsUpdate=true}}var ai=this.contactMaterials;for(var ah=0;ah!==ai.length;ah++){var aj=ai[ah];aj.stiffness=aj.frictionStiffness=af}var aj=this.defaultContactMaterial;aj.stiffness=aj.frictionStiffness=af};w.prototype.setGlobalRelaxation=function(ah){for(var ag=0;ag!==this.constraints.length;ag++){var ai=this.constraints[ag];for(var af=0;af!==ai.equations.length;af++){var ae=ai.equations[af];ae.relaxation=ah;ae.needsUpdate=true}}for(var ag=0;ag!==this.contactMaterials.length;ag++){var ai=this.contactMaterials[ag];ai.relaxation=ai.frictionRelaxation=ah}var ai=this.defaultContactMaterial;ai.relaxation=ai.frictionRelaxation=ah};var Q=new aa();var i=[];w.prototype.raycast=function(ae,af){af.getAABB(Q);this.broadphase.aabbQuery(this,Q,i);af.intersectBodies(ae,i);i.length=0;return ae.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});(function(){var a=this;var b=b||{};b.game=null;b.WEBGL_RENDERER=0;b.CANVAS_RENDERER=1;b.VERSION="v2.2.9";b._UID=0;if(typeof(Float32Array)!="undefined"){b.Float32Array=Float32Array;b.Uint16Array=Uint16Array;b.Uint32Array=Uint32Array;b.ArrayBuffer=ArrayBuffer}else{b.Float32Array=Array;b.Uint16Array=Array}b.PI_2=Math.PI*2;b.RAD_TO_DEG=180/Math.PI;b.DEG_TO_RAD=Math.PI/180;b.RETINA_PREFIX="@2x";b.DisplayObject=function(){this.position=new b.Point(0,0);this.scale=new b.Point(1,1);this.pivot=new b.Point(0,0);this.rotation=0;this.alpha=1;this.visible=true;this.hitArea=null;this.renderable=false;this.parent=null;this.worldAlpha=1;this.worldTransform=new b.Matrix();this.worldPosition=new b.Point(0,0);this.worldScale=new b.Point(1,1);this.worldRotation=0;this.filterArea=null;this._sr=0;this._cr=1;this._bounds=new b.Rectangle(0,0,0,0);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=false;this._cacheIsDirty=false};b.DisplayObject.prototype.constructor=b.DisplayObject;b.DisplayObject.prototype={destroy:function(){if(this.children){var c=this.children.length;while(c--){this.children[c].destroy()}this.children=[]}this.hitArea=null;this.parent=null;this.worldTransform=null;this.filterArea=null;this.renderable=false;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite()},updateTransform:function(m){if(!m&&!this.parent&&!this.game){return this}var e=this.parent;if(m){e=m}else{if(!this.parent){e=this.game.world}}var n=e.worldTransform;var h=this.worldTransform;var l,k,j,i,g,f;if(this.rotation%b.PI_2){if(this.rotation!==this.rotationCache){this.rotationCache=this.rotation;this._sr=Math.sin(this.rotation);this._cr=Math.cos(this.rotation)}l=this._cr*this.scale.x;k=this._sr*this.scale.x;j=-this._sr*this.scale.y;i=this._cr*this.scale.y;g=this.position.x;f=this.position.y;if(this.pivot.x||this.pivot.y){g-=this.pivot.x*l+this.pivot.y*j;f-=this.pivot.x*k+this.pivot.y*i}h.a=l*n.a+k*n.c;h.b=l*n.b+k*n.d;h.c=j*n.a+i*n.c;h.d=j*n.b+i*n.d;h.tx=g*n.a+f*n.c+n.tx;h.ty=g*n.b+f*n.d+n.ty}else{l=this.scale.x;i=this.scale.y;g=this.position.x-this.pivot.x*l;f=this.position.y-this.pivot.y*i;h.a=l*n.a;h.b=l*n.b;h.c=i*n.c;h.d=i*n.d;h.tx=g*n.a+f*n.c+n.tx;h.ty=g*n.b+f*n.d+n.ty}this.worldAlpha=this.alpha*e.worldAlpha;this.worldPosition.set(h.tx,h.ty);this.worldScale.set(this.scale.x*Math.sqrt(h.a*h.a+h.c*h.c),this.scale.y*Math.sqrt(h.b*h.b+h.d*h.d));this.worldRotation=Math.atan2(-h.c,h.d);this._currentBounds=null;if(this.transformCallback){this.transformCallback.call(this.transformCallbackContext,h,n)}return this},preUpdate:function(){},generateTexture:function(d,e,g){var f=this.getLocalBounds();var c=new b.RenderTexture(f.width|0,f.height|0,g,e,d);b.DisplayObject._tempMatrix.tx=-f.x;b.DisplayObject._tempMatrix.ty=-f.y;c.render(this,b.DisplayObject._tempMatrix);return c},updateCache:function(){this._generateCachedSprite();return this},toGlobal:function(c){this.updateTransform();return this.worldTransform.apply(c)},toLocal:function(c,d){if(d){c=d.toGlobal(c)}this.updateTransform();return this.worldTransform.applyInverse(c)},_renderCachedSprite:function(c){this._cachedSprite.worldAlpha=this.worldAlpha;if(c.gl){b.Sprite.prototype._renderWebGL.call(this._cachedSprite,c)}else{b.Sprite.prototype._renderCanvas.call(this._cachedSprite,c)}},_generateCachedSprite:function(){this._cacheAsBitmap=false;var e=this.getLocalBounds();e.width=Math.max(1,Math.ceil(e.width));e.height=Math.max(1,Math.ceil(e.height));this.updateTransform();if(!this._cachedSprite){var c=new b.RenderTexture(e.width,e.height);this._cachedSprite=new b.Sprite(c);this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.texture.resize(e.width,e.height)}var d=this._filters;this._filters=null;this._cachedSprite.filters=d;b.DisplayObject._tempMatrix.tx=-e.x;b.DisplayObject._tempMatrix.ty=-e.y;this._cachedSprite.texture.render(this,b.DisplayObject._tempMatrix,true);this._cachedSprite.anchor.x=-(e.x/e.width);this._cachedSprite.anchor.y=-(e.y/e.height);this._filters=d;this._cacheAsBitmap=true},_destroyCachedSprite:function(){if(!this._cachedSprite){return}this._cachedSprite.texture.destroy(true);this._cachedSprite=null}};b.DisplayObject.prototype.displayObjectUpdateTransform=b.DisplayObject.prototype.updateTransform;Object.defineProperties(b.DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(c){this.position.x=c}},y:{get:function(){return this.position.y},set:function(c){this.position.y=c}},worldVisible:{get:function(){if(!this.visible){return false}else{var c=this.parent;if(!c){return this.visible}else{do{if(!c.visible){return false}c=c.parent}while(c)}return true}}},mask:{get:function(){return this._mask},set:function(c){if(this._mask){this._mask.isMask=false}this._mask=c;if(c){this._mask.isMask=true}}},filters:{get:function(){return this._filters},set:function(f){if(Array.isArray(f)){var e=[];for(var d=0;d<f.length;d++){var g=f[d].passes;for(var c=0;c<g.length;c++){e.push(g[c])}}this._filterBlock={target:this,filterPasses:e}}this._filters=f;if(this.blendMode&&this.blendMode===b.blendModes.MULTIPLY){this.blendMode=b.blendModes.NORMAL}}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(c){if(this._cacheAsBitmap===c){return}if(c){this._generateCachedSprite()}else{this._destroyCachedSprite()}this._cacheAsBitmap=c}}});b.DisplayObjectContainer=function(){b.DisplayObject.call(this);this.children=[];this.ignoreChildInput=false};b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype);b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer;b.DisplayObjectContainer.prototype.addChild=function(c){return this.addChildAt(c,this.children.length)};b.DisplayObjectContainer.prototype.addChildAt=function(d,c){if(c>=0&&c<=this.children.length){if(d.parent){d.parent.removeChild(d)}d.parent=this;this.children.splice(c,0,d);return d}else{throw new Error(d+"addChildAt: The index "+c+" supplied is out of bounds "+this.children.length)}};b.DisplayObjectContainer.prototype.swapChildren=function(f,c){if(f===c){return}var e=this.getChildIndex(f);var d=this.getChildIndex(c);if(e<0||d<0){throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.")}this.children[e]=c;this.children[d]=f};b.DisplayObjectContainer.prototype.getChildIndex=function(d){var c=this.children.indexOf(d);if(c===-1){throw new Error("The supplied DisplayObject must be a child of the caller")}return c};b.DisplayObjectContainer.prototype.setChildIndex=function(e,d){if(d<0||d>=this.children.length){throw new Error("The supplied index is out of bounds")}var c=this.getChildIndex(e);this.children.splice(c,1);this.children.splice(d,0,e)};b.DisplayObjectContainer.prototype.getChildAt=function(c){if(c<0||c>=this.children.length){throw new Error("getChildAt: Supplied index "+c+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller")}return this.children[c]};b.DisplayObjectContainer.prototype.removeChild=function(d){var c=this.children.indexOf(d);if(c===-1){return}return this.removeChildAt(c)};b.DisplayObjectContainer.prototype.removeChildAt=function(c){var d=this.getChildAt(c);if(d){d.parent=undefined;this.children.splice(c,1)}return d};b.DisplayObjectContainer.prototype.removeChildren=function(e,f){if(e===undefined){e=0}if(f===undefined){f=this.children.length}var c=f-e;if(c>0&&c<=f){var g=this.children.splice(begin,c);for(var d=0;d<g.length;d++){var h=g[d];h.parent=undefined}return g}else{if(c===0&&this.children.length===0){return[]}else{throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")}}};b.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible){return}this.displayObjectUpdateTransform();if(this._cacheAsBitmap){return}for(var c=0;c<this.children.length;c++){this.children[c].updateTransform()}};b.DisplayObjectContainer.prototype.displayObjectContainerUpdateTransform=b.DisplayObjectContainer.prototype.updateTransform;b.DisplayObjectContainer.prototype.getBounds=function(N){var B=(N&&N instanceof b.DisplayObject);var w=true;if(!B){N=this}else{if(N instanceof b.DisplayObjectContainer){w=N.contains(this)}else{w=false}}var y;if(B){var t=N.worldTransform;N.worldTransform=b.identityMatrix;for(y=0;y<N.children.length;y++){N.children[y].updateTransform()}}var I=Infinity;var F=Infinity;var G=-Infinity;var C=-Infinity;var E;var n;var l;var s=false;for(y=0;y<this.children.length;y++){var k=this.children[y];if(!k.visible){continue}s=true;E=this.children[y].getBounds();I=(I<E.x)?I:E.x;F=(F<E.y)?F:E.y;n=E.width+E.x;l=E.height+E.y;G=(G>n)?G:n;C=(C>l)?C:l}var m=this._bounds;if(!s){m=new b.Rectangle();var r=m.x;var q=m.width+m.x;var p=m.y;var o=m.height+m.y;var u=this.worldTransform;var M=u.a;var K=u.b;var H=u.c;var D=u.d;var L=u.tx;var J=u.ty;var A=M*q+H*o+L;var h=D*o+K*q+J;var z=M*r+H*o+L;var g=D*o+K*r+J;var x=M*r+H*p+L;var f=D*p+K*r+J;var v=M*q+H*p+L;var e=D*p+K*q+J;G=A;C=h;I=A;F=h;I=z<I?z:I;I=x<I?x:I;I=v<I?v:I;F=g<F?g:F;F=f<F?f:F;F=e<F?e:F;G=z>G?z:G;G=x>G?x:G;G=v>G?v:G;C=g>C?g:C;C=f>C?f:C;C=e>C?e:C}m.x=I;m.y=F;m.width=G-I;m.height=C-F;if(B){N.worldTransform=t;for(y=0;y<N.children.length;y++){N.children[y].updateTransform()}}if(!w){var j=N.getBounds();m.x-=j.x;m.y-=j.y}return m};b.DisplayObjectContainer.prototype.getLocalBounds=function(){return this.getBounds(this)};b.DisplayObjectContainer.prototype.contains=function(c){if(!c){return false}else{if(c===this){return true}else{return this.contains(c.parent)}}};b.DisplayObjectContainer.prototype._renderWebGL=function(d){if(!this.visible||this.alpha<=0){return}if(this._cacheAsBitmap){this._renderCachedSprite(d);return}var c;if(this._mask||this._filters){if(this._filters){d.spriteBatch.flush();d.filterManager.pushFilter(this._filterBlock)}if(this._mask){d.spriteBatch.stop();d.maskManager.pushMask(this.mask,d);d.spriteBatch.start()}for(c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}d.spriteBatch.stop();if(this._mask){d.maskManager.popMask(this._mask,d)}if(this._filters){d.filterManager.popFilter()}d.spriteBatch.start()}else{for(c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}}};b.DisplayObjectContainer.prototype._renderCanvas=function(d){if(this.visible===false||this.alpha===0){return}if(this._cacheAsBitmap){this._renderCachedSprite(d);return}if(this._mask){d.maskManager.pushMask(this._mask,d)}for(var c=0;c<this.children.length;c++){this.children[c]._renderCanvas(d)}if(this._mask){d.maskManager.popMask(d)}};Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.getLocalBounds().width*this.scale.x},set:function(d){var c=this.getLocalBounds().width;if(c!==0){this.scale.x=d/c}else{this.scale.x=1}this._width=d}});Object.defineProperty(b.DisplayObjectContainer.prototype,"height",{get:function(){return this.getLocalBounds().height*this.scale.y},set:function(d){var c=this.getLocalBounds().height;if(c!==0){this.scale.y=d/c}else{this.scale.y=1}this._height=d}});b.Sprite=function(c){b.DisplayObjectContainer.call(this);this.anchor=new b.Point();this.texture=c||b.Texture.emptyTexture;this._width=0;this._height=0;this.tint=16777215;this.cachedTint=-1;this.tintedTexture=null;this.blendMode=b.blendModes.NORMAL;this.shader=null;this.exists=true;if(this.texture.baseTexture.hasLoaded){this.onTextureUpdate()}this.renderable=true};b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Sprite.prototype.constructor=b.Sprite;Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(c){this.scale.x=c/this.texture.frame.width;this._width=c}});Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(c){this.scale.y=c/this.texture.frame.height;this._height=c}});b.Sprite.prototype.setTexture=function(d,c){if(c!==undefined){this.texture.baseTexture.destroy()}this.texture.baseTexture.skipRender=false;this.texture=d;this.texture.valid=true;this.cachedTint=-1};b.Sprite.prototype.onTextureUpdate=function(){if(this._width){this.scale.x=this._width/this.texture.frame.width}if(this._height){this.scale.y=this._height/this.texture.frame.height}};b.Sprite.prototype.getBounds=function(r){var o=this.texture.frame.width;var n=this.texture.frame.height;var m=o*(1-this.anchor.x);var l=o*-this.anchor.x;var k=n*(1-this.anchor.y);var j=n*-this.anchor.y;var p=r||this.worldTransform;var E=p.a;var C=p.b;var A=p.c;var y=p.d;var F=p.tx;var D=p.ty;var z=-Infinity;var v=-Infinity;var B=Infinity;var x=Infinity;if(C===0&&A===0){if(E<0){E*=-1;var w=m;m=-l;l=-w}if(y<0){y*=-1;var w=k;k=-j;j=-w}B=E*l+F;z=E*m+F;x=y*j+D;v=y*k+D}else{var u=E*l+A*j+F;var h=y*j+C*l+D;var t=E*m+A*j+F;var g=y*j+C*m+D;var s=E*m+A*k+F;var f=y*k+C*m+D;var q=E*l+A*k+F;var e=y*k+C*l+D;B=u<B?u:B;B=t<B?t:B;B=s<B?s:B;B=q<B?q:B;x=h<x?h:x;x=g<x?g:x;x=f<x?f:x;x=e<x?e:x;z=u>z?u:z;z=t>z?t:z;z=s>z?s:z;z=q>z?q:z;v=h>v?h:v;v=g>v?g:v;v=f>v?f:v;v=e>v?e:v}var i=this._bounds;i.x=B;i.width=z-B;i.y=x;i.height=v-x;this._currentBounds=i;return i};b.Sprite.prototype.getLocalBounds=function(){var c=this.worldTransform;this.worldTransform=b.identityMatrix;for(var d=0;d<this.children.length;d++){this.children[d].updateTransform()}var e=this.getBounds();this.worldTransform=c;for(d=0;d<this.children.length;d++){this.children[d].updateTransform()}return e};b.Sprite.prototype._renderWebGL=function(g,e){if(!this.visible||this.alpha<=0||!this.renderable){return}var c=this.worldTransform;if(e){c=e}if(this._mask||this._filters){var d=g.spriteBatch;if(this._filters){d.flush();g.filterManager.pushFilter(this._filterBlock)}if(this._mask){d.stop();g.maskManager.pushMask(this.mask,g);d.start()}d.render(this);for(var f=0;f<this.children.length;f++){this.children[f]._renderWebGL(g)}d.stop();if(this._mask){g.maskManager.popMask(this._mask,g)}if(this._filters){g.filterManager.popFilter()}d.start()}else{g.spriteBatch.render(this);for(var f=0;f<this.children.length;f++){this.children[f]._renderWebGL(g,c)}}};b.Sprite.prototype._renderCanvas=function(n,m){if(!this.visible||this.alpha===0||!this.renderable||this.texture.crop.width<=0||this.texture.crop.height<=0){return}var l=this.worldTransform;if(m){l=m}if(this.blendMode!==n.currentBlendMode){n.currentBlendMode=this.blendMode;n.context.globalCompositeOperation=b.blendModesCanvas[n.currentBlendMode]}if(this._mask){n.maskManager.pushMask(this._mask,n)}if(this.texture.valid){var e=this.texture.baseTexture.resolution/n.resolution;n.context.globalAlpha=this.worldAlpha;if(n.smoothProperty&&n.scaleMode!==this.texture.baseTexture.scaleMode){n.scaleMode=this.texture.baseTexture.scaleMode;n.context[n.smoothProperty]=(n.scaleMode===b.scaleModes.LINEAR)}var p=(this.texture.trim)?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width;var o=(this.texture.trim)?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;var k=(l.tx*n.resolution)+n.shakeX;var h=(l.ty*n.resolution)+n.shakeY;if(n.roundPixels){n.context.setTransform(l.a,l.b,l.c,l.d,k|0,h|0);p|=0;o|=0}else{n.context.setTransform(l.a,l.b,l.c,l.d,k,h)}var g=this.texture.crop.width;var c=this.texture.crop.height;p/=e;o/=e;if(this.tint!==16777215){if(this.texture.requiresReTint||this.cachedTint!==this.tint){this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint);this.cachedTint=this.tint;this.texture.requiresReTint=false}n.context.drawImage(this.tintedTexture,0,0,g,c,p,o,g/e,c/e)}else{var f=this.texture.crop.x;var d=this.texture.crop.y;n.context.drawImage(this.texture.baseTexture.source,f,d,g,c,p,o,g/e,c/e)}}for(var j=0;j<this.children.length;j++){this.children[j]._renderCanvas(n)}if(this._mask){n.maskManager.popMask(n)}};b.SpriteBatch=function(c){b.DisplayObjectContainer.call(this);this.textureThing=c;this.ready=false};b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype);b.SpriteBatch.prototype.constructor=b.SpriteBatch;b.SpriteBatch.prototype.initWebGL=function(c){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(c);this.ready=true};b.SpriteBatch.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};b.SpriteBatch.prototype._renderWebGL=function(c){if(!this.visible||this.alpha<=0||!this.children.length){return}if(!this.ready){this.initWebGL(c.gl)}if(this.fastSpriteBatch.gl!==c.gl){this.fastSpriteBatch.setContext(c.gl)}c.spriteBatch.stop();c.shaderManager.setShader(c.shaderManager.fastShader);this.fastSpriteBatch.begin(this,c);this.fastSpriteBatch.render(this);c.spriteBatch.start()};b.SpriteBatch.prototype._renderCanvas=function(n){if(!this.visible||this.alpha<=0||!this.children.length){return}var c=n.context;c.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();var f=this.worldTransform;var m=true;for(var j=0;j<this.children.length;j++){var d=this.children[j];if(!d.visible){continue}var l=d.texture;var e=l.frame;c.globalAlpha=this.worldAlpha*d.alpha;if(d.rotation%(Math.PI*2)===0){if(m){c.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty);m=false}c.drawImage(l.baseTexture.source,e.x,e.y,e.width,e.height,((d.anchor.x)*(-e.width*d.scale.x)+d.position.x+0.5+n.shakeX)|0,((d.anchor.y)*(-e.height*d.scale.y)+d.position.y+0.5+n.shakeY)|0,e.width*d.scale.x,e.height*d.scale.y)}else{if(!m){m=true}d.displayObjectUpdateTransform();var k=d.worldTransform;var h=(k.tx*n.resolution)+n.shakeX;var g=(k.ty*n.resolution)+n.shakeY;if(n.roundPixels){c.setTransform(k.a,k.b,k.c,k.d,h|0,g|0)}else{c.setTransform(k.a,k.b,k.c,k.d,h,g)}c.drawImage(l.baseTexture.source,e.x,e.y,e.width,e.height,((d.anchor.x)*(-e.width)+0.5)|0,((d.anchor.y)*(-e.height)+0.5)|0,e.width,e.height)}}};b.hex2rgb=function(c){return[(c>>16&255)/255,(c>>8&255)/255,(c&255)/255]};b.rgb2hex=function(c){return((c[0]*255<<16)+(c[1]*255<<8)+c[2]*255)};b.canUseNewCanvasBlendModes=function(){if(document===undefined){return false}var d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/";var h="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==";var c=new Image();c.src=d+"AP804Oa6"+h;var i=new Image();i.src=d+"/wCKxvRF"+h;var e=b.CanvasPool.create(this,6,1);var f=e.getContext("2d");f.globalCompositeOperation="multiply";f.drawImage(c,0,0);f.drawImage(i,2,0);if(!f.getImageData(2,0,1,1)){return false}var g=f.getImageData(2,0,1,1).data;b.CanvasPool.remove(this);return(g[0]===255&&g[1]===0&&g[2]===0)};b.getNextPowerOfTwo=function(d){if(d>0&&(d&(d-1))===0){return d}else{var c=1;while(c<d){c<<=1}return c}};b.isPowerOfTwo=function(d,c){return(d>0&&(d&(d-1))===0&&c>0&&(c&(c-1))===0)};b.CanvasPool={create:function(h,g,d){var c=b.CanvasPool.getFirst();var f;if(c===-1){var e={parent:h,canvas:document.createElement("canvas")};b.CanvasPool.pool.push(e);f=e.canvas}else{b.CanvasPool.pool[c].parent=h;f=b.CanvasPool.pool[c].canvas}if(g!==undefined){f.width=g;f.height=d}return f},getFirst:function(){var d=b.CanvasPool.pool;for(var c=0;c<d.length;c++){if(!d[c].parent){return c}}return -1},remove:function(e){var d=b.CanvasPool.pool;for(var c=0;c<d.length;c++){if(d[c].parent===e){d[c].parent=null;d[c].canvas.width=1;d[c].canvas.height=1}}},removeByCanvas:function(c){var e=b.CanvasPool.pool;for(var d=0;d<e.length;d++){if(e[d].canvas===c){e[d].parent=null;e[d].canvas.width=1;e[d].canvas.height=1}}},getTotal:function(){var e=b.CanvasPool.pool;var f=0;for(var d=0;d<e.length;d++){if(e[d].parent){f++}}return f},getFree:function(){var e=b.CanvasPool.pool;var f=0;for(var d=0;d<e.length;d++){if(!e[d].parent){f++}}return f}};b.CanvasPool.pool=[];b.initDefaultShaders=function(){};b.CompileVertexShader=function(d,c){return b._CompileShader(d,c,d.VERTEX_SHADER)};b.CompileFragmentShader=function(d,c){return b._CompileShader(d,c,d.FRAGMENT_SHADER)};b._CompileShader=function(g,f,e){var d=f;if(Array.isArray(f)){d=f.join("\n")}var c=g.createShader(e);g.shaderSource(c,d);g.compileShader(c);if(!g.getShaderParameter(c,g.COMPILE_STATUS)){window.console.log(g.getShaderInfoLog(c));return null}return c};b.compileProgram=function(g,c,e){var d=b.CompileFragmentShader(g,e);var f=b.CompileVertexShader(g,c);var h=g.createProgram();g.attachShader(h,f);g.attachShader(h,d);g.linkProgram(h);if(!g.getProgramParameter(h,g.LINK_STATUS)){window.console.log(g.getProgramInfoLog(h));window.console.log("Could not initialise shaders")}return h};b.PixiShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.firstRun=true;this.dirty=true;this.attributes=[];this.init()};b.PixiShader.prototype.constructor=b.PixiShader;b.PixiShader.prototype.init=function(){var e=this.gl;var c=b.compileProgram(e,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(c);this.uSampler=e.getUniformLocation(c,"uSampler");this.projectionVector=e.getUniformLocation(c,"projectionVector");this.offsetVector=e.getUniformLocation(c,"offsetVector");this.dimensions=e.getUniformLocation(c,"dimensions");this.aVertexPosition=e.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=e.getAttribLocation(c,"aTextureCoord");this.colorAttribute=e.getAttribLocation(c,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var d in this.uniforms){this.uniforms[d].uniformLocation=e.getUniformLocation(c,d)}this.initUniforms();this.program=c};b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var f=this.gl;var c;for(var d in this.uniforms){c=this.uniforms[d];var e=c.type;if(e==="sampler2D"){c._init=false;if(c.value!==null){this.initSampler2D(c)}}else{if(e==="mat2"||e==="mat3"||e==="mat4"){c.glMatrix=true;c.glValueLength=1;if(e==="mat2"){c.glFunc=f.uniformMatrix2fv}else{if(e==="mat3"){c.glFunc=f.uniformMatrix3fv}else{if(e==="mat4"){c.glFunc=f.uniformMatrix4fv}}}}else{c.glFunc=f["uniform"+e];if(e==="2f"||e==="2i"){c.glValueLength=2}else{if(e==="3f"||e==="3i"){c.glValueLength=3}else{if(e==="4f"||e==="4i"){c.glValueLength=4}else{c.glValueLength=1}}}}}}};b.PixiShader.prototype.initSampler2D=function(e){if(!e.value||!e.value.baseTexture||!e.value.baseTexture.hasLoaded){return}var j=this.gl;j.activeTexture(j["TEXTURE"+this.textureCount]);j.bindTexture(j.TEXTURE_2D,e.value.baseTexture._glTextures[j.id]);if(e.textureData){var h=e.textureData;var l=(h.magFilter)?h.magFilter:j.LINEAR;var d=(h.minFilter)?h.minFilter:j.LINEAR;var i=(h.wrapS)?h.wrapS:j.CLAMP_TO_EDGE;var g=(h.wrapT)?h.wrapT:j.CLAMP_TO_EDGE;var k=(h.luminance)?j.LUMINANCE:j.RGBA;if(h.repeat){i=j.REPEAT;g=j.REPEAT}j.pixelStorei(j.UNPACK_FLIP_Y_WEBGL,!!h.flipY);if(h.width){var c=(h.width)?h.width:512;var m=(h.height)?h.height:2;var f=(h.border)?h.border:0;j.texImage2D(j.TEXTURE_2D,0,k,c,m,f,k,j.UNSIGNED_BYTE,null)}else{j.texImage2D(j.TEXTURE_2D,0,k,j.RGBA,j.UNSIGNED_BYTE,e.value.baseTexture.source)}j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,l);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,d);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,i);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,g)}j.uniform1i(e.uniformLocation,this.textureCount);e._init=true;this.textureCount++};b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var c;var e=this.gl;for(var d in this.uniforms){c=this.uniforms[d];if(c.glValueLength===1){if(c.glMatrix===true){c.glFunc.call(e,c.uniformLocation,c.transpose,c.value)}else{c.glFunc.call(e,c.uniformLocation,c.value)}}else{if(c.glValueLength===2){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y)}else{if(c.glValueLength===3){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y,c.value.z)}else{if(c.glValueLength===4){c.glFunc.call(e,c.uniformLocation,c.value.x,c.value.y,c.value.z,c.value.w)}else{if(c.type==="sampler2D"){if(c._init){e.activeTexture(e["TEXTURE"+this.textureCount]);if(c.value.baseTexture._dirty[e.id]){b.instances[e.id].updateTexture(c.value.baseTexture)}else{e.bindTexture(e.TEXTURE_2D,c.value.baseTexture._glTextures[e.id])}e.uniform1i(c.uniformLocation,this.textureCount);this.textureCount++}else{this.initSampler2D(c)}}}}}}}};b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"];b.PixiFastShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};b.PixiFastShader.prototype.constructor=b.PixiFastShader;b.PixiFastShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.uSampler=d.getUniformLocation(c,"uSampler");this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.dimensions=d.getUniformLocation(c,"dimensions");this.uMatrix=d.getUniformLocation(c,"uMatrix");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.aPositionCoord=d.getAttribLocation(c,"aPositionCoord");this.aScale=d.getAttribLocation(c,"aScale");this.aRotation=d.getAttribLocation(c,"aRotation");this.aTextureCoord=d.getAttribLocation(c,"aTextureCoord");this.colorAttribute=d.getAttribLocation(c,"aColor");if(this.colorAttribute===-1){this.colorAttribute=2}this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=c};b.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.StripShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * alpha;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};b.StripShader.prototype.constructor=b.StripShader;b.StripShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.uSampler=d.getUniformLocation(c,"uSampler");this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.colorAttribute=d.getAttribLocation(c,"aColor");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.aTextureCoord=d.getAttribLocation(c,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};b.PrimitiveShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};b.PrimitiveShader.prototype.constructor=b.PrimitiveShader;b.PrimitiveShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.tintColor=d.getUniformLocation(c,"tint");this.flipY=d.getUniformLocation(c,"flipY");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.colorAttribute=d.getAttribLocation(c,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};b.ComplexPrimitiveShader=function(c){this._UID=b._UID++;this.gl=c;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","uniform float flipY;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, (v.y / projectionVector.y * -flipY) + flipY , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};b.ComplexPrimitiveShader.prototype.constructor=b.ComplexPrimitiveShader;b.ComplexPrimitiveShader.prototype.init=function(){var d=this.gl;var c=b.compileProgram(d,this.vertexSrc,this.fragmentSrc);d.useProgram(c);this.projectionVector=d.getUniformLocation(c,"projectionVector");this.offsetVector=d.getUniformLocation(c,"offsetVector");this.tintColor=d.getUniformLocation(c,"tint");this.color=d.getUniformLocation(c,"color");this.flipY=d.getUniformLocation(c,"flipY");this.aVertexPosition=d.getAttribLocation(c,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=d.getUniformLocation(c,"translationMatrix");this.alpha=d.getUniformLocation(c,"alpha");this.program=c};b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};b.glContexts=[];b.instances=[];b.WebGLRenderer=function(c){this.game=c;if(!b.defaultRenderer){b.defaultRenderer=this}this.type=b.WEBGL_RENDERER;this.resolution=c.resolution;this.transparent=c.transparent;this.autoResize=false;this.preserveDrawingBuffer=c.preserveDrawingBuffer;this.clearBeforeRender=c.clearBeforeRender;this.width=c.width;this.height=c.height;this.view=c.canvas;this._contextOptions={alpha:this.transparent,antialias:c.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:true,preserveDrawingBuffer:this.preserveDrawingBuffer};this.projection=new b.Point();this.offset=new b.Point();this.shaderManager=new b.WebGLShaderManager();this.spriteBatch=new b.WebGLSpriteBatch();this.maskManager=new b.WebGLMaskManager();this.filterManager=new b.WebGLFilterManager();this.stencilManager=new b.WebGLStencilManager();this.blendModeManager=new b.WebGLBlendModeManager();this.renderSession={};this.renderSession.game=this.game;this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;this.renderSession.resolution=this.resolution;this.initContext();this.mapBlendModes()};b.WebGLRenderer.prototype.constructor=b.WebGLRenderer;b.WebGLRenderer.prototype.initContext=function(){var c=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=c;if(!c){throw new Error("This browser does not support webGL. Try using the canvas renderer")}this.glContextId=c.id=b.WebGLRenderer.glContextId++;b.glContexts[this.glContextId]=c;b.instances[this.glContextId]=this;c.disable(c.DEPTH_TEST);c.disable(c.CULL_FACE);c.enable(c.BLEND);this.shaderManager.setContext(c);this.spriteBatch.setContext(c);this.maskManager.setContext(c);this.filterManager.setContext(c);this.blendModeManager.setContext(c);this.stencilManager.setContext(c);this.renderSession.gl=this.gl;this.resize(this.width,this.height)};b.WebGLRenderer.prototype.render=function(c){if(this.contextLost){return}var d=this.gl;d.viewport(0,0,this.width,this.height);d.bindFramebuffer(d.FRAMEBUFFER,null);if(this.game.clearBeforeRender){d.clearColor(c._bgColor.r,c._bgColor.g,c._bgColor.b,c._bgColor.a);d.clear(d.COLOR_BUFFER_BIT)}this.offset.x=this.game.camera._shake.x;this.offset.y=this.game.camera._shake.y;this.renderDisplayObject(c,this.projection)};b.WebGLRenderer.prototype.renderDisplayObject=function(f,c,d,e){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.flipY=d?-1:1;this.renderSession.projection=c;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,d);f._renderWebGL(this.renderSession,e);this.spriteBatch.end()};b.WebGLRenderer.prototype.resize=function(d,c){this.width=d*this.resolution;this.height=c*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2/this.resolution;this.projection.y=-this.height/2/this.resolution};b.WebGLRenderer.prototype.updateTexture=function(c){if(!c.hasLoaded){return false}var d=this.gl;if(!c._glTextures[d.id]){c._glTextures[d.id]=d.createTexture()}d.bindTexture(d.TEXTURE_2D,c._glTextures[d.id]);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.premultipliedAlpha);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,c.source);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR:d.NEAREST);if(c.mipmap&&b.isPowerOfTwo(c.width,c.height)){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR_MIPMAP_LINEAR:d.NEAREST_MIPMAP_NEAREST);d.generateMipmap(d.TEXTURE_2D)}else{d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,c.scaleMode===b.scaleModes.LINEAR?d.LINEAR:d.NEAREST)}if(!c._powerOf2){d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE)}else{d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT)}c._dirty[d.id]=false;return true};b.WebGLRenderer.prototype.destroy=function(){b.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null;b.CanvasPool.remove(this);b.instances[this.glContextId]=null;b.WebGLRenderer.glContextId--};b.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;if(!b.blendModesWebGL){var c=[];var d=b.blendModes;c[d.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.ADD]=[e.SRC_ALPHA,e.DST_ALPHA];c[d.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA];c[d.SCREEN]=[e.SRC_ALPHA,e.ONE];c[d.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];c[d.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA];b.blendModesWebGL=c}};b.WebGLRenderer.glContextId=0;b.WebGLBlendModeManager=function(){this.currentBlendMode=99999};b.WebGLBlendModeManager.prototype.constructor=b.WebGLBlendModeManager;b.WebGLBlendModeManager.prototype.setContext=function(c){this.gl=c};b.WebGLBlendModeManager.prototype.setBlendMode=function(c){if(this.currentBlendMode===c){return false}this.currentBlendMode=c;var d=b.blendModesWebGL[this.currentBlendMode];if(d){this.gl.blendFunc(d[0],d[1])}return true};b.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};b.WebGLMaskManager=function(){};b.WebGLMaskManager.prototype.constructor=b.WebGLMaskManager;b.WebGLMaskManager.prototype.setContext=function(c){this.gl=c};b.WebGLMaskManager.prototype.pushMask=function(d,c){var e=c.gl;if(d.dirty){b.WebGLGraphics.updateGraphics(d,e)}if(d._webGL[e.id]===undefined||d._webGL[e.id].data===undefined||d._webGL[e.id].data.length===0){return}c.stencilManager.pushStencil(d,d._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.popMask=function(d,c){var e=this.gl;if(d._webGL[e.id]===undefined||d._webGL[e.id].data===undefined||d._webGL[e.id].data.length===0){return}c.stencilManager.popStencil(d,d._webGL[e.id].data[0],c)};b.WebGLMaskManager.prototype.destroy=function(){this.gl=null};b.WebGLStencilManager=function(){this.stencilStack=[];this.reverse=true;this.count=0};b.WebGLStencilManager.prototype.setContext=function(c){this.gl=c};b.WebGLStencilManager.prototype.pushStencil=function(c,f,d){var e=this.gl;this.bindGraphics(c,f,d);if(this.stencilStack.length===0){e.enable(e.STENCIL_TEST);e.clear(e.STENCIL_BUFFER_BIT);this.reverse=true;this.count=0}this.stencilStack.push(f);var g=this.count;e.colorMask(false,false,false,false);e.stencilFunc(e.ALWAYS,0,255);e.stencilOp(e.KEEP,e.KEEP,e.INVERT);if(f.mode===1){e.drawElements(e.TRIANGLE_FAN,f.indices.length-4,e.UNSIGNED_SHORT,0);if(this.reverse){e.stencilFunc(e.EQUAL,255-g,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}else{e.stencilFunc(e.EQUAL,g,255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);if(this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255)}else{e.stencilFunc(e.EQUAL,g+1,255)}this.reverse=!this.reverse}else{if(!this.reverse){e.stencilFunc(e.EQUAL,255-g,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}else{e.stencilFunc(e.EQUAL,g,255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255)}else{e.stencilFunc(e.EQUAL,g+1,255)}}e.colorMask(true,true,true,true);e.stencilOp(e.KEEP,e.KEEP,e.KEEP);this.count++};b.WebGLStencilManager.prototype.bindGraphics=function(d,i,f){this._currentGraphics=d;var h=this.gl;var c=f.projection,g=f.offset,e;if(i.mode===1){e=f.shaderManager.complexPrimitiveShader;f.shaderManager.setShader(e);h.uniform1f(e.flipY,f.flipY);h.uniformMatrix3fv(e.translationMatrix,false,d.worldTransform.toArray(true));h.uniform2f(e.projectionVector,c.x,-c.y);h.uniform2f(e.offsetVector,-g.x,-g.y);h.uniform3fv(e.tintColor,b.hex2rgb(d.tint));h.uniform3fv(e.color,i.color);h.uniform1f(e.alpha,d.worldAlpha*i.alpha);h.bindBuffer(h.ARRAY_BUFFER,i.buffer);h.vertexAttribPointer(e.aVertexPosition,2,h.FLOAT,false,4*2,0);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}else{e=f.shaderManager.primitiveShader;f.shaderManager.setShader(e);h.uniformMatrix3fv(e.translationMatrix,false,d.worldTransform.toArray(true));h.uniform1f(e.flipY,f.flipY);h.uniform2f(e.projectionVector,c.x,-c.y);h.uniform2f(e.offsetVector,-g.x,-g.y);h.uniform3fv(e.tintColor,b.hex2rgb(d.tint));h.uniform1f(e.alpha,d.worldAlpha);h.bindBuffer(h.ARRAY_BUFFER,i.buffer);h.vertexAttribPointer(e.aVertexPosition,2,h.FLOAT,false,4*6,0);h.vertexAttribPointer(e.colorAttribute,4,h.FLOAT,false,4*6,2*4);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i.indexBuffer)}};b.WebGLStencilManager.prototype.popStencil=function(c,f,d){var e=this.gl;this.stencilStack.pop();this.count--;if(this.stencilStack.length===0){e.disable(e.STENCIL_TEST)}else{var g=this.count;this.bindGraphics(c,f,d);e.colorMask(false,false,false,false);if(f.mode===1){this.reverse=!this.reverse;if(this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}else{e.stencilFunc(e.EQUAL,g+1,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,(f.indices.length-4)*2);e.stencilFunc(e.ALWAYS,0,255);e.stencilOp(e.KEEP,e.KEEP,e.INVERT);e.drawElements(e.TRIANGLE_FAN,f.indices.length-4,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g),255)}else{e.stencilFunc(e.EQUAL,g,255)}}else{if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g+1),255);e.stencilOp(e.KEEP,e.KEEP,e.INCR)}else{e.stencilFunc(e.EQUAL,g+1,255);e.stencilOp(e.KEEP,e.KEEP,e.DECR)}e.drawElements(e.TRIANGLE_STRIP,f.indices.length,e.UNSIGNED_SHORT,0);if(!this.reverse){e.stencilFunc(e.EQUAL,255-(g),255)}else{e.stencilFunc(e.EQUAL,g,255)}}e.colorMask(true,true,true,true);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}};b.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};b.WebGLShaderManager=function(){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var c=0;c<this.maxAttibs;c++){this.attribState[c]=false}this.stack=[]};b.WebGLShaderManager.prototype.constructor=b.WebGLShaderManager;b.WebGLShaderManager.prototype.setContext=function(c){this.gl=c;this.primitiveShader=new b.PrimitiveShader(c);this.complexPrimitiveShader=new b.ComplexPrimitiveShader(c);this.defaultShader=new b.PixiShader(c);this.fastShader=new b.PixiFastShader(c);this.stripShader=new b.StripShader(c);this.setShader(this.defaultShader)};b.WebGLShaderManager.prototype.setAttribs=function(f){var d;for(d=0;d<this.tempAttribState.length;d++){this.tempAttribState[d]=false}for(d=0;d<f.length;d++){var c=f[d];this.tempAttribState[c]=true}var e=this.gl;for(d=0;d<this.attribState.length;d++){if(this.attribState[d]!==this.tempAttribState[d]){this.attribState[d]=this.tempAttribState[d];if(this.tempAttribState[d]){e.enableVertexAttribArray(d)}else{e.disableVertexAttribArray(d)}}}};b.WebGLShaderManager.prototype.setShader=function(c){if(this._currentId===c._UID){return false}this._currentId=c._UID;this.currentShader=c;this.gl.useProgram(c.program);this.setAttribs(c.attributes);return true};b.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};b.WebGLSpriteBatch=function(){this.vertSize=5;this.size=2000;var c=this.size*4*4*this.vertSize;var f=this.size*6;this.vertices=new b.ArrayBuffer(c);this.positions=new b.Float32Array(this.vertices);this.colors=new b.Uint32Array(this.vertices);this.indices=new b.Uint16Array(f);this.lastIndexCount=0;for(var e=0,d=0;e<f;e+=6,d+=4){this.indices[e+0]=d+0;this.indices[e+1]=d+1;this.indices[e+2]=d+2;this.indices[e+3]=d+0;this.indices[e+4]=d+2;this.indices[e+5]=d+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.dirty=true;this.textures=[];this.blendModes=[];this.shaders=[];this.sprites=[];this.defaultShader=new b.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])};b.WebGLSpriteBatch.prototype.setContext=function(d){this.gl=d;this.vertexBuffer=d.createBuffer();this.indexBuffer=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.indexBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this.indices,d.STATIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this.vertexBuffer);d.bufferData(d.ARRAY_BUFFER,this.vertices,d.DYNAMIC_DRAW);this.currentBlendMode=99999;var c=new b.PixiShader(d);c.fragmentSrc=this.defaultShader.fragmentSrc;c.uniforms={};c.init();this.defaultShader.shaders[d.id]=c};b.WebGLSpriteBatch.prototype.begin=function(c){this.renderSession=c;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};b.WebGLSpriteBatch.prototype.end=function(){this.flush()};b.WebGLSpriteBatch.prototype.render=function(r,t){var q=r.texture;var e=r.worldTransform;if(t){e=t}if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=q.baseTexture}var n=q._uvs;if(!n){return}var g=r.anchor.x;var f=r.anchor.y;var p,o,l,k;if(q.trim){var v=q.trim;o=v.x-g*v.width;p=o+q.crop.width;k=v.y-f*v.height;l=k+q.crop.height}else{p=(q.frame.width)*(1-g);o=(q.frame.width)*-g;l=q.frame.height*(1-f);k=q.frame.height*-f}var u=this.currentBatchSize*4*this.vertSize;var s=q.baseTexture.resolution;var B=e.a/s;var z=e.b/s;var x=e.c/s;var w=e.d/s;var A=e.tx;var y=e.ty;var m=this.colors;var j=this.positions;if(this.renderSession.roundPixels){j[u]=B*o+x*k+A|0;j[u+1]=w*k+z*o+y|0;j[u+5]=B*p+x*k+A|0;j[u+6]=w*k+z*p+y|0;j[u+10]=B*p+x*l+A|0;j[u+11]=w*l+z*p+y|0;j[u+15]=B*o+x*l+A|0;j[u+16]=w*l+z*o+y|0}else{j[u]=B*o+x*k+A;j[u+1]=w*k+z*o+y;j[u+5]=B*p+x*k+A;j[u+6]=w*k+z*p+y;j[u+10]=B*p+x*l+A;j[u+11]=w*l+z*p+y;j[u+15]=B*o+x*l+A;j[u+16]=w*l+z*o+y}j[u+2]=n.x0;j[u+3]=n.y0;j[u+7]=n.x1;j[u+8]=n.y1;j[u+12]=n.x2;j[u+13]=n.y2;j[u+17]=n.x3;j[u+18]=n.y3;var h=r.tint;m[u+4]=m[u+9]=m[u+14]=m[u+19]=(h>>16)+(h&65280)+((h&255)<<16)+(r.worldAlpha*255<<24);this.sprites[this.currentBatchSize++]=r};b.WebGLSpriteBatch.prototype.renderTilingSprite=function(u){var s=u.tilingTexture;if(this.currentBatchSize>=this.size){this.flush();this.currentBaseTexture=s.baseTexture}if(!u._uvs){u._uvs=new b.TextureUvs()}var o=u._uvs;var q=s.baseTexture.width;var A=s.baseTexture.height;u.tilePosition.x%=q*u.tileScaleOffset.x;u.tilePosition.y%=A*u.tileScaleOffset.y;var C=u.tilePosition.x/(q*u.tileScaleOffset.x);var B=u.tilePosition.y/(A*u.tileScaleOffset.y);var I=(u.width/q)/(u.tileScale.x*u.tileScaleOffset.x);var F=(u.height/A)/(u.tileScale.y*u.tileScaleOffset.y);o.x0=0-C;o.y0=0-B;o.x1=(1*I)-C;o.y1=0-B;o.x2=(1*I)-C;o.y2=(1*F)-B;o.x3=0-C;o.y3=(1*F)-B;var j=u.tint;var y=(j>>16)+(j&65280)+((j&255)<<16)+(u.worldAlpha*255<<24);var l=this.positions;var n=this.colors;var v=u.width;var t=u.height;var g=u.anchor.x;var f=u.anchor.y;var r=v*(1-g);var p=v*-g;var m=t*(1-f);var k=t*-f;var z=this.currentBatchSize*4*this.vertSize;var x=s.baseTexture.resolution;var e=u.worldTransform;var K=e.a/x;var H=e.b/x;var E=e.c/x;var D=e.d/x;var J=e.tx;var G=e.ty;l[z++]=K*p+E*k+J;l[z++]=D*k+H*p+G;l[z++]=o.x0;l[z++]=o.y0;n[z++]=y;l[z++]=(K*r+E*k+J);l[z++]=D*k+H*r+G;l[z++]=o.x1;l[z++]=o.y1;n[z++]=y;l[z++]=K*r+E*m+J;l[z++]=D*m+H*r+G;l[z++]=o.x2;l[z++]=o.y2;n[z++]=y;l[z++]=K*p+E*m+J;l[z++]=D*m+H*p+G;l[z++]=o.x3;l[z++]=o.y3;n[z++]=y;this.sprites[this.currentBatchSize++]=u};b.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var t=this.gl;var c;if(this.dirty){this.dirty=false;t.activeTexture(t.TEXTURE0);t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c=this.defaultShader.shaders[t.id];var n=this.vertSize*4;t.vertexAttribPointer(c.aVertexPosition,2,t.FLOAT,false,n,0);t.vertexAttribPointer(c.aTextureCoord,2,t.FLOAT,false,n,2*4);t.vertexAttribPointer(c.colorAttribute,4,t.UNSIGNED_BYTE,true,n,4*4)}if(this.currentBatchSize>(this.size*0.5)){t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices)}else{var k=this.positions.subarray(0,this.currentBatchSize*4*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,k)}var r,w,h;var p=0;var g=0;var v=null;var l=this.renderSession.blendModeManager.currentBlendMode;var d=null;var f=false;var e=false;var m;for(var u=0,s=this.currentBatchSize;u<s;u++){m=this.sprites[u];if(m.tilingTexture){r=m.tilingTexture.baseTexture}else{r=m.texture.baseTexture}w=m.blendMode;h=m.shader||this.defaultShader;f=l!==w;e=d!==h;var o=r.skipRender;if(o&&m.children.length>0){o=false}if((v!==r&&!o)||f||e){this.renderBatch(v,p,g);g=u;p=0;v=r;if(f){l=w;this.renderSession.blendModeManager.setBlendMode(l)}if(e){d=h;c=d.shaders[t.id];if(!c){c=new b.PixiShader(t);c.fragmentSrc=d.fragmentSrc;c.uniforms=d.uniforms;c.init();d.shaders[t.id]=c}this.renderSession.shaderManager.setShader(c);if(c.dirty){c.syncUniforms()}var x=this.renderSession.projection;t.uniform2f(c.projectionVector,x.x,x.y);var q=this.renderSession.offset;t.uniform2f(c.offsetVector,q.x,q.y)}}p++}this.renderBatch(v,p,g);this.currentBatchSize=0};b.WebGLSpriteBatch.prototype.renderBatch=function(d,c,f){if(c===0){return}var e=this.gl;if(d._dirty[e.id]){if(!this.renderSession.renderer.updateTexture(d)){return}}else{e.bindTexture(e.TEXTURE_2D,d._glTextures[e.id])}e.drawElements(e.TRIANGLES,c*6,e.UNSIGNED_SHORT,f*6*2);this.renderSession.drawCount++};b.WebGLSpriteBatch.prototype.stop=function(){this.flush();this.dirty=true};b.WebGLSpriteBatch.prototype.start=function(){this.dirty=true};b.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};b.WebGLFastSpriteBatch=function(g){this.vertSize=10;this.maxSize=6000;this.size=this.maxSize;var c=this.size*4*this.vertSize;var f=this.maxSize*6;this.vertices=new b.Float32Array(c);this.indices=new b.Uint16Array(f);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var e=0,d=0;e<f;e+=6,d+=4){this.indices[e+0]=d+0;this.indices[e+1]=d+1;this.indices[e+2]=d+2;this.indices[e+3]=d+0;this.indices[e+4]=d+2;this.indices[e+5]=d+3}this.drawing=false;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(g)};b.WebGLFastSpriteBatch.prototype.constructor=b.WebGLFastSpriteBatch;b.WebGLFastSpriteBatch.prototype.setContext=function(c){this.gl=c;this.vertexBuffer=c.createBuffer();this.indexBuffer=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertices,c.DYNAMIC_DRAW)};b.WebGLFastSpriteBatch.prototype.begin=function(c,d){this.renderSession=d;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=c.worldTransform.toArray(true);this.start()};b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.render=function(c){var g=c.children;var f=g[0];if(!f.texture._uvs){return}this.currentBaseTexture=f.texture.baseTexture;if(f.blendMode!==this.renderSession.blendModeManager.currentBlendMode){this.flush();this.renderSession.blendModeManager.setBlendMode(f.blendMode)}for(var e=0,d=g.length;e<d;e++){this.renderSprite(g[e])}this.flush()};b.WebGLFastSpriteBatch.prototype.renderSprite=function(l){if(!l.visible){return}if(l.texture.baseTexture!==this.currentBaseTexture&&!l.texture.baseTexture.skipRender){this.flush();this.currentBaseTexture=l.texture.baseTexture;if(!l.texture._uvs){return}}var e,i=this.vertices,c,m,g,f,k,j,h;e=l.texture._uvs;c=l.texture.frame.width;m=l.texture.frame.height;if(l.texture.trim){var d=l.texture.trim;f=d.x-l.anchor.x*d.width;g=f+l.texture.crop.width;j=d.y-l.anchor.y*d.height;k=j+l.texture.crop.height}else{g=(l.texture.frame.width)*(1-l.anchor.x);f=(l.texture.frame.width)*-l.anchor.x;k=l.texture.frame.height*(1-l.anchor.y);j=l.texture.frame.height*-l.anchor.y}h=this.currentBatchSize*4*this.vertSize;i[h++]=f;i[h++]=j;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x0;i[h++]=e.y1;i[h++]=l.alpha;i[h++]=g;i[h++]=j;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x1;i[h++]=e.y1;i[h++]=l.alpha;i[h++]=g;i[h++]=k;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x2;i[h++]=e.y2;i[h++]=l.alpha;i[h++]=f;i[h++]=k;i[h++]=l.position.x;i[h++]=l.position.y;i[h++]=l.scale.x;i[h++]=l.scale.y;i[h++]=l.rotation;i[h++]=e.x3;i[h++]=e.y3;i[h++]=l.alpha;this.currentBatchSize++;if(this.currentBatchSize>=this.size){this.flush()}};b.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0){return}var d=this.gl;if(!this.currentBaseTexture._glTextures[d.id]){this.renderSession.renderer.updateTexture(this.currentBaseTexture,d)}d.bindTexture(d.TEXTURE_2D,this.currentBaseTexture._glTextures[d.id]);if(this.currentBatchSize>(this.size*0.5)){d.bufferSubData(d.ARRAY_BUFFER,0,this.vertices)}else{var c=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);d.bufferSubData(d.ARRAY_BUFFER,0,c)}d.drawElements(d.TRIANGLES,this.currentBatchSize*6,d.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++};b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};b.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0);e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,c.x,c.y);e.uniformMatrix3fv(this.shader.uMatrix,false,this.matrix);var d=this.vertSize*4;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,false,d,0);e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,false,d,2*4);e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,false,d,4*4);e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,false,d,6*4);e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,false,d,7*4);e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,false,d,9*4)};b.WebGLFilterManager=function(){this.filterStack=[];this.offsetX=0;this.offsetY=0};b.WebGLFilterManager.prototype.constructor=b.WebGLFilterManager;b.WebGLFilterManager.prototype.setContext=function(c){this.gl=c;this.texturePool=[];this.initShaderBuffers()};b.WebGLFilterManager.prototype.begin=function(e,d){this.renderSession=e;this.defaultShader=e.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=c.x*2;this.height=-c.y*2;this.buffer=d};b.WebGLFilterManager.prototype.pushFilter=function(d){var j=this.gl;var c=this.renderSession.projection;var i=this.renderSession.offset;d._filterArea=d.target.filterArea||d.target.getBounds();d._previous_stencil_mgr=this.renderSession.stencilManager;this.renderSession.stencilManager=new b.WebGLStencilManager();this.renderSession.stencilManager.setContext(j);j.disable(j.STENCIL_TEST);this.filterStack.push(d);var e=d.filterPasses[0];this.offsetX+=d._filterArea.x;this.offsetY+=d._filterArea.y;var f=this.texturePool.pop();if(!f){f=new b.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}else{f.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}j.bindTexture(j.TEXTURE_2D,f.texture);var g=d._filterArea;var h=e.padding;g.x-=h;g.y-=h;g.width+=h*2;g.height+=h*2;if(g.x<0){g.x=0}if(g.width>this.width){g.width=this.width}if(g.y<0){g.y=0}if(g.height>this.height){g.height=this.height}j.bindFramebuffer(j.FRAMEBUFFER,f.frameBuffer);j.viewport(0,0,g.width*this.renderSession.resolution,g.height*this.renderSession.resolution);c.x=g.width/2;c.y=-g.height/2;i.x=-g.x;i.y=-g.y;j.colorMask(true,true,true,true);j.clearColor(0,0,0,0);j.clear(j.COLOR_BUFFER_BIT);d._glFilterTexture=f};b.WebGLFilterManager.prototype.popFilter=function(){var p=this.gl;var m=this.filterStack.pop();var v=m._filterArea;var k=m._glFilterTexture;var w=this.renderSession.projection;var f=this.renderSession.offset;if(m.filterPasses.length>1){p.viewport(0,0,v.width*this.renderSession.resolution,v.height*this.renderSession.resolution);p.bindBuffer(p.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=v.height;this.vertexArray[2]=v.width;this.vertexArray[3]=v.height;this.vertexArray[4]=0;this.vertexArray[5]=0;this.vertexArray[6]=v.width;this.vertexArray[7]=0;p.bufferSubData(p.ARRAY_BUFFER,0,this.vertexArray);p.bindBuffer(p.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=v.width/this.width;this.uvArray[5]=v.height/this.height;this.uvArray[6]=v.width/this.width;this.uvArray[7]=v.height/this.height;p.bufferSubData(p.ARRAY_BUFFER,0,this.uvArray);var r=k;var d=this.texturePool.pop();if(!d){d=new b.FilterTexture(this.gl,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution)}d.resize(this.width*this.renderSession.resolution,this.height*this.renderSession.resolution);p.bindFramebuffer(p.FRAMEBUFFER,d.frameBuffer);p.clear(p.COLOR_BUFFER_BIT);p.disable(p.BLEND);for(var q=0;q<m.filterPasses.length-1;q++){var e=m.filterPasses[q];p.bindFramebuffer(p.FRAMEBUFFER,d.frameBuffer);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,r.texture);this.applyFilterPass(e,v,v.width,v.height);var u=r;r=d;d=u}p.enable(p.BLEND);k=r;this.texturePool.push(d)}var j=m.filterPasses[m.filterPasses.length-1];this.offsetX-=v.x;this.offsetY-=v.y;var n=this.width;var l=this.height;var t=0;var s=0;var o=this.buffer;if(this.filterStack.length===0){p.colorMask(true,true,true,true)}else{var c=this.filterStack[this.filterStack.length-1];v=c._filterArea;n=v.width;l=v.height;t=v.x;s=v.y;o=c._glFilterTexture.frameBuffer}w.x=n/2;w.y=-l/2;f.x=t;f.y=s;v=m._filterArea;var h=v.x-t;var g=v.y-s;p.bindBuffer(p.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=h;this.vertexArray[1]=g+v.height;this.vertexArray[2]=h+v.width;this.vertexArray[3]=g+v.height;this.vertexArray[4]=h;this.vertexArray[5]=g;this.vertexArray[6]=h+v.width;this.vertexArray[7]=g;p.bufferSubData(p.ARRAY_BUFFER,0,this.vertexArray);p.bindBuffer(p.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=v.width/this.width;this.uvArray[5]=v.height/this.height;this.uvArray[6]=v.width/this.width;this.uvArray[7]=v.height/this.height;p.bufferSubData(p.ARRAY_BUFFER,0,this.uvArray);p.viewport(0,0,n*this.renderSession.resolution,l*this.renderSession.resolution);p.bindFramebuffer(p.FRAMEBUFFER,o);p.activeTexture(p.TEXTURE0);p.bindTexture(p.TEXTURE_2D,k.texture);if(this.renderSession.stencilManager){this.renderSession.stencilManager.destroy()}this.renderSession.stencilManager=m._previous_stencil_mgr;m._previous_stencil_mgr=null;if(this.renderSession.stencilManager.count>0){p.enable(p.STENCIL_TEST)}else{p.disable(p.STENCIL_TEST)}this.applyFilterPass(j,v,n,l);this.texturePool.push(k);m._glFilterTexture=null};b.WebGLFilterManager.prototype.applyFilterPass=function(e,g,d,c){var h=this.gl;var f=e.shaders[h.id];if(!f){f=new b.PixiShader(h);f.fragmentSrc=e.fragmentSrc;f.uniforms=e.uniforms;f.init();e.shaders[h.id]=f}this.renderSession.shaderManager.setShader(f);h.uniform2f(f.projectionVector,d/2,-c/2);h.uniform2f(f.offsetVector,0,0);if(e.uniforms.dimensions){e.uniforms.dimensions.value[0]=this.width;e.uniforms.dimensions.value[1]=this.height;e.uniforms.dimensions.value[2]=this.vertexArray[0];e.uniforms.dimensions.value[3]=this.vertexArray[5]}f.syncUniforms();h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer);h.vertexAttribPointer(f.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this.uvBuffer);h.vertexAttribPointer(f.aTextureCoord,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this.colorBuffer);h.vertexAttribPointer(f.colorAttribute,2,h.FLOAT,false,0,0);h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer);h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0);this.renderSession.drawCount++};b.WebGLFilterManager.prototype.initShaderBuffers=function(){var c=this.gl;this.vertexBuffer=c.createBuffer();this.uvBuffer=c.createBuffer();this.colorBuffer=c.createBuffer();this.indexBuffer=c.createBuffer();this.vertexArray=new b.Float32Array([0,0,1,0,0,1,1,1]);c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,this.vertexArray,c.STATIC_DRAW);this.uvArray=new b.Float32Array([0,0,1,0,0,1,1,1]);c.bindBuffer(c.ARRAY_BUFFER,this.uvBuffer);c.bufferData(c.ARRAY_BUFFER,this.uvArray,c.STATIC_DRAW);this.colorArray=new b.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);c.bindBuffer(c.ARRAY_BUFFER,this.colorBuffer);c.bufferData(c.ARRAY_BUFFER,this.colorArray,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this.indexBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),c.STATIC_DRAW)};b.WebGLFilterManager.prototype.destroy=function(){var d=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var c=0;c<this.texturePool.length;c++){this.texturePool[c].destroy()}this.texturePool=null;d.deleteBuffer(this.vertexBuffer);d.deleteBuffer(this.uvBuffer);d.deleteBuffer(this.colorBuffer);d.deleteBuffer(this.indexBuffer)};b.FilterTexture=function(f,e,c,d){this.gl=f;this.frameBuffer=f.createFramebuffer();this.texture=f.createTexture();d=d||b.scaleModes.DEFAULT;f.bindTexture(f.TEXTURE_2D,this.texture);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,d===b.scaleModes.LINEAR?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,d===b.scaleModes.LINEAR?f.LINEAR:f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer);f.bindFramebuffer(f.FRAMEBUFFER,this.frameBuffer);f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,this.texture,0);this.renderBuffer=f.createRenderbuffer();f.bindRenderbuffer(f.RENDERBUFFER,this.renderBuffer);f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,this.renderBuffer);this.resize(e,c)};b.FilterTexture.prototype.constructor=b.FilterTexture;b.FilterTexture.prototype.clear=function(){var c=this.gl;c.clearColor(0,0,0,0);c.clear(c.COLOR_BUFFER_BIT)};b.FilterTexture.prototype.resize=function(d,c){if(this.width===d&&this.height===c){return}this.width=d;this.height=c;var e=this.gl;e.bindTexture(e.TEXTURE_2D,this.texture);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,d,c,0,e.RGBA,e.UNSIGNED_BYTE,null);e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,d,c)};b.FilterTexture.prototype.destroy=function(){var c=this.gl;c.deleteFramebuffer(this.frameBuffer);c.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};b.CanvasBuffer=function(d,c){this.width=d;this.height=c;this.canvas=b.CanvasPool.create(this,this.width,this.height);this.context=this.canvas.getContext("2d");this.canvas.width=d;this.canvas.height=c};b.CanvasBuffer.prototype.constructor=b.CanvasBuffer;b.CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.width,this.height)};b.CanvasBuffer.prototype.resize=function(d,c){this.width=this.canvas.width=d;this.height=this.canvas.height=c};b.CanvasBuffer.prototype.destroy=function(){b.CanvasPool.remove(this)};b.CanvasMaskManager=function(){};b.CanvasMaskManager.prototype.constructor=b.CanvasMaskManager;b.CanvasMaskManager.prototype.pushMask=function(h,g){var f=g.context;f.save();var c=h.alpha;var e=h.worldTransform;var d=g.resolution;f.setTransform(e.a*d,e.b*d,e.c*d,e.d*d,e.tx*d,e.ty*d);b.CanvasGraphics.renderGraphicsMask(h,f);f.clip();h.worldAlpha=c};b.CanvasMaskManager.prototype.popMask=function(c){c.context.restore()};b.CanvasTinter=function(){};b.CanvasTinter.getTintedTexture=function(e,c){var d=e.tintedTexture||b.CanvasPool.create(this);b.CanvasTinter.tintMethod(e.texture,c,d);return d};b.CanvasTinter.tintWithMultiply=function(g,c,d){var e=d.getContext("2d");var f=g.crop;if(d.width!==f.width||d.height!==f.height){d.width=f.width;d.height=f.height}e.clearRect(0,0,f.width,f.height);e.fillStyle="#"+("00000"+(c|0).toString(16)).substr(-6);e.fillRect(0,0,f.width,f.height);e.globalCompositeOperation="multiply";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);e.globalCompositeOperation="destination-atop";e.drawImage(g.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};b.CanvasTinter.tintWithPerPixel=function(o,k,f){var e=f.getContext("2d");var m=o.crop;f.width=m.width;f.height=m.height;e.globalCompositeOperation="copy";e.drawImage(o.baseTexture.source,m.x,m.y,m.width,m.height,0,0,m.width,m.height);var d=b.hex2rgb(k);var c=d[0],n=d[1],p=d[2];var q=e.getImageData(0,0,m.width,m.height);var h=q.data;for(var l=0;l<h.length;l+=4){h[l+0]*=c;h[l+1]*=n;h[l+2]*=p;if(!b.CanvasTinter.canHandleAlpha){var j=h[l+3];h[l+0]/=255/j;h[l+1]/=255/j;h[l+2]/=255/j}}e.putImageData(q,0,0)};b.CanvasTinter.checkInverseAlpha=function(){var d=new b.CanvasBuffer(2,1);d.context.fillStyle="rgba(10, 20, 30, 0.5)";d.context.fillRect(0,0,1,1);var e=d.context.getImageData(0,0,1,1);if(e===null){return false}d.context.putImageData(e,1,0);var c=d.context.getImageData(1,0,1,1);return(c.data[0]===e.data[0]&&c.data[1]===e.data[1]&&c.data[2]===e.data[2]&&c.data[3]===e.data[3])};b.CanvasTinter.canHandleAlpha=b.CanvasTinter.checkInverseAlpha();b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes();b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel;b.CanvasRenderer=function(c){this.game=c;if(!b.defaultRenderer){b.defaultRenderer=this}this.type=b.CANVAS_RENDERER;this.resolution=c.resolution;this.clearBeforeRender=c.clearBeforeRender;this.transparent=c.transparent;this.autoResize=false;this.width=c.width*this.resolution;this.height=c.height*this.resolution;this.view=c.canvas;this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=true;this.count=0;this.maskManager=new b.CanvasMaskManager();this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:Phaser.Canvas.getSmoothingPrefix(this.context),roundPixels:false};this.mapBlendModes();this.resize(this.width,this.height)};b.CanvasRenderer.prototype.constructor=b.CanvasRenderer;b.CanvasRenderer.prototype.render=function(c){this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;this.renderSession.currentBlendMode=0;this.renderSession.shakeX=this.game.camera._shake.x;this.renderSession.shakeY=this.game.camera._shake.y;this.context.globalCompositeOperation="source-over";if(navigator.isCocoonJS&&this.view.screencanvas){this.context.fillStyle="black";this.context.clear()}if(this.clearBeforeRender){if(this.transparent){this.context.clearRect(0,0,this.width,this.height)}else{if(c._bgColor){this.context.fillStyle=c._bgColor.rgba;this.context.fillRect(0,0,this.width,this.height)}}}this.renderDisplayObject(c)};b.CanvasRenderer.prototype.destroy=function(c){if(c===undefined){c=true}if(c&&this.view.parent){this.view.parent.removeChild(this.view)}this.view=null;this.context=null;this.maskManager=null;this.renderSession=null};b.CanvasRenderer.prototype.resize=function(d,c){this.width=d*this.resolution;this.height=c*this.resolution;this.view.width=this.width;this.view.height=this.height;if(this.autoResize){this.view.style.width=this.width/this.resolution+"px";this.view.style.height=this.height/this.resolution+"px"}if(this.renderSession.smoothProperty){this.context[this.renderSession.smoothProperty]=(this.renderSession.scaleMode===b.scaleModes.LINEAR)}};b.CanvasRenderer.prototype.renderDisplayObject=function(e,d,c){this.renderSession.context=d||this.context;this.renderSession.resolution=this.resolution;e._renderCanvas(this.renderSession,c)};b.CanvasRenderer.prototype.mapBlendModes=function(){if(!b.blendModesCanvas){var c=[];var d=b.blendModes;var e=b.canUseNewCanvasBlendModes();c[d.NORMAL]="source-over";c[d.ADD]="lighter";c[d.MULTIPLY]=(e)?"multiply":"source-over";c[d.SCREEN]=(e)?"screen":"source-over";c[d.OVERLAY]=(e)?"overlay":"source-over";c[d.DARKEN]=(e)?"darken":"source-over";c[d.LIGHTEN]=(e)?"lighten":"source-over";c[d.COLOR_DODGE]=(e)?"color-dodge":"source-over";c[d.COLOR_BURN]=(e)?"color-burn":"source-over";c[d.HARD_LIGHT]=(e)?"hard-light":"source-over";c[d.SOFT_LIGHT]=(e)?"soft-light":"source-over";c[d.DIFFERENCE]=(e)?"difference":"source-over";c[d.EXCLUSION]=(e)?"exclusion":"source-over";c[d.HUE]=(e)?"hue":"source-over";c[d.SATURATION]=(e)?"saturation":"source-over";c[d.COLOR]=(e)?"color":"source-over";c[d.LUMINOSITY]=(e)?"luminosity":"source-over";b.blendModesCanvas=c}};b.BaseTexture=function(d,c){this.resolution=1;this.width=100;this.height=100;this.scaleMode=c||b.scaleModes.DEFAULT;this.hasLoaded=false;this.source=d;this.premultipliedAlpha=true;this._glTextures=[];this.mipmap=false;this._dirty=[true,true,true,true];if(!d){return}if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height){this.hasLoaded=true;this.width=this.source.naturalWidth||this.source.width;this.height=this.source.naturalHeight||this.source.height;this.dirty()}this.skipRender=false;this._powerOf2=false};b.BaseTexture.prototype.constructor=b.BaseTexture;b.BaseTexture.prototype.forceLoaded=function(d,c){this.hasLoaded=true;this.width=d;this.height=c;this.dirty()};b.BaseTexture.prototype.destroy=function(){if(this.source){b.CanvasPool.removeByCanvas(this.source)}this.source=null;this.unloadFromGPU()};b.BaseTexture.prototype.updateSourceImage=function(c){console.warn("PIXI.BaseTexture.updateSourceImage is deprecated. Use Phaser.Sprite.loadTexture instead.")};b.BaseTexture.prototype.dirty=function(){for(var c=0;c<this._glTextures.length;c++){this._dirty[c]=true}};b.BaseTexture.prototype.unloadFromGPU=function(){this.dirty();for(var d=this._glTextures.length-1;d>=0;d--){var c=this._glTextures[d];var e=b.glContexts[d];if(e&&c){e.deleteTexture(c)}}this._glTextures.length=0;this.dirty()};b.BaseTexture.fromCanvas=function(c,d){if(c.width===0){c.width=1}if(c.height===0){c.height=1}return new b.BaseTexture(c,d)};b.TextureSilentFail=false;b.Texture=function(e,f,d,c){this.noFrame=false;if(!f){this.noFrame=true;f=new b.Rectangle(0,0,1,1)}if(e instanceof b.Texture){e=e.baseTexture}this.baseTexture=e;this.frame=f;this.trim=c;this.valid=false;this.isTiling=false;this.requiresUpdate=false;this.requiresReTint=false;this._uvs=null;this.width=0;this.height=0;this.crop=d||new b.Rectangle(0,0,1,1);if(e.hasLoaded){if(this.noFrame){f=new b.Rectangle(0,0,e.width,e.height)}this.setFrame(f)}};b.Texture.prototype.constructor=b.Texture;b.Texture.prototype.onBaseTextureLoaded=function(){var c=this.baseTexture;if(this.noFrame){this.frame=new b.Rectangle(0,0,c.width,c.height)}this.setFrame(this.frame)};b.Texture.prototype.destroy=function(c){if(c){this.baseTexture.destroy()}this.valid=false};b.Texture.prototype.setFrame=function(c){this.noFrame=false;this.frame=c;this.width=c.width;this.height=c.height;this.crop.x=c.x;this.crop.y=c.y;this.crop.width=c.width;this.crop.height=c.height;if(!this.trim&&(c.x+c.width>this.baseTexture.width||c.y+c.height>this.baseTexture.height)){if(!b.TextureSilentFail){throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this)}this.valid=false;return}this.valid=c&&c.width&&c.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;if(this.trim){this.width=this.trim.width;this.height=this.trim.height;this.frame.width=this.trim.width;this.frame.height=this.trim.height}if(this.valid){this._updateUvs()}};b.Texture.prototype._updateUvs=function(){if(!this._uvs){this._uvs=new b.TextureUvs()}var e=this.crop;var c=this.baseTexture.width;var d=this.baseTexture.height;this._uvs.x0=e.x/c;this._uvs.y0=e.y/d;this._uvs.x1=(e.x+e.width)/c;this._uvs.y1=e.y/d;this._uvs.x2=(e.x+e.width)/c;this._uvs.y2=(e.y+e.height)/d;this._uvs.x3=e.x/c;this._uvs.y3=(e.y+e.height)/d};b.Texture.fromCanvas=function(c,d){var e=b.BaseTexture.fromCanvas(c,d);return new b.Texture(e)};b.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};b.RenderTexture=function(f,c,g,e,d){this.width=f||100;this.height=c||100;this.resolution=d||1;this.frame=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.crop=new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution);this.baseTexture=new b.BaseTexture();this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution;this.baseTexture._glTextures=[];this.baseTexture.resolution=this.resolution;this.baseTexture.scaleMode=e||b.scaleModes.DEFAULT;this.baseTexture.hasLoaded=true;b.Texture.call(this,this.baseTexture,new b.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution));this.renderer=g||b.defaultRenderer;if(this.renderer.type===b.WEBGL_RENDERER){var h=this.renderer.gl;this.baseTexture._dirty[h.id]=false;this.textureBuffer=new b.FilterTexture(h,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[h.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new b.Point(this.width*0.5,-this.height*0.5)}else{this.render=this.renderCanvas;this.textureBuffer=new b.CanvasBuffer(this.width*this.resolution,this.height*this.resolution);this.baseTexture.source=this.textureBuffer.canvas}this.valid=true;this.tempMatrix=new Phaser.Matrix();this._updateUvs()};b.RenderTexture.prototype=Object.create(b.Texture.prototype);b.RenderTexture.prototype.constructor=b.RenderTexture;b.RenderTexture.prototype.resize=function(e,c,d){if(e===this.width&&c===this.height){return}this.valid=(e>0&&c>0);this.width=e;this.height=c;this.frame.width=this.crop.width=e*this.resolution;this.frame.height=this.crop.height=c*this.resolution;if(d){this.baseTexture.width=this.width*this.resolution;this.baseTexture.height=this.height*this.resolution}if(this.renderer.type===b.WEBGL_RENDERER){this.projection.x=this.width/2;this.projection.y=-this.height/2}if(!this.valid){return}this.textureBuffer.resize(this.width,this.height)};b.RenderTexture.prototype.clear=function(){if(!this.valid){return}if(this.renderer.type===b.WEBGL_RENDERER){this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer)}this.textureBuffer.clear()};b.RenderTexture.prototype.renderWebGL=function(h,e,d){if(!this.valid||h.alpha===0){return}var c=h.worldTransform;c.identity();c.translate(0,this.projection.y*2);if(e){c.append(e)}c.scale(1,-1);for(var f=0;f<h.children.length;f++){h.children[f].updateTransform()}var g=this.renderer.gl;g.viewport(0,0,this.width*this.resolution,this.height*this.resolution);g.bindFramebuffer(g.FRAMEBUFFER,this.textureBuffer.frameBuffer);if(d){this.textureBuffer.clear()}this.renderer.spriteBatch.dirty=true;this.renderer.renderDisplayObject(h,this.projection,this.textureBuffer.frameBuffer,e);this.renderer.spriteBatch.dirty=true};b.RenderTexture.prototype.renderCanvas=function(h,e,d){if(!this.valid||h.alpha===0){return}var c=h.worldTransform;c.identity();if(e){c.append(e)}for(var f=0;f<h.children.length;f++){h.children[f].updateTransform()}if(d){this.textureBuffer.clear()}var g=this.renderer.resolution;this.renderer.resolution=this.resolution;this.renderer.renderDisplayObject(h,this.textureBuffer.context,e);this.renderer.resolution=g};b.RenderTexture.prototype.getImage=function(){var c=new Image();c.src=this.getBase64();return c};b.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};b.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===b.WEBGL_RENDERER){var h=this.renderer.gl;var f=this.textureBuffer.width;var c=this.textureBuffer.height;var d=new Uint8Array(4*f*c);h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer);h.readPixels(0,0,f,c,h.RGBA,h.UNSIGNED_BYTE,d);h.bindFramebuffer(h.FRAMEBUFFER,null);var g=new b.CanvasBuffer(f,c);var e=g.context.getImageData(0,0,f,c);e.data.set(d);g.context.putImageData(e,0,0);return g.canvas}else{return this.textureBuffer.canvas}};b.AbstractFilter=function(d,c){this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.uniforms=c||{};this.fragmentSrc=d||[]};b.AbstractFilter.prototype.constructor=b.AbstractFilter;b.AbstractFilter.prototype.syncUniforms=function(){for(var d=0,c=this.shaders.length;d<c;d++){this.shaders[d].dirty=true}};b.Strip=function(c){b.DisplayObjectContainer.call(this);this.texture=c;this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]);this.vertices=new b.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new b.Float32Array([1,1,1,1]);this.indices=new b.Uint16Array([0,1,2,3]);this.dirty=true;this.blendMode=b.blendModes.NORMAL;this.canvasPadding=0;this.drawMode=b.Strip.DrawModes.TRIANGLE_STRIP};b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype);b.Strip.prototype.constructor=b.Strip;b.Strip.prototype._renderWebGL=function(c){if(!this.visible||this.alpha<=0){return}c.spriteBatch.stop();if(!this._vertexBuffer){this._initWebGL(c)}c.shaderManager.setShader(c.shaderManager.stripShader);this._renderStrip(c);c.spriteBatch.start()};b.Strip.prototype._initWebGL=function(c){var d=c.gl;this._vertexBuffer=d.createBuffer();this._indexBuffer=d.createBuffer();this._uvBuffer=d.createBuffer();this._colorBuffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer);d.bufferData(d.ARRAY_BUFFER,this.vertices,d.DYNAMIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this._uvBuffer);d.bufferData(d.ARRAY_BUFFER,this.uvs,d.STATIC_DRAW);d.bindBuffer(d.ARRAY_BUFFER,this._colorBuffer);d.bufferData(d.ARRAY_BUFFER,this.colors,d.STATIC_DRAW);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._indexBuffer);d.bufferData(d.ELEMENT_ARRAY_BUFFER,this.indices,d.STATIC_DRAW)};b.Strip.prototype._renderStrip=function(f){var h=f.gl;var c=f.projection,g=f.offset,d=f.shaderManager.stripShader;var e=this.drawMode===b.Strip.DrawModes.TRIANGLE_STRIP?h.TRIANGLE_STRIP:h.TRIANGLES;f.blendModeManager.setBlendMode(this.blendMode);h.uniformMatrix3fv(d.translationMatrix,false,this.worldTransform.toArray(true));h.uniform2f(d.projectionVector,c.x,-c.y);h.uniform2f(d.offsetVector,-g.x,-g.y);h.uniform1f(d.alpha,this.worldAlpha);if(!this.dirty){h.bindBuffer(h.ARRAY_BUFFER,this._vertexBuffer);h.bufferSubData(h.ARRAY_BUFFER,0,this.vertices);h.vertexAttribPointer(d.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this._uvBuffer);h.vertexAttribPointer(d.aTextureCoord,2,h.FLOAT,false,0,0);h.activeTexture(h.TEXTURE0);if(this.texture.baseTexture._dirty[h.id]){f.renderer.updateTexture(this.texture.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,this.texture.baseTexture._glTextures[h.id])}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer)}else{this.dirty=false;h.bindBuffer(h.ARRAY_BUFFER,this._vertexBuffer);h.bufferData(h.ARRAY_BUFFER,this.vertices,h.STATIC_DRAW);h.vertexAttribPointer(d.aVertexPosition,2,h.FLOAT,false,0,0);h.bindBuffer(h.ARRAY_BUFFER,this._uvBuffer);h.bufferData(h.ARRAY_BUFFER,this.uvs,h.STATIC_DRAW);h.vertexAttribPointer(d.aTextureCoord,2,h.FLOAT,false,0,0);h.activeTexture(h.TEXTURE0);if(this.texture.baseTexture._dirty[h.id]){f.renderer.updateTexture(this.texture.baseTexture)}else{h.bindTexture(h.TEXTURE_2D,this.texture.baseTexture._glTextures[h.id])}h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBuffer);h.bufferData(h.ELEMENT_ARRAY_BUFFER,this.indices,h.STATIC_DRAW)}h.drawElements(e,this.indices.length,h.UNSIGNED_SHORT,0)};b.Strip.prototype._renderCanvas=function(g){var f=g.context;var e=this.worldTransform;var d=(e.tx*g.resolution)+g.shakeX;var c=(e.ty*g.resolution)+g.shakeY;if(g.roundPixels){f.setTransform(e.a,e.b,e.c,e.d,d|0,c|0)}else{f.setTransform(e.a,e.b,e.c,e.d,d,c)}if(this.drawMode===b.Strip.DrawModes.TRIANGLE_STRIP){this._renderCanvasTriangleStrip(f)}else{this._renderCanvasTriangles(f)}};b.Strip.prototype._renderCanvasTriangleStrip=function(g){var d=this.vertices;var f=this.uvs;var h=d.length/2;this.count++;for(var e=0;e<h-2;e++){var c=e*2;this._renderCanvasDrawTriangle(g,d,f,c,(c+2),(c+4))}};b.Strip.prototype._renderCanvasTriangles=function(c){var h=this.vertices;var e=this.uvs;var l=this.indices;var d=l.length;this.count++;for(var f=0;f<d;f+=3){var k=l[f]*2,j=l[f+1]*2,g=l[f+2]*2;this._renderCanvasDrawTriangle(c,h,e,k,j,g)}};b.Strip.prototype._renderCanvasDrawTriangle=function(h,n,x,p,m,l){var e=this.texture.baseTexture.source;var c=this.texture.width;var y=this.texture.height;var J=n[p],I=n[m],G=n[l];var k=n[p+1],j=n[m+1],g=n[l+1];var H=x[p]*c,F=x[m]*c,E=x[l]*c;var i=x[p+1]*y,f=x[m+1]*y,d=x[l+1]*y;if(this.canvasPadding>0){var D=this.canvasPadding/this.worldTransform.a;var C=this.canvasPadding/this.worldTransform.d;var v=(J+I+G)/3;var t=(k+j+g)/3;var B=J-v;var A=k-t;var z=Math.sqrt(B*B+A*A);J=v+(B/z)*(z+D);k=t+(A/z)*(z+C);B=I-v;A=j-t;z=Math.sqrt(B*B+A*A);I=v+(B/z)*(z+D);j=t+(A/z)*(z+C);B=G-v;A=g-t;z=Math.sqrt(B*B+A*A);G=v+(B/z)*(z+D);g=t+(A/z)*(z+C)}h.save();h.beginPath();h.moveTo(J,k);h.lineTo(I,j);h.lineTo(G,g);h.closePath();h.clip();var K=(H*f)+(i*E)+(F*d)-(f*E)-(i*F)-(H*d);var w=(J*f)+(i*G)+(I*d)-(f*G)-(i*I)-(J*d);var u=(H*I)+(J*E)+(F*G)-(I*E)-(J*F)-(H*G);var s=(H*f*G)+(i*I*E)+(J*F*d)-(J*f*E)-(i*F*G)-(H*I*d);var r=(k*f)+(i*g)+(j*d)-(f*g)-(i*j)-(k*d);var q=(H*j)+(k*E)+(F*g)-(j*E)-(k*F)-(H*g);var o=(H*f*g)+(i*j*E)+(k*F*d)-(k*f*E)-(i*F*g)-(H*j*d);h.transform(w/K,r/K,u/K,q/K,s/K,o/K);h.drawImage(e,0,0);h.restore()};b.Strip.prototype.renderStripFlat=function(d){var e=this.context;var l=d.vertices;var g=l.length/2;this.count++;e.beginPath();for(var j=1;j<g-2;j++){var k=j*2;var h=l[k],f=l[k+2],c=l[k+4];var o=l[k+1],n=l[k+3],m=l[k+5];e.moveTo(h,o);e.lineTo(f,n);e.lineTo(c,m)}e.fillStyle="#FF0000";e.fill();e.closePath()};b.Strip.prototype.onTextureUpdate=function(){this.updateFrame=true};b.Strip.prototype.getBounds=function(o){var m=o||this.worldTransform;var A=m.a;var w=m.b;var u=m.c;var r=m.d;var B=m.tx;var z=m.ty;var t=-Infinity;var q=-Infinity;var v=Infinity;var s=Infinity;var g=this.vertices;for(var p=0,l=g.length;p<l;p+=2){var f=g[p],e=g[p+1];var k=(A*f)+(u*e)+B;var j=(r*e)+(w*f)+z;v=k<v?k:v;s=j<s?j:s;t=k>t?k:t;q=j>q?j:q}if(v===-Infinity||q===Infinity){return b.EmptyRectangle}var h=this._bounds;h.x=v;h.width=t-v;h.y=s;h.height=q-s;this._currentBounds=h;return h};b.Strip.DrawModes={TRIANGLE_STRIP:0,TRIANGLES:1};b.Rope=function(d,c){b.Strip.call(this,d);this.points=c;this.vertices=new b.Float32Array(c.length*4);this.uvs=new b.Float32Array(c.length*4);this.colors=new b.Float32Array(c.length*2);this.indices=new b.Uint16Array(c.length*2);this.refresh()};b.Rope.prototype=Object.create(b.Strip.prototype);b.Rope.prototype.constructor=b.Rope;b.Rope.prototype.refresh=function(){var l=this.points;if(l.length<1){return}var d=this.uvs;var j=l[0];var m=this.indices;var c=this.colors;this.count-=0.2;d[0]=0;d[1]=0;d[2]=0;d[3]=1;c[0]=1;c[1]=1;m[0]=0;m[1]=1;var h=l.length,k,g,f;for(var e=1;e<h;e++){k=l[e];g=e*4;f=e/(h-1);if(e%2){d[g]=f;d[g+1]=0;d[g+2]=f;d[g+3]=1}else{d[g]=f;d[g+1]=0;d[g+2]=f;d[g+3]=1}g=e*2;c[g]=1;c[g+1]=1;g=e*2;m[g]=g;m[g+1]=g+1;j=k}};b.Rope.prototype.updateTransform=function(){var o=this.points;if(o.length<1){return}var m=o[0];var k;var c={x:0,y:0};this.count-=0.2;var h=this.vertices;var l=o.length,n,g,j,d,f;for(var e=0;e<l;e++){n=o[e];g=e*4;if(e<o.length-1){k=o[e+1]}else{k=n}c.y=-(k.x-m.x);c.x=k.y-m.y;j=(1-(e/(l-1)))*10;if(j>1){j=1}d=Math.sqrt(c.x*c.x+c.y*c.y);f=this.texture.height/2;c.x/=d;c.y/=d;c.x*=f;c.y*=f;h[g]=n.x+c.x;h[g+1]=n.y+c.y;h[g+2]=n.x-c.x;h[g+3]=n.y-c.y;m=n}b.DisplayObjectContainer.prototype.updateTransform.call(this)};b.Rope.prototype.setTexture=function(c){this.texture=c};b.TilingSprite=function(e,d,c){b.Sprite.call(this,e);this._width=d||128;this._height=c||128;this.tileScale=new b.Point(1,1);this.tileScaleOffset=new b.Point(1,1);this.tilePosition=new b.Point();this.renderable=true;this.tint=16777215;this.textureDebug=false;this.blendMode=b.blendModes.NORMAL;this.canvasBuffer=null;this.tilingTexture=null;this.tilePattern=null;this.refreshTexture=true;this.frameWidth=0;this.frameHeight=0};b.TilingSprite.prototype=Object.create(b.Sprite.prototype);b.TilingSprite.prototype.constructor=b.TilingSprite;b.TilingSprite.prototype.setTexture=function(c){if(this.texture!==c){this.texture=c;this.refreshTexture=true;this.cachedTint=16777215}};b.TilingSprite.prototype._renderWebGL=function(d){if(!this.visible||!this.renderable||this.alpha===0){return}if(this._mask){d.spriteBatch.stop();d.maskManager.pushMask(this.mask,d);d.spriteBatch.start()}if(this._filters){d.spriteBatch.flush();d.filterManager.pushFilter(this._filterBlock)}if(this.refreshTexture){this.generateTilingTexture(true,d);if(this.tilingTexture){if(this.tilingTexture.needsUpdate){d.renderer.updateTexture(this.tilingTexture.baseTexture);this.tilingTexture.needsUpdate=false}}else{return}}d.spriteBatch.renderTilingSprite(this);for(var c=0;c<this.children.length;c++){this.children[c]._renderWebGL(d)}d.spriteBatch.stop();if(this._filters){d.filterManager.popFilter()}if(this._mask){d.maskManager.popMask(this._mask,d)}d.spriteBatch.start()};b.TilingSprite.prototype._renderCanvas=function(n){if(!this.visible||!this.renderable||this.alpha===0){return}var d=n.context;if(this._mask){n.maskManager.pushMask(this._mask,n)}d.globalAlpha=this.worldAlpha;var l=this.worldTransform;var e=n.resolution;var h=(l.tx*e)+n.shakeX;var f=(l.ty*e)+n.shakeY;d.setTransform(l.a*e,l.b*e,l.c*e,l.d*e,h,f);if(this.refreshTexture){this.generateTilingTexture(false,n);if(this.tilingTexture){this.tilePattern=d.createPattern(this.tilingTexture.baseTexture.source,"repeat")}else{return}}var m=n.currentBlendMode;if(this.blendMode!==n.currentBlendMode){n.currentBlendMode=this.blendMode;d.globalCompositeOperation=b.blendModesCanvas[n.currentBlendMode]}var j=this.tilePosition;var o=this.tileScale;j.x%=this.tilingTexture.baseTexture.width;j.y%=this.tilingTexture.baseTexture.height;d.scale(o.x,o.y);d.translate(j.x+(this.anchor.x*-this._width),j.y+(this.anchor.y*-this._height));d.fillStyle=this.tilePattern;var h=-j.x;var f=-j.y;var k=this._width/o.x;var c=this._height/o.y;if(n.roundPixels){h|=0;f|=0;k|=0;c|=0}d.fillRect(h,f,k,c);d.scale(1/o.x,1/o.y);d.translate(-j.x+(this.anchor.x*this._width),-j.y+(this.anchor.y*this._height));if(this._mask){n.maskManager.popMask(n)}for(var g=0;g<this.children.length;g++){this.children[g]._renderCanvas(n)}if(m!==this.blendMode){n.currentBlendMode=m;d.globalCompositeOperation=b.blendModesCanvas[m]}};b.TilingSprite.prototype.onTextureUpdate=function(){};b.TilingSprite.prototype.generateTilingTexture=function(l,j){if(!this.texture.baseTexture.hasLoaded){return}var f=this.texture;var c=f.frame;var g=this._frame.sourceSizeW||this._frame.width;var e=this._frame.sourceSizeH||this._frame.height;var m=0;var k=0;if(this._frame.trimmed){m=this._frame.spriteSourceSizeX;k=this._frame.spriteSourceSizeY}if(l){g=b.getNextPowerOfTwo(g);e=b.getNextPowerOfTwo(e)}if(this.canvasBuffer){this.canvasBuffer.resize(g,e);this.tilingTexture.baseTexture.width=g;this.tilingTexture.baseTexture.height=e;this.tilingTexture.needsUpdate=true}else{this.canvasBuffer=new b.CanvasBuffer(g,e);this.tilingTexture=b.Texture.fromCanvas(this.canvasBuffer.canvas);this.tilingTexture.isTiling=true;this.tilingTexture.needsUpdate=true}if(this.textureDebug){this.canvasBuffer.context.strokeStyle="#00ff00";this.canvasBuffer.context.strokeRect(0,0,g,e)}var i=f.crop.width;var d=f.crop.height;if(i!==g||d!==e){i=g;d=e}this.canvasBuffer.context.drawImage(f.baseTexture.source,f.crop.x,f.crop.y,f.crop.width,f.crop.height,m,k,i,d);this.tileScaleOffset.x=c.width/g;this.tileScaleOffset.y=c.height/e;this.refreshTexture=false;this.tilingTexture.baseTexture._powerOf2=true};b.TilingSprite.prototype.getBounds=function(){var o=this._width;var n=this._height;var m=o*(1-this.anchor.x);var l=o*-this.anchor.x;var k=n*(1-this.anchor.y);var j=n*-this.anchor.y;var p=this.worldTransform;var C=p.a;var A=p.b;var z=p.c;var x=p.d;var D=p.tx;var B=p.ty;var t=C*l+z*j+D;var h=x*j+A*l+B;var s=C*m+z*j+D;var g=x*j+A*m+B;var r=C*m+z*k+D;var f=x*k+A*m+B;var q=C*l+z*k+D;var e=x*k+A*l+B;var w=-Infinity;var u=-Infinity;var y=Infinity;var v=Infinity;y=t<y?t:y;y=s<y?s:y;y=r<y?r:y;y=q<y?q:y;v=h<v?h:v;v=g<v?g:v;v=f<v?f:v;v=e<v?e:v;w=t>w?t:w;w=s>w?s:w;w=r>w?r:w;w=q>w?q:w;u=h>u?h:u;u=g>u?g:u;u=f>u?f:u;u=e>u?e:u;var i=this._bounds;i.x=y;i.width=w-y;i.y=v;i.height=u-v;this._currentBounds=i;return i};b.TilingSprite.prototype.destroy=function(){b.Sprite.prototype.destroy.call(this);if(this.canvasBuffer){this.canvasBuffer.destroy();this.canvasBuffer=null}this.tileScale=null;this.tileScaleOffset=null;this.tilePosition=null;if(this.tilingTexture){this.tilingTexture.destroy(true);this.tilingTexture=null}};Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(c){this._width=c}});Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(c){this._height=c}});if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=b}exports.PIXI=b}else{if(typeof define!=="undefined"&&define.amd){define("PIXI",(function(){return a.PIXI=b})())}else{a.PIXI=b}}return b}).call(this);(function(){var k=this;var g=g||{VERSION:"2.6.2",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,CIRCLE:21,RECTANGLE:22,LINE:23,MATRIX:24,POINT:25,ROUNDEDRECTANGLE:26,CREATURE:27,VIDEO:28,PENDING_ATLAS:-1,HORIZONTAL:0,VERTICAL:1,LANDSCAPE:0,PORTRAIT:1,ANGLE_UP:270,ANGLE_DOWN:90,ANGLE_LEFT:180,ANGLE_RIGHT:0,ANGLE_NORTH_EAST:315,ANGLE_NORTH_WEST:225,ANGLE_SOUTH_EAST:45,ANGLE_SOUTH_WEST:135,TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1},PIXI:PIXI||{}};if(!Math.trunc){Math.trunc=function b(p){return p<0?Math.ceil(p):Math.floor(p)}}if(!Function.prototype.bind){Function.prototype.bind=(function(){var p=Array.prototype.slice;return function(q){var t=this,u=p.call(arguments,1);if(typeof t!=="function"){throw new TypeError()}function r(){var v=u.concat(p.call(arguments));t.apply(this instanceof r?this:q,v)}r.prototype=(function s(v){if(v){s.prototype=v}if(!(this instanceof s)){return new s}})(t.prototype);return r}})()}if(!Array.isArray){Array.isArray=function(p){return Object.prototype.toString.call(p)==="[object Array]"}}if(!Array.prototype.forEach){Array.prototype.forEach=function(r){if(this===void 0||this===null){throw new TypeError()}var u=Object(this);var p=u.length>>>0;if(typeof r!=="function"){throw new TypeError()}var q=arguments.length>=2?arguments[1]:void 0;for(var s=0;s<p;s++){if(s in u){r.call(q,u[s],s,u)}}}}if(typeof window.Uint32Array!=="function"&&typeof window.Uint32Array!=="object"){var i=function(p){var q=new Array();window[p]=function(r){if(typeof(r)==="number"){Array.call(this,r);this.length=r;for(var s=0;s<this.length;s++){this[s]=0}}else{Array.call(this,r.length);this.length=r.length;for(var s=0;s<this.length;s++){this[s]=r[s]}}};window[p].prototype=q;window[p].constructor=window[p]};i("Uint32Array");i("Int16Array")}if(!window.console){window.console={};window.console.log=window.console.assert=function(){};window.console.warn=window.console.assert=function(){}}g.Utils={reverseString:function(p){return p.split("").reverse().join("")},getProperty:function(u,v){var t=v.split("."),r=t.pop(),p=t.length,q=1,s=t[0];while(q<p&&(u=u[s])){s=t[q];q++}if(u){return u[r]}else{return null}},setProperty:function(v,w,s){var u=w.split("."),r=u.pop(),p=u.length,q=1,t=u[0];while(q<p&&(v=v[t])){t=u[q];q++}if(v){v[r]=s}return v},chanceRoll:function(p){if(p===undefined){p=50}return p>0&&(Math.random()*100<=p)},randomChoice:function(q,p){return(Math.random()<0.5)?q:p},parseDimension:function(q,s){var r=0;var p=0;if(typeof q==="string"){if(q.substr(-1)==="%"){r=parseInt(q,10)/100;if(s===0){p=window.innerWidth*r}else{p=window.innerHeight*r}}else{p=parseInt(q,10)}}else{p=q}return p},pad:function(v,p,u,q){if(p===undefined){var p=0}if(u===undefined){var u=" "}if(q===undefined){var q=3}v=v.toString();var s=0;if(p+1>=v.length){switch(q){case 1:v=new Array(p+1-v.length).join(u)+v;break;case 3:var r=Math.ceil((s=p-v.length)/2);var t=s-r;v=new Array(t+1).join(u)+v+new Array(r+1).join(u);break;default:v=v+new Array(p+1-v.length).join(u);break}}return v},isPlainObject:function(q){if(typeof(q)!=="object"||q.nodeType||q===q.window){return false}try{if(q.constructor&&!({}).hasOwnProperty.call(q.constructor.prototype,"isPrototypeOf")){return false}}catch(p){return false}return true},extend:function(){var y,r,p,q,v,w,u=arguments[0]||{},t=1,s=arguments.length,x=false;if(typeof u==="boolean"){x=u;u=arguments[1]||{};t=2}if(s===t){u=this;--t}for(;t<s;t++){if((y=arguments[t])!=null){for(r in y){p=u[r];q=y[r];if(u===q){continue}if(x&&q&&(g.Utils.isPlainObject(q)||(v=Array.isArray(q)))){if(v){v=false;w=p&&Array.isArray(p)?p:[]}else{w=p&&g.Utils.isPlainObject(p)?p:{}}u[r]=g.Utils.extend(x,w,q)}else{if(q!==undefined){u[r]=q}}}}}return u},mixinPrototype:function(v,p,t){if(t===undefined){t=false}var s=Object.keys(p);for(var r=0;r<s.length;r++){var q=s[r];var u=p[q];if(!t&&(q in v)){continue}else{if(u&&(typeof u.get==="function"||typeof u.set==="function")){if(typeof u.clone==="function"){v[q]=u.clone()}else{Object.defineProperty(v,q,u)}}else{v[q]=u}}}},mixin:function(t,s){if(!t||typeof(t)!=="object"){return s}for(var p in t){var r=t[p];if(r.childNodes||r.cloneNode){continue}var q=typeof(t[p]);if(!t[p]||q!=="object"){s[p]=t[p]}else{if(typeof(s[p])===q){s[p]=g.Utils.mixin(t[p],s[p])}else{s[p]=g.Utils.mixin(t[p],new r.constructor())}}}return s}};g.Circle=function(p,r,q){p=p||0;r=r||0;q=q||0;this.x=p;this.y=r;this._diameter=q;this._radius=0;if(q>0){this._radius=q*0.5}this.type=g.CIRCLE};g.Circle.prototype={circumference:function(){return 2*(Math.PI*this._radius)},random:function(s){if(s===undefined){s=new g.Point()}var v=2*Math.PI*Math.random();var q=Math.random()+Math.random();var w=(q>1)?2-q:q;var p=w*Math.cos(v);var z=w*Math.sin(v);s.x=this.x+(p*this.radius);s.y=this.y+(z*this.radius);return s},getBounds:function(){return new g.Rectangle(this.x-this.radius,this.y-this.radius,this.diameter,this.diameter)},setTo:function(p,r,q){this.x=p;this.y=r;this._diameter=q;this._radius=q*0.5;return this},copyFrom:function(p){return this.setTo(p.x,p.y,p.diameter)},copyTo:function(p){p.x=this.x;p.y=this.y;p.diameter=this._diameter;return p},distance:function(q,p){var r=g.Math.distance(this.x,this.y,q.x,q.y);return p?Math.round(r):r},clone:function(p){if(p===undefined||p===null){p=new g.Circle(this.x,this.y,this.diameter)}else{p.setTo(this.x,this.y,this.diameter)}return p},contains:function(p,q){return g.Circle.contains(this,p,q)},circumferencePoint:function(r,q,p){return g.Circle.circumferencePoint(this,r,q,p)},offset:function(q,p){this.x+=q;this.y+=p;return this},offsetPoint:function(p){return this.offset(p.x,p.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};g.Circle.prototype.constructor=g.Circle;Object.defineProperty(g.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(p){if(p>0){this._diameter=p;this._radius=p*0.5}}});Object.defineProperty(g.Circle.prototype,"radius",{get:function(){return this._radius},set:function(p){if(p>0){this._radius=p;this._diameter=p*2}}});Object.defineProperty(g.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(p){if(p>this.x){this._radius=0;this._diameter=0}else{this.radius=this.x-p}}});Object.defineProperty(g.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(p){if(p<this.x){this._radius=0;this._diameter=0}else{this.radius=p-this.x}}});Object.defineProperty(g.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(p){if(p>this.y){this._radius=0;this._diameter=0}else{this.radius=this.y-p}}});Object.defineProperty(g.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(p){if(p<this.y){this._radius=0;this._diameter=0}else{this.radius=p-this.y}}});Object.defineProperty(g.Circle.prototype,"area",{get:function(){if(this._radius>0){return Math.PI*this._radius*this._radius}else{return 0}}});Object.defineProperty(g.Circle.prototype,"empty",{get:function(){return(this._diameter===0)},set:function(p){if(p===true){this.setTo(0,0,0)}}});g.Circle.contains=function(r,p,t){if(r.radius>0&&p>=r.left&&p<=r.right&&t>=r.top&&t<=r.bottom){var s=(r.x-p)*(r.x-p);var q=(r.y-t)*(r.y-t);return(s+q)<=(r.radius*r.radius)}else{return false}};g.Circle.equals=function(q,p){return(q.x===p.x&&q.y===p.y&&q.diameter===p.diameter)};g.Circle.intersects=function(q,p){return(g.Math.distance(q.x,q.y,p.x,p.y)<=(q.radius+p.radius))};g.Circle.circumferencePoint=function(p,s,r,q){if(r===undefined){r=false}if(q===undefined){q=new g.Point()}if(r===true){s=g.Math.degToRad(s)}q.x=p.x+p.radius*Math.cos(s);q.y=p.y+p.radius*Math.sin(s);return q};g.Circle.intersectsRectangle=function(A,q){var u=Math.abs(A.x-q.x-q.halfWidth);var z=q.halfWidth+A.radius;if(u>z){return false}var t=Math.abs(A.y-q.y-q.halfHeight);var x=q.halfHeight+A.radius;if(t>x){return false}if(u<=q.halfWidth||t<=q.halfHeight){return true}var v=u-q.halfWidth;var s=t-q.halfHeight;var y=v*v;var p=s*s;var w=A.radius*A.radius;return y+p<=w};PIXI.Circle=g.Circle;g.Ellipse=function(q,s,r,p){q=q||0;s=s||0;r=r||0;p=p||0;this.x=q;this.y=s;this.width=r;this.height=p;this.type=g.ELLIPSE};g.Ellipse.prototype={setTo:function(q,s,r,p){this.x=q;this.y=s;this.width=r;this.height=p;return this},getBounds:function(){return new g.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},copyFrom:function(p){return this.setTo(p.x,p.y,p.width,p.height)},copyTo:function(p){p.x=this.x;p.y=this.y;p.width=this.width;p.height=this.height;return p},clone:function(p){if(p===undefined||p===null){p=new g.Ellipse(this.x,this.y,this.width,this.height)}else{p.setTo(this.x,this.y,this.width,this.height)}return p},contains:function(p,q){return g.Ellipse.contains(this,p,q)},random:function(q){if(q===undefined){q=new g.Point()}var t=Math.random()*Math.PI*2;var s=Math.random();q.x=Math.sqrt(s)*Math.cos(t);q.y=Math.sqrt(s)*Math.sin(t);q.x=this.x+(q.x*this.width/2);q.y=this.y+(q.y*this.height/2);return q},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};g.Ellipse.prototype.constructor=g.Ellipse;Object.defineProperty(g.Ellipse.prototype,"left",{get:function(){return this.x},set:function(p){this.x=p}});Object.defineProperty(g.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(p){if(p<this.x){this.width=0}else{this.width=p-this.x}}});Object.defineProperty(g.Ellipse.prototype,"top",{get:function(){return this.y},set:function(p){this.y=p}});Object.defineProperty(g.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(p){if(p<this.y){this.height=0}else{this.height=p-this.y}}});Object.defineProperty(g.Ellipse.prototype,"empty",{get:function(){return(this.width===0||this.height===0)},set:function(p){if(p===true){this.setTo(0,0,0,0)}}});g.Ellipse.contains=function(s,q,t){if(s.width<=0||s.height<=0){return false}var r=((q-s.x)/s.width)-0.5;var p=((t-s.y)/s.height)-0.5;r*=r;p*=p;return(r+p<0.25)};PIXI.Ellipse=g.Ellipse;g.Line=function(q,s,p,r){q=q||0;s=s||0;p=p||0;r=r||0;this.start=new g.Point(q,s);this.end=new g.Point(p,r);this.type=g.LINE};g.Line.prototype={setTo:function(q,s,p,r){this.start.setTo(q,s);this.end.setTo(p,r);return this},fromSprite:function(q,r,p){if(p===undefined){p=false}if(p){return this.setTo(q.center.x,q.center.y,r.center.x,r.center.y)}return this.setTo(q.x,q.y,r.x,r.y)},fromAngle:function(p,s,r,q){this.start.setTo(p,s);this.end.setTo(p+(Math.cos(r)*q),s+(Math.sin(r)*q));return this},rotate:function(r,q){var p=(this.start.x+this.end.x)/2;var s=(this.start.y+this.end.y)/2;this.start.rotate(p,s,r,q);this.end.rotate(p,s,r,q);return this},rotateAround:function(p,s,r,q){this.start.rotate(p,s,r,q);this.end.rotate(p,s,r,q);return this},intersects:function(q,r,p){return g.Line.intersectsPoints(this.start,this.end,q.start,q.end,r,p)},reflect:function(p){return g.Line.reflect(this,p)},midPoint:function(p){if(p===undefined){p=new g.Point()}p.x=(this.start.x+this.end.x)/2;p.y=(this.start.y+this.end.y)/2;return p},centerOn:function(r,u){var q=(this.start.x+this.end.x)/2;var t=(this.start.y+this.end.y)/2;var s=r-q;var p=u-t;this.start.add(s,p);this.end.add(s,p)},pointOnLine:function(p,q){return((p-this.start.x)*(this.end.y-this.start.y)===(this.end.x-this.start.x)*(q-this.start.y))},pointOnSegment:function(q,u){var r=Math.min(this.start.x,this.end.x);var t=Math.max(this.start.x,this.end.x);var p=Math.min(this.start.y,this.end.y);var s=Math.max(this.start.y,this.end.y);return(this.pointOnLine(q,u)&&(q>=r&&q<=t)&&(u>=p&&u<=s))},random:function(p){if(p===undefined){p=new g.Point()}var q=Math.random();p.x=this.start.x+q*(this.end.x-this.start.x);p.y=this.start.y+q*(this.end.y-this.start.y);return p},coordinatesOnLine:function(u,t){if(u===undefined){u=1}if(t===undefined){t=[]}var q=Math.round(this.start.x);var z=Math.round(this.start.y);var p=Math.round(this.end.x);var x=Math.round(this.end.y);var B=Math.abs(p-q);var A=Math.abs(x-z);var y=(q<p)?1:-1;var w=(z<x)?1:-1;var r=B-A;t.push([q,z]);var s=1;while(!((q===p)&&(z===x))){var v=r<<1;if(v>-A){r-=A;q+=y}if(v<B){r+=B;z+=w}if(s%u===0){t.push([q,z])}s++}return t},clone:function(p){if(p===undefined||p===null){p=new g.Line(this.start.x,this.start.y,this.end.x,this.end.y)}else{p.setTo(this.start.x,this.start.y,this.end.x,this.end.y)}return p}};Object.defineProperty(g.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(g.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(g.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(g.Line.prototype,"perpSlope",{get:function(){return -((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(g.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(g.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(g.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(g.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});Object.defineProperty(g.Line.prototype,"normalX",{get:function(){return Math.cos(this.angle-1.5707963267948966)}});Object.defineProperty(g.Line.prototype,"normalY",{get:function(){return Math.sin(this.angle-1.5707963267948966)}});Object.defineProperty(g.Line.prototype,"normalAngle",{get:function(){return g.Math.wrap(this.angle-1.5707963267948966,-Math.PI,Math.PI)}});g.Line.intersectsPoints=function(C,A,x,w,y,E){if(y===undefined){y=true}if(E===undefined){E=new g.Point()}var s=A.y-C.y;var r=w.y-x.y;var B=C.x-A.x;var z=x.x-w.x;var u=(A.x*C.y)-(C.x*A.y);var t=(w.x*x.y)-(x.x*w.y);var v=(s*z)-(r*B);if(v===0){return null}E.x=((B*t)-(z*u))/v;E.y=((r*u)-(s*t))/v;if(y){var D=((w.y-x.y)*(A.x-C.x)-(w.x-x.x)*(A.y-C.y));var q=(((w.x-x.x)*(C.y-x.y))-(w.y-x.y)*(C.x-x.x))/D;var p=(((A.x-C.x)*(C.y-x.y))-((A.y-C.y)*(C.x-x.x)))/D;if(q>=0&&q<=1&&p>=0&&p<=1){return E}else{return null}}return E};g.Line.intersects=function(r,q,s,p){return g.Line.intersectsPoints(r.start,r.end,q.start,q.end,s,p)};g.Line.intersectsRectangle=function(A,w){if(!g.Rectangle.intersects(A,w)){return false}var s=A.start.x;var y=A.start.y;var r=A.end.x;var x=A.end.y;var v=w.x;var q=w.y;var u=w.right;var p=w.bottom;var z=0;if((s>=v&&s<=u&&y>=q&&y<=p)||(r>=v&&r<=u&&x>=q&&x<=p)){return true}if(s<v&&r>=v){z=y+(x-y)*(v-s)/(r-s);if(z>q&&z<=p){return true}}else{if(s>u&&r<=u){z=y+(x-y)*(u-s)/(r-s);if(z>=q&&z<=p){return true}}}if(y<q&&x>=q){z=s+(r-s)*(q-y)/(x-y);if(z>=v&&z<=u){return true}}else{if(y>p&&x<=p){z=s+(r-s)*(p-y)/(x-y);if(z>=v&&z<=u){return true}}}return false};g.Line.reflect=function(q,p){return 2*p.normalAngle-3.141592653589793-q.angle};g.Matrix=function(s,q,u,t,r,p){if(s===undefined||s===null){s=1}if(q===undefined||q===null){q=0}if(u===undefined||u===null){u=0}if(t===undefined||t===null){t=1}if(r===undefined||r===null){r=0}if(p===undefined||p===null){p=0}this.a=s;this.b=q;this.c=u;this.d=t;this.tx=r;this.ty=p;this.type=g.MATRIX};g.Matrix.prototype={fromArray:function(p){return this.setTo(p[0],p[1],p[3],p[4],p[2],p[5])},setTo:function(s,q,u,t,r,p){this.a=s;this.b=q;this.c=u;this.d=t;this.tx=r;this.ty=p;return this},clone:function(p){if(p===undefined||p===null){p=new g.Matrix(this.a,this.b,this.c,this.d,this.tx,this.ty)}else{p.a=this.a;p.b=this.b;p.c=this.c;p.d=this.d;p.tx=this.tx;p.ty=this.ty}return p},copyTo:function(p){p.copyFrom(this);return p},copyFrom:function(p){this.a=p.a;this.b=p.b;this.c=p.c;this.d=p.d;this.tx=p.tx;this.ty=p.ty;return this},toArray:function(p,q){if(q===undefined){q=new PIXI.Float32Array(9)}if(p){q[0]=this.a;q[1]=this.b;q[2]=0;q[3]=this.c;q[4]=this.d;q[5]=0;q[6]=this.tx;q[7]=this.ty;q[8]=1}else{q[0]=this.a;q[1]=this.c;q[2]=this.tx;q[3]=this.b;q[4]=this.d;q[5]=this.ty;q[6]=0;q[7]=0;q[8]=1}return q},apply:function(q,p){if(p===undefined){p=new g.Point()}p.x=this.a*q.x+this.c*q.y+this.tx;p.y=this.b*q.x+this.d*q.y+this.ty;return p},applyInverse:function(t,q){if(q===undefined){q=new g.Point()}var s=1/(this.a*this.d+this.c*-this.b);var p=t.x;var r=t.y;q.x=this.d*s*p+-this.c*s*r+(this.ty*this.c-this.tx*this.d)*s;q.y=this.a*s*r+-this.b*s*p+(-this.ty*this.a+this.tx*this.b)*s;return q},translate:function(p,q){this.tx+=p;this.ty+=q;return this},scale:function(p,q){this.a*=p;this.d*=q;this.c*=p;this.b*=q;this.tx*=p;this.ty*=q;return this},rotate:function(u){var t=Math.cos(u);var r=Math.sin(u);var q=this.a;var s=this.c;var p=this.tx;this.a=q*t-this.b*r;this.b=q*r+this.b*t;this.c=s*t-this.d*r;this.d=s*r+this.d*t;this.tx=p*t-this.ty*r;this.ty=p*r+this.ty*t;return this},append:function(q){var p=this.a;var r=this.b;var s=this.c;var t=this.d;this.a=q.a*p+q.b*s;this.b=q.a*r+q.b*t;this.c=q.c*p+q.d*s;this.d=q.c*r+q.d*t;this.tx=q.tx*p+q.ty*s+this.tx;this.ty=q.tx*r+q.ty*t+this.ty;return this},identity:function(){return this.setTo(1,0,0,1,0,0)}};g.identityMatrix=new g.Matrix();PIXI.Matrix=g.Matrix;PIXI.identityMatrix=g.identityMatrix;g.Point=function(p,q){p=p||0;q=q||0;this.x=p;this.y=q;this.type=g.POINT};g.Point.prototype={copyFrom:function(p){return this.setTo(p.x,p.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(p,q){this.x=p||0;this.y=q||((q!==0)?this.x:0);return this},set:function(p,q){this.x=p||0;this.y=q||((q!==0)?this.x:0);return this},add:function(p,q){this.x+=p;this.y+=q;return this},subtract:function(p,q){this.x-=p;this.y-=q;return this},multiply:function(p,q){this.x*=p;this.y*=q;return this},divide:function(p,q){this.x/=p;this.y/=q;return this},clampX:function(q,p){this.x=g.Math.clamp(this.x,q,p);return this},clampY:function(q,p){this.y=g.Math.clamp(this.y,q,p);return this},clamp:function(q,p){this.x=g.Math.clamp(this.x,q,p);this.y=g.Math.clamp(this.y,q,p);return this},clone:function(p){if(p===undefined||p===null){p=new g.Point(this.x,this.y)}else{p.setTo(this.x,this.y)}return p},copyTo:function(p){p.x=this.x;p.y=this.y;return p},distance:function(q,p){return g.Point.distance(this,q,p)},equals:function(p){return(p.x===this.x&&p.y===this.y)},angle:function(p,q){if(q===undefined){q=false}if(q){return g.Math.radToDeg(Math.atan2(p.y-this.y,p.x-this.x))}else{return Math.atan2(p.y-this.y,p.x-this.x)}},rotate:function(p,t,r,q,s){return g.Point.rotate(this,p,t,r,q,s)},getMagnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getMagnitudeSq:function(){return(this.x*this.x)+(this.y*this.y)},setMagnitude:function(p){return this.normalize().multiply(p,p)},normalize:function(){if(!this.isZero()){var p=this.getMagnitude();this.x/=p;this.y/=p}return this},isZero:function(){return(this.x===0&&this.y===0)},dot:function(p){return((this.x*p.x)+(this.y*p.y))},cross:function(p){return((this.x*p.y)-(this.y*p.x))},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},floor:function(){return this.setTo(Math.floor(this.x),Math.floor(this.y))},ceil:function(){return this.setTo(Math.ceil(this.x),Math.ceil(this.y))},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};g.Point.prototype.constructor=g.Point;g.Point.add=function(q,p,r){if(r===undefined){r=new g.Point()}r.x=q.x+p.x;r.y=q.y+p.y;return r};g.Point.subtract=function(q,p,r){if(r===undefined){r=new g.Point()}r.x=q.x-p.x;r.y=q.y-p.y;return r};g.Point.multiply=function(q,p,r){if(r===undefined){r=new g.Point()}r.x=q.x*p.x;r.y=q.y*p.y;return r};g.Point.divide=function(q,p,r){if(r===undefined){r=new g.Point()}r.x=q.x/p.x;r.y=q.y/p.y;return r};g.Point.equals=function(q,p){return(q.x===p.x&&q.y===p.y)};g.Point.angle=function(q,p){return Math.atan2(q.y-p.y,q.x-p.x)};g.Point.negative=function(p,q){if(q===undefined){q=new g.Point()}return q.setTo(-p.x,-p.y)};g.Point.multiplyAdd=function(q,p,t,r){if(r===undefined){r=new g.Point()}return r.setTo(q.x+p.x*t,q.y+p.y*t)};g.Point.interpolate=function(q,p,s,r){if(r===undefined){r=new g.Point()}return r.setTo(q.x+(p.x-q.x)*s,q.y+(p.y-q.y)*s)};g.Point.perp=function(p,q){if(q===undefined){q=new g.Point()}return q.setTo(-p.y,p.x)};g.Point.rperp=function(p,q){if(q===undefined){q=new g.Point()}return q.setTo(p.y,-p.x)};g.Point.distance=function(q,p,r){var s=g.Math.distance(q.x,q.y,p.x,p.y);return r?Math.round(s):s};g.Point.project=function(q,p,r){if(r===undefined){r=new g.Point()}var s=q.dot(p)/p.getMagnitudeSq();if(s!==0){r.setTo(s*p.x,s*p.y)}return r};g.Point.projectUnit=function(q,p,r){if(r===undefined){r=new g.Point()}var s=q.dot(p);if(s!==0){r.setTo(s*p.x,s*p.y)}return r};g.Point.normalRightHand=function(p,q){if(q===undefined){q=new g.Point()}return q.setTo(p.y*-1,p.x)};g.Point.normalize=function(q,r){if(r===undefined){r=new g.Point()}var p=q.getMagnitude();if(p!==0){r.setTo(q.x/p,q.y/p)}return r};g.Point.rotate=function(A,B,z,q,u,p){if(u){q=g.Math.degToRad(q)}if(p===undefined){A.subtract(B,z);var D=Math.sin(q);var w=Math.cos(q);var v=w*A.x-D*A.y;var r=D*A.x+w*A.y;A.x=v+B;A.y=r+z}else{var C=q+Math.atan2(A.y-z,A.x-B);A.x=B+p*Math.cos(C);A.y=z+p*Math.sin(C)}return A};g.Point.centroid=function(r,p){if(p===undefined){p=new g.Point()}if(Object.prototype.toString.call(r)!=="[object Array]"){throw new Error("Phaser.Point. Parameter 'points' must be an array")}var s=r.length;if(s<1){throw new Error("Phaser.Point. Parameter 'points' array must not be empty")}if(s===1){p.copyFrom(r[0]);return p}for(var q=0;q<s;q++){g.Point.add(p,r[q],p)}p.divide(s,s);return p};g.Point.parse=function(s,q,r){q=q||"x";r=r||"y";var p=new g.Point();if(s[q]){p.x=parseInt(s[q],10)}if(s[r]){p.y=parseInt(s[r],10)}return p};PIXI.Point=g.Point;g.Polygon=function(){this.area=0;this._points=[];if(arguments.length>0){this.setTo.apply(this,arguments)}this.closed=true;this.flattened=false;this.type=g.POLYGON};g.Polygon.prototype={toNumberArray:function(p){if(p===undefined){p=[]}for(var q=0;q<this._points.length;q++){if(typeof this._points[q]==="number"){p.push(this._points[q]);p.push(this._points[q+1]);q++}else{p.push(this._points[q].x);p.push(this._points[q].y)}}return p},flatten:function(){this._points=this.toNumberArray();this.flattened=true;return this},clone:function(p){var q=this._points.slice();if(p===undefined||p===null){p=new g.Polygon(q)}else{p.setTo(q)}return p},contains:function(v,u){var r=false;if(this.flattened){for(var t=-2,s=this._points.length-2;(t+=2)<this._points.length;s=t){var q=this._points[t];var p=this._points[t+1];var z=this._points[s];var w=this._points[s+1];if(((p<=u&&u<w)||(w<=u&&u<p))&&(v<(z-q)*(u-p)/(w-p)+q)){r=!r}}}else{for(var t=-1,s=this._points.length-1;++t<this._points.length;s=t){var q=this._points[t].x;var p=this._points[t].y;var z=this._points[s].x;var w=this._points[s].y;if(((p<=u&&u<w)||(w<=u&&u<p))&&(v<(z-q)*(u-p)/(w-p)+q)){r=!r}}}return r},setTo:function(s){this.area=0;this._points=[];if(arguments.length>0){if(!Array.isArray(s)){s=Array.prototype.slice.call(arguments)}var t=Number.MAX_VALUE;for(var r=0,q=s.length;r<q;r++){if(typeof s[r]==="number"){var u=new PIXI.Point(s[r],s[r+1]);r++}else{if(Array.isArray(s[r])){var u=new PIXI.Point(s[r][0],s[r][1])}else{var u=new PIXI.Point(s[r].x,s[r].y)}}this._points.push(u);if(u.y<t){t=u.y}}this.calculateArea(t)}return this},calculateArea:function(t){var v;var u;var q;var s;for(var r=0,p=this._points.length;r<p;r++){v=this._points[r];if(r===p-1){u=this._points[0]}else{u=this._points[r+1]}q=((v.y-t)+(u.y-t))/2;s=v.x-u.x;this.area+=q*s}return this.area}};g.Polygon.prototype.constructor=g.Polygon;Object.defineProperty(g.Polygon.prototype,"points",{get:function(){return this._points},set:function(p){if(p!=null){this.setTo(p)}else{this.setTo()}}});PIXI.Polygon=g.Polygon;g.Rectangle=function(q,s,r,p){q=q||0;s=s||0;r=r||0;p=p||0;this.x=q;this.y=s;this.width=r;this.height=p;this.type=g.RECTANGLE};g.Rectangle.prototype={offset:function(q,p){this.x+=q;this.y+=p;return this},offsetPoint:function(p){return this.offset(p.x,p.y)},setTo:function(q,s,r,p){this.x=q;this.y=s;this.width=r;this.height=p;return this},scale:function(p,q){if(q===undefined){q=p}this.width*=p;this.height*=q;return this},centerOn:function(p,q){this.centerX=p;this.centerY=q;return this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y)},ceilAll:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height)},copyFrom:function(p){return this.setTo(p.x,p.y,p.width,p.height)},copyTo:function(p){p.x=this.x;p.y=this.y;p.width=this.width;p.height=this.height;return p},inflate:function(q,p){return g.Rectangle.inflate(this,q,p)},size:function(p){return g.Rectangle.size(this,p)},resize:function(q,p){this.width=q;this.height=p;return this},clone:function(p){return g.Rectangle.clone(this,p)},contains:function(p,q){return g.Rectangle.contains(this,p,q)},containsRect:function(p){return g.Rectangle.containsRect(p,this)},equals:function(p){return g.Rectangle.equals(this,p)},intersection:function(p,q){return g.Rectangle.intersection(this,p,q)},intersects:function(p){return g.Rectangle.intersects(this,p)},intersectsRaw:function(t,r,s,q,p){return g.Rectangle.intersectsRaw(this,t,r,s,q,p)},union:function(p,q){return g.Rectangle.union(this,p,q)},random:function(p){if(p===undefined){p=new g.Point()}p.x=this.randomX;p.y=this.randomY;return p},getPoint:function(p,q){if(q===undefined){q=new g.Point()}switch(p){default:case g.TOP_LEFT:return q.set(this.x,this.y);case g.TOP_CENTER:return q.set(this.centerX,this.y);case g.TOP_RIGHT:return q.set(this.right,this.y);case g.LEFT_CENTER:return q.set(this.x,this.centerY);case g.CENTER:return q.set(this.centerX,this.centerY);case g.RIGHT_CENTER:return q.set(this.right,this.centerY);case g.BOTTOM_LEFT:return q.set(this.x,this.bottom);case g.BOTTOM_CENTER:return q.set(this.centerX,this.bottom);case g.BOTTOM_RIGHT:return q.set(this.right,this.bottom)}},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(g.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(g.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(g.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(p){if(p<=this.y){this.height=0}else{this.height=p-this.y}}});Object.defineProperty(g.Rectangle.prototype,"bottomLeft",{get:function(){return new g.Point(this.x,this.bottom)},set:function(p){this.x=p.x;this.bottom=p.y}});Object.defineProperty(g.Rectangle.prototype,"bottomRight",{get:function(){return new g.Point(this.right,this.bottom)},set:function(p){this.right=p.x;this.bottom=p.y}});Object.defineProperty(g.Rectangle.prototype,"left",{get:function(){return this.x},set:function(p){if(p>=this.right){this.width=0}else{this.width=this.right-p}this.x=p}});Object.defineProperty(g.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(p){if(p<=this.x){this.width=0}else{this.width=p-this.x}}});Object.defineProperty(g.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(g.Rectangle.prototype,"perimeter",{get:function(){return(this.width*2)+(this.height*2)}});Object.defineProperty(g.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(p){this.x=p-this.halfWidth}});Object.defineProperty(g.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(p){this.y=p-this.halfHeight}});Object.defineProperty(g.Rectangle.prototype,"randomX",{get:function(){return this.x+(Math.random()*this.width)}});Object.defineProperty(g.Rectangle.prototype,"randomY",{get:function(){return this.y+(Math.random()*this.height)}});Object.defineProperty(g.Rectangle.prototype,"top",{get:function(){return this.y},set:function(p){if(p>=this.bottom){this.height=0;this.y=p}else{this.height=(this.bottom-p)}}});Object.defineProperty(g.Rectangle.prototype,"topLeft",{get:function(){return new g.Point(this.x,this.y)},set:function(p){this.x=p.x;this.y=p.y}});Object.defineProperty(g.Rectangle.prototype,"topRight",{get:function(){return new g.Point(this.x+this.width,this.y)},set:function(p){this.right=p.x;this.y=p.y}});Object.defineProperty(g.Rectangle.prototype,"empty",{get:function(){return(!this.width||!this.height)},set:function(p){if(p===true){this.setTo(0,0,0,0)}}});g.Rectangle.prototype.constructor=g.Rectangle;g.Rectangle.inflate=function(q,r,p){q.x-=r;q.width+=2*r;q.y-=p;q.height+=2*p;return q};g.Rectangle.inflatePoint=function(q,p){return g.Rectangle.inflate(q,p.x,p.y)};g.Rectangle.size=function(p,q){if(q===undefined||q===null){q=new g.Point(p.width,p.height)}else{q.setTo(p.width,p.height)}return q};g.Rectangle.clone=function(p,q){if(q===undefined||q===null){q=new g.Rectangle(p.x,p.y,p.width,p.height)}else{q.setTo(p.x,p.y,p.width,p.height)}return q};g.Rectangle.contains=function(q,p,r){if(q.width<=0||q.height<=0){return false}return(p>=q.x&&p<q.right&&r>=q.y&&r<q.bottom)};g.Rectangle.containsRaw=function(s,r,t,q,p,u){return(p>=s&&p<(s+t)&&u>=r&&u<(r+q))};g.Rectangle.containsPoint=function(q,p){return g.Rectangle.contains(q,p.x,p.y)};g.Rectangle.containsRect=function(q,p){if(q.volume>p.volume){return false}return(q.x>=p.x&&q.y>=p.y&&q.right<p.right&&q.bottom<p.bottom)};g.Rectangle.equals=function(q,p){return(q.x===p.x&&q.y===p.y&&q.width===p.width&&q.height===p.height)};g.Rectangle.sameDimensions=function(q,p){return(q.width===p.width&&q.height===p.height)};g.Rectangle.intersection=function(q,p,r){if(r===undefined){r=new g.Rectangle()}if(g.Rectangle.intersects(q,p)){r.x=Math.max(q.x,p.x);r.y=Math.max(q.y,p.y);r.width=Math.min(q.right,p.right)-r.x;r.height=Math.min(q.bottom,p.bottom)-r.y}return r};g.Rectangle.intersects=function(q,p){if(q.width<=0||q.height<=0||p.width<=0||p.height<=0){return false}return !(q.right<p.x||q.bottom<p.y||q.x>p.right||q.y>p.bottom)};g.Rectangle.intersectsRaw=function(p,u,s,t,r,q){if(q===undefined){q=0}return !(u>p.right+q||s<p.left-q||t>p.bottom+q||r<p.top-q)};g.Rectangle.union=function(q,p,r){if(r===undefined){r=new g.Rectangle()}return r.setTo(Math.min(q.x,p.x),Math.min(q.y,p.y),Math.max(q.right,p.right)-Math.min(q.left,p.left),Math.max(q.bottom,p.bottom)-Math.min(q.top,p.top))};g.Rectangle.aabb=function(s,r){if(r===undefined){r=new g.Rectangle()}var u=Number.NEGATIVE_INFINITY,q=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY;s.forEach(function(v){if(v.x>u){u=v.x}if(v.x<q){q=v.x}if(v.y>t){t=v.y}if(v.y<p){p=v.y}});r.setTo(q,p,u-q,t-p);return r};PIXI.Rectangle=g.Rectangle;PIXI.EmptyRectangle=new g.Rectangle(0,0,0,0);g.RoundedRectangle=function(r,t,s,q,p){if(r===undefined){r=0}if(t===undefined){t=0}if(s===undefined){s=0}if(q===undefined){q=0}if(p===undefined){p=20}this.x=r;this.y=t;this.width=s;this.height=q;this.radius=p||20;this.type=g.ROUNDEDRECTANGLE};g.RoundedRectangle.prototype={clone:function(){return new g.RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},contains:function(p,s){if(this.width<=0||this.height<=0){return false}var q=this.x;if(p>=q&&p<=q+this.width){var r=this.y;if(s>=r&&s<=r+this.height){return true}}return false}};g.RoundedRectangle.prototype.constructor=g.RoundedRectangle;PIXI.RoundedRectangle=g.RoundedRectangle;g.Camera=function(r,u,q,t,s,p){this.game=r;this.world=r.world;this.id=0;this.view=new g.Rectangle(q,t,s,p);this.bounds=new g.Rectangle(q,t,s,p);this.deadzone=null;this.visible=true;this.roundPx=true;this.atLimit={x:false,y:false};this.target=null;this.displayObject=null;this.scale=null;this.totalInView=0;this.lerp=new g.Point(1,1);this.onShakeComplete=new g.Signal();this.onFlashComplete=new g.Signal();this.onFadeComplete=new g.Signal();this.fx=null;this._targetPosition=new g.Point();this._edge=0;this._position=new g.Point();this._shake={intensity:0,duration:0,horizontal:false,vertical:false,shakeBounds:true,x:0,y:0};this._fxDuration=0;this._fxType=0};g.Camera.FOLLOW_LOCKON=0;g.Camera.FOLLOW_PLATFORMER=1;g.Camera.FOLLOW_TOPDOWN=2;g.Camera.FOLLOW_TOPDOWN_TIGHT=3;g.Camera.SHAKE_BOTH=4;g.Camera.SHAKE_HORIZONTAL=5;g.Camera.SHAKE_VERTICAL=6;g.Camera.ENABLE_FX=true;g.Camera.prototype={boot:function(){this.displayObject=this.game.world;this.scale=this.game.world.scale;this.game.camera=this;if(g.Graphics&&g.Camera.ENABLE_FX){this.fx=new g.Graphics(this.game);this.game.stage.addChild(this.fx)}},preUpdate:function(){this.totalInView=0},follow:function(v,t,r,q){if(t===undefined){t=g.Camera.FOLLOW_LOCKON}if(r===undefined){r=1}if(q===undefined){q=1}this.target=v;this.lerp.set(r,q);var u;switch(t){case g.Camera.FOLLOW_PLATFORMER:var p=this.width/8;var s=this.height/3;this.deadzone=new g.Rectangle((this.width-p)/2,(this.height-s)/2-s*0.25,p,s);break;case g.Camera.FOLLOW_TOPDOWN:u=Math.max(this.width,this.height)/4;this.deadzone=new g.Rectangle((this.width-u)/2,(this.height-u)/2,u,u);break;case g.Camera.FOLLOW_TOPDOWN_TIGHT:u=Math.max(this.width,this.height)/8;this.deadzone=new g.Rectangle((this.width-u)/2,(this.height-u)/2,u,u);break;case g.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null;break}},unfollow:function(){this.target=null},focusOn:function(p){this.setPosition(Math.round(p.x-this.view.halfWidth),Math.round(p.y-this.view.halfHeight))},focusOnXY:function(p,q){this.setPosition(Math.round(p-this.view.halfWidth),Math.round(q-this.view.halfHeight))},shake:function(p,t,r,s,q){if(p===undefined){p=0.05}if(t===undefined){t=500}if(r===undefined){r=true}if(s===undefined){s=g.Camera.SHAKE_BOTH}if(q===undefined){q=true}if(!r&&this._shake.duration>0){return false}this._shake.intensity=p;this._shake.duration=t;this._shake.shakeBounds=q;this._shake.x=0;this._shake.y=0;this._shake.horizontal=(s===g.Camera.SHAKE_BOTH||s===g.Camera.SHAKE_HORIZONTAL);this._shake.vertical=(s===g.Camera.SHAKE_BOTH||s===g.Camera.SHAKE_VERTICAL);return true},flash:function(p,r,q){if(p===undefined){p=16777215}if(r===undefined){r=500}if(q===undefined){q=false}if(!this.fx||(!q&&this._fxDuration>0)){return false}this.fx.clear();this.fx.beginFill(p);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=1;this._fxDuration=r;this._fxType=0;return true},fade:function(p,r,q){if(p===undefined){p=0}if(r===undefined){r=500}if(q===undefined){q=false}if(!this.fx||(!q&&this._fxDuration>0)){return false}this.fx.clear();this.fx.beginFill(p);this.fx.drawRect(0,0,this.width,this.height);this.fx.endFill();this.fx.alpha=0;this._fxDuration=r;this._fxType=1;return true},update:function(){if(this._fxDuration>0){this.updateFX()}if(this._shake.duration>0){this.updateShake()}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor();this._shake.x=Math.floor(this._shake.x);this._shake.y=Math.floor(this._shake.y)}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateFX:function(){if(this._fxType===0){this.fx.alpha-=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha<=0){this._fxDuration=0;this.fx.alpha=0;this.onFlashComplete.dispatch()}}else{this.fx.alpha+=this.game.time.elapsedMS/this._fxDuration;if(this.fx.alpha>=1){this._fxDuration=0;this.fx.alpha=1;this.onFadeComplete.dispatch()}}},updateShake:function(){this._shake.duration-=this.game.time.elapsedMS;if(this._shake.duration<=0){this.onShakeComplete.dispatch();this._shake.x=0;this._shake.y=0}else{if(this._shake.horizontal){this._shake.x=this.game.rnd.frac()*this._shake.intensity*this.view.width*2-this._shake.intensity*this.view.width}if(this._shake.vertical){this._shake.y=this.game.rnd.frac()*this._shake.intensity*this.view.height*2-this._shake.intensity*this.view.height}}},updateTarget:function(){this._targetPosition.x=this.view.x+this.target.worldPosition.x;this._targetPosition.y=this.view.y+this.target.worldPosition.y;if(this.deadzone){this._edge=this._targetPosition.x-this.view.x;if(this._edge<this.deadzone.left){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.left,this.lerp.x)}else{if(this._edge>this.deadzone.right){this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.deadzone.right,this.lerp.x)}}this._edge=this._targetPosition.y-this.view.y;if(this._edge<this.deadzone.top){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.top,this.lerp.y)}else{if(this._edge>this.deadzone.bottom){this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.deadzone.bottom,this.lerp.y)}}}else{this.view.x=this.game.math.linear(this.view.x,this._targetPosition.x-this.view.halfWidth,this.lerp.x);this.view.y=this.game.math.linear(this.view.y,this._targetPosition.y-this.view.halfHeight,this.lerp.y)}if(this.bounds){this.checkBounds()}if(this.roundPx){this.view.floor()}this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},setBoundsToWorld:function(){if(this.bounds){this.bounds.copyFrom(this.game.world.bounds)}},checkBounds:function(){this.atLimit.x=false;this.atLimit.y=false;var q=this.view.x+this._shake.x;var r=this.view.right+this._shake.x;var p=this.view.y+this._shake.y;var s=this.view.bottom+this._shake.y;if(q<=this.bounds.x*this.scale.x){this.atLimit.x=true;this.view.x=this.bounds.x*this.scale.x;if(!this._shake.shakeBounds){this._shake.x=0}}if(r>=this.bounds.right*this.scale.x){this.atLimit.x=true;this.view.x=(this.bounds.right*this.scale.x)-this.width;if(!this._shake.shakeBounds){this._shake.x=0}}if(p<=this.bounds.top*this.scale.y){this.atLimit.y=true;this.view.y=this.bounds.top*this.scale.y;if(!this._shake.shakeBounds){this._shake.y=0}}if(s>=this.bounds.bottom*this.scale.y){this.atLimit.y=true;this.view.y=(this.bounds.bottom*this.scale.y)-this.height;if(!this._shake.shakeBounds){this._shake.y=0}}},setPosition:function(p,q){this.view.x=p;this.view.y=q;if(this.bounds){this.checkBounds()}},setSize:function(q,p){this.view.width=q;this.view.height=p},reset:function(){this.target=null;this.view.x=0;this.view.y=0;this._shake.duration=0;this.resetFX()},resetFX:function(){this.fx.clear();this.fx.alpha=0;this._fxDuration=0}};g.Camera.prototype.constructor=g.Camera;Object.defineProperty(g.Camera.prototype,"x",{get:function(){return this.view.x},set:function(p){this.view.x=p;if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"y",{get:function(){return this.view.y},set:function(p){this.view.y=p;if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"position",{get:function(){this._position.set(this.view.x,this.view.y);return this._position},set:function(p){if(typeof p.x!=="undefined"){this.view.x=p.x}if(typeof p.y!=="undefined"){this.view.y=p.y}if(this.bounds){this.checkBounds()}}});Object.defineProperty(g.Camera.prototype,"width",{get:function(){return this.view.width},set:function(p){this.view.width=p}});Object.defineProperty(g.Camera.prototype,"height",{get:function(){return this.view.height},set:function(p){this.view.height=p}});Object.defineProperty(g.Camera.prototype,"shakeIntensity",{get:function(){return this._shake.intensity},set:function(p){this._shake.intensity=p}});g.State=function(){this.game=null;this.key="";this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.state=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};g.State.prototype={init:function(){},preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},preRender:function(){},render:function(){},resize:function(){},paused:function(){},resumed:function(){},pauseUpdate:function(){},shutdown:function(){}};g.State.prototype.constructor=g.State;g.StateManager=function(q,p){this.game=q;this.states={};this._pendingState=null;if(typeof p!=="undefined"&&p!==null){this._pendingState=p}this._clearWorld=false;this._clearCache=false;this._created=false;this._args=[];this.current="";this.onStateChange=new g.Signal();this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};g.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);if(this._pendingState!==null&&typeof this._pendingState!=="string"){this.add("default",this._pendingState,true)}},add:function(q,r,p){if(p===undefined){p=false}var s;if(r instanceof g.State){s=r}else{if(typeof r==="object"){s=r;s.game=this.game}else{if(typeof r==="function"){s=new r(this.game)}}}this.states[q]=s;if(p){if(this.game.isBooted){this.start(q)}else{this._pendingState=q}}return s},remove:function(p){if(this.current===p){this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onPreRenderCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null}delete this.states[p]},start:function(q,p,r){if(p===undefined){p=true}if(r===undefined){r=false}if(this.checkState(q)){this._pendingState=q;this._clearWorld=p;this._clearCache=r;if(arguments.length>3){this._args=Array.prototype.splice.call(arguments,3)}}},restart:function(p,q){if(p===undefined){p=true}if(q===undefined){q=false}this._pendingState=this.current;this._clearWorld=p;this._clearCache=q;if(arguments.length>2){this._args=Array.prototype.slice.call(arguments,2)}},dummy:function(){},preUpdate:function(){if(this._pendingState&&this.game.isBooted){var p=this.current;this.clearCurrentState();this.setCurrentState(this._pendingState);this.onStateChange.dispatch(this.current,p);if(this.current!==this._pendingState){return}else{this._pendingState=null}if(this.onPreloadCallback){this.game.load.reset(true);this.onPreloadCallback.call(this.callbackContext,this.game);if(this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0){this.loadComplete()}else{this.game.load.start()}}else{this.loadComplete()}}},clearCurrentState:function(){if(this.current){if(this.onShutDownCallback){this.onShutDownCallback.call(this.callbackContext,this.game)}this.game.tweens.removeAll();this.game.camera.reset();this.game.input.reset(true);this.game.physics.clear();this.game.time.removeAll();this.game.scale.reset(this._clearWorld);if(this.game.debug){this.game.debug.reset()}if(this._clearWorld){this.game.world.shutdown();if(this._clearCache){this.game.cache.destroy()}}}},checkState:function(p){if(this.states[p]){if(this.states[p]["preload"]||this.states[p]["create"]||this.states[p]["update"]||this.states[p]["render"]){return true}else{console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render");return false}}else{console.warn("Phaser.StateManager - No state found with the key: "+p);return false}},link:function(p){this.states[p].game=this.game;this.states[p].add=this.game.add;this.states[p].make=this.game.make;this.states[p].camera=this.game.camera;this.states[p].cache=this.game.cache;this.states[p].input=this.game.input;this.states[p].load=this.game.load;this.states[p].math=this.game.math;this.states[p].sound=this.game.sound;this.states[p].scale=this.game.scale;this.states[p].state=this;this.states[p].stage=this.game.stage;this.states[p].time=this.game.time;this.states[p].tweens=this.game.tweens;this.states[p].world=this.game.world;this.states[p].particles=this.game.particles;this.states[p].rnd=this.game.rnd;this.states[p].physics=this.game.physics;this.states[p].key=p},unlink:function(p){if(this.states[p]){this.states[p].game=null;this.states[p].add=null;this.states[p].make=null;this.states[p].camera=null;this.states[p].cache=null;this.states[p].input=null;this.states[p].load=null;this.states[p].math=null;this.states[p].sound=null;this.states[p].scale=null;this.states[p].state=null;this.states[p].stage=null;this.states[p].time=null;this.states[p].tweens=null;this.states[p].world=null;this.states[p].particles=null;this.states[p].rnd=null;this.states[p].physics=null}},setCurrentState:function(p){this.callbackContext=this.states[p];this.link(p);this.onInitCallback=this.states[p]["init"]||this.dummy;this.onPreloadCallback=this.states[p]["preload"]||null;this.onLoadRenderCallback=this.states[p]["loadRender"]||null;this.onLoadUpdateCallback=this.states[p]["loadUpdate"]||null;this.onCreateCallback=this.states[p]["create"]||null;this.onUpdateCallback=this.states[p]["update"]||null;this.onPreRenderCallback=this.states[p]["preRender"]||null;this.onRenderCallback=this.states[p]["render"]||null;this.onResizeCallback=this.states[p]["resize"]||null;this.onPausedCallback=this.states[p]["paused"]||null;this.onResumedCallback=this.states[p]["resumed"]||null;this.onPauseUpdateCallback=this.states[p]["pauseUpdate"]||null;this.onShutDownCallback=this.states[p]["shutdown"]||this.dummy;if(this.current!==""){this.game.physics.reset()}this.current=p;this._created=false;this.onInitCallback.apply(this.callbackContext,this._args);if(p===this._pendingState){this._args=[]}this.game._kickstart=true},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){if(this._created===false&&this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}if(this._created===false&&this.onCreateCallback){this._created=true;this.onCreateCallback.call(this.callbackContext,this.game)}else{this._created=true}},pause:function(){if(this._created&&this.onPausedCallback){this.onPausedCallback.call(this.callbackContext,this.game)}},resume:function(){if(this._created&&this.onResumedCallback){this.onResumedCallback.call(this.callbackContext,this.game)}},update:function(){if(this._created){if(this.onUpdateCallback){this.onUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},pauseUpdate:function(){if(this._created){if(this.onPauseUpdateCallback){this.onPauseUpdateCallback.call(this.callbackContext,this.game)}}else{if(this.onLoadUpdateCallback){this.onLoadUpdateCallback.call(this.callbackContext,this.game)}}},preRender:function(p){if(this._created&&this.onPreRenderCallback){this.onPreRenderCallback.call(this.callbackContext,this.game,p)}},resize:function(q,p){if(this.onResizeCallback){this.onResizeCallback.call(this.callbackContext,q,p)}},render:function(){if(this._created){if(this.onRenderCallback){if(this.game.renderType===g.CANVAS){this.game.context.save();this.game.context.setTransform(1,0,0,1,0,0);this.onRenderCallback.call(this.callbackContext,this.game);this.game.context.restore()}else{this.onRenderCallback.call(this.callbackContext,this.game)}}}else{if(this.onLoadRenderCallback){this.onLoadRenderCallback.call(this.callbackContext,this.game)}}},destroy:function(){this._clearWorld=true;this._clearCache=true;this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null;this.current=""}};g.StateManager.prototype.constructor=g.StateManager;Object.defineProperty(g.StateManager.prototype,"created",{get:function(){return this._created}});g.Signal=function(){};g.Signal.prototype={_bindings:null,_prevParams:null,memorize:false,_shouldPropagate:true,active:true,_boundDispatch:false,validateListener:function(p,q){if(typeof p!=="function"){throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",q))}},_registerListener:function(u,s,t,r,p){var q=this._indexOfListener(u,t);var v;if(q!==-1){v=this._bindings[q];if(v.isOnce()!==s){throw new Error("You cannot add"+(s?"":"Once")+"() then add"+(!s?"":"Once")+"() the same listener without removing the relationship first.")}}else{v=new g.SignalBinding(this,u,s,t,r,p);this._addBinding(v)}if(this.memorize&&this._prevParams){v.execute(this._prevParams)}return v},_addBinding:function(p){if(!this._bindings){this._bindings=[]}var q=this._bindings.length;do{q--}while(this._bindings[q]&&p._priority<=this._bindings[q]._priority);this._bindings.splice(q+1,0,p)},_indexOfListener:function(q,p){if(!this._bindings){return -1}if(p===undefined){p=null}var s=this._bindings.length;var r;while(s--){r=this._bindings[s];if(r._listener===q&&r.context===p){return s}}return -1},has:function(q,p){return this._indexOfListener(q,p)!==-1},add:function(t,s,r){this.validateListener(t,"add");var p=[];if(arguments.length>3){for(var q=3;q<arguments.length;q++){p.push(arguments[q])}}return this._registerListener(t,false,s,r,p)},addOnce:function(t,s,r){this.validateListener(t,"addOnce");var p=[];if(arguments.length>3){for(var q=3;q<arguments.length;q++){p.push(arguments[q])}}return this._registerListener(t,true,s,r,p)},remove:function(r,q){this.validateListener(r,"remove");var p=this._indexOfListener(r,q);if(p!==-1){this._bindings[p]._destroy();this._bindings.splice(p,1)}return r},removeAll:function(p){if(p===undefined){p=null}if(!this._bindings){return}var q=this._bindings.length;while(q--){if(p){if(this._bindings[q].context===p){this._bindings[q]._destroy();this._bindings.splice(q,1)}}else{this._bindings[q]._destroy()}}if(!p){this._bindings.length=0}},getNumListeners:function(){return this._bindings?this._bindings.length:0},halt:function(){this._shouldPropagate=false},dispatch:function(){if(!this.active||!this._bindings){return}var p=Array.prototype.slice.call(arguments);var r=this._bindings.length;var q;if(this.memorize){this._prevParams=p}if(!r){return}q=this._bindings.slice();this._shouldPropagate=true;do{r--}while(q[r]&&this._shouldPropagate&&q[r].execute(p)!==false)},forget:function(){if(this._prevParams){this._prevParams=null}},dispose:function(){this.removeAll();this._bindings=null;if(this._prevParams){this._prevParams=null}},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};Object.defineProperty(g.Signal.prototype,"boundDispatch",{get:function(){var p=this;return this._boundDispatch||(this._boundDispatch=function(){return p.dispatch.apply(p,arguments)})}});g.Signal.prototype.constructor=g.Signal;g.SignalBinding=function(u,t,r,s,q,p){this._listener=t;if(r){this._isOnce=true}if(s!=null){this.context=s}this._signal=u;if(q){this._priority=q}if(p&&p.length){this._args=p}};g.SignalBinding.prototype={context:null,_isOnce:false,_priority:0,_args:null,callCount:0,active:true,params:null,execute:function(p){var r,q;if(this.active&&!!this._listener){q=this.params?this.params.concat(p):p;if(this._args){q=q.concat(this._args)}r=this._listener.apply(this.context,q);this.callCount++;if(this._isOnce){this.detach()}}return r},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return(!!this._signal&&!!this._listener)},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};g.SignalBinding.prototype.constructor=g.SignalBinding;g.Filter=function(q,p,s){this.game=q;this.type=g.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=true;this.padding=0;this.prevPoint=new g.Point();var t=new Date();this.uniforms={resolution:{type:"2f",value:{x:256,y:256}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:0,y:0}},date:{type:"4fv",value:[t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()*60*60+t.getMinutes()*60+t.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:true}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:true}}};if(p){for(var r in p){this.uniforms[r]=p[r]}}this.fragmentSrc=s||""};g.Filter.prototype={init:function(){},setResolution:function(q,p){this.uniforms.resolution.value.x=q;this.uniforms.resolution.value.y=p},update:function(q){if(typeof q!=="undefined"){var p=q.x/this.game.width;var r=1-q.y/this.game.height;if(p!==this.prevPoint.x||r!==this.prevPoint.y){this.uniforms.mouse.value.x=p.toFixed(2);this.uniforms.mouse.value.y=r.toFixed(2);this.prevPoint.set(p,r)}}this.uniforms.time.value=this.game.time.totalElapsedSeconds()},addToWorld:function(r,v,s,q,p,u){if(p===undefined){p=0}if(u===undefined){u=0}if(s!==undefined&&s!==null){this.width=s}else{s=this.width}if(q!==undefined&&q!==null){this.height=q}else{q=this.height}var t=this.game.add.image(r,v,"__default");t.width=s;t.height=q;t.anchor.set(p,u);t.filters=[this];return t},destroy:function(){this.game=null}};g.Filter.prototype.constructor=g.Filter;Object.defineProperty(g.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(p){this.uniforms.resolution.value.x=p}});Object.defineProperty(g.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(p){this.uniforms.resolution.value.y=p}});g.Plugin=function(p,q){if(q===undefined){q=null}this.game=p;this.parent=q;this.active=false;this.visible=false;this.hasPreUpdate=false;this.hasUpdate=false;this.hasPostUpdate=false;this.hasRender=false;this.hasPostRender=false};g.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=false;this.visible=false}};g.Plugin.prototype.constructor=g.Plugin;g.PluginManager=function(p){this.game=p;this.plugins=[];this._len=0;this._i=0};g.PluginManager.prototype={add:function(r){var q=Array.prototype.slice.call(arguments,1);var p=false;if(typeof r==="function"){r=new r(this.game,this)}else{r.game=this.game;r.parent=this}if(typeof r.preUpdate==="function"){r.hasPreUpdate=true;p=true}if(typeof r.update==="function"){r.hasUpdate=true;p=true}if(typeof r.postUpdate==="function"){r.hasPostUpdate=true;p=true}if(typeof r.render==="function"){r.hasRender=true;p=true}if(typeof r.postRender==="function"){r.hasPostRender=true;p=true}if(p){if(r.hasPreUpdate||r.hasUpdate||r.hasPostUpdate){r.active=true}if(r.hasRender||r.hasPostRender){r.visible=true}this._len=this.plugins.push(r);if(typeof r.init==="function"){r.init.apply(r,q)}return r}else{return null}},remove:function(q,p){if(p===undefined){p=true}this._i=this._len;while(this._i--){if(this.plugins[this._i]===q){if(p){q.destroy()}this.plugins.splice(this._i,1);this._len--;return}}},removeAll:function(){this._i=this._len;while(this._i--){this.plugins[this._i].destroy()}this.plugins.length=0;this._len=0},preUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate){this.plugins[this._i].preUpdate()}}},update:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasUpdate){this.plugins[this._i].update()}}},postUpdate:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate){this.plugins[this._i].postUpdate()}}},render:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasRender){this.plugins[this._i].render()}}},postRender:function(){this._i=this._len;while(this._i--){if(this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender){this.plugins[this._i].postRender()}}},destroy:function(){this.removeAll();this.game=null}};g.PluginManager.prototype.constructor=g.PluginManager;g.Stage=function(p){this.game=p;PIXI.DisplayObjectContainer.call(this);this.name="_stage_root";this.disableVisibilityChange=false;this.exists=true;this.worldTransform=new PIXI.Matrix();this.stage=this;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._onChange=null;this._bgColor={r:0,g:0,b:0,a:0,color:0,rgba:"#000000"};if(!this.game.transparent){this._bgColor.a=1}if(p.config){this.parseConfig(p.config)}};g.Stage.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);g.Stage.prototype.constructor=g.Stage;g.Stage.prototype.parseConfig=function(p){if(p.disableVisibilityChange){this.disableVisibilityChange=p.disableVisibilityChange}if(p.backgroundColor){this.setBackgroundColor(p.backgroundColor)}};g.Stage.prototype.boot=function(){g.DOM.getOffset(this.game.canvas,this.offset);g.Canvas.setUserSelect(this.game.canvas,"none");g.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};g.Stage.prototype.preUpdate=function(){this.currentRenderOrderID=0;for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}};g.Stage.prototype.update=function(){var p=this.children.length;while(p--){this.children[p].update()}};g.Stage.prototype.postUpdate=function(){this.game.camera.update();if(this.game.camera.target){this.game.camera.target.postUpdate();this.updateTransform();this.game.camera.updateTarget()}for(var p=0;p<this.children.length;p++){this.children[p].postUpdate()}this.updateTransform()};g.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var p=0;p<this.children.length;p++){this.children[p].updateTransform()}};g.Stage.prototype.checkVisibility=function(){if(document.hidden!==undefined){this._hiddenVar="visibilitychange"}else{if(document.webkitHidden!==undefined){this._hiddenVar="webkitvisibilitychange"}else{if(document.mozHidden!==undefined){this._hiddenVar="mozvisibilitychange"}else{if(document.msHidden!==undefined){this._hiddenVar="msvisibilitychange"}else{this._hiddenVar=null}}}}var p=this;this._onChange=function(q){return p.visibilityChange(q)};if(this._hiddenVar){document.addEventListener(this._hiddenVar,this._onChange,false)}window.onblur=this._onChange;window.onfocus=this._onChange;window.onpagehide=this._onChange;window.onpageshow=this._onChange;if(this.game.device.cocoonJSApp){CocoonJS.App.onSuspended.addEventListener(function(){g.Stage.prototype.visibilityChange.call(p,{type:"pause"})});CocoonJS.App.onActivated.addEventListener(function(){g.Stage.prototype.visibilityChange.call(p,{type:"resume"})})}};g.Stage.prototype.visibilityChange=function(p){if(p.type==="pagehide"||p.type==="blur"||p.type==="pageshow"||p.type==="focus"){if(p.type==="pagehide"||p.type==="blur"){this.game.focusLoss(p)}else{if(p.type==="pageshow"||p.type==="focus"){this.game.focusGain(p)}}return}if(this.disableVisibilityChange){return}if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||p.type==="pause"){this.game.gamePaused(p)}else{this.game.gameResumed(p)}};g.Stage.prototype.setBackgroundColor=function(p){if(this.game.transparent){return}g.Color.valueToColor(p,this._bgColor);g.Color.updateColor(this._bgColor);this._bgColor.r/=255;this._bgColor.g/=255;this._bgColor.b/=255;this._bgColor.a=1};g.Stage.prototype.destroy=function(){if(this._hiddenVar){document.removeEventListener(this._hiddenVar,this._onChange,false)}window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(g.Stage.prototype,"backgroundColor",{get:function(){return this._bgColor.color},set:function(p){this.setBackgroundColor(p)}});Object.defineProperty(g.Stage.prototype,"smoothed",{get:function(){return PIXI.scaleModes.DEFAULT===PIXI.scaleModes.LINEAR},set:function(p){if(p){PIXI.scaleModes.DEFAULT=PIXI.scaleModes.LINEAR}else{PIXI.scaleModes.DEFAULT=PIXI.scaleModes.NEAREST}}});g.Group=function(q,t,r,p,u,s){if(p===undefined){p=false}if(u===undefined){u=false}if(s===undefined){s=g.Physics.ARCADE}this.game=q;if(t===undefined){t=q.world}this.name=r||"group";this.z=0;PIXI.DisplayObjectContainer.call(this);if(p){this.game.stage.addChild(this);this.z=this.game.stage.children.length}else{if(t){t.addChild(this);this.z=t.children.length}}this.type=g.GROUP;this.physicsType=g.GROUP;this.alive=true;this.exists=true;this.ignoreDestroy=false;this.pendingDestroy=false;this.classType=g.Sprite;this.cursor=null;this.inputEnableChildren=false;this.onChildInputDown=new g.Signal();this.onChildInputUp=new g.Signal();this.onChildInputOver=new g.Signal();this.onChildInputOut=new g.Signal();this.enableBody=u;this.enableBodyDebug=false;this.physicsBodyType=s;this.physicsSortDirection=null;this.onDestroy=new g.Signal();this.cursorIndex=0;this.fixedToCamera=false;this.cameraOffset=new g.Point();this.hash=[];this._sortProperty="z"};g.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);g.Group.prototype.constructor=g.Group;g.Group.RETURN_NONE=0;g.Group.RETURN_TOTAL=1;g.Group.RETURN_CHILD=2;g.Group.RETURN_ALL=3;g.Group.SORT_ASCENDING=-1;g.Group.SORT_DESCENDING=1;g.Group.prototype.add=function(r,p,q){if(p===undefined){p=false}if(r.parent===this){return r}if(r.body&&r.parent&&r.parent.hash){r.parent.removeFromHash(r)}if(q===undefined){r.z=this.children.length;this.addChild(r)}else{this.addChildAt(r,q);this.updateZ()}if(this.enableBody&&r.hasOwnProperty("body")&&r.body===null){this.game.physics.enable(r,this.physicsBodyType)}else{if(r.body){this.addToHash(r)}}if(this.inputEnableChildren&&(!r.input||r.inputEnabled)){r.inputEnabled=true}if(!p&&r.events){r.events.onAddedToGroup$dispatch(r,this)}if(this.cursor===null){this.cursor=r}return r};g.Group.prototype.addAt=function(r,q,p){this.add(r,p,q)};g.Group.prototype.addToHash=function(q){if(q.parent===this){var p=this.hash.indexOf(q);if(p===-1){this.hash.push(q);return true}}return false};g.Group.prototype.removeFromHash=function(q){if(q){var p=this.hash.indexOf(q);if(p!==-1){this.hash.splice(p,1);return true}}return false};g.Group.prototype.addMultiple=function(r,p){if(r instanceof g.Group){r.moveAll(this,p)}else{if(Array.isArray(r)){for(var q=0;q<r.length;q++){this.add(r[q],p)}}}return r};g.Group.prototype.getAt=function(p){if(p<0||p>=this.children.length){return -1}else{return this.getChildAt(p)}};g.Group.prototype.create=function(p,v,r,t,s,q){if(s===undefined){s=true}var u=new this.classType(this.game,p,v,r,t);u.exists=s;u.visible=s;u.alive=s;return this.add(u,false,q)};g.Group.prototype.createMultiple=function(s,q,t,r){if(t===undefined){t=0}if(r===undefined){r=false}if(!Array.isArray(q)){q=[q]}if(!Array.isArray(t)){t=[t]}var u=this;var p=[];q.forEach(function(v){t.forEach(function(x){for(var w=0;w<s;w++){p.push(u.create(0,0,v,x,r))}})});return p};g.Group.prototype.updateZ=function(){var p=this.children.length;while(p--){this.children[p].z=p}};g.Group.prototype.align=function(q,B,t,z,y,u){if(y===undefined){y=g.TOP_LEFT}if(u===undefined){u=0}if(this.children.length===0||u>this.children.length||(q===-1&&B===-1)){return false}var p=new g.Rectangle(0,0,t,z);var A=(q*t);var x=(B*z);for(var v=u;v<this.children.length;v++){var s=this.children[v];if(s.alignIn){s.alignIn(p,y)}else{continue}if(q===-1){p.y+=z;if(p.y===x){p.x+=t;p.y=0}}else{if(B===-1){p.x+=t;if(p.x===A){p.x=0;p.y+=z}}else{p.x+=t;if(p.x===A){p.x=0;p.y+=z;if(p.y===x){return true}}}}}return true};g.Group.prototype.resetCursor=function(p){if(p===undefined){p=0}if(p>this.children.length-1){p=0}if(this.cursor){this.cursorIndex=p;this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.next=function(){if(this.cursor){if(this.cursorIndex>=this.children.length-1){this.cursorIndex=0}else{this.cursorIndex++}this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.previous=function(){if(this.cursor){if(this.cursorIndex===0){this.cursorIndex=this.children.length-1}else{this.cursorIndex--}this.cursor=this.children[this.cursorIndex];return this.cursor}};g.Group.prototype.swap=function(q,p){this.swapChildren(q,p);this.updateZ()};g.Group.prototype.bringToTop=function(p){if(p.parent===this&&this.getIndex(p)<this.children.length){this.remove(p,false,true);this.add(p,true)}return p};g.Group.prototype.sendToBack=function(p){if(p.parent===this&&this.getIndex(p)>0){this.remove(p,false,true);this.addAt(p,0,true)}return p};g.Group.prototype.moveUp=function(r){if(r.parent===this&&this.getIndex(r)<this.children.length-1){var q=this.getIndex(r);var p=this.getAt(q+1);if(p){this.swap(r,p)}}return r};g.Group.prototype.moveDown=function(r){if(r.parent===this&&this.getIndex(r)>0){var q=this.getIndex(r);var p=this.getAt(q-1);if(p){this.swap(r,p)}}return r};g.Group.prototype.xy=function(q,p,r){if(q<0||q>this.children.length){return -1}else{this.getChildAt(q).x=p;this.getChildAt(q).y=r}};g.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};g.Group.prototype.getIndex=function(p){return this.children.indexOf(p)};g.Group.prototype.getByName=function(p){for(var q=0;q<this.children.length;q++){if(this.children[q].name===p){return this.children[q]}}return null};g.Group.prototype.replace=function(r,p){var q=this.getIndex(r);if(q!==-1){if(p.parent){if(p.parent instanceof g.Group){p.parent.remove(p)}else{p.parent.removeChild(p)}}this.remove(r);this.addAt(p,q);return r}};g.Group.prototype.hasProperty=function(r,q){var p=q.length;if(p===1&&q[0] in r){return true}else{if(p===2&&q[0] in r&&q[1] in r[q[0]]){return true}else{if(p===3&&q[0] in r&&q[1] in r[q[0]]&&q[2] in r[q[0]][q[1]]){return true}else{if(p===4&&q[0] in r&&q[1] in r[q[0]]&&q[2] in r[q[0]][q[1]]&&q[3] in r[q[0]][q[1]][q[2]]){return true}}}}return false};g.Group.prototype.setProperty=function(u,r,t,q,s){if(s===undefined){s=false}q=q||0;if(!this.hasProperty(u,r)&&(!s||q>0)){return false}var p=r.length;if(p===1){if(q===0){u[r[0]]=t}else{if(q===1){u[r[0]]+=t}else{if(q===2){u[r[0]]-=t}else{if(q===3){u[r[0]]*=t}else{if(q===4){u[r[0]]/=t}}}}}}else{if(p===2){if(q===0){u[r[0]][r[1]]=t}else{if(q===1){u[r[0]][r[1]]+=t}else{if(q===2){u[r[0]][r[1]]-=t}else{if(q===3){u[r[0]][r[1]]*=t}else{if(q===4){u[r[0]][r[1]]/=t}}}}}}else{if(p===3){if(q===0){u[r[0]][r[1]][r[2]]=t}else{if(q===1){u[r[0]][r[1]][r[2]]+=t}else{if(q===2){u[r[0]][r[1]][r[2]]-=t}else{if(q===3){u[r[0]][r[1]][r[2]]*=t}else{if(q===4){u[r[0]][r[1]][r[2]]/=t}}}}}}else{if(p===4){if(q===0){u[r[0]][r[1]][r[2]][r[3]]=t}else{if(q===1){u[r[0]][r[1]][r[2]][r[3]]+=t}else{if(q===2){u[r[0]][r[1]][r[2]][r[3]]-=t}else{if(q===3){u[r[0]][r[1]][r[2]][r[3]]*=t}else{if(q===4){u[r[0]][r[1]][r[2]][r[3]]/=t}}}}}}}}}return true};g.Group.prototype.checkProperty=function(s,p,r,q){if(q===undefined){q=false}if(!g.Utils.getProperty(s,p)&&q){return false}if(g.Utils.getProperty(s,p)!==r){return false}return true};g.Group.prototype.set=function(v,r,t,q,u,p,s){if(s===undefined){s=false}r=r.split(".");if(q===undefined){q=false}if(u===undefined){u=false}if((q===false||(q&&v.alive))&&(u===false||(u&&v.visible))){return this.setProperty(v,r,t,p,s)}};g.Group.prototype.setAll=function(s,u,q,v,p,t){if(q===undefined){q=false}if(v===undefined){v=false}if(t===undefined){t=false}s=s.split(".");p=p||0;for(var r=0;r<this.children.length;r++){if((!q||(q&&this.children[r].alive))&&(!v||(v&&this.children[r].visible))){this.setProperty(this.children[r],s,u,p,t)}}};g.Group.prototype.setAllChildren=function(s,u,q,v,p,t){if(q===undefined){q=false}if(v===undefined){v=false}if(t===undefined){t=false}p=p||0;for(var r=0;r<this.children.length;r++){if((!q||(q&&this.children[r].alive))&&(!v||(v&&this.children[r].visible))){if(this.children[r] instanceof g.Group){this.children[r].setAllChildren(s,u,q,v,p,t)}else{this.setProperty(this.children[r],s.split("."),u,p,t)}}}};g.Group.prototype.checkAll=function(r,t,p,u,s){if(p===undefined){p=false}if(u===undefined){u=false}if(s===undefined){s=false}for(var q=0;q<this.children.length;q++){if((!p||(p&&this.children[q].alive))&&(!u||(u&&this.children[q].visible))){if(!this.checkProperty(this.children[q],r,t,s)){return false}}}return true};g.Group.prototype.addAll=function(r,q,p,s){this.setAll(r,q,p,s,1)};g.Group.prototype.subAll=function(r,q,p,s){this.setAll(r,q,p,s,2)};g.Group.prototype.multiplyAll=function(r,q,p,s){this.setAll(r,q,p,s,3)};g.Group.prototype.divideAll=function(r,q,p,s){this.setAll(r,q,p,s,4)};g.Group.prototype.callAllExists=function(s,r){var p;if(arguments.length>2){p=[];for(var q=2;q<arguments.length;q++){p.push(arguments[q])}}for(var q=0;q<this.children.length;q++){if(this.children[q].exists===r&&this.children[q][s]){this.children[q][s].apply(this.children[q],p)}}};g.Group.prototype.callbackFromArray=function(r,q,p){if(p===1){if(r[q[0]]){return r[q[0]]}}else{if(p===2){if(r[q[0]][q[1]]){return r[q[0]][q[1]]}}else{if(p===3){if(r[q[0]][q[1]][q[2]]){return r[q[0]][q[1]][q[2]]}}else{if(p===4){if(r[q[0]][q[1]][q[2]][q[3]]){return r[q[0]][q[1]][q[2]][q[3]]}}else{if(r[q]){return r[q]}}}}}return false};g.Group.prototype.callAll=function(w,s){if(w===undefined){return}w=w.split(".");var u=w.length;if(s===undefined||s===null||s===""){s=null}else{if(typeof s==="string"){s=s.split(".");var t=s.length}}var q;if(arguments.length>2){q=[];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}var v=null;var p=null;for(var r=0;r<this.children.length;r++){v=this.callbackFromArray(this.children[r],w,u);if(s&&v){p=this.callbackFromArray(this.children[r],s,t);if(v){v.apply(p,q)}}else{if(v){v.apply(this.children[r],q)}}}};g.Group.prototype.preUpdate=function(){if(this.pendingDestroy){this.destroy();return false}if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}return true};g.Group.prototype.update=function(){var p=this.children.length;while(p--){this.children[p].update()}};g.Group.prototype.postUpdate=function(){if(this.fixedToCamera){this.x=this.game.camera.view.x+this.cameraOffset.x;this.y=this.game.camera.view.y+this.cameraOffset.y}for(var p=0;p<this.children.length;p++){this.children[p].postUpdate()}};g.Group.prototype.filter=function(p,u){var q=-1;var s=this.children.length;var r=[];while(++q<s){var t=this.children[q];if(!u||(u&&t.exists)){if(p(t,q,this.children)){r.push(t)}}}return new g.ArraySet(r)};g.Group.prototype.forEach=function(t,p,s){if(s===undefined){s=false}if(arguments.length<=3){for(var r=0;r<this.children.length;r++){if(!s||(s&&this.children[r].exists)){t.call(p,this.children[r])}}}else{var q=[null];for(var r=3;r<arguments.length;r++){q.push(arguments[r])}for(var r=0;r<this.children.length;r++){if(!s||(s&&this.children[r].exists)){q[0]=this.children[r];t.apply(p,q)}}}};g.Group.prototype.forEachExists=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("exists",true,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.forEachAlive=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("alive",true,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.forEachDead=function(s,p){var q;if(arguments.length>2){q=[null];for(var r=2;r<arguments.length;r++){q.push(arguments[r])}}this.iterate("alive",false,g.Group.RETURN_TOTAL,s,p,q)};g.Group.prototype.sort=function(q,p){if(this.children.length<2){return}if(q===undefined){q="z"}if(p===undefined){p=g.Group.SORT_ASCENDING}this._sortProperty=q;if(p===g.Group.SORT_ASCENDING){this.children.sort(this.ascendingSortHandler.bind(this))}else{this.children.sort(this.descendingSortHandler.bind(this))}this.updateZ()};g.Group.prototype.customSort=function(p,q){if(this.children.length<2){return}this.children.sort(p.bind(q));this.updateZ()};g.Group.prototype.ascendingSortHandler=function(q,p){if(q[this._sortProperty]<p[this._sortProperty]){return -1}else{if(q[this._sortProperty]>p[this._sortProperty]){return 1}else{if(q.z<p.z){return -1}else{return 1}}}};g.Group.prototype.descendingSortHandler=function(q,p){if(q[this._sortProperty]<p[this._sortProperty]){return 1}else{if(q[this._sortProperty]>p[this._sortProperty]){return -1}else{return 0}}};g.Group.prototype.iterate=function(w,v,s,x,q,t){if(this.children.length===0){if(s===g.Group.RETURN_TOTAL){return 0}else{if(s===g.Group.RETURN_ALL){return[]}}}var u=0;if(s===g.Group.RETURN_ALL){var p=[]}for(var r=0;r<this.children.length;r++){if(this.children[r][w]===v){u++;if(x){if(t){t[0]=this.children[r];x.apply(q,t)}else{x.call(q,this.children[r])}}if(s===g.Group.RETURN_CHILD){return this.children[r]}else{if(s===g.Group.RETURN_ALL){p.push(this.children[r])}}}}if(s===g.Group.RETURN_TOTAL){return u}else{if(s===g.Group.RETURN_ALL){return p}else{return null}}};g.Group.prototype.getFirstExists=function(s,q,p,v,r,t){if(q===undefined){q=false}if(typeof s!=="boolean"){s=true}var u=this.iterate("exists",s,g.Group.RETURN_CHILD);return(u===null&&q)?this.create(p,v,r,t):this.resetChild(u,p,v,r,t)};g.Group.prototype.getFirstAlive=function(q,p,u,r,s){if(q===undefined){q=false}var t=this.iterate("alive",true,g.Group.RETURN_CHILD);return(t===null&&q)?this.create(p,u,r,s):this.resetChild(t,p,u,r,s)};g.Group.prototype.getFirstDead=function(q,p,u,r,s){if(q===undefined){q=false}var t=this.iterate("alive",false,g.Group.RETURN_CHILD);return(t===null&&q)?this.create(p,u,r,s):this.resetChild(t,p,u,r,s)};g.Group.prototype.resetChild=function(t,p,s,q,r){if(t===null){return null}if(p===undefined){p=null}if(s===undefined){s=null}if(p!==null&&s!==null){t.reset(p,s)}if(q!==undefined){t.loadTexture(q,r)}return t};g.Group.prototype.getTop=function(){if(this.children.length>0){return this.children[this.children.length-1]}};g.Group.prototype.getBottom=function(){if(this.children.length>0){return this.children[0]}};g.Group.prototype.getClosestTo=function(s,w,r){var v=Number.MAX_VALUE;var q=0;var p=null;for(var t=0;t<this.children.length;t++){var u=this.children[t];if(u.exists){q=Math.abs(g.Point.distance(s,u));if(q<v&&(!w||w.call(r,u,q))){v=q;p=u}}}return p};g.Group.prototype.getFurthestFrom=function(s,w,r){var v=0;var q=0;var p=null;for(var t=0;t<this.children.length;t++){var u=this.children[t];if(u.exists){q=Math.abs(g.Point.distance(s,u));if(q>v&&(!w||w.call(r,u,q))){v=q;p=u}}}return p};g.Group.prototype.countLiving=function(){return this.iterate("alive",true,g.Group.RETURN_TOTAL)};g.Group.prototype.countDead=function(){return this.iterate("alive",false,g.Group.RETURN_TOTAL)};g.Group.prototype.getRandom=function(q,p){if(q===undefined){q=0}if(p===undefined){p=this.children.length}if(p===0){return null}return g.ArrayUtils.getRandomItem(this.children,q,p)};g.Group.prototype.getRandomExists=function(r,q){var p=this.getAll("exists",true,r,q);return this.game.rnd.pick(p)};g.Group.prototype.getAll=function(t,s,u,r){if(u===undefined){u=0}if(r===undefined){r=this.children.length}var p=[];for(var q=u;q<r;q++){var v=this.children[q];if(t&&v[t]===s){p.push(v)}}return p};g.Group.prototype.remove=function(s,q,p){if(q===undefined){q=false}if(p===undefined){p=false}if(this.children.length===0||this.children.indexOf(s)===-1){return false}if(!p&&s.events&&!s.destroyPhase){s.events.onRemovedFromGroup$dispatch(s,this)}var r=this.removeChild(s);this.removeFromHash(s);this.updateZ();if(this.cursor===s){this.next()}if(q&&r){r.destroy(true)}return true};g.Group.prototype.moveAll=function(q,p){if(p===undefined){p=false}if(this.children.length>0&&q instanceof g.Group){do{q.add(this.children[0],p)}while(this.children.length>0);this.hash=[];this.cursor=null}return q};g.Group.prototype.removeAll=function(r,p,q){if(r===undefined){r=false}if(p===undefined){p=false}if(q===undefined){q=false}if(this.children.length===0){return}do{if(!p&&this.children[0].events){this.children[0].events.onRemovedFromGroup$dispatch(this.children[0],this)}var s=this.removeChild(this.children[0]);this.removeFromHash(s);if(r&&s){s.destroy(true,q)}}while(this.children.length>0);this.hash=[];this.cursor=null};g.Group.prototype.removeBetween=function(u,s,r,p){if(s===undefined){s=this.children.length-1}if(r===undefined){r=false}if(p===undefined){p=false}if(this.children.length===0){return}if(u>s||u<0||s>this.children.length){return false}var q=s;while(q>=u){if(!p&&this.children[q].events){this.children[q].events.onRemovedFromGroup$dispatch(this.children[q],this)}var t=this.removeChild(this.children[q]);this.removeFromHash(t);if(r&&t){t.destroy(true)}if(this.cursor===this.children[q]){this.cursor=null}q--}this.updateZ()};g.Group.prototype.destroy=function(q,p){if(this.game===null||this.ignoreDestroy){return}if(q===undefined){q=true}if(p===undefined){p=false}this.onDestroy.dispatch(this,q,p);this.removeAll(q);this.cursor=null;this.filters=null;this.pendingDestroy=false;if(!p){if(this.parent){this.parent.removeChild(this)}this.game=null;this.exists=false}};Object.defineProperty(g.Group.prototype,"total",{get:function(){return this.iterate("exists",true,g.Group.RETURN_TOTAL)}});Object.defineProperty(g.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(g.Group.prototype,"angle",{get:function(){return g.Math.radToDeg(this.rotation)},set:function(p){this.rotation=g.Math.degToRad(p)}});Object.defineProperty(g.Group.prototype,"centerX",{get:function(){return this.getBounds(this.parent).centerX},set:function(q){var p=this.getBounds(this.parent);var s=this.x-p.x;this.x=(q+s)-p.halfWidth}});Object.defineProperty(g.Group.prototype,"centerY",{get:function(){return this.getBounds(this.parent).centerY},set:function(q){var p=this.getBounds(this.parent);var s=this.y-p.y;this.y=(q+s)-p.halfHeight}});Object.defineProperty(g.Group.prototype,"left",{get:function(){return this.getBounds(this.parent).left},set:function(q){var p=this.getBounds(this.parent);var s=this.x-p.x;this.x=q+s}});Object.defineProperty(g.Group.prototype,"right",{get:function(){return this.getBounds(this.parent).right},set:function(q){var p=this.getBounds(this.parent);var s=this.x-p.x;this.x=(q+s)-p.width}});Object.defineProperty(g.Group.prototype,"top",{get:function(){return this.getBounds(this.parent).top},set:function(q){var p=this.getBounds(this.parent);var s=this.y-p.y;this.y=(q+s)}});Object.defineProperty(g.Group.prototype,"bottom",{get:function(){return this.getBounds(this.parent).bottom},set:function(q){var p=this.getBounds(this.parent);var s=this.y-p.y;this.y=(q+s)-p.height}});g.World=function(p){g.Group.call(this,p,null,"__world",false);this.bounds=new g.Rectangle(0,0,p.width,p.height);this.camera=null;this._definedSize=false;this._width=p.width;this._height=p.height;this.game.state.onStateChange.add(this.stateChange,this)};g.World.prototype=Object.create(g.Group.prototype);g.World.prototype.constructor=g.World;g.World.prototype.boot=function(){this.camera=new g.Camera(this.game,0,0,0,this.game.width,this.game.height);this.game.stage.addChild(this);this.camera.boot()};g.World.prototype.stateChange=function(){this.x=0;this.y=0;this.camera.reset()};g.World.prototype.setBounds=function(q,s,r,p){this._definedSize=true;this._width=r;this._height=p;this.bounds.setTo(q,s,r,p);this.x=q;this.y=s;if(this.camera.bounds){this.camera.bounds.setTo(q,s,Math.max(r,this.game.width),Math.max(p,this.game.height))}this.game.physics.setBoundsToWorld()};g.World.prototype.resize=function(q,p){if(this._definedSize){if(q<this._width){q=this._width}if(p<this._height){p=this._height}}this.bounds.width=q;this.bounds.height=p;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};g.World.prototype.shutdown=function(){this.destroy(true,true)};g.World.prototype.wrap=function(s,t,q,p,r){if(t===undefined){t=0}if(q===undefined){q=false}if(p===undefined){p=true}if(r===undefined){r=true}if(!q){if(p&&s.x+t<this.bounds.x){s.x=this.bounds.right+t}else{if(p&&s.x-t>this.bounds.right){s.x=this.bounds.left-t}}if(r&&s.y+t<this.bounds.top){s.y=this.bounds.bottom+t}else{if(r&&s.y-t>this.bounds.bottom){s.y=this.bounds.top-t}}}else{s.getBounds();if(p){if((s.x+s._currentBounds.width)<this.bounds.x){s.x=this.bounds.right}else{if(s.x>this.bounds.right){s.x=this.bounds.left}}}if(r){if((s.y+s._currentBounds.height)<this.bounds.top){s.y=this.bounds.bottom}else{if(s.y>this.bounds.bottom){s.y=this.bounds.top}}}}};Object.defineProperty(g.World.prototype,"width",{get:function(){return this.bounds.width},set:function(p){if(p<this.game.width){p=this.game.width}this.bounds.width=p;this._width=p;this._definedSize=true}});Object.defineProperty(g.World.prototype,"height",{get:function(){return this.bounds.height},set:function(p){if(p<this.game.height){p=this.game.height}this.bounds.height=p;this._height=p;this._definedSize=true}});Object.defineProperty(g.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth+this.bounds.x}});Object.defineProperty(g.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight+this.bounds.y}});Object.defineProperty(g.World.prototype,"randomX",{get:function(){if(this.bounds.x<0){return this.game.rnd.between(this.bounds.x,(this.bounds.width-Math.abs(this.bounds.x)))}else{return this.game.rnd.between(this.bounds.x,this.bounds.width)}}});Object.defineProperty(g.World.prototype,"randomY",{get:function(){if(this.bounds.y<0){return this.game.rnd.between(this.bounds.y,(this.bounds.height-Math.abs(this.bounds.y)))}else{return this.game.rnd.between(this.bounds.y,this.bounds.height)}}});g.Game=function(t,p,v,s,u,w,q,r){this.id=g.GAMES.push(this)-1;this.config=null;this.physicsConfig=r;this.parent="";this.width=800;this.height=600;this.resolution=1;this._width=800;this._height=600;this.transparent=false;this.antialias=true;this.preserveDrawingBuffer=false;this.clearBeforeRender=true;this.renderer=null;this.renderType=g.AUTO;this.state=null;this.isBooted=false;this.isRunning=false;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.plugins=null;this.rnd=null;this.device=g.Device;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.create=null;this.lockRender=false;this.stepping=false;this.pendingStep=false;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=false;this._codePaused=false;this.currentUpdateID=0;this.updatesThisFrame=1;this._deltaTime=0;this._lastCount=0;this._spiraling=0;this._kickstart=true;this.fpsProblemNotifier=new g.Signal();this.forceSingleUpdate=true;this._nextFpsNotification=0;if(arguments.length===1&&typeof arguments[0]==="object"){this.parseConfig(arguments[0])}else{this.config={enableDebug:true};if(typeof t!=="undefined"){this._width=t}if(typeof p!=="undefined"){this._height=p}if(typeof v!=="undefined"){this.renderType=v}if(typeof s!=="undefined"){this.parent=s}if(typeof w!=="undefined"){this.transparent=w}if(typeof q!=="undefined"){this.antialias=q}this.rnd=new g.RandomDataGenerator([(Date.now()*Math.random()).toString()]);this.state=new g.StateManager(this,u)}this.device.whenReady(this.boot,this);return this};g.Game.prototype={parseConfig:function(q){this.config=q;if(q.enableDebug===undefined){this.config.enableDebug=true}if(q.width){this._width=q.width}if(q.height){this._height=q.height}if(q.renderer){this.renderType=q.renderer}if(q.parent){this.parent=q.parent}if(q.transparent!==undefined){this.transparent=q.transparent}if(q.antialias!==undefined){this.antialias=q.antialias}if(q.resolution){this.resolution=q.resolution}if(q.preserveDrawingBuffer!==undefined){this.preserveDrawingBuffer=q.preserveDrawingBuffer}if(q.physicsConfig){this.physicsConfig=q.physicsConfig}var p=[(Date.now()*Math.random()).toString()];if(q.seed){p=q.seed}this.rnd=new g.RandomDataGenerator(p);var r=null;if(q.state){r=q.state}this.state=new g.StateManager(this,r)},boot:function(){if(this.isBooted){return}this.onPause=new g.Signal();this.onResume=new g.Signal();this.onBlur=new g.Signal();this.onFocus=new g.Signal();this.isBooted=true;PIXI.game=this;this.math=g.Math;this.scale=new g.ScaleManager(this,this._width,this._height);this.stage=new g.Stage(this);this.setUpRenderer();this.world=new g.World(this);this.add=new g.GameObjectFactory(this);this.make=new g.GameObjectCreator(this);this.cache=new g.Cache(this);this.load=new g.Loader(this);this.time=new g.Time(this);this.tweens=new g.TweenManager(this);this.input=new g.Input(this);this.sound=new g.SoundManager(this);this.physics=new g.Physics(this,this.physicsConfig);this.particles=new g.Particles(this);this.create=new g.Create(this);this.plugins=new g.PluginManager(this);this.net=new g.Net(this);this.time.boot();this.stage.boot();this.world.boot();this.scale.boot();this.input.boot();this.sound.boot();this.state.boot();if(this.config.enableDebug){this.debug=new g.Utils.Debug(this);this.debug.boot()}else{this.debug={preUpdate:function(){},update:function(){},reset:function(){}}}this.showDebugHeader();this.isRunning=true;if(this.config&&this.config.forceSetTimeOut){this.raf=new g.RequestAnimationFrame(this,this.config.forceSetTimeOut)}else{this.raf=new g.RequestAnimationFrame(this,false)}this._kickstart=true;if(window.focus){if(!window.PhaserGlobal||(window.PhaserGlobal&&!window.PhaserGlobal.stopFocus)){window.focus()}}this.raf.start()},showDebugHeader:function(){if(window.PhaserGlobal&&window.PhaserGlobal.hideBanner){return}var q=g.VERSION;var u="Canvas";var p="HTML Audio";var w=1;if(this.renderType===g.WEBGL){u="WebGL";w++}else{if(this.renderType===g.HEADLESS){u="Headless"}}if(this.device.webAudio){p="WebAudio";w++}if(this.device.chrome){var s=["%c %c %c Phaser v"+q+" | Pixi.js | "+u+" | "+p+"  %c %c %c http://phaser.io %c\u2665%c\u2665%c\u2665","background: #fb8cb3","background: #d44a52","color: #ffffff; background: #871905;","background: #d44a52","background: #fb8cb3","background: #ffffff"];for(var t=0;t<3;t++){if(t<w){s.push("color: #ff2424; background: #fff")}else{s.push("color: #959595; background: #fff")}}console.log.apply(console,s)}else{if(window.console){console.log("Phaser v"+q+" | Pixi.js "+PIXI.VERSION+" | "+u+" | "+p+" | http://phaser.io")}}},setUpRenderer:function(){if(this.config.canvas){this.canvas=this.config.canvas}else{this.canvas=g.Canvas.create(this,this.width,this.height,this.config.canvasID,true)}if(this.config.canvasStyle){this.canvas.style=this.config.canvasStyle}else{this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%"}if(this.renderType===g.HEADLESS||this.renderType===g.CANVAS||(this.renderType===g.AUTO&&!this.device.webGL)){if(this.device.canvas){this.renderType=g.CANVAS;this.renderer=new PIXI.CanvasRenderer(this);this.context=this.renderer.context}else{throw new Error("Phaser.Game - Cannot create Canvas or WebGL context, aborting.")}}else{this.renderType=g.WEBGL;this.renderer=new PIXI.WebGLRenderer(this);this.context=null;this.canvas.addEventListener("webglcontextlost",this.contextLost.bind(this),false);this.canvas.addEventListener("webglcontextrestored",this.contextRestored.bind(this),false)}if(this.device.cocoonJS){this.canvas.screencanvas=(this.renderType===g.CANVAS)?true:false}if(this.renderType!==g.HEADLESS){this.stage.smoothed=this.antialias;g.Canvas.addToDOM(this.canvas,this.parent,false);g.Canvas.setTouchAction(this.canvas)}},contextLost:function(p){p.preventDefault();this.renderer.contextLost=true},contextRestored:function(){this.renderer.initContext();this.cache.clearGLTextures();this.renderer.contextLost=false},update:function(r){this.time.update(r);if(this._kickstart){this.updateLogic(this.time.desiredFpsMult);this.updateRender(this.time.slowMotion*this.time.desiredFps);this._kickstart=false;return}if(this._spiraling>1&&!this.forceSingleUpdate){if(this.time.time>this._nextFpsNotification){this._nextFpsNotification=this.time.time+10000;this.fpsProblemNotifier.dispatch()}this._deltaTime=0;this._spiraling=0;this.updateRender(this.time.slowMotion*this.time.desiredFps)}else{var p=this.time.slowMotion*1000/this.time.desiredFps;this._deltaTime+=Math.max(Math.min(p*3,this.time.elapsed),0);var q=0;this.updatesThisFrame=Math.floor(this._deltaTime/p);if(this.forceSingleUpdate){this.updatesThisFrame=Math.min(1,this.updatesThisFrame)}while(this._deltaTime>=p){this._deltaTime-=p;this.currentUpdateID=q;this.updateLogic(this.time.desiredFpsMult);q++;if(this.forceSingleUpdate&&q===1){break}else{this.time.refresh()}}if(q>this._lastCount){this._spiraling++}else{if(q<this._lastCount){this._spiraling=0}}this._lastCount=q;this.updateRender(this._deltaTime/p)}},updateLogic:function(p){if(!this._paused&&!this.pendingStep){if(this.stepping){this.pendingStep=true}this.scale.preUpdate();this.debug.preUpdate();this.camera.preUpdate();this.physics.preUpdate();this.state.preUpdate(p);this.plugins.preUpdate(p);this.stage.preUpdate();this.state.update();this.stage.update();this.tweens.update();this.sound.update();this.input.update();this.physics.update();this.particles.update();this.plugins.update();this.stage.postUpdate();this.plugins.postUpdate()}else{this.scale.pauseUpdate();this.state.pauseUpdate();this.debug.preUpdate()}this.stage.updateTransform()},updateRender:function(p){if(this.lockRender){return}this.state.preRender(p);if(this.renderType!==g.HEADLESS){this.renderer.render(this.stage);this.plugins.render(p);this.state.render(p)}this.plugins.postRender(p)},enableStep:function(){this.stepping=true;this.pendingStep=false;this.stepCount=0},disableStep:function(){this.stepping=false;this.pendingStep=false},step:function(){this.pendingStep=false;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.plugins.destroy();this.state=null;this.sound=null;this.scale=null;this.stage=null;this.input=null;this.physics=null;this.plugins=null;this.cache=null;this.load=null;this.time=null;this.world=null;this.isBooted=false;this.renderer.destroy(false);g.Canvas.removeFromDOM(this.canvas);PIXI.defaultRenderer=null;g.GAMES[this.id]=null},gamePaused:function(p){if(!this._paused){this._paused=true;this.time.gamePaused();if(this.sound.muteOnPause){this.sound.setMute()}this.onPause.dispatch(p);if(this.device.cordova&&this.device.iOS){this.lockRender=true}}},gameResumed:function(p){if(this._paused&&!this._codePaused){this._paused=false;this.time.gameResumed();this.input.reset();if(this.sound.muteOnPause){this.sound.unsetMute()}this.onResume.dispatch(p);if(this.device.cordova&&this.device.iOS){this.lockRender=false}}},focusLoss:function(p){this.onBlur.dispatch(p);if(!this.stage.disableVisibilityChange){this.gamePaused(p)}},focusGain:function(p){this.onFocus.dispatch(p);if(!this.stage.disableVisibilityChange){this.gameResumed(p)}}};g.Game.prototype.constructor=g.Game;Object.defineProperty(g.Game.prototype,"paused",{get:function(){return this._paused},set:function(p){if(p===true){if(this._paused===false){this._paused=true;this.sound.setMute();this.time.gamePaused();this.onPause.dispatch(this)}this._codePaused=true}else{if(this._paused){this._paused=false;this.input.reset();this.sound.unsetMute();this.time.gameResumed();this.onResume.dispatch(this)}this._codePaused=false}}});g.Input=function(p){this.game=p;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.customCandidateHandler=null;this.customCandidateHandlerContext=null;this.pollRate=0;this.enabled=true;this.multiInputOverride=g.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=-1;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2000;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=false;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.pointers=[];this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=false;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new g.ArraySet();this._localPoint=new g.Point();this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};g.Input.MOUSE_OVERRIDES_TOUCH=0;g.Input.TOUCH_OVERRIDES_MOUSE=1;g.Input.MOUSE_TOUCH_COMBINE=2;g.Input.MAX_POINTERS=10;g.Input.prototype={boot:function(){this.mousePointer=new g.Pointer(this.game,0,g.PointerMode.CURSOR);this.addPointer();this.addPointer();this.mouse=new g.Mouse(this.game);this.touch=new g.Touch(this.game);this.mspointer=new g.MSPointer(this.game);if(g.Keyboard){this.keyboard=new g.Keyboard(this.game)}if(g.Gamepad){this.gamepad=new g.Gamepad(this.game)}this.onDown=new g.Signal();this.onUp=new g.Signal();this.onTap=new g.Signal();this.onHold=new g.Signal();this.scale=new g.Point(1,1);this.speed=new g.Point();this.position=new g.Point();this._oldPosition=new g.Point();this.circle=new g.Circle(0,0,44);this.activePointer=this.mousePointer;this.hitCanvas=PIXI.CanvasPool.create(this,1,1);this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.touch.start();this.mspointer.start();this.mousePointer.active=true;if(this.keyboard){this.keyboard.start()}var p=this;this._onClickTrampoline=function(q){p.onClickTrampoline(q)};this.game.canvas.addEventListener("click",this._onClickTrampoline,false)},destroy:function(){this.mouse.stop();this.touch.stop();this.mspointer.stop();if(this.keyboard){this.keyboard.stop()}if(this.gamepad){this.gamepad.stop()}this.moveCallbacks=[];PIXI.CanvasPool.remove(this);this.game.canvas.removeEventListener("click",this._onClickTrampoline)},setInteractiveCandidateHandler:function(q,p){this.customCandidateHandler=q;this.customCandidateHandlerContext=p},addMoveCallback:function(q,p){this.moveCallbacks.push({callback:q,context:p})},deleteMoveCallback:function(r,q){var p=this.moveCallbacks.length;while(p--){if(this.moveCallbacks[p].callback===r&&this.moveCallbacks[p].context===q){this.moveCallbacks.splice(p,1);return}}},addPointer:function(){if(this.pointers.length>=g.Input.MAX_POINTERS){console.warn("Phaser.Input.addPointer: Maximum limit of "+g.Input.MAX_POINTERS+" pointers reached.");return null}var q=this.pointers.length+1;var p=new g.Pointer(this.game,q,g.PointerMode.TOUCH);this.pointers.push(p);this["pointer"+q]=p;return p},update:function(){if(this.keyboard){this.keyboard.update()}if(this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();if(this.gamepad&&this.gamepad.active){this.gamepad.update()}for(var p=0;p<this.pointers.length;p++){this.pointers[p].update()}this._pollCounter=0},reset:function(q){if(!this.game.isBooted||this.resetLocked){return}if(q===undefined){q=false}this.mousePointer.reset();if(this.keyboard){this.keyboard.reset(q)}if(this.gamepad){this.gamepad.reset()}for(var p=0;p<this.pointers.length;p++){this.pointers[p].reset()}if(this.game.canvas.style.cursor!=="none"){this.game.canvas.style.cursor="inherit"}if(q){this.onDown.dispose();this.onUp.dispose();this.onTap.dispose();this.onHold.dispose();this.onDown=new g.Signal();this.onUp=new g.Signal();this.onTap=new g.Signal();this.onHold=new g.Signal();this.moveCallbacks=[]}this._pollCounter=0},resetSpeed:function(p,q){this._oldPosition.setTo(p,q);this.speed.setTo(0,0)},startPointer:function(q){if(this.maxPointers>=0&&this.countActivePointers(this.maxPointers)>=this.maxPointers){return null}if(!this.pointer1.active){return this.pointer1.start(q)}if(!this.pointer2.active){return this.pointer2.start(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(!r.active){return r.start(q)}}return null},updatePointer:function(q){if(this.pointer1.active&&this.pointer1.identifier===q.identifier){return this.pointer1.move(q)}if(this.pointer2.active&&this.pointer2.identifier===q.identifier){return this.pointer2.move(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active&&r.identifier===q.identifier){return r.move(q)}}return null},stopPointer:function(q){if(this.pointer1.active&&this.pointer1.identifier===q.identifier){return this.pointer1.stop(q)}if(this.pointer2.active&&this.pointer2.identifier===q.identifier){return this.pointer2.stop(q)}for(var p=2;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active&&r.identifier===q.identifier){return r.stop(q)}}return null},countActivePointers:function(p){if(p===undefined){p=this.pointers.length}var r=p;for(var q=0;q<this.pointers.length&&r>0;q++){var s=this.pointers[q];if(s.active){r--}}return(p-r)},getPointer:function(q){if(q===undefined){q=false}for(var p=0;p<this.pointers.length;p++){var r=this.pointers[p];if(r.active===q){return r}}return null},getPointerFromIdentifier:function(p){for(var q=0;q<this.pointers.length;q++){var r=this.pointers[q];if(r.identifier===p){return r}}return null},getPointerFromId:function(q){for(var p=0;p<this.pointers.length;p++){var r=this.pointers[p];if(r.pointerId===q){return r}}return null},getLocalPosition:function(s,r,q){if(q===undefined){q=new g.Point()}var p=s.worldTransform;var t=1/(p.a*p.d+p.c*-p.b);return q.setTo(p.d*t*r.x+-p.c*t*r.y+(p.ty*p.c-p.tx*p.d)*t,p.a*t*r.y+-p.b*t*r.x+(-p.ty*p.a+p.tx*p.b)*t)},hitTest:function(u,p,x){if(!u.worldVisible){return false}this.getLocalPosition(u,p,this._localPoint);x.copyFrom(this._localPoint);if(u.hitArea&&u.hitArea.contains){return(u.hitArea.contains(this._localPoint.x,this._localPoint.y))}else{if(u instanceof g.TileSprite){var q=u.width;var w=u.height;var r=-q*u.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+q){var v=-w*u.anchor.y;if(this._localPoint.y>=v&&this._localPoint.y<v+w){return true}}}else{if(u instanceof PIXI.Sprite){var q=u.texture.frame.width;var w=u.texture.frame.height;var r=-q*u.anchor.x;if(this._localPoint.x>=r&&this._localPoint.x<r+q){var v=-w*u.anchor.y;if(this._localPoint.y>=v&&this._localPoint.y<v+w){return true}}}else{if(u instanceof g.Graphics){for(var t=0;t<u.graphicsData.length;t++){var s=u.graphicsData[t];if(!s.fill){continue}if(s.shape&&s.shape.contains(this._localPoint.x,this._localPoint.y)){return true}}}}}}for(var t=0;t<u.children.length;t++){if(this.hitTest(u.children[t],p,x)){return true}}return false},onClickTrampoline:function(){this.activePointer.processClickTrampolines()}};g.Input.prototype.constructor=g.Input;Object.defineProperty(g.Input.prototype,"x",{get:function(){return this._x},set:function(p){this._x=Math.floor(p)}});Object.defineProperty(g.Input.prototype,"y",{get:function(){return this._y},set:function(p){this._y=Math.floor(p)}});Object.defineProperty(g.Input.prototype,"pollLocked",{get:function(){return(this.pollRate>0&&this._pollCounter<this.pollRate)}});Object.defineProperty(g.Input.prototype,"totalInactivePointers",{get:function(){return this.pointers.length-this.countActivePointers()}});Object.defineProperty(g.Input.prototype,"totalActivePointers",{get:function(){return this.countActivePointers()}});Object.defineProperty(g.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(g.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});g.Mouse=function(p){this.game=p;this.input=p.input;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=false;this.button=-1;this.wheelDelta=0;this.enabled=true;this.locked=false;this.stopOnGameOut=false;this.pointerLock=new g.Signal();this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null;this._wheelEvent=null};g.Mouse.NO_BUTTON=-1;g.Mouse.LEFT_BUTTON=0;g.Mouse.MIDDLE_BUTTON=1;g.Mouse.RIGHT_BUTTON=2;g.Mouse.BACK_BUTTON=3;g.Mouse.FORWARD_BUTTON=4;g.Mouse.WHEEL_UP=1;g.Mouse.WHEEL_DOWN=-1;g.Mouse.prototype={start:function(){if(this.game.device.android&&this.game.device.chrome===false){return}if(this._onMouseDown!==null){return}var r=this;this._onMouseDown=function(s){return r.onMouseDown(s)};this._onMouseMove=function(s){return r.onMouseMove(s)};this._onMouseUp=function(s){return r.onMouseUp(s)};this._onMouseUpGlobal=function(s){return r.onMouseUpGlobal(s)};this._onMouseOutGlobal=function(s){return r.onMouseOutGlobal(s)};this._onMouseOut=function(s){return r.onMouseOut(s)};this._onMouseOver=function(s){return r.onMouseOver(s)};this._onMouseWheel=function(s){return r.onMouseWheel(s)};var q=this.game.canvas;q.addEventListener("mousedown",this._onMouseDown,true);q.addEventListener("mousemove",this._onMouseMove,true);q.addEventListener("mouseup",this._onMouseUp,true);if(!this.game.device.cocoonJS){window.addEventListener("mouseup",this._onMouseUpGlobal,true);window.addEventListener("mouseout",this._onMouseOutGlobal,true);q.addEventListener("mouseover",this._onMouseOver,true);q.addEventListener("mouseout",this._onMouseOut,true)}var p=this.game.device.wheelEvent;if(p){q.addEventListener(p,this._onMouseWheel,true);if(p==="mousewheel"){this._wheelEvent=new l(-1/40,1)}else{if(p==="DOMMouseScroll"){this._wheelEvent=new l(1,1)}}}},onMouseDown:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.mouseDownCallback){this.mouseDownCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}p.identifier=0;this.input.mousePointer.start(p)},onMouseMove:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.mouseMoveCallback){this.mouseMoveCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}p.identifier=0;this.input.mousePointer.move(p)},onMouseUp:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}p.identifier=0;this.input.mousePointer.stop(p)},onMouseUpGlobal:function(p){if(!this.input.mousePointer.withinGame){if(this.mouseUpCallback){this.mouseUpCallback.call(this.callbackContext,p)}p.identifier=0;this.input.mousePointer.stop(p)}},onMouseOutGlobal:function(p){this.event=p;if(this.capture){p.preventDefault()}this.input.mousePointer.withinGame=false;if(!this.input.enabled||!this.enabled){return}this.input.mousePointer.stop(p);this.input.mousePointer.leftButton.stop(p);this.input.mousePointer.rightButton.stop(p)},onMouseOut:function(p){this.event=p;if(this.capture){p.preventDefault()}this.input.mousePointer.withinGame=false;if(this.mouseOutCallback){this.mouseOutCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}if(this.stopOnGameOut){p.identifier=0;this.input.mousePointer.stop(p)}},onMouseOver:function(p){this.event=p;if(this.capture){p.preventDefault()}this.input.mousePointer.withinGame=true;if(this.mouseOverCallback){this.mouseOverCallback.call(this.callbackContext,p)}},onMouseWheel:function(p){if(this._wheelEvent){p=this._wheelEvent.bindEvent(p)}this.event=p;if(this.capture){p.preventDefault()}this.wheelDelta=g.Math.clamp(-p.deltaY,-1,1);if(this.mouseWheelCallback){this.mouseWheelCallback.call(this.callbackContext,p)}},requestPointerLock:function(){if(this.game.device.pointerLock){var p=this.game.canvas;p.requestPointerLock=p.requestPointerLock||p.mozRequestPointerLock||p.webkitRequestPointerLock;p.requestPointerLock();var q=this;this._pointerLockChange=function(r){return q.pointerLockChange(r)};document.addEventListener("pointerlockchange",this._pointerLockChange,true);document.addEventListener("mozpointerlockchange",this._pointerLockChange,true);document.addEventListener("webkitpointerlockchange",this._pointerLockChange,true)}},pointerLockChange:function(q){var p=this.game.canvas;if(document.pointerLockElement===p||document.mozPointerLockElement===p||document.webkitPointerLockElement===p){this.locked=true;this.pointerLock.dispatch(true,q)}else{this.locked=false;this.pointerLock.dispatch(false,q)}},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)},stop:function(){var q=this.game.canvas;q.removeEventListener("mousedown",this._onMouseDown,true);q.removeEventListener("mousemove",this._onMouseMove,true);q.removeEventListener("mouseup",this._onMouseUp,true);q.removeEventListener("mouseover",this._onMouseOver,true);q.removeEventListener("mouseout",this._onMouseOut,true);var p=this.game.device.wheelEvent;if(p){q.removeEventListener(p,this._onMouseWheel,true)}window.removeEventListener("mouseup",this._onMouseUpGlobal,true);window.removeEventListener("mouseout",this._onMouseOutGlobal,true);document.removeEventListener("pointerlockchange",this._pointerLockChange,true);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,true);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,true)}};g.Mouse.prototype.constructor=g.Mouse;function l(q,p){this._scaleFactor=q;this._deltaMode=p;this.originalEvent=null}l.prototype={};l.prototype.constructor=l;l.prototype.bindEvent=function(q){if(!l._stubsGenerated&&q){var p=function(s){return function(){var t=this.originalEvent[s];return typeof t!=="function"?t:t.bind(this.originalEvent)}};for(var r in q){if(!(r in l.prototype)){Object.defineProperty(l.prototype,r,{get:p(r)})}}l._stubsGenerated=true}this.originalEvent=q;return this};Object.defineProperties(l.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return(this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail))||0}},deltaX:{get:function(){return(this._scaleFactor*this.originalEvent.wheelDeltaX)||0}},deltaZ:{value:0}});g.MSPointer=function(p){this.game=p;this.input=p.input;this.callbackContext=this.game;this.pointerDownCallback=null;this.pointerMoveCallback=null;this.pointerUpCallback=null;this.capture=true;this.button=-1;this.event=null;this.enabled=true;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null;this._onMSPointerUpGlobal=null;this._onMSPointerOut=null;this._onMSPointerOver=null};g.MSPointer.prototype={start:function(){if(this._onMSPointerDown!==null){return}var q=this;if(this.game.device.mspointer){this._onMSPointerDown=function(r){return q.onPointerDown(r)};this._onMSPointerMove=function(r){return q.onPointerMove(r)};this._onMSPointerUp=function(r){return q.onPointerUp(r)};this._onMSPointerUpGlobal=function(r){return q.onPointerUpGlobal(r)};this._onMSPointerOut=function(r){return q.onPointerOut(r)};this._onMSPointerOver=function(r){return q.onPointerOver(r)};var p=this.game.canvas;p.addEventListener("MSPointerDown",this._onMSPointerDown,false);p.addEventListener("MSPointerMove",this._onMSPointerMove,false);p.addEventListener("MSPointerUp",this._onMSPointerUp,false);p.addEventListener("pointerdown",this._onMSPointerDown,false);p.addEventListener("pointermove",this._onMSPointerMove,false);p.addEventListener("pointerup",this._onMSPointerUp,false);p.style["-ms-content-zooming"]="none";p.style["-ms-touch-action"]="none";if(!this.game.device.cocoonJS){window.addEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);p.addEventListener("MSPointerOver",this._onMSPointerOver,true);p.addEventListener("MSPointerOut",this._onMSPointerOut,true);window.addEventListener("pointerup",this._onMSPointerUpGlobal,true);p.addEventListener("pointerover",this._onMSPointerOver,true);p.addEventListener("pointerout",this._onMSPointerOut,true)}}},onPointerDown:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.pointerDownCallback){this.pointerDownCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}p.identifier=p.pointerId;if(p.pointerType==="mouse"||p.pointerType===4){this.input.mousePointer.start(p)}else{this.input.startPointer(p)}},onPointerMove:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.pointerMoveCallback){this.pointerMoveCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}p.identifier=p.pointerId;if(p.pointerType==="mouse"||p.pointerType===4){this.input.mousePointer.move(p)}else{this.input.updatePointer(p)}},onPointerUp:function(p){this.event=p;if(this.capture){p.preventDefault()}if(this.pointerUpCallback){this.pointerUpCallback.call(this.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}p.identifier=p.pointerId;if(p.pointerType==="mouse"||p.pointerType===4){this.input.mousePointer.stop(p)}else{this.input.stopPointer(p)}},onPointerUpGlobal:function(p){if((p.pointerType==="mouse"||p.pointerType===4)&&!this.input.mousePointer.withinGame){this.onPointerUp(p)}else{var q=this.input.getPointerFromIdentifier(p.identifier);if(q&&q.withinGame){this.onPointerUp(p)}}},onPointerOut:function(p){this.event=p;if(this.capture){p.preventDefault()}if(p.pointerType==="mouse"||p.pointerType===4){this.input.mousePointer.withinGame=false}else{var q=this.input.getPointerFromIdentifier(p.identifier);if(q){q.withinGame=false}}if(this.input.mouse.mouseOutCallback){this.input.mouse.mouseOutCallback.call(this.input.mouse.callbackContext,p)}if(!this.input.enabled||!this.enabled){return}if(this.input.mouse.stopOnGameOut){p.identifier=0;if(q){q.stop(p)}else{this.input.mousePointer.stop(p)}}},onPointerOver:function(p){this.event=p;if(this.capture){p.preventDefault()}if(p.pointerType==="mouse"||p.pointerType===4){this.input.mousePointer.withinGame=true}else{var q=this.input.getPointerFromIdentifier(p.identifier);if(q){q.withinGame=true}}if(this.input.mouse.mouseOverCallback){this.input.mouse.mouseOverCallback.call(this.input.mouse.callbackContext,p)}},stop:function(){var p=this.game.canvas;p.removeEventListener("MSPointerDown",this._onMSPointerDown,false);p.removeEventListener("MSPointerMove",this._onMSPointerMove,false);p.removeEventListener("MSPointerUp",this._onMSPointerUp,false);p.removeEventListener("pointerdown",this._onMSPointerDown,false);p.removeEventListener("pointermove",this._onMSPointerMove,false);p.removeEventListener("pointerup",this._onMSPointerUp,false);window.removeEventListener("MSPointerUp",this._onMSPointerUpGlobal,true);p.removeEventListener("MSPointerOver",this._onMSPointerOver,true);p.removeEventListener("MSPointerOut",this._onMSPointerOut,true);window.removeEventListener("pointerup",this._onMSPointerUpGlobal,true);p.removeEventListener("pointerover",this._onMSPointerOver,true);p.removeEventListener("pointerout",this._onMSPointerOut,true)}};g.MSPointer.prototype.constructor=g.MSPointer;g.DeviceButton=function(q,p){this.parent=q;this.game=q.game;this.event=null;this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false;this.value=0;this.buttonCode=p;this.onDown=new g.Signal();this.onUp=new g.Signal();this.onFloat=new g.Signal()};g.DeviceButton.prototype={start:function(p,q){if(this.isDown){return}this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.repeats=0;this.event=p;this.value=q;if(p){this.altKey=p.altKey;this.shiftKey=p.shiftKey;this.ctrlKey=p.ctrlKey}this.onDown.dispatch(this,q)},stop:function(p,q){if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.event=p;this.value=q;if(p){this.altKey=p.altKey;this.shiftKey=p.shiftKey;this.ctrlKey=p.ctrlKey}this.onUp.dispatch(this,q)},padFloat:function(p){this.value=p;this.onFloat.dispatch(this,p)},justPressed:function(p){p=p||250;return(this.isDown&&(this.timeDown+p)>this.game.time.time)},justReleased:function(p){p=p||250;return(this.isUp&&(this.timeUp+p)>this.game.time.time)},reset:function(){this.isDown=false;this.isUp=true;this.timeDown=this.game.time.time;this.repeats=0;this.altKey=false;this.shiftKey=false;this.ctrlKey=false},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.parent=null;this.game=null}};g.DeviceButton.prototype.constructor=g.DeviceButton;Object.defineProperty(g.DeviceButton.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.time-this.timeDown}});g.Pointer=function(p,r,q){this.game=p;this.id=r;this.type=g.POINTER;this.exists=true;this.identifier=0;this.pointerId=null;this.pointerMode=q||(g.PointerMode.CURSOR|g.PointerMode.CONTACT);this.target=null;this.button=null;this.leftButton=new g.DeviceButton(this,g.Pointer.LEFT_BUTTON);this.middleButton=new g.DeviceButton(this,g.Pointer.MIDDLE_BUTTON);this.rightButton=new g.DeviceButton(this,g.Pointer.RIGHT_BUTTON);this.backButton=new g.DeviceButton(this,g.Pointer.BACK_BUTTON);this.forwardButton=new g.DeviceButton(this,g.Pointer.FORWARD_BUTTON);this.eraserButton=new g.DeviceButton(this,g.Pointer.ERASER_BUTTON);this._holdSent=false;this._history=[];this._nextDrop=0;this._stateReset=false;this.withinGame=false;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=(r===0);this.isDown=false;this.isUp=true;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.interactiveCandidates=[];this.active=false;this.dirty=false;this.position=new g.Point();this.positionDown=new g.Point();this.positionUp=new g.Point();this.circle=new g.Circle(0,0,44);this._clickTrampolines=null;this._trampolineTargetObject=null};g.Pointer.NO_BUTTON=0;g.Pointer.LEFT_BUTTON=1;g.Pointer.RIGHT_BUTTON=2;g.Pointer.MIDDLE_BUTTON=4;g.Pointer.BACK_BUTTON=8;g.Pointer.FORWARD_BUTTON=16;g.Pointer.ERASER_BUTTON=32;g.Pointer.prototype={resetButtons:function(){this.isDown=false;this.isUp=true;if(this.isMouse){this.leftButton.reset();this.middleButton.reset();this.rightButton.reset();this.backButton.reset();this.forwardButton.reset();this.eraserButton.reset()}},processButtonsDown:function(q,p){if(g.Pointer.LEFT_BUTTON&q){this.leftButton.start(p)}if(g.Pointer.RIGHT_BUTTON&q){this.rightButton.start(p)}if(g.Pointer.MIDDLE_BUTTON&q){this.middleButton.start(p)}if(g.Pointer.BACK_BUTTON&q){this.backButton.start(p)}if(g.Pointer.FORWARD_BUTTON&q){this.forwardButton.start(p)}if(g.Pointer.ERASER_BUTTON&q){this.eraserButton.start(p)}},processButtonsUp:function(p,q){if(p===g.Mouse.LEFT_BUTTON){this.leftButton.stop(q)}if(p===g.Mouse.RIGHT_BUTTON){this.rightButton.stop(q)}if(p===g.Mouse.MIDDLE_BUTTON){this.middleButton.stop(q)}if(p===g.Mouse.BACK_BUTTON){this.backButton.stop(q)}if(p===g.Mouse.FORWARD_BUTTON){this.forwardButton.stop(q)}if(p===5){this.eraserButton.stop(q)}},updateButtons:function(p){this.button=p.button;var q=(p.type.toLowerCase().substr(-4)==="down");if(p.buttons!==undefined){if(q){this.processButtonsDown(p.buttons,p)}else{this.processButtonsUp(p.button,p)}}else{if(q){this.leftButton.start(p)}else{this.leftButton.stop(p);this.rightButton.stop(p)}}if(p.buttons===1&&p.ctrlKey&&this.leftButton.isDown){this.leftButton.stop(p);this.rightButton.start(p)}this.isUp=true;this.isDown=false;if(this.leftButton.isDown||this.rightButton.isDown||this.middleButton.isDown||this.backButton.isDown||this.forwardButton.isDown||this.eraserButton.isDown){this.isUp=false;this.isDown=true}},start:function(q){var p=this.game.input;if(q.pointerId){this.pointerId=q.pointerId}this.identifier=q.identifier;this.target=q.target;if(this.isMouse){this.updateButtons(q)}else{this.isDown=true;this.isUp=false}this.active=true;this.withinGame=true;this.dirty=false;this._history=[];this._clickTrampolines=null;this._trampolineTargetObject=null;this.msSinceLastClick=this.game.time.time-this.timeDown;this.timeDown=this.game.time.time;this._holdSent=false;this.move(q,true);this.positionDown.setTo(this.x,this.y);if(p.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||p.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(p.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&p.totalActivePointers===0)){p.x=this.x;p.y=this.y;p.position.setTo(this.x,this.y);p.onDown.dispatch(this,q);p.resetSpeed(this.x,this.y)}this._stateReset=false;this.totalTouches++;if(this.targetObject!==null){this.targetObject._touchedHandler(this)}return this},update:function(){var p=this.game.input;if(this.active){if(this.dirty){if(p.interactiveItems.total>0){this.processInteractiveObjects(false)}this.dirty=false}if(this._holdSent===false&&this.duration>=p.holdRate){if(p.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||p.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(p.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&p.totalActivePointers===0)){p.onHold.dispatch(this)}this._holdSent=true}if(p.recordPointerHistory&&this.game.time.time>=this._nextDrop){this._nextDrop=this.game.time.time+p.recordRate;this._history.push({x:this.position.x,y:this.position.y});if(this._history.length>p.recordLimit){this._history.shift()}}}},move:function(r,s){var p=this.game.input;if(p.pollLocked){return}if(s===undefined){s=false}if(r.button!==undefined){this.button=r.button}if(s&&this.isMouse){this.updateButtons(r)}this.clientX=r.clientX;this.clientY=r.clientY;this.pageX=r.pageX;this.pageY=r.pageY;this.screenX=r.screenX;this.screenY=r.screenY;if(this.isMouse&&p.mouse.locked&&!s){this.rawMovementX=r.movementX||r.mozMovementX||r.webkitMovementX||0;this.rawMovementY=r.movementY||r.mozMovementY||r.webkitMovementY||0;this.movementX+=this.rawMovementX;this.movementY+=this.rawMovementY}this.x=(this.pageX-this.game.scale.offset.x)*p.scale.x;this.y=(this.pageY-this.game.scale.offset.y)*p.scale.y;this.position.setTo(this.x,this.y);this.circle.x=this.x;this.circle.y=this.y;if(p.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||p.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(p.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&p.totalActivePointers===0)){p.activePointer=this;p.x=this.x;p.y=this.y;p.position.setTo(p.x,p.y);p.circle.x=p.x;p.circle.y=p.y}this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY);if(this.game.paused){return this}var q=p.moveCallbacks.length;while(q--){p.moveCallbacks[q].callback.call(p.moveCallbacks[q].context,this,this.x,this.y,s)}if(this.targetObject!==null&&this.targetObject.isDragged===true){if(this.targetObject.update(this)===false){this.targetObject=null}}else{if(p.interactiveItems.total>0){this.processInteractiveObjects(s)}}return this},processInteractiveObjects:function(t){var r=0;var q=-1;var p=null;var s=this.game.input.interactiveItems.first;this.interactiveCandidates=[];while(s){s.checked=false;if(s.validForInput(q,r,false)){s.checked=true;if((t&&s.checkPointerDown(this,true))||(!t&&s.checkPointerOver(this,true))){r=s.sprite.renderOrderID;q=s.priorityID;p=s;this.interactiveCandidates.push(s)}}s=this.game.input.interactiveItems.next}s=this.game.input.interactiveItems.first;while(s){if(!s.checked&&s.validForInput(q,r,true)){if((t&&s.checkPointerDown(this,false))||(!t&&s.checkPointerOver(this,false))){r=s.sprite.renderOrderID;q=s.priorityID;p=s;this.interactiveCandidates.push(s)}}s=this.game.input.interactiveItems.next}if(this.game.input.customCandidateHandler){p=this.game.input.customCandidateHandler.call(this.game.input.customCandidateHandlerContext,this,this.interactiveCandidates,p)}this.swapTarget(p,false);return(this.targetObject!==null)},swapTarget:function(q,p){if(p===undefined){p=false}if(q===null){if(this.targetObject){this.targetObject._pointerOutHandler(this,p);this.targetObject=null}}else{if(this.targetObject===null){this.targetObject=q;q._pointerOverHandler(this,p)}else{if(this.targetObject===q){if(q.update(this)===false){this.targetObject=null}}else{this.targetObject._pointerOutHandler(this,p);this.targetObject=q;this.targetObject._pointerOverHandler(this,p)}}}},leave:function(p){this.withinGame=false;this.move(p,false)},stop:function(q){var p=this.game.input;if(this._stateReset&&this.withinGame){q.preventDefault();return}this.timeUp=this.game.time.time;if(p.multiInputOverride===g.Input.MOUSE_OVERRIDES_TOUCH||p.multiInputOverride===g.Input.MOUSE_TOUCH_COMBINE||(p.multiInputOverride===g.Input.TOUCH_OVERRIDES_MOUSE&&p.totalActivePointers===0)){p.onUp.dispatch(this,q);if(this.duration>=0&&this.duration<=p.tapRate){if(this.timeUp-this.previousTapTime<p.doubleTapRate){p.onTap.dispatch(this,true)}else{p.onTap.dispatch(this,false)}this.previousTapTime=this.timeUp}}if(this.isMouse){this.updateButtons(q)}else{this.isDown=false;this.isUp=true}if(this.id>0){this.active=false}this.withinGame=this.game.scale.bounds.contains(q.pageX,q.pageY);this.pointerId=null;this.identifier=null;this.positionUp.setTo(this.x,this.y);if(this.isMouse===false){p.currentPointers--}p.interactiveItems.callAll("_releasedHandler",this);if(this._clickTrampolines){this._trampolineTargetObject=this.targetObject}this.targetObject=null;return this},justPressed:function(p){p=p||this.game.input.justPressedRate;return(this.isDown===true&&(this.timeDown+p)>this.game.time.time)},justReleased:function(p){p=p||this.game.input.justReleasedRate;return(this.isUp&&(this.timeUp+p)>this.game.time.time)},addClickTrampoline:function(q,u,p,s){if(!this.isDown){return}var t=(this._clickTrampolines=this._clickTrampolines||[]);for(var r=0;r<t.length;r++){if(t[r].name===q){t.splice(r,1);break}}t.push({name:q,targetObject:this.targetObject,callback:u,callbackContext:p,callbackArgs:s})},processClickTrampolines:function(){var r=this._clickTrampolines;if(!r){return}for(var p=0;p<r.length;p++){var q=r[p];if(q.targetObject===this._trampolineTargetObject){q.callback.apply(q.callbackContext,q.callbackArgs)}}this._clickTrampolines=null;this._trampolineTargetObject=null},reset:function(){if(this.isMouse===false){this.active=false}this.pointerId=null;this.identifier=null;this.dirty=false;this.totalTouches=0;this._holdSent=false;this._history.length=0;this._stateReset=true;this.resetButtons();if(this.targetObject){this.targetObject._releasedHandler(this)}this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};g.Pointer.prototype.constructor=g.Pointer;Object.defineProperty(g.Pointer.prototype,"duration",{get:function(){if(this.isUp){return -1}return this.game.time.time-this.timeDown}});Object.defineProperty(g.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(g.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});g.PointerMode={CURSOR:1<<0,CONTACT:1<<1};g.Touch=function(p){this.game=p;this.enabled=true;this.touchLockCallbacks=[];this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=true;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};g.Touch.prototype={start:function(){if(this._onTouchStart!==null){return}var p=this;if(this.game.device.touch){this._onTouchStart=function(q){return p.onTouchStart(q)};this._onTouchMove=function(q){return p.onTouchMove(q)};this._onTouchEnd=function(q){return p.onTouchEnd(q)};this._onTouchEnter=function(q){return p.onTouchEnter(q)};this._onTouchLeave=function(q){return p.onTouchLeave(q)};this._onTouchCancel=function(q){return p.onTouchCancel(q)};this.game.canvas.addEventListener("touchstart",this._onTouchStart,false);this.game.canvas.addEventListener("touchmove",this._onTouchMove,false);this.game.canvas.addEventListener("touchend",this._onTouchEnd,false);this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,false);if(!this.game.device.cocoonJS){this.game.canvas.addEventListener("touchenter",this._onTouchEnter,false);this.game.canvas.addEventListener("touchleave",this._onTouchLeave,false)}}},consumeDocumentTouches:function(){this._documentTouchMove=function(p){p.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,false)},addTouchLockCallback:function(r,q,p){if(p===undefined){p=false}this.touchLockCallbacks.push({callback:r,context:q,onEnd:p})},removeTouchLockCallback:function(r,q){var p=this.touchLockCallbacks.length;while(p--){if(this.touchLockCallbacks[p].callback===r&&this.touchLockCallbacks[p].context===q){this.touchLockCallbacks.splice(p,1);return true}}return false},onTouchStart:function(r){var q=this.touchLockCallbacks.length;while(q--){var p=this.touchLockCallbacks[q];if(!p.onEnd&&p.callback.call(p.context,this,r)){this.touchLockCallbacks.splice(q,1)}}this.event=r;if(!this.game.input.enabled||!this.enabled){return}if(this.touchStartCallback){this.touchStartCallback.call(this.callbackContext,r)}if(this.preventDefault){r.preventDefault()}for(var q=0;q<r.changedTouches.length;q++){this.game.input.startPointer(r.changedTouches[q])}},onTouchCancel:function(q){this.event=q;if(this.touchCancelCallback){this.touchCancelCallback.call(this.callbackContext,q)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.stopPointer(q.changedTouches[p])}},onTouchEnter:function(p){this.event=p;if(this.touchEnterCallback){this.touchEnterCallback.call(this.callbackContext,p)}if(!this.game.input.enabled||!this.enabled){return}if(this.preventDefault){p.preventDefault()}},onTouchLeave:function(p){this.event=p;if(this.touchLeaveCallback){this.touchLeaveCallback.call(this.callbackContext,p)}if(this.preventDefault){p.preventDefault()}},onTouchMove:function(q){this.event=q;if(this.touchMoveCallback){this.touchMoveCallback.call(this.callbackContext,q)}if(this.preventDefault){q.preventDefault()}for(var p=0;p<q.changedTouches.length;p++){this.game.input.updatePointer(q.changedTouches[p])}},onTouchEnd:function(r){var q=this.touchLockCallbacks.length;while(q--){var p=this.touchLockCallbacks[q];if(p.onEnd&&p.callback.call(p.context,this,r)){this.touchLockCallbacks.splice(q,1)}}this.event=r;if(this.touchEndCallback){this.touchEndCallback.call(this.callbackContext,r)}if(this.preventDefault){r.preventDefault()}for(var q=0;q<r.changedTouches.length;q++){this.game.input.stopPointer(r.changedTouches[q])}},stop:function(){if(this.game.device.touch){this.game.canvas.removeEventListener("touchstart",this._onTouchStart);this.game.canvas.removeEventListener("touchmove",this._onTouchMove);this.game.canvas.removeEventListener("touchend",this._onTouchEnd);this.game.canvas.removeEventListener("touchenter",this._onTouchEnter);this.game.canvas.removeEventListener("touchleave",this._onTouchLeave);this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel)}}};g.Touch.prototype.constructor=g.Touch;g.InputHandler=function(p){this.sprite=p;this.game=p.game;this.enabled=false;this.checked=false;this.priorityID=0;this.useHandCursor=false;this._setHandCursor=false;this.isDragged=false;this.allowHorizontalDrag=true;this.allowVerticalDrag=true;this.bringToTop=false;this.snapOffset=null;this.snapOnDrag=false;this.snapOnRelease=false;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=false;this.pixelPerfectClick=false;this.pixelPerfectAlpha=255;this.draggable=false;this.boundsRect=null;this.boundsSprite=null;this.scaleLayer=false;this.dragOffset=new g.Point();this.dragFromCenter=false;this.dragStopBlocksInputUp=false;this.dragStartPoint=new g.Point();this.dragDistanceThreshold=0;this.dragTimeThreshold=0;this.downPoint=new g.Point();this.snapPoint=new g.Point();this._dragPoint=new g.Point();this._dragPhase=false;this._pendingDrag=false;this._dragTimePass=false;this._dragDistancePass=false;this._wasEnabled=false;this._tempPoint=new g.Point();this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,camX:0,camY:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false})};g.InputHandler.prototype={start:function(r,p){r=r||0;if(p===undefined){p=false}if(this.enabled===false){this.game.input.interactiveItems.add(this);this.useHandCursor=p;this.priorityID=r;for(var q=0;q<10;q++){this._pointerData[q]={id:q,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}this.snapOffset=new g.Point();this.enabled=true;this._wasEnabled=true}this.sprite.events.onAddedToGroup.add(this.addedToGroup,this);this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this);return this.sprite},addedToGroup:function(){if(this._dragPhase){return}if(this._wasEnabled&&!this.enabled){this.start()}},removedFromGroup:function(){if(this._dragPhase){return}if(this.enabled){this._wasEnabled=true;this.stop()}else{this._wasEnabled=false}},reset:function(){this.enabled=false;for(var p=0;p<10;p++){this._pointerData[p]={id:p,x:0,y:0,isDown:false,isUp:false,isOver:false,isOut:false,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:false}}},stop:function(){if(this.enabled===false){return}else{this.enabled=false;this.game.input.interactiveItems.remove(this)}},destroy:function(){if(this.sprite){if(this._setHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}this.enabled=false;this.game.input.interactiveItems.remove(this);this._pointerData.length=0;this.boundsRect=null;this.boundsSprite=null;this.sprite=null}},validForInput:function(r,q,p){if(p===undefined){p=true}if(!this.enabled||this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID||(this.sprite.parent&&this.sprite.parent.ignoreChildInput)){return false}if(!p&&(this.pixelPerfectClick||this.pixelPerfectOver)){return false}if(this.priorityID>r||(this.priorityID===r&&this.sprite.renderOrderID>q)){return true}return false},isPixelPerfect:function(){return(this.pixelPerfectClick||this.pixelPerfectOver)},pointerX:function(p){p=p||0;return this._pointerData[p].x},pointerY:function(p){p=p||0;return this._pointerData[p].y},pointerDown:function(p){p=p||0;return this._pointerData[p].isDown},pointerUp:function(p){p=p||0;return this._pointerData[p].isUp},pointerTimeDown:function(p){p=p||0;return this._pointerData[p].timeDown},pointerTimeUp:function(p){p=p||0;return this._pointerData[p].timeUp},pointerOver:function(q){if(!this.enabled){return false}if(q===undefined){for(var p=0;p<10;p++){if(this._pointerData[p].isOver){return true}}return false}else{return this._pointerData[q].isOver}},pointerOut:function(q){if(!this.enabled){return false}if(q===undefined){for(var p=0;p<10;p++){if(this._pointerData[p].isOut){return true}}}else{return this._pointerData[q].isOut}},pointerTimeOver:function(p){p=p||0;return this._pointerData[p].timeOver},pointerTimeOut:function(p){p=p||0;return this._pointerData[p].timeOut},pointerDragged:function(p){p=p||0;return this._pointerData[p].isDragged},checkPointerDown:function(q,p){if(!q.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,q,this._tempPoint)){if(p===undefined){p=false}if(!p&&this.pixelPerfectClick){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPointerOver:function(q,p){if(!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible||this.sprite.worldScale.x===0||this.sprite.worldScale.y===0){return false}if(this.game.input.hitTest(this.sprite,q,this._tempPoint)){if(p===undefined){p=false}if(!p&&this.pixelPerfectOver){return this.checkPixel(this._tempPoint.x,this._tempPoint.y)}else{return true}}return false},checkPixel:function(p,s,r){if(this.sprite.texture.baseTexture.source){if(p===null&&s===null){this.game.input.getLocalPosition(this.sprite,r,this._tempPoint);var p=this._tempPoint.x;var s=this._tempPoint.y}if(this.sprite.anchor.x!==0){p-=-this.sprite.texture.frame.width*this.sprite.anchor.x}if(this.sprite.anchor.y!==0){s-=-this.sprite.texture.frame.height*this.sprite.anchor.y}p+=this.sprite.texture.frame.x;s+=this.sprite.texture.frame.y;if(this.sprite.texture.trim){p-=this.sprite.texture.trim.x;s-=this.sprite.texture.trim.y;if(p<this.sprite.texture.crop.x||p>this.sprite.texture.crop.right||s<this.sprite.texture.crop.y||s>this.sprite.texture.crop.bottom){this._dx=p;this._dy=s;return false}}this._dx=p;this._dy=s;this.game.input.hitContext.clearRect(0,0,1,1);this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,p,s,1,1,0,0,1,1);var q=this.game.input.hitContext.getImageData(0,0,1,1);if(q.data[3]>=this.pixelPerfectAlpha){return true}}return false},update:function(p){if(this.sprite===null||this.sprite.parent===undefined){return}if(!this.enabled||!this.sprite.visible||!this.sprite.parent.visible){this._pointerOutHandler(p);return false}if(this._pendingDrag){if(!this._dragDistancePass){this._dragDistancePass=(g.Math.distance(p.x,p.y,this.downPoint.x,this.downPoint.y)>=this.dragDistanceThreshold)}if(this._dragDistancePass&&this._dragTimePass){this.startDrag(p)}return true}else{if(this.draggable&&this._draggedPointerID===p.id){return this.updateDrag(p,false)}else{if(this._pointerData[p.id].isOver){if(this.checkPointerOver(p)){this._pointerData[p.id].x=p.x-this.sprite.x;this._pointerData[p.id].y=p.y-this.sprite.y;return true}else{this._pointerOutHandler(p);return false}}}}},_pointerOverHandler:function(r,p){if(this.sprite===null){return}var q=this._pointerData[r.id];if(q.isOver===false||r.dirty){var s=(q.isOver===false);q.isOver=true;q.isOut=false;q.timeOver=this.game.time.time;q.x=r.x-this.sprite.x;q.y=r.y-this.sprite.y;if(this.useHandCursor&&q.isDragged===false){this.game.canvas.style.cursor="pointer";this._setHandCursor=true}if(!p&&s&&this.sprite&&this.sprite.events){this.sprite.events.onInputOver$dispatch(this.sprite,r)}if(this.sprite.parent&&this.sprite.parent.type===g.GROUP){this.sprite.parent.onChildInputOver.dispatch(this.sprite,r)}}},_pointerOutHandler:function(r,p){if(this.sprite===null){return}var q=this._pointerData[r.id];q.isOver=false;q.isOut=true;q.timeOut=this.game.time.time;if(this.useHandCursor&&q.isDragged===false){this.game.canvas.style.cursor="default";this._setHandCursor=false}if(!p&&this.sprite&&this.sprite.events){this.sprite.events.onInputOut$dispatch(this.sprite,r);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===g.GROUP){this.sprite.parent.onChildInputOut.dispatch(this.sprite,r)}}},_touchedHandler:function(q){if(this.sprite===null){return}var p=this._pointerData[q.id];if(!p.isDown&&p.isOver){if(this.pixelPerfectClick&&!this.checkPixel(null,null,q)){return}p.isDown=true;p.isUp=false;p.timeDown=this.game.time.time;this.downPoint.set(q.x,q.y);q.dirty=true;if(this.sprite&&this.sprite.events){this.sprite.events.onInputDown$dispatch(this.sprite,q);if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===g.GROUP){this.sprite.parent.onChildInputDown.dispatch(this.sprite,q)}if(this.sprite===null){return}}if(this.draggable&&this.isDragged===false){if(this.dragTimeThreshold===0&&this.dragDistanceThreshold===0){this.startDrag(q)}else{this._pendingDrag=true;this._dragDistancePass=(this.dragDistanceThreshold===0);if(this.dragTimeThreshold>0){this._dragTimePass=false;this.game.time.events.add(this.dragTimeThreshold,this.dragTimeElapsed,this,q)}else{this._dragTimePass=true}}}if(this.bringToTop){this.sprite.bringToTop()}}},dragTimeElapsed:function(p){this._dragTimePass=true;if(this._pendingDrag&&this.sprite){if(this._dragDistancePass){this.startDrag(p)}}},_releasedHandler:function(r){if(this.sprite===null){return}var p=this._pointerData[r.id];if(p.isDown&&r.isUp){p.isDown=false;p.isUp=true;p.timeUp=this.game.time.time;p.downDuration=p.timeUp-p.timeDown;var q=this.checkPointerOver(r);if(this.sprite&&this.sprite.events){if(!this.dragStopBlocksInputUp||this.dragStopBlocksInputUp&&!(this.draggable&&this.isDragged&&this._draggedPointerID===r.id)){this.sprite.events.onInputUp$dispatch(this.sprite,r,q)}if(this.sprite&&this.sprite.parent&&this.sprite.parent.type===g.GROUP){this.sprite.parent.onChildInputUp.dispatch(this.sprite,r,q)}if(q){q=this.checkPointerOver(r)}}p.isOver=q;if(!q&&this.useHandCursor){this.game.canvas.style.cursor="default";this._setHandCursor=false}r.dirty=true;this._pendingDrag=false;if(this.draggable&&this.isDragged&&this._draggedPointerID===r.id){this.stopDrag(r)}}},updateDrag:function(t,q){if(q===undefined){q=false}if(t.isUp){this.stopDrag(t);return false}var s=this.globalToLocalX(t.x)+this._dragPoint.x+this.dragOffset.x;var r=this.globalToLocalY(t.y)+this._dragPoint.y+this.dragOffset.y;if(this.sprite.fixedToCamera){if(this.allowHorizontalDrag){this.sprite.cameraOffset.x=s}if(this.allowVerticalDrag){this.sprite.cameraOffset.y=r}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);this.snapPoint.set(this.sprite.cameraOffset.x,this.sprite.cameraOffset.y)}}else{var p=this.game.camera.x-this._pointerData[t.id].camX;var u=this.game.camera.y-this._pointerData[t.id].camY;if(this.allowHorizontalDrag){this.sprite.x=s+p}if(this.allowVerticalDrag){this.sprite.y=r+u}if(this.boundsRect){this.checkBoundsRect()}if(this.boundsSprite){this.checkBoundsSprite()}if(this.snapOnDrag){this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY);this.snapPoint.set(this.sprite.x,this.sprite.y)}}this.sprite.events.onDragUpdate.dispatch(this.sprite,t,s,r,this.snapPoint,q);return true},justOver:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isOver&&this.overDuration(q)<p)},justOut:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isOut&&(this.game.time.time-this._pointerData[q].timeOut<p))},justPressed:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isDown&&this.downDuration(q)<p)},justReleased:function(q,p){q=q||0;p=p||500;return(this._pointerData[q].isUp&&(this.game.time.time-this._pointerData[q].timeUp<p))},overDuration:function(p){p=p||0;if(this._pointerData[p].isOver){return this.game.time.time-this._pointerData[p].timeOver}return -1},downDuration:function(p){p=p||0;if(this._pointerData[p].isDown){return this.game.time.time-this._pointerData[p].timeDown}return -1},enableDrag:function(q,t,p,s,u,r){if(q===undefined){q=false}if(t===undefined){t=false}if(p===undefined){p=false}if(s===undefined){s=255}if(u===undefined){u=null}if(r===undefined){r=null}this._dragPoint=new g.Point();this.draggable=true;this.bringToTop=t;this.dragOffset=new g.Point();this.dragFromCenter=q;this.pixelPerfectClick=p;this.pixelPerfectAlpha=s;if(u){this.boundsRect=u}if(r){this.boundsSprite=r}},disableDrag:function(){if(this._pointerData){for(var p=0;p<10;p++){this._pointerData[p].isDragged=false}}this.draggable=false;this.isDragged=false;this._draggedPointerID=-1;this._pendingDrag=false},startDrag:function(r){var p=this.sprite.x;var s=this.sprite.y;this.isDragged=true;this._draggedPointerID=r.id;this._pointerData[r.id].camX=this.game.camera.x;this._pointerData[r.id].camY=this.game.camera.y;this._pointerData[r.id].isDragged=true;if(this.sprite.fixedToCamera){if(this.dragFromCenter){var q=this.sprite.getBounds();this.sprite.cameraOffset.x=this.globalToLocalX(r.x)+(this.sprite.cameraOffset.x-q.centerX);this.sprite.cameraOffset.y=this.globalToLocalY(r.y)+(this.sprite.cameraOffset.y-q.centerY)}this._dragPoint.setTo(this.sprite.cameraOffset.x-r.x,this.sprite.cameraOffset.y-r.y)}else{if(this.dragFromCenter){var q=this.sprite.getBounds();this.sprite.x=this.globalToLocalX(r.x)+(this.sprite.x-q.centerX);this.sprite.y=this.globalToLocalY(r.y)+(this.sprite.y-q.centerY)}this._dragPoint.setTo(this.sprite.x-this.globalToLocalX(r.x),this.sprite.y-this.globalToLocalY(r.y))}this.updateDrag(r,true);if(this.bringToTop){this._dragPhase=true;this.sprite.bringToTop()}this.dragStartPoint.set(p,s);this.sprite.events.onDragStart$dispatch(this.sprite,r,p,s);this._pendingDrag=false},globalToLocalX:function(p){if(this.scaleLayer){p-=this.game.scale.grid.boundsFluid.x;p*=this.game.scale.grid.scaleFluidInversed.x}return p},globalToLocalY:function(p){if(this.scaleLayer){p-=this.game.scale.grid.boundsFluid.y;p*=this.game.scale.grid.scaleFluidInversed.y}return p},stopDrag:function(p){this.isDragged=false;this._draggedPointerID=-1;this._pointerData[p.id].isDragged=false;this._dragPhase=false;this._pendingDrag=false;if(this.snapOnRelease){if(this.sprite.fixedToCamera){this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}else{this.sprite.x=Math.round((this.sprite.x-(this.snapOffsetX%this.snapX))/this.snapX)*this.snapX+(this.snapOffsetX%this.snapX);this.sprite.y=Math.round((this.sprite.y-(this.snapOffsetY%this.snapY))/this.snapY)*this.snapY+(this.snapOffsetY%this.snapY)}}this.sprite.events.onDragStop$dispatch(this.sprite,p);if(this.checkPointerOver(p)===false){this._pointerOutHandler(p)}},setDragLock:function(p,q){if(p===undefined){p=true}if(q===undefined){q=true}this.allowHorizontalDrag=p;this.allowVerticalDrag=q},enableSnap:function(s,r,q,p,u,t){if(q===undefined){q=true}if(p===undefined){p=false}if(u===undefined){u=0}if(t===undefined){t=0}this.snapX=s;this.snapY=r;this.snapOffsetX=u;this.snapOffsetY=t;this.snapOnDrag=q;this.snapOnRelease=p},disableSnap:function(){this.snapOnDrag=false;this.snapOnRelease=false},checkBoundsRect:function(){if(this.sprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsRect.left){this.sprite.cameraOffset.x=this.boundsRect.left}else{if((this.sprite.cameraOffset.x+this.sprite.width)>this.boundsRect.right){this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsRect.top){this.sprite.cameraOffset.y=this.boundsRect.top}else{if((this.sprite.cameraOffset.y+this.sprite.height)>this.boundsRect.bottom){this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height}}}else{if(this.sprite.left<this.boundsRect.left){this.sprite.x=this.boundsRect.x+this.sprite.offsetX}else{if(this.sprite.right>this.boundsRect.right){this.sprite.x=this.boundsRect.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsRect.top){this.sprite.y=this.boundsRect.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsRect.bottom){this.sprite.y=this.boundsRect.bottom-(this.sprite.height-this.sprite.offsetY)}}}},checkBoundsSprite:function(){if(this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera){if(this.sprite.cameraOffset.x<this.boundsSprite.cameraOffset.x){this.sprite.cameraOffset.x=this.boundsSprite.cameraOffset.x}else{if((this.sprite.cameraOffset.x+this.sprite.width)>(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)){this.sprite.cameraOffset.x=(this.boundsSprite.cameraOffset.x+this.boundsSprite.width)-this.sprite.width}}if(this.sprite.cameraOffset.y<this.boundsSprite.cameraOffset.y){this.sprite.cameraOffset.y=this.boundsSprite.cameraOffset.y}else{if((this.sprite.cameraOffset.y+this.sprite.height)>(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)){this.sprite.cameraOffset.y=(this.boundsSprite.cameraOffset.y+this.boundsSprite.height)-this.sprite.height}}}else{if(this.sprite.left<this.boundsSprite.left){this.sprite.x=this.boundsSprite.left+this.sprite.offsetX}else{if(this.sprite.right>this.boundsSprite.right){this.sprite.x=this.boundsSprite.right-(this.sprite.width-this.sprite.offsetX)}}if(this.sprite.top<this.boundsSprite.top){this.sprite.y=this.boundsSprite.top+this.sprite.offsetY}else{if(this.sprite.bottom>this.boundsSprite.bottom){this.sprite.y=this.boundsSprite.bottom-(this.sprite.height-this.sprite.offsetY)}}}}};g.InputHandler.prototype.constructor=g.InputHandler;g.Gamepad=function(p){this.game=p;this._gamepadIndexMap={};this._rawPads=[];this._active=false;this.enabled=true;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||(navigator.userAgent.indexOf("Firefox/")!==-1)||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new g.SinglePad(p,this),new g.SinglePad(p,this),new g.SinglePad(p,this),new g.SinglePad(p,this)]};g.Gamepad.prototype={addCallbacks:function(p,q){if(typeof q!=="undefined"){this.onConnectCallback=(typeof q.onConnect==="function")?q.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof q.onDisconnect==="function")?q.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof q.onDown==="function")?q.onDown:this.onDownCallback;this.onUpCallback=(typeof q.onUp==="function")?q.onUp:this.onUpCallback;this.onAxisCallback=(typeof q.onAxis==="function")?q.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof q.onFloat==="function")?q.onFloat:this.onFloatCallback;this.callbackContext=p}},start:function(){if(this._active){return}this._active=true;var p=this;this._onGamepadConnected=function(q){return p.onGamepadConnected(q)};this._onGamepadDisconnected=function(q){return p.onGamepadDisconnected(q)};window.addEventListener("gamepadconnected",this._onGamepadConnected,false);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,false)},onGamepadConnected:function(q){var p=q.gamepad;this._rawPads.push(p);this._gamepads[p.index].connect(p)},onGamepadDisconnected:function(q){var r=q.gamepad;for(var p in this._rawPads){if(this._rawPads[p].index===r.index){this._rawPads.splice(p,1)}}this._gamepads[r.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){if(!this._active){return}if(navigator.getGamepads){var p=navigator.getGamepads()}else{if(navigator.webkitGetGamepads){var p=navigator.webkitGetGamepads()}else{if(navigator.webkitGamepads){var p=navigator.webkitGamepads()}}}if(p){this._rawPads=[];var w=false;for(var u=0;u<p.length;u++){if(typeof p[u]!==this._prevRawGamepadTypes[u]){w=true;this._prevRawGamepadTypes[u]=typeof p[u]}if(p[u]){this._rawPads.push(p[u])}if(u===3){break}}for(var v=0;v<this._gamepads.length;v++){this._gamepads[v]._rawPad=this._rawPads[v]}if(w){var z={rawIndices:{},padIndices:{}};var y;for(var t=0;t<this._gamepads.length;t++){y=this._gamepads[t];if(y.connected){for(var s=0;s<this._rawPads.length;s++){if(this._rawPads[s].index===y.index){z.rawIndices[y.index]=true;z.padIndices[t]=true}}}}for(var r=0;r<this._gamepads.length;r++){y=this._gamepads[r];if(z.padIndices[r]){continue}if(this._rawPads.length<1){y.disconnect()}for(var q=0;q<this._rawPads.length;q++){if(z.padIndices[r]){break}var x=this._rawPads[q];if(x){if(z.rawIndices[x.index]){y.disconnect();continue}else{y.connect(x);z.rawIndices[x.index]=true;z.padIndices[r]=true}}else{y.disconnect()}}}}}},setDeadZones:function(q){for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].deadZone=q}},stop:function(){this._active=false;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].reset()}},justPressed:function(p,r){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].justPressed(p,r)===true){return true}}return false},justReleased:function(p,r){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].justReleased(p,r)===true){return true}}return false},isDown:function(p){for(var q=0;q<this._gamepads.length;q++){if(this._gamepads[q].isDown(p)===true){return true}}return false},destroy:function(){this.stop();for(var p=0;p<this._gamepads.length;p++){this._gamepads[p].destroy()}}};g.Gamepad.prototype.constructor=g.Gamepad;Object.defineProperty(g.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(g.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(g.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(g.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(g.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(g.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(g.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});g.Gamepad.BUTTON_0=0;g.Gamepad.BUTTON_1=1;g.Gamepad.BUTTON_2=2;g.Gamepad.BUTTON_3=3;g.Gamepad.BUTTON_4=4;g.Gamepad.BUTTON_5=5;g.Gamepad.BUTTON_6=6;g.Gamepad.BUTTON_7=7;g.Gamepad.BUTTON_8=8;g.Gamepad.BUTTON_9=9;g.Gamepad.BUTTON_10=10;g.Gamepad.BUTTON_11=11;g.Gamepad.BUTTON_12=12;g.Gamepad.BUTTON_13=13;g.Gamepad.BUTTON_14=14;g.Gamepad.BUTTON_15=15;g.Gamepad.AXIS_0=0;g.Gamepad.AXIS_1=1;g.Gamepad.AXIS_2=2;g.Gamepad.AXIS_3=3;g.Gamepad.AXIS_4=4;g.Gamepad.AXIS_5=5;g.Gamepad.AXIS_6=6;g.Gamepad.AXIS_7=7;g.Gamepad.AXIS_8=8;g.Gamepad.AXIS_9=9;g.Gamepad.XBOX360_A=0;g.Gamepad.XBOX360_B=1;g.Gamepad.XBOX360_X=2;g.Gamepad.XBOX360_Y=3;g.Gamepad.XBOX360_LEFT_BUMPER=4;g.Gamepad.XBOX360_RIGHT_BUMPER=5;g.Gamepad.XBOX360_LEFT_TRIGGER=6;g.Gamepad.XBOX360_RIGHT_TRIGGER=7;g.Gamepad.XBOX360_BACK=8;g.Gamepad.XBOX360_START=9;g.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;g.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;g.Gamepad.XBOX360_DPAD_LEFT=14;g.Gamepad.XBOX360_DPAD_RIGHT=15;g.Gamepad.XBOX360_DPAD_UP=12;g.Gamepad.XBOX360_DPAD_DOWN=13;g.Gamepad.XBOX360_STICK_LEFT_X=0;g.Gamepad.XBOX360_STICK_LEFT_Y=1;g.Gamepad.XBOX360_STICK_RIGHT_X=2;g.Gamepad.XBOX360_STICK_RIGHT_Y=3;g.Gamepad.PS3XC_X=0;g.Gamepad.PS3XC_CIRCLE=1;g.Gamepad.PS3XC_SQUARE=2;g.Gamepad.PS3XC_TRIANGLE=3;g.Gamepad.PS3XC_L1=4;g.Gamepad.PS3XC_R1=5;g.Gamepad.PS3XC_L2=6;g.Gamepad.PS3XC_R2=7;g.Gamepad.PS3XC_SELECT=8;g.Gamepad.PS3XC_START=9;g.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;g.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;g.Gamepad.PS3XC_DPAD_UP=12;g.Gamepad.PS3XC_DPAD_DOWN=13;g.Gamepad.PS3XC_DPAD_LEFT=14;g.Gamepad.PS3XC_DPAD_RIGHT=15;g.Gamepad.PS3XC_STICK_LEFT_X=0;g.Gamepad.PS3XC_STICK_LEFT_Y=1;g.Gamepad.PS3XC_STICK_RIGHT_X=2;g.Gamepad.PS3XC_STICK_RIGHT_Y=3;g.SinglePad=function(p,q){this.game=p;this.index=null;this.connected=false;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=0.26;this._padParent=q;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};g.SinglePad.prototype={addCallbacks:function(p,q){if(typeof q!=="undefined"){this.onConnectCallback=(typeof q.onConnect==="function")?q.onConnect:this.onConnectCallback;this.onDisconnectCallback=(typeof q.onDisconnect==="function")?q.onDisconnect:this.onDisconnectCallback;this.onDownCallback=(typeof q.onDown==="function")?q.onDown:this.onDownCallback;this.onUpCallback=(typeof q.onUp==="function")?q.onUp:this.onUpCallback;this.onAxisCallback=(typeof q.onAxis==="function")?q.onAxis:this.onAxisCallback;this.onFloatCallback=(typeof q.onFloat==="function")?q.onFloat:this.onFloatCallback;this.callbackContext=p}},getButton:function(p){if(this._buttons[p]){return this._buttons[p]}else{return null}},pollStatus:function(){if(!this.connected||!this.game.input.enabled||!this.game.input.gamepad.enabled||(this._rawPad.timestamp&&(this._rawPad.timestamp===this._prevTimestamp))){return}for(var r=0;r<this._buttonsLen;r++){var p=isNaN(this._rawPad.buttons[r])?this._rawPad.buttons[r].value:this._rawPad.buttons[r];if(p!==this._buttons[r].value){if(p===1){this.processButtonDown(r,p)}else{if(p===0){this.processButtonUp(r,p)}else{this.processButtonFloat(r,p)}}}}for(var q=0;q<this._axesLen;q++){var s=this._rawPad.axes[q];if((s>0&&s>this.deadZone)||(s<0&&s<-this.deadZone)){this.processAxisChange(q,s)}else{this.processAxisChange(q,0)}}this._prevTimestamp=this._rawPad.timestamp},connect:function(r){var s=!this.connected;this.connected=true;this.index=r.index;this._rawPad=r;this._buttons=[];this._buttonsLen=r.buttons.length;this._axes=[];this._axesLen=r.axes.length;for(var p=0;p<this._axesLen;p++){this._axes[p]=r.axes[p]}for(var q in r.buttons){q=parseInt(q,10);this._buttons[q]=new g.DeviceButton(this,q)}if(s&&this._padParent.onConnectCallback){this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index)}if(s&&this.onConnectCallback){this.onConnectCallback.call(this.callbackContext)}},disconnect:function(){var r=this.connected;var p=this.index;this.connected=false;this.index=null;this._rawPad=undefined;for(var q=0;q<this._buttonsLen;q++){this._buttons[q].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;if(r&&this._padParent.onDisconnectCallback){this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,p)}if(r&&this.onDisconnectCallback){this.onDisconnectCallback.call(this.callbackContext)}},destroy:function(){this._rawPad=undefined;for(var p=0;p<this._buttonsLen;p++){this._buttons[p].destroy()}this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(p,q){if(this._axes[p]===q){return}this._axes[p]=q;if(this._padParent.onAxisCallback){this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,p,q)}if(this.onAxisCallback){this.onAxisCallback.call(this.callbackContext,this,p,q)}},processButtonDown:function(p,q){if(this._buttons[p]){this._buttons[p].start(null,q)}if(this._padParent.onDownCallback){this._padParent.onDownCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,p,q)}},processButtonUp:function(p,q){if(this._padParent.onUpCallback){this._padParent.onUpCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].stop(null,q)}},processButtonFloat:function(p,q){if(this._padParent.onFloatCallback){this._padParent.onFloatCallback.call(this._padParent.callbackContext,p,q,this.index)}if(this.onFloatCallback){this.onFloatCallback.call(this.callbackContext,p,q)}if(this._buttons[p]){this._buttons[p].padFloat(q)}},axis:function(p){if(this._axes[p]){return this._axes[p]}return false},isDown:function(p){if(this._buttons[p]){return this._buttons[p].isDown}return false},isUp:function(p){if(this._buttons[p]){return this._buttons[p].isUp}return false},justReleased:function(p,q){if(this._buttons[p]){return this._buttons[p].justReleased(q)}},justPressed:function(p,q){if(this._buttons[p]){return this._buttons[p].justPressed(q)}},buttonValue:function(p){if(this._buttons[p]){return this._buttons[p].value}return null},reset:function(){for(var p=0;p<this._axes.length;p++){this._axes[p]=0}}};g.SinglePad.prototype.constructor=g.SinglePad;g.Key=function(q,p){this.game=q;this._enabled=true;this.event=null;this.isDown=false;this.isUp=true;this.altKey=false;this.ctrlKey=false;this.shiftKey=false;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=p;this.onDown=new g.Signal();this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new g.Signal();this._justDown=false;this._justUp=false};g.Key.prototype={update:function(){if(!this._enabled){return}if(this.isDown){this.duration=this.game.time.time-this.timeDown;this.repeats++;if(this.onHoldCallback){this.onHoldCallback.call(this.onHoldContext,this)}}},processKeyDown:function(p){if(!this._enabled){return}this.event=p;if(this.isDown){return}this.altKey=p.altKey;this.ctrlKey=p.ctrlKey;this.shiftKey=p.shiftKey;this.isDown=true;this.isUp=false;this.timeDown=this.game.time.time;this.duration=0;this.repeats=0;this._justDown=true;this.onDown.dispatch(this)},processKeyUp:function(p){if(!this._enabled){return}this.event=p;if(this.isUp){return}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=this.game.time.time-this.timeDown;this._justUp=true;this.onUp.dispatch(this)},reset:function(p){if(p===undefined){p=true}this.isDown=false;this.isUp=true;this.timeUp=this.game.time.time;this.duration=0;this._enabled=true;this._justDown=false;this._justUp=false;if(p){this.onDown.removeAll();this.onUp.removeAll();this.onHoldCallback=null;this.onHoldContext=null}},downDuration:function(p){if(p===undefined){p=50}return(this.isDown&&this.duration<p)},upDuration:function(p){if(p===undefined){p=50}return(!this.isDown&&((this.game.time.time-this.timeUp)<p))}};Object.defineProperty(g.Key.prototype,"justDown",{get:function(){var p=this._justDown;this._justDown=false;return p}});Object.defineProperty(g.Key.prototype,"justUp",{get:function(){var p=this._justUp;this._justUp=false;return p}});Object.defineProperty(g.Key.prototype,"enabled",{get:function(){return this._enabled},set:function(p){p=!!p;if(p!==this._enabled){if(!p){this.reset(false)}this._enabled=p}}});g.Key.prototype.constructor=g.Key;g.Keyboard=function(p){this.game=p;this.enabled=true;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};g.Keyboard.prototype={addCallbacks:function(p,q,s,r){this.callbackContext=p;if(q!==undefined&&q!==null){this.onDownCallback=q}if(s!==undefined&&s!==null){this.onUpCallback=s}if(r!==undefined&&r!==null){this.onPressCallback=r}},addKey:function(p){if(!this._keys[p]){this._keys[p]=new g.Key(this.game,p);this.addKeyCapture(p)}return this._keys[p]},addKeys:function(r){var p={};for(var q in r){p[q]=this.addKey(r[q])}return p},removeKey:function(p){if(this._keys[p]){this._keys[p]=null;this.removeKeyCapture(p)}},createCursorKeys:function(){return this.addKeys({up:g.KeyCode.UP,down:g.KeyCode.DOWN,left:g.KeyCode.LEFT,right:g.KeyCode.RIGHT})},start:function(){if(this.game.device.cocoonJS){return}if(this._onKeyDown!==null){return}var p=this;this._onKeyDown=function(q){return p.processKeyDown(q)};this._onKeyUp=function(q){return p.processKeyUp(q)};this._onKeyPress=function(q){return p.processKeyPress(q)};window.addEventListener("keydown",this._onKeyDown,false);window.addEventListener("keyup",this._onKeyUp,false);window.addEventListener("keypress",this._onKeyPress,false)},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(p){if(typeof p==="object"){for(var q in p){this._capture[p[q]]=true}}else{this._capture[p]=true}},removeKeyCapture:function(p){delete this._capture[p]},clearCaptures:function(){this._capture={}},update:function(){this._i=this._keys.length;while(this._i--){if(this._keys[this._i]){this._keys[this._i].update()}}},processKeyDown:function(q){this.event=q;if(!this.game.input.enabled||!this.enabled){return}var p=q.keyCode;if(this._capture[p]){q.preventDefault()}if(!this._keys[p]){this._keys[p]=new g.Key(this.game,p)}this._keys[p].processKeyDown(q);this._k=p;if(this.onDownCallback){this.onDownCallback.call(this.callbackContext,q)}},processKeyPress:function(p){this.pressEvent=p;if(!this.game.input.enabled||!this.enabled){return}if(this.onPressCallback){this.onPressCallback.call(this.callbackContext,String.fromCharCode(p.charCode),p)}},processKeyUp:function(q){this.event=q;if(!this.game.input.enabled||!this.enabled){return}var p=q.keyCode;if(this._capture[p]){q.preventDefault()}if(!this._keys[p]){this._keys[p]=new g.Key(this.game,p)}this._keys[p].processKeyUp(q);if(this.onUpCallback){this.onUpCallback.call(this.callbackContext,q)}},reset:function(q){if(q===undefined){q=true}this.event=null;var p=this._keys.length;while(p--){if(this._keys[p]){this._keys[p].reset(q)}}},downDuration:function(p,q){if(this._keys[p]){return this._keys[p].downDuration(q)}else{return null}},upDuration:function(p,q){if(this._keys[p]){return this._keys[p].upDuration(q)}else{return null}},isDown:function(p){if(this._keys[p]){return this._keys[p].isDown}else{return null}}};Object.defineProperty(g.Keyboard.prototype,"lastChar",{get:function(){if(this.event.charCode===32){return""}else{return String.fromCharCode(this.pressEvent.charCode)}}});Object.defineProperty(g.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});g.Keyboard.prototype.constructor=g.Keyboard;g.KeyCode={A:"A".charCodeAt(0),B:"B".charCodeAt(0),C:"C".charCodeAt(0),D:"D".charCodeAt(0),E:"E".charCodeAt(0),F:"F".charCodeAt(0),G:"G".charCodeAt(0),H:"H".charCodeAt(0),I:"I".charCodeAt(0),J:"J".charCodeAt(0),K:"K".charCodeAt(0),L:"L".charCodeAt(0),M:"M".charCodeAt(0),N:"N".charCodeAt(0),O:"O".charCodeAt(0),P:"P".charCodeAt(0),Q:"Q".charCodeAt(0),R:"R".charCodeAt(0),S:"S".charCodeAt(0),T:"T".charCodeAt(0),U:"U".charCodeAt(0),V:"V".charCodeAt(0),W:"W".charCodeAt(0),X:"X".charCodeAt(0),Y:"Y".charCodeAt(0),Z:"Z".charCodeAt(0),ZERO:"0".charCodeAt(0),ONE:"1".charCodeAt(0),TWO:"2".charCodeAt(0),THREE:"3".charCodeAt(0),FOUR:"4".charCodeAt(0),FIVE:"5".charCodeAt(0),SIX:"6".charCodeAt(0),SEVEN:"7".charCodeAt(0),EIGHT:"8".charCodeAt(0),NINE:"9".charCodeAt(0),NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,NUMPAD_MULTIPLY:106,NUMPAD_ADD:107,NUMPAD_ENTER:108,NUMPAD_SUBTRACT:109,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,COLON:186,EQUALS:187,COMMA:188,UNDERSCORE:189,PERIOD:190,QUESTION_MARK:191,TILDE:192,OPEN_BRACKET:219,BACKWARD_SLASH:220,CLOSED_BRACKET:221,QUOTES:222,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,CAPS_LOCK:20,ESC:27,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PLUS:43,MINUS:44,INSERT:45,DELETE:46,HELP:47,NUM_LOCK:144};for(var n in g.KeyCode){if(g.KeyCode.hasOwnProperty(n)&&!n.match(/[a-z]/)){g.Keyboard[n]=g.KeyCode[n]}}g.Component=function(){};g.Component.Angle=function(){};g.Component.Angle.prototype={angle:{get:function(){return g.Math.wrapAngle(g.Math.radToDeg(this.rotation))},set:function(p){this.rotation=g.Math.degToRad(g.Math.wrapAngle(p))}}};g.Component.Animation=function(){};g.Component.Animation.prototype={play:function(s,r,q,p){if(this.animations){return this.animations.play(s,r,q,p)}}};g.Component.AutoCull=function(){};g.Component.AutoCull.prototype={autoCull:false,inCamera:{get:function(){if(!this.autoCull&&!this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y}return this.game.world.camera.view.intersects(this._bounds)}}};g.Component.Bounds=function(){};g.Component.Bounds.prototype={offsetX:{get:function(){return this.anchor.x*this.width}},offsetY:{get:function(){return this.anchor.y*this.height}},centerX:{get:function(){return(this.x-this.offsetX)+(this.width*0.5)},set:function(p){this.x=(p+this.offsetX)-(this.width*0.5)}},centerY:{get:function(){return(this.y-this.offsetY)+(this.height*0.5)},set:function(p){this.y=(p+this.offsetY)-(this.height*0.5)}},left:{get:function(){return this.x-this.offsetX},set:function(p){this.x=p+this.offsetX}},right:{get:function(){return(this.x+this.width)-this.offsetX},set:function(p){this.x=p-(this.width)+this.offsetX}},top:{get:function(){return this.y-this.offsetY},set:function(p){this.y=p+this.offsetY}},bottom:{get:function(){return(this.y+this.height)-this.offsetY},set:function(p){this.y=p-(this.height)+this.offsetY}},alignIn:function(r,q,p,s){if(p===undefined){p=0}if(s===undefined){s=0}switch(q){default:case g.TOP_LEFT:this.left=r.left-p;this.top=r.top-s;break;case g.TOP_CENTER:this.centerX=r.centerX+p;this.top=r.top-s;break;case g.TOP_RIGHT:this.right=r.right+p;this.top=r.top-s;break;case g.LEFT_CENTER:this.left=r.left-p;this.centerY=r.centerY+s;break;case g.CENTER:this.centerX=r.centerX+p;this.centerY=r.centerY+s;break;case g.RIGHT_CENTER:this.right=r.right+p;this.centerY=r.centerY+s;break;case g.BOTTOM_LEFT:this.left=r.left-p;this.bottom=r.bottom+s;break;case g.BOTTOM_CENTER:this.centerX=r.centerX+p;this.bottom=r.bottom+s;break;case g.BOTTOM_RIGHT:this.right=r.right+p;this.bottom=r.bottom+s;break}return this},alignTo:function(r,q,p,s){if(p===undefined){p=0}if(s===undefined){s=0}switch(q){default:case g.TOP_LEFT:this.left=r.left-p;this.bottom=r.top-s;break;case g.TOP_CENTER:this.centerX=r.centerX+p;this.bottom=r.top-s;break;case g.TOP_RIGHT:this.right=r.right+p;this.bottom=r.top-s;break;case g.LEFT_TOP:this.right=r.left-p;this.top=r.top-s;break;case g.LEFT_CENTER:this.right=r.left-p;this.centerY=r.centerY+s;break;case g.LEFT_BOTTOM:this.right=r.left-p;this.bottom=r.bottom+s;break;case g.RIGHT_TOP:this.left=r.right+p;this.top=r.top-s;break;case g.RIGHT_CENTER:this.left=r.right+p;this.centerY=r.centerY+s;break;case g.RIGHT_BOTTOM:this.left=r.right+p;this.bottom=r.bottom+s;break;case g.BOTTOM_LEFT:this.left=r.left-p;this.top=r.bottom+s;break;case g.BOTTOM_CENTER:this.centerX=r.centerX+p;this.top=r.bottom+s;break;case g.BOTTOM_RIGHT:this.right=r.right+p;this.top=r.bottom+s;break}return this}};g.Group.prototype.alignIn=g.Component.Bounds.prototype.alignIn;g.Group.prototype.alignTo=g.Component.Bounds.prototype.alignTo;g.Component.BringToTop=function(){};g.Component.BringToTop.prototype.bringToTop=function(){if(this.parent){this.parent.bringToTop(this)}return this};g.Component.BringToTop.prototype.sendToBack=function(){if(this.parent){this.parent.sendToBack(this)}return this};g.Component.BringToTop.prototype.moveUp=function(){if(this.parent){this.parent.moveUp(this)}return this};g.Component.BringToTop.prototype.moveDown=function(){if(this.parent){this.parent.moveDown(this)}return this};g.Component.Core=function(){};g.Component.Core.install=function(r){g.Utils.mixinPrototype(this,g.Component.Core.prototype);this.components={};for(var q=0;q<r.length;q++){var s=r[q];var p=false;if(s==="Destroy"){p=true}g.Utils.mixinPrototype(this,g.Component[s].prototype,p);this.components[s]=true}};g.Component.Core.init=function(q,p,t,r,s){this.game=q;this.key=r;this.data={};this.position.set(p,t);this.world=new g.Point(p,t);this.previousPosition=new g.Point(p,t);this.events=new g.Events(this);this._bounds=new g.Rectangle();if(this.components.PhysicsBody){this.body=this.body}if(this.components.Animation){this.animations=new g.AnimationManager(this)}if(this.components.LoadTexture&&r!==null){this.loadTexture(r,s)}if(this.components.FixedToCamera){this.cameraOffset=new g.Point(p,t)}};g.Component.Core.preUpdate=function(){if(this.pendingDestroy){this.destroy();return}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this.exists||!this.parent.exists){this.renderOrderID=-1;return false}this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);if(this.visible){this.renderOrderID=this.game.stage.currentRenderOrderID++}if(this.animations){this.animations.update()}if(this.body){this.body.preUpdate()}for(var p=0;p<this.children.length;p++){this.children[p].preUpdate()}return true};g.Component.Core.prototype={game:null,name:"",data:{},components:{},z:0,events:undefined,animations:undefined,key:"",world:null,debug:false,previousPosition:null,previousRotation:0,renderOrderID:0,fresh:true,pendingDestroy:false,_bounds:null,_exists:true,exists:{get:function(){return this._exists},set:function(p){if(p){this._exists=true;if(this.body&&this.body.type===g.Physics.P2JS){this.body.addToWorld()}this.visible=true}else{this._exists=false;if(this.body&&this.body.type===g.Physics.P2JS){this.body.removeFromWorld()}this.visible=false}}},update:function(){},postUpdate:function(){if(this.customRender){this.key.render()}if(this.components.PhysicsBody){g.Component.PhysicsBody.postUpdate.call(this)}if(this.components.FixedToCamera){g.Component.FixedToCamera.postUpdate.call(this)}for(var p=0;p<this.children.length;p++){this.children[p].postUpdate()}}};g.Component.Crop=function(){};g.Component.Crop.prototype={cropRect:null,_crop:null,crop:function(p,q){if(q===undefined){q=false}if(p){if(q&&this.cropRect!==null){this.cropRect.setTo(p.x,p.y,p.width,p.height)}else{if(q&&this.cropRect===null){this.cropRect=new g.Rectangle(p.x,p.y,p.width,p.height)}else{this.cropRect=p}}this.updateCrop()}else{this._crop=null;this.cropRect=null;this.resetFrame()}},updateCrop:function(){if(!this.cropRect){return}var u=this.texture.crop.x;var t=this.texture.crop.y;var v=this.texture.crop.width;var q=this.texture.crop.height;this._crop=g.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var p=Math.max(this._frame.x,this._crop.x);var w=Math.max(this._frame.y,this._crop.y);var r=Math.min(this._frame.right,this._crop.right)-p;var s=Math.min(this._frame.bottom,this._crop.bottom)-w;this.texture.crop.x=p;this.texture.crop.y=w;this.texture.crop.width=r;this.texture.crop.height=s;this.texture.frame.width=Math.min(r,this.cropRect.width);this.texture.frame.height=Math.min(s,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.texture._updateUvs();if(this.tint!==16777215&&(u!==p||t!==w||v!==r||q!==s)){this.texture.requiresReTint=true}}};g.Component.Delta=function(){};g.Component.Delta.prototype={deltaX:{get:function(){return this.world.x-this.previousPosition.x}},deltaY:{get:function(){return this.world.y-this.previousPosition.y}},deltaZ:{get:function(){return this.rotation-this.previousRotation}}};g.Component.Destroy=function(){};g.Component.Destroy.prototype={destroyPhase:false,destroy:function(r,p){if(this.game===null||this.destroyPhase){return}if(r===undefined){r=true}if(p===undefined){p=false}this.destroyPhase=true;if(this.events){this.events.onDestroy$dispatch(this)}if(this.parent){if(this.parent instanceof g.Group){this.parent.remove(this)}else{this.parent.removeChild(this)}}if(this.input){this.input.destroy()}if(this.animations){this.animations.destroy()}if(this.body){this.body.destroy()}if(this.events){this.events.destroy()}this.game.tweens.removeFrom(this);var q=this.children.length;if(r){while(q--){this.children[q].destroy(r)}}else{while(q--){this.removeChild(this.children[q])}}if(this._crop){this._crop=null;this.cropRect=null}if(this._frame){this._frame=null}if(g.Video&&this.key instanceof g.Video){this.key.onChangeSource.remove(this.resizeFrame,this)}if(g.BitmapText&&this._glyphs){this._glyphs=[]}this.alive=false;this.exists=false;this.visible=false;this.filters=null;this.mask=null;this.game=null;this.data={};this.renderable=false;if(this.transformCallback){this.transformCallback=null;this.transformCallbackContext=null}this.hitArea=null;this.parent=null;this.stage=null;this.worldTransform=null;this.filterArea=null;this._bounds=null;this._currentBounds=null;this._mask=null;this._destroyCachedSprite();if(p){this.texture.destroy(true)}this.destroyPhase=false;this.pendingDestroy=false}};g.Events=function(p){this.parent=p};g.Events.prototype={destroy:function(){this._parent=null;if(this._onDestroy){this._onDestroy.dispose()}if(this._onAddedToGroup){this._onAddedToGroup.dispose()}if(this._onRemovedFromGroup){this._onRemovedFromGroup.dispose()}if(this._onRemovedFromWorld){this._onRemovedFromWorld.dispose()}if(this._onKilled){this._onKilled.dispose()}if(this._onRevived){this._onRevived.dispose()}if(this._onEnterBounds){this._onEnterBounds.dispose()}if(this._onOutOfBounds){this._onOutOfBounds.dispose()}if(this._onInputOver){this._onInputOver.dispose()}if(this._onInputOut){this._onInputOut.dispose()}if(this._onInputDown){this._onInputDown.dispose()}if(this._onInputUp){this._onInputUp.dispose()}if(this._onDragStart){this._onDragStart.dispose()}if(this._onDragUpdate){this._onDragUpdate.dispose()}if(this._onDragStop){this._onDragStop.dispose()}if(this._onAnimationStart){this._onAnimationStart.dispose()}if(this._onAnimationComplete){this._onAnimationComplete.dispose()}if(this._onAnimationLoop){this._onAnimationLoop.dispose()}},onAddedToGroup:null,onRemovedFromGroup:null,onRemovedFromWorld:null,onDestroy:null,onKilled:null,onRevived:null,onOutOfBounds:null,onEnterBounds:null,onInputOver:null,onInputOut:null,onInputDown:null,onInputUp:null,onDragStart:null,onDragUpdate:null,onDragStop:null,onAnimationStart:null,onAnimationComplete:null,onAnimationLoop:null};g.Events.prototype.constructor=g.Events;for(var e in g.Events.prototype){if(!g.Events.prototype.hasOwnProperty(e)||e.indexOf("on")!==0||g.Events.prototype[e]!==null){continue}(function(q,p){Object.defineProperty(g.Events.prototype,q,{get:function(){return this[p]||(this[p]=new g.Signal())}});g.Events.prototype[q+"$dispatch"]=function(){return this[p]?this[p].dispatch.apply(this[p],arguments):null}})(e,"_"+e)}g.Component.FixedToCamera=function(){};g.Component.FixedToCamera.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}};g.Component.FixedToCamera.prototype={_fixedToCamera:false,fixedToCamera:{get:function(){return this._fixedToCamera},set:function(p){if(p){this._fixedToCamera=true;this.cameraOffset.set(this.x,this.y)}else{this._fixedToCamera=false}}},cameraOffset:new g.Point()};g.Component.Health=function(){};g.Component.Health.prototype={health:1,maxHealth:100,damage:function(p){if(this.alive){this.health-=p;if(this.health<=0){this.kill()}}return this},setHealth:function(p){this.health=p;if(this.health>this.maxHealth){this.health=this.maxHealth}return this},heal:function(p){if(this.alive){this.health+=p;if(this.health>this.maxHealth){this.health=this.maxHealth}}return this}};g.Component.InCamera=function(){};g.Component.InCamera.prototype={inCamera:{get:function(){return this.game.world.camera.view.intersects(this._bounds)}}};g.Component.InputEnabled=function(){};g.Component.InputEnabled.prototype={input:null,inputEnabled:{get:function(){return(this.input&&this.input.enabled)},set:function(p){if(p){if(this.input===null){this.input=new g.InputHandler(this);this.input.start()}else{if(this.input&&!this.input.enabled){this.input.start()}}}else{if(this.input&&this.input.enabled){this.input.stop()}}}}};g.Component.InWorld=function(){};g.Component.InWorld.preUpdate=function(){if(this.autoCull||this.checkWorldBounds){this._bounds.copyFrom(this.getBounds());this._bounds.x+=this.game.camera.view.x;this._bounds.y+=this.game.camera.view.y;if(this.autoCull){if(this.game.world.camera.view.intersects(this._bounds)){this.renderable=true;this.game.world.camera.totalInView++}else{this.renderable=false;if(this.outOfCameraBoundsKill){this.kill();return false}}}if(this.checkWorldBounds){if(this._outOfBoundsFired&&this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=false;this.events.onEnterBounds$dispatch(this)}else{if(!this._outOfBoundsFired&&!this.game.world.bounds.intersects(this._bounds)){this._outOfBoundsFired=true;this.events.onOutOfBounds$dispatch(this);if(this.outOfBoundsKill){this.kill();return false}}}}}return true};g.Component.InWorld.prototype={checkWorldBounds:false,outOfBoundsKill:false,outOfCameraBoundsKill:false,_outOfBoundsFired:false,inWorld:{get:function(){return this.game.world.bounds.intersects(this.getBounds())}}};g.Component.LifeSpan=function(){};g.Component.LifeSpan.preUpdate=function(){if(this.lifespan>0){this.lifespan-=this.game.time.physicsElapsedMS;if(this.lifespan<=0){this.kill();return false}}return true};g.Component.LifeSpan.prototype={alive:true,lifespan:0,revive:function(p){if(p===undefined){p=100}this.alive=true;this.exists=true;this.visible=true;if(typeof this.setHealth==="function"){this.setHealth(p)}if(this.events){this.events.onRevived$dispatch(this)}return this},kill:function(){this.alive=false;this.exists=false;this.visible=false;if(this.events){this.events.onKilled$dispatch(this)}return this}};g.Component.LoadTexture=function(){};g.Component.LoadTexture.prototype={customRender:false,_frame:null,loadTexture:function(u,w,s){if(u===g.PENDING_ATLAS){u=w;w=0}else{w=w||0}if((s||s===undefined)&&this.animations){this.animations.stop()}this.key=u;this.customRender=false;var r=this.game.cache;var p=true;var t=!this.texture.baseTexture.scaleMode;if(g.RenderTexture&&u instanceof g.RenderTexture){this.key=u.key;this.setTexture(u)}else{if(g.BitmapData&&u instanceof g.BitmapData){this.customRender=true;this.setTexture(u.texture);if(r.hasFrameData(u.key,g.Cache.BITMAPDATA)){p=!this.animations.loadFrameData(r.getFrameData(u.key,g.Cache.BITMAPDATA),w)}else{p=!this.animations.loadFrameData(u.frameData,0)}}else{if(g.Video&&u instanceof g.Video){this.customRender=true;var v=u.texture.valid;this.setTexture(u.texture);this.setFrame(u.texture.frame.clone());u.onChangeSource.add(this.resizeFrame,this);this.texture.valid=v}else{if(g.Tilemap&&u instanceof g.TilemapLayer){this.setTexture(PIXI.Texture.fromCanvas(u.canvas))}else{if(u instanceof PIXI.Texture){this.setTexture(u)}else{var q=r.getImage(u,true);this.key=q.key;this.setTexture(new PIXI.Texture(q.base));if(u==="__default"){this.texture.baseTexture.skipRender=true}else{this.texture.baseTexture.skipRender=false}p=!this.animations.loadFrameData(q.frameData,w)}}}}}if(p){this._frame=g.Rectangle.clone(this.texture.frame)}if(!t){this.texture.baseTexture.scaleMode=1}},setFrame:function(p){this._frame=p;this.texture.frame.x=p.x;this.texture.frame.y=p.y;this.texture.frame.width=p.width;this.texture.frame.height=p.height;this.texture.crop.x=p.x;this.texture.crop.y=p.y;this.texture.crop.width=p.width;this.texture.crop.height=p.height;if(p.trimmed){if(this.texture.trim){this.texture.trim.x=p.spriteSourceSizeX;this.texture.trim.y=p.spriteSourceSizeY;this.texture.trim.width=p.sourceSizeW;this.texture.trim.height=p.sourceSizeH}else{this.texture.trim={x:p.spriteSourceSizeX,y:p.spriteSourceSizeY,width:p.sourceSizeW,height:p.sourceSizeH}}this.texture.width=p.sourceSizeW;this.texture.height=p.sourceSizeH;this.texture.frame.width=p.sourceSizeW;this.texture.frame.height=p.sourceSizeH}else{if(!p.trimmed&&this.texture.trim){this.texture.trim=null}}if(this.cropRect){this.updateCrop()}this.texture.requiresReTint=true;this.texture._updateUvs();if(this.tilingTexture){this.refreshTexture=true}},resizeFrame:function(r,q,p){this.texture.frame.resize(q,p);this.texture.setFrame(this.texture.frame)},resetFrame:function(){if(this._frame){this.setFrame(this._frame)}},frame:{get:function(){return this.animations.frame},set:function(p){this.animations.frame=p}},frameName:{get:function(){return this.animations.frameName},set:function(p){this.animations.frameName=p}}};g.Component.Overlap=function(){};g.Component.Overlap.prototype={overlap:function(p){return g.Rectangle.intersects(this.getBounds(),p.getBounds())}};g.Component.PhysicsBody=function(){};g.Component.PhysicsBody.preUpdate=function(){if(this.fresh&&this.exists){this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y);this.worldTransform.tx=this.world.x;this.worldTransform.ty=this.world.y;this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(this.body){this.body.preUpdate()}this.fresh=false;return false}this.previousPosition.set(this.world.x,this.world.y);this.previousRotation=this.rotation;if(!this._exists||!this.parent.exists){this.renderOrderID=-1;return false}return true};g.Component.PhysicsBody.postUpdate=function(){if(this.exists&&this.body){this.body.postUpdate()}};g.Component.PhysicsBody.prototype={body:null,x:{get:function(){return this.position.x},set:function(p){this.position.x=p;if(this.body&&!this.body.dirty){this.body._reset=true}}},y:{get:function(){return this.position.y},set:function(p){this.position.y=p;if(this.body&&!this.body.dirty){this.body._reset=true}}}};g.Component.Reset=function(){};g.Component.Reset.prototype.reset=function(p,r,q){if(q===undefined){q=1}this.world.set(p,r);this.position.set(p,r);this.fresh=true;this.exists=true;this.visible=true;this.renderable=true;if(this.components.InWorld){this._outOfBoundsFired=false}if(this.components.LifeSpan){this.alive=true;this.health=q}if(this.components.PhysicsBody){if(this.body){this.body.reset(p,r,false,false)}}return this};g.Component.ScaleMinMax=function(){};g.Component.ScaleMinMax.prototype={transformCallback:null,transformCallbackContext:this,scaleMin:null,scaleMax:null,checkTransform:function(p){if(this.scaleMin){if(p.a<this.scaleMin.x){p.a=this.scaleMin.x}if(p.d<this.scaleMin.y){p.d=this.scaleMin.y}}if(this.scaleMax){if(p.a>this.scaleMax.x){p.a=this.scaleMax.x}if(p.d>this.scaleMax.y){p.d=this.scaleMax.y}}},setScaleMinMax:function(p,s,r,q){if(s===undefined){s=r=q=p}else{if(r===undefined){r=q=s;s=p}}if(p===null){this.scaleMin=null}else{if(this.scaleMin){this.scaleMin.set(p,s)}else{this.scaleMin=new g.Point(p,s)}}if(r===null){this.scaleMax=null}else{if(this.scaleMax){this.scaleMax.set(r,q)}else{this.scaleMax=new g.Point(r,q)}}if(this.scaleMin===null){this.transformCallback=null}else{this.transformCallback=this.checkTransform;this.transformCallbackContext=this}}};g.Component.Smoothed=function(){};g.Component.Smoothed.prototype={smoothed:{get:function(){return !this.texture.baseTexture.scaleMode},set:function(p){if(p){if(this.texture){this.texture.baseTexture.scaleMode=0}}else{if(this.texture){this.texture.baseTexture.scaleMode=1}}}}};g.GameObjectFactory=function(p){this.game=p;this.world=this.game.world};g.GameObjectFactory.prototype={existing:function(p){return this.world.add(p)},weapon:function(s,q,t,r){var p=this.game.plugins.add(g.Weapon);p.createBullets(s,q,t,r);return p},image:function(p,t,q,s,r){if(r===undefined){r=this.world}return r.add(new g.Image(this.game,p,t,q,s))},sprite:function(p,t,q,s,r){if(r===undefined){r=this.world}return r.create(p,t,q,s)},creature:function(p,u,q,t,s){if(s===undefined){s=this.world}var r=new g.Creature(this.game,p,u,q,t);s.add(r);return r},tween:function(p){return this.game.tweens.create(p)},group:function(s,q,p,t,r){return new g.Group(this.game,s,q,p,t,r)},physicsGroup:function(s,r,q,p){return new g.Group(this.game,r,q,p,true,s)},spriteBatch:function(r,q,p){if(r===undefined){r=null}if(q===undefined){q="group"}if(p===undefined){p=false}return new g.SpriteBatch(this.game,r,q,p)},audio:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},sound:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},audioSprite:function(p){return this.game.sound.addSprite(p)},tileSprite:function(q,v,s,p,r,u,t){if(t===undefined){t=this.world}return t.add(new g.TileSprite(this.game,q,v,s,p,r,u))},rope:function(p,u,q,t,r,s){if(s===undefined){s=this.world}return s.add(new g.Rope(this.game,p,u,q,t,r))},text:function(p,t,s,q,r){if(r===undefined){r=this.world}return r.add(new g.Text(this.game,p,t,s,q))},button:function(v,u,z,A,q,r,p,s,t,w){if(w===undefined){w=this.world}return w.add(new g.Button(this.game,v,u,z,A,q,r,p,s,t))},graphics:function(p,r,q){if(q===undefined){q=this.world}return q.add(new g.Graphics(this.game,p,r))},emitter:function(p,r,q){return this.game.particles.add(new g.Particles.Arcade.Emitter(this.game,p,r,q))},retroFont:function(q,p,s,v,x,w,t,u,r){return new g.RetroFont(this.game,q,p,s,v,x,w,t,u,r)},bitmapText:function(p,u,q,t,r,s){if(s===undefined){s=this.world}return s.add(new g.BitmapText(this.game,p,u,q,t,r))},tilemap:function(r,t,q,s,p){return new g.Tilemap(this.game,r,t,q,s,p)},renderTexture:function(s,q,r,p){if(r===undefined||r===""){r=this.game.rnd.uuid()}if(p===undefined){p=false}var t=new g.RenderTexture(this.game,s,q,r);if(p){this.game.cache.addRenderTexture(r,t)}return t},video:function(q,p){return new g.Video(this.game,q,p)},bitmapData:function(s,q,r,p){if(p===undefined){p=false}if(r===undefined||r===""){r=this.game.rnd.uuid()}var t=new g.BitmapData(this.game,r,s,q);if(p){this.game.cache.addBitmapData(r,t)}return t},filter:function(q){var p=Array.prototype.slice.call(arguments,1);var q=new g.Filter[q](this.game);q.init.apply(q,p);return q},plugin:function(p){return this.game.plugins.add(p)}};g.GameObjectFactory.prototype.constructor=g.GameObjectFactory;g.GameObjectCreator=function(p){this.game=p;this.world=this.game.world};g.GameObjectCreator.prototype={image:function(p,s,q,r){return new g.Image(this.game,p,s,q,r)},sprite:function(p,s,q,r){return new g.Sprite(this.game,p,s,q,r)},tween:function(p){return new g.Tween(p,this.game,this.game.tweens)},group:function(s,q,p,t,r){return new g.Group(this.game,s,q,p,t,r)},spriteBatch:function(r,q,p){if(q===undefined){q="group"}if(p===undefined){p=false}return new g.SpriteBatch(this.game,r,q,p)},audio:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},audioSprite:function(p){return this.game.sound.addSprite(p)},sound:function(r,s,p,q){return this.game.sound.add(r,s,p,q)},tileSprite:function(q,u,s,p,r,t){return new g.TileSprite(this.game,q,u,s,p,r,t)},rope:function(p,t,q,s,r){return new g.Rope(this.game,p,t,q,s,r)},text:function(p,s,r,q){return new g.Text(this.game,p,s,r,q)},button:function(v,u,w,z,q,r,p,s,t){return new g.Button(this.game,v,u,w,z,q,r,p,s,t)},graphics:function(p,q){return new g.Graphics(this.game,p,q)},emitter:function(p,r,q){return new g.Particles.Arcade.Emitter(this.game,p,r,q)},retroFont:function(q,p,s,v,x,w,t,u,r){return new g.RetroFont(this.game,q,p,s,v,x,w,t,u,r)},bitmapText:function(p,u,q,s,r,t){return new g.BitmapText(this.game,p,u,q,s,r,t)},tilemap:function(r,t,q,s,p){return new g.Tilemap(this.game,r,t,q,s,p)},renderTexture:function(s,q,r,p){if(r===undefined||r===""){r=this.game.rnd.uuid()}if(p===undefined){p=false}var t=new g.RenderTexture(this.game,s,q,r);if(p){this.game.cache.addRenderTexture(r,t)}return t},bitmapData:function(s,q,r,p){if(p===undefined){p=false}if(r===undefined||r===""){r=this.game.rnd.uuid()}var t=new g.BitmapData(this.game,r,s,q);if(p){this.game.cache.addBitmapData(r,t)}return t},filter:function(q){var p=Array.prototype.slice.call(arguments,1);var q=new g.Filter[q](this.game);q.init.apply(q,p);return q}};g.GameObjectCreator.prototype.constructor=g.GameObjectCreator;g.Sprite=function(q,p,t,r,s){p=p||0;t=t||0;r=r||null;s=s||null;this.type=g.SPRITE;this.physicsType=g.SPRITE;PIXI.Sprite.call(this,g.Cache.DEFAULT);g.Component.Core.init.call(this,q,p,t,r,s)};g.Sprite.prototype=Object.create(PIXI.Sprite.prototype);g.Sprite.prototype.constructor=g.Sprite;g.Component.Core.install.call(g.Sprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);g.Sprite.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Sprite.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Sprite.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Sprite.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Sprite.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Image=function(q,p,t,r,s){p=p||0;t=t||0;r=r||null;s=s||null;this.type=g.IMAGE;PIXI.Sprite.call(this,g.Cache.DEFAULT);g.Component.Core.init.call(this,q,p,t,r,s)};g.Image.prototype=Object.create(PIXI.Sprite.prototype);g.Image.prototype.constructor=g.Image;g.Component.Core.install.call(g.Image.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Destroy","FixedToCamera","InputEnabled","LifeSpan","LoadTexture","Overlap","Reset","ScaleMinMax","Smoothed"]);g.Image.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Image.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Image.prototype.preUpdate=function(){if(!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Button=function(A,v,u,w,z,q,r,p,s,t){v=v||0;u=u||0;w=w||null;z=z||null;q=q||this;g.Image.call(this,A,v,u,w,p);this.type=g.BUTTON;this.physicsType=g.SPRITE;this._onOverFrame=null;this._onOutFrame=null;this._onDownFrame=null;this._onUpFrame=null;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new g.Signal();this.onInputOut=new g.Signal();this.onInputDown=new g.Signal();this.onInputUp=new g.Signal();this.onOverMouseOnly=true;this.justReleasedPreventsOver=g.PointerMode.TOUCH;this.freezeFrames=false;this.forceOut=false;this.inputEnabled=true;this.input.start(0,true);this.input.useHandCursor=true;this.setFrames(r,p,s,t);if(z!==null){this.onInputUp.add(z,q)}this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this);this.events.onRemovedFromWorld.add(this.removedFromWorld,this)};g.Button.prototype=Object.create(g.Image.prototype);g.Button.prototype.constructor=g.Button;var m="Over";var a="Out";var d="Down";var j="Up";g.Button.prototype.clearFrames=function(){this.setFrames(null,null,null,null)};g.Button.prototype.removedFromWorld=function(){this.inputEnabled=false};g.Button.prototype.setStateFrame=function(r,s,q){var p="_on"+r+"Frame";if(s!==null){this[p]=s;if(q){this.changeStateFrame(r)}}else{this[p]=null}};g.Button.prototype.changeStateFrame=function(q){if(this.freezeFrames){return false}var p="_on"+q+"Frame";var r=this[p];if(typeof r==="string"){this.frameName=r;return true}else{if(typeof r==="number"){this.frame=r;return true}else{return false}}};g.Button.prototype.setFrames=function(q,s,p,r){this.setStateFrame(m,q,this.input.pointerOver());this.setStateFrame(a,s,!this.input.pointerOver());this.setStateFrame(d,p,this.input.pointerDown());this.setStateFrame(j,r,this.input.pointerUp())};g.Button.prototype.setStateSound=function(r,s,p){var t="on"+r+"Sound";var q="on"+r+"SoundMarker";if(s instanceof g.Sound||s instanceof g.AudioSprite){this[t]=s;this[q]=typeof p==="string"?p:""}else{this[t]=null;this[q]=""}};g.Button.prototype.playStateSound=function(r){var t="on"+r+"Sound";var s=this[t];if(s){var q="on"+r+"SoundMarker";var p=this[q];s.play(p);return true}else{return false}};g.Button.prototype.setSounds=function(q,u,p,t,s,w,r,v){this.setStateSound(m,q,u);this.setStateSound(a,s,w);this.setStateSound(d,p,t);this.setStateSound(j,r,v)};g.Button.prototype.setOverSound=function(q,p){this.setStateSound(m,q,p)};g.Button.prototype.setOutSound=function(q,p){this.setStateSound(a,q,p)};g.Button.prototype.setDownSound=function(q,p){this.setStateSound(d,q,p)};g.Button.prototype.setUpSound=function(q,p){this.setStateSound(j,q,p)};g.Button.prototype.onInputOverHandler=function(p,q){if(q.justReleased()&&(this.justReleasedPreventsOver&q.pointerMode)===q.pointerMode){return}this.changeStateFrame(m);if(this.onOverMouseOnly&&!q.isMouse){return}this.playStateSound(m);if(this.onInputOver){this.onInputOver.dispatch(this,q)}};g.Button.prototype.onInputOutHandler=function(p,q){this.changeStateFrame(a);this.playStateSound(a);if(this.onInputOut){this.onInputOut.dispatch(this,q)}};g.Button.prototype.onInputDownHandler=function(p,q){this.changeStateFrame(d);this.playStateSound(d);if(this.onInputDown){this.onInputDown.dispatch(this,q)}};g.Button.prototype.onInputUpHandler=function(p,s,r){this.playStateSound(j);if(this.onInputUp){this.onInputUp.dispatch(this,s,r)}if(this.freezeFrames){return}if(this.forceOut===true||(this.forceOut&s.pointerMode)===s.pointerMode){this.changeStateFrame(a)}else{var q=this.changeStateFrame(j);if(!q){if(r){this.changeStateFrame(m)}else{this.changeStateFrame(a)}}}};g.SpriteBatch=function(q,s,r,p){if(s===undefined||s===null){s=q.world}PIXI.SpriteBatch.call(this);g.Group.call(this,q,s,r,p);this.type=g.SPRITEBATCH};g.SpriteBatch.prototype=g.Utils.extend(true,g.SpriteBatch.prototype,PIXI.SpriteBatch.prototype,g.Group.prototype);g.SpriteBatch.prototype.constructor=g.SpriteBatch;g.BitmapData=function(q,s,t,p,r){if(t===undefined||t===0){t=256}if(p===undefined||p===0){p=256}if(r===undefined){r=false}this.game=q;this.key=s;this.width=t;this.height=p;this.canvas=g.Canvas.create(this,t,p,null,r);this.context=this.canvas.getContext("2d",{alpha:true});this.ctx=this.context;this.smoothProperty=(q.renderType===g.CANVAS)?q.renderer.renderSession.smoothProperty:g.Canvas.getSmoothingPrefix(this.context);this.imageData=this.context.getImageData(0,0,t,p);this.data=null;if(this.imageData){this.data=this.imageData.data}this.pixels=null;if(this.data){if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}}this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.frameData=new g.FrameData();this.textureFrame=this.frameData.addFrame(new g.Frame(0,0,0,t,p,"bitmapData"));this.texture.frame=this.textureFrame;this.type=g.BITMAPDATA;this.disableTextureUpload=false;this.dirty=false;this.cls=this.clear;this._image=null;this._pos=new g.Point();this._size=new g.Point();this._scale=new g.Point();this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new g.Point();this._tempR=0;this._tempG=0;this._tempB=0;this._circle=new g.Circle();this._swapCanvas=undefined};g.BitmapData.prototype={move:function(p,r,q){if(p!==0){this.moveH(p,q)}if(r!==0){this.moveV(r,q)}return this},moveH:function(v,s){if(s===undefined){s=true}if(this._swapCanvas===undefined){this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height)}var u=this._swapCanvas;var q=u.getContext("2d");var r=this.height;var t=this.canvas;q.clearRect(0,0,this.width,this.height);if(v<0){v=Math.abs(v);var p=this.width-v;if(s){q.drawImage(t,0,0,v,r,p,0,v,r)}q.drawImage(t,v,0,p,r,0,0,p,r)}else{var p=this.width-v;if(s){q.drawImage(t,p,0,v,r,0,0,v,r)}q.drawImage(t,0,0,p,r,v,0,p,r)}this.clear();return this.copy(this._swapCanvas)},moveV:function(v,s){if(s===undefined){s=true}if(this._swapCanvas===undefined){this._swapCanvas=PIXI.CanvasPool.create(this,this.width,this.height)}var u=this._swapCanvas;var q=u.getContext("2d");var p=this.width;var t=this.canvas;q.clearRect(0,0,this.width,this.height);if(v<0){v=Math.abs(v);var r=this.height-v;if(s){q.drawImage(t,0,0,p,v,0,r,p,v)}q.drawImage(t,0,v,p,r,0,0,p,r)}else{var r=this.height-v;if(s){q.drawImage(t,0,r,p,v,0,0,p,v)}q.drawImage(t,0,0,p,r,0,v,p,r)}this.clear();return this.copy(this._swapCanvas)},add:function(p){if(Array.isArray(p)){for(var q=0;q<p.length;q++){if(p[q]["loadTexture"]){p[q].loadTexture(this)}}}else{p.loadTexture(this)}return this},load:function(p){if(typeof p==="string"){p=this.game.cache.getImage(p)}if(p){this.resize(p.width,p.height);this.cls()}else{return}this.draw(p);this.update();return this},clear:function(q,s,r,p){if(q===undefined){q=0}if(s===undefined){s=0}if(r===undefined){r=this.width}if(p===undefined){p=this.height}this.context.clearRect(q,s,r,p);this.dirty=true;return this},fill:function(t,s,p,q){if(q===undefined){q=1}this.context.fillStyle="rgba("+t+","+s+","+p+","+q+")";this.context.fillRect(0,0,this.width,this.height);this.dirty=true;return this},generateTexture:function(p){var r=new Image();r.src=this.canvas.toDataURL("image/png");var q=this.game.cache.addImage(p,"",r);return new PIXI.Texture(q.base)},resize:function(q,p){if(q!==this.width||p!==this.height){this.width=q;this.height=p;this.canvas.width=q;this.canvas.height=p;if(this._swapCanvas!==undefined){this._swapCanvas.width=q;this._swapCanvas.height=p}this.baseTexture.width=q;this.baseTexture.height=p;this.textureFrame.width=q;this.textureFrame.height=p;this.texture.width=q;this.texture.height=p;this.texture.crop.width=q;this.texture.crop.height=p;this.update();this.dirty=true}return this},update:function(q,s,r,p){if(q===undefined){q=0}if(s===undefined){s=0}if(r===undefined){r=Math.max(1,this.width)}if(p===undefined){p=Math.max(1,this.height)}this.imageData=this.context.getImageData(q,s,r,p);this.data=this.imageData.data;if(this.imageData.data.buffer){this.buffer=this.imageData.data.buffer;this.pixels=new Uint32Array(this.buffer)}else{if(window.ArrayBuffer){this.buffer=new ArrayBuffer(this.imageData.data.length);this.pixels=new Uint32Array(this.buffer)}else{this.pixels=this.imageData.data}}return this},processPixelRGB:function(C,s,A,z,r,D){if(A===undefined){A=0}if(z===undefined){z=0}if(r===undefined){r=this.width}if(D===undefined){D=this.height}var B=A+r;var v=z+D;var q=g.Color.createColor();var E={r:0,g:0,b:0,a:0};var p=false;for(var t=z;t<v;t++){for(var u=A;u<B;u++){g.Color.unpackPixel(this.getPixel32(u,t),q);E=C.call(s,q,u,t);if(E!==false&&E!==null&&E!==undefined){this.setPixel32(u,t,E.r,E.g,E.b,E.a,false);p=true}}}if(p){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},processPixel:function(C,s,A,z,r,D){if(A===undefined){A=0}if(z===undefined){z=0}if(r===undefined){r=this.width}if(D===undefined){D=this.height}var B=A+r;var v=z+D;var q=0;var E=0;var p=false;for(var t=z;t<v;t++){for(var u=A;u<B;u++){q=this.getPixel32(u,t);E=C.call(s,q,u,t);if(E!==q){this.pixels[t*this.width+u]=E;p=true}}}if(p){this.context.putImageData(this.imageData,0,0);this.dirty=true}return this},replaceRGB:function(u,q,F,s,t,H,C,r,B){var E=0;var A=0;var G=this.width;var v=this.height;var p=g.Color.packPixel(u,q,F,s);if(B!==undefined&&B instanceof g.Rectangle){E=B.x;A=B.y;G=B.width;v=B.height}for(var z=0;z<v;z++){for(var D=0;D<G;D++){if(this.getPixel32(E+D,A+z)===p){this.setPixel32(E+D,A+z,t,H,C,r,false)}}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setHSL:function(t,B,q,v){var A=t||t===0;var r=B||B===0;var w=q||q===0;if(!A&&!r&&!w){return}if(v===undefined){v=new g.Rectangle(0,0,this.width,this.height)}var p=g.Color.createColor();for(var u=v.y;u<v.bottom;u++){for(var z=v.x;z<v.right;z++){g.Color.unpackPixel(this.getPixel32(z,u),p,true);if(A){p.h=t}if(r){p.s=B}if(w){p.l=q}g.Color.HSLtoRGB(p.h,p.s,p.l,p);this.setPixel32(z,u,p.r,p.g,p.b,p.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},shiftHSL:function(u,t,q,v){if(u===undefined||u===null){u=false}if(t===undefined||t===null){t=false}if(q===undefined||q===null){q=false}if(!u&&!t&&!q){return}if(v===undefined){v=new g.Rectangle(0,0,this.width,this.height)}var r=g.Color.createColor();for(var w=v.y;w<v.bottom;w++){for(var p=v.x;p<v.right;p++){g.Color.unpackPixel(this.getPixel32(p,w),r,true);if(u){r.h=this.game.math.wrap(r.h+u,0,1)}if(t){r.s=this.game.math.clamp(r.s+t,0,1)}if(q){r.l=this.game.math.clamp(r.l+q,0,1)}g.Color.HSLtoRGB(r.h,r.s,r.l,r);this.setPixel32(p,w,r.r,r.g,r.b,r.a,false)}}this.context.putImageData(this.imageData,0,0);this.dirty=true;return this},setPixel32:function(q,v,u,s,p,t,r){if(r===undefined){r=true}if(q>=0&&q<=this.width&&v>=0&&v<=this.height){if(g.Device.LITTLE_ENDIAN){this.pixels[v*this.width+q]=(t<<24)|(p<<16)|(s<<8)|u}else{this.pixels[v*this.width+q]=(u<<24)|(s<<16)|(p<<8)|t}if(r){this.context.putImageData(this.imageData,0,0);this.dirty=true}}return this},setPixel:function(q,u,t,s,p,r){return this.setPixel32(q,u,t,s,p,255,r)},getPixel:function(p,s,r){if(!r){r=g.Color.createColor()}var q=~~(p+(s*this.width));q*=4;r.r=this.data[q];r.g=this.data[++q];r.b=this.data[++q];r.a=this.data[++q];return r},getPixel32:function(p,q){if(p>=0&&p<=this.width&&q>=0&&q<=this.height){return this.pixels[q*this.width+p]}},getPixelRGB:function(p,t,s,q,r){return g.Color.unpackPixel(this.getPixel32(p,t),s,q,r)},getPixels:function(p){return this.context.getImageData(p.x,p.y,p.width,p.height)},getFirstPixel:function(t){if(t===undefined){t=0}var s=g.Color.createColor();var p=0;var u=0;var r=1;var q=false;if(t===1){r=-1;u=this.height}else{if(t===3){r=-1;p=this.width}}do{g.Color.unpackPixel(this.getPixel32(p,u),s);if(t===0||t===1){p++;if(p===this.width){p=0;u+=r;if(u>=this.height||u<=0){q=true}}}else{if(t===2||t===3){u++;if(u===this.height){u=0;p+=r;if(p>=this.width||p<=0){q=true}}}}}while(s.a===0&&!q);s.x=p;s.y=u;return s},getBounds:function(p){if(p===undefined){p=new g.Rectangle()}p.x=this.getFirstPixel(2).x;if(p.x===this.width){return p.setTo(0,0,0,0)}p.y=this.getFirstPixel(0).y;p.width=(this.getFirstPixel(3).x-p.x)+1;p.height=(this.getFirstPixel(1).y-p.y)+1;return p},addToWorld:function(q,v,p,u,s,r){s=s||1;r=r||1;var t=this.game.add.image(q,v,this);t.anchor.set(p,u);t.scale.set(s,r);return t},copy:function(A,u,t,z,w,H,G,v,C,D,q,p,F,E,r,I,s){if(A===undefined||A===null){A=this}if(A instanceof g.RenderTexture||A instanceof PIXI.RenderTexture){A=A.getCanvas()}this._image=A;if(A instanceof g.Sprite||A instanceof g.Image||A instanceof g.Text||A instanceof PIXI.Sprite){this._pos.set(A.texture.crop.x,A.texture.crop.y);this._size.set(A.texture.crop.width,A.texture.crop.height);this._scale.set(A.scale.x,A.scale.y);this._anchor.set(A.anchor.x,A.anchor.y);this._rotate=A.rotation;this._alpha.current=A.alpha;if(A.texture instanceof g.RenderTexture||A.texture instanceof PIXI.RenderTexture){this._image=A.texture.getCanvas()}else{this._image=A.texture.baseTexture.source}if(H===undefined||H===null){H=A.x}if(G===undefined||G===null){G=A.y}if(A.texture.trim){H+=A.texture.trim.x-A.anchor.x*A.texture.trim.width;G+=A.texture.trim.y-A.anchor.y*A.texture.trim.height}if(A.tint!==16777215){if(A.cachedTint!==A.tint){A.cachedTint=A.tint;A.tintedTexture=PIXI.CanvasTinter.getTintedTexture(A,A.tint)}this._image=A.tintedTexture;this._pos.set(0)}}else{this._pos.set(0);this._scale.set(1);this._anchor.set(0);this._rotate=0;this._alpha.current=1;if(A instanceof g.BitmapData){this._image=A.canvas}else{if(typeof A==="string"){A=this.game.cache.getImage(A);if(A===null){return}else{this._image=A}}}this._size.set(this._image.width,this._image.height)}if(u===undefined||u===null){u=0}if(t===undefined||t===null){t=0}if(z){this._size.x=z}if(w){this._size.y=w}if(H===undefined||H===null){H=u}if(G===undefined||G===null){G=t}if(v===undefined||v===null){v=this._size.x}if(C===undefined||C===null){C=this._size.y}if(typeof D==="number"){this._rotate=D}if(typeof q==="number"){this._anchor.x=q}if(typeof p==="number"){this._anchor.y=p}if(typeof F==="number"){this._scale.x=F}if(typeof E==="number"){this._scale.y=E}if(typeof r==="number"){this._alpha.current=r}if(I===undefined){I=null}if(s===undefined){s=false}if(this._alpha.current<=0||this._scale.x===0||this._scale.y===0||this._size.x===0||this._size.y===0){return}var B=this.context;this._alpha.prev=B.globalAlpha;B.save();B.globalAlpha=this._alpha.current;if(I){this.op=I}if(s){H|=0;G|=0}B.translate(H,G);B.scale(this._scale.x,this._scale.y);B.rotate(this._rotate);B.drawImage(this._image,this._pos.x+u,this._pos.y+t,this._size.x,this._size.y,-v*this._anchor.x,-C*this._anchor.y,v,C);B.restore();B.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyTransform:function(v,u,t){if(u===undefined){u=null}if(t===undefined){t=false}if(!v.hasOwnProperty("worldTransform")||!v.worldVisible||v.worldAlpha===0){return this}var q=v.worldTransform;this._pos.set(v.texture.crop.x,v.texture.crop.y);this._size.set(v.texture.crop.width,v.texture.crop.height);if(q.a===0||q.d===0||this._size.x===0||this._size.y===0){return this}if(v.texture instanceof g.RenderTexture||v.texture instanceof PIXI.RenderTexture){this._image=v.texture.getCanvas()}else{this._image=v.texture.baseTexture.source}var s=q.tx;var p=q.ty;if(v.texture.trim){s+=v.texture.trim.x-v.anchor.x*v.texture.trim.width;p+=v.texture.trim.y-v.anchor.y*v.texture.trim.height}if(v.tint!==16777215){if(v.cachedTint!==v.tint){v.cachedTint=v.tint;v.tintedTexture=PIXI.CanvasTinter.getTintedTexture(v,v.tint)}this._image=v.tintedTexture;this._pos.set(0)}if(t){s|=0;p|=0}var r=this.context;this._alpha.prev=r.globalAlpha;r.save();r.globalAlpha=this._alpha.current;if(u){this.op=u}r[this.smoothProperty]=(v.texture.baseTexture.scaleMode===PIXI.scaleModes.LINEAR);r.setTransform(q.a,q.b,q.c,q.d,s,p);r.drawImage(this._image,this._pos.x,this._pos.y,this._size.x,this._size.y,-this._size.x*v.anchor.x,-this._size.y*v.anchor.y,this._size.x,this._size.y);r.restore();r.globalAlpha=this._alpha.prev;this.dirty=true;return this},copyRect:function(t,s,p,v,u,r,q){return this.copy(t,s.x,s.y,s.width,s.height,p,v,s.width,s.height,0,0,0,1,1,u,r,q)},draw:function(u,q,v,t,p,s,r){return this.copy(u,null,null,null,null,q,v,t,p,null,null,null,null,null,null,s,r)},drawGroup:function(r,q,p){if(r.total>0){r.forEachExists(this.drawGroupProxy,this,q,p)}return this},drawGroupProxy:function(s,r,q){if(s.hasOwnProperty("texture")){this.copyTransform(s,r,q)}if(s.type===g.GROUP&&s.exists){this.drawGroup(s,r,q)}else{if(s.hasOwnProperty("children")&&s.children.length>0){for(var p=0;p<s.children.length;p++){if(s.children[p].exists){this.copyTransform(s.children[p],r,q)}}}}},drawFull:function(s,r,q){if(s.worldVisible===false||s.worldAlpha===0||(s.hasOwnProperty("exists")&&s.exists===false)){return this}if(s.type!==g.GROUP&&s.type!==g.EMITTER&&s.type!==g.BITMAPTEXT){if(s.type===g.GRAPHICS){var t=s.getBounds();this.ctx.save();this.ctx.translate(t.x,t.y);PIXI.CanvasGraphics.renderGraphics(s,this.ctx);this.ctx.restore()}else{this.copy(s,null,null,null,null,s.worldPosition.x,s.worldPosition.y,null,null,s.worldRotation,null,null,s.worldScale.x,s.worldScale.y,s.worldAlpha,r,q)}}if(s.children){for(var p=0;p<s.children.length;p++){this.drawFull(s.children[p],r,q)}}return this},shadow:function(r,s,p,t){var q=this.context;if(r===undefined||r===null){q.shadowColor="rgba(0,0,0,0)"}else{q.shadowColor=r;q.shadowBlur=s||5;q.shadowOffsetX=p||10;q.shadowOffsetY=t||10}return this},alphaMask:function(s,p,q,r){if(r===undefined||r===null){this.draw(p).blendSourceAtop()}else{this.draw(p,r.x,r.y,r.width,r.height).blendSourceAtop()}if(q===undefined||q===null){this.draw(s).blendReset()}else{this.draw(s,q.x,q.y,q.width,q.height).blendReset()}return this},extract:function(v,p,t,w,x,q,s,y,u){if(x===undefined){x=255}if(q===undefined){q=false}if(s===undefined){s=p}if(y===undefined){y=t}if(u===undefined){u=w}if(q){v.resize(this.width,this.height)}this.processPixelRGB(function(z,r,A){if(z.r===p&&z.g===t&&z.b===w){v.setPixel32(r,A,s,y,u,x,false)}return false},this);v.context.putImageData(v.imageData,0,0);v.dirty=true;return v},rect:function(q,t,s,p,r){if(typeof r!=="undefined"){this.context.fillStyle=r}this.context.fillRect(q,t,s,p);return this},text:function(u,p,w,s,r,v){if(p===undefined){p=0}if(w===undefined){w=0}if(s===undefined){s="14px Courier"}if(r===undefined){r="rgb(255,255,255)"}if(v===undefined){v=true}var q=this.context;var t=q.font;q.font=s;if(v){q.fillStyle="rgb(0,0,0)";q.fillText(u,p+1,w+1)}q.fillStyle=r;q.fillText(u,p,w);q.font=t;return this},circle:function(q,t,p,s){var r=this.context;if(s!==undefined){r.fillStyle=s}r.beginPath();r.arc(q,t,p,0,Math.PI*2,false);r.closePath();r.fill();return this},line:function(s,v,r,t,q,u){if(q===undefined){q="#fff"}if(u===undefined){u=1}var p=this.context;p.beginPath();p.moveTo(s,v);p.lineTo(r,t);p.lineWidth=u;p.strokeStyle=q;p.stroke();p.closePath();return this},textureLine:function(q,t,s){if(s===undefined){s="repeat-x"}if(typeof t==="string"){t=this.game.cache.getImage(t);if(!t){return}}var r=q.length;if(s==="no-repeat"&&r>t.width){r=t.width}var p=this.context;p.fillStyle=p.createPattern(t,s);this._circle=new g.Circle(q.start.x,q.start.y,t.height);this._circle.circumferencePoint(q.angle-1.5707963267948966,false,this._pos);p.save();p.translate(this._pos.x,this._pos.y);p.rotate(q.angle);p.fillRect(0,0,r,t.height);p.restore();this.dirty=true;return this},render:function(){if(!this.disableTextureUpload&&this.dirty){this.baseTexture.dirty();this.dirty=false}return this},destroy:function(){this.frameData.destroy();this.texture.destroy(true);PIXI.CanvasPool.remove(this)},blendReset:function(){this.op="source-over";return this},blendSourceOver:function(){this.op="source-over";return this},blendSourceIn:function(){this.op="source-in";return this},blendSourceOut:function(){this.op="source-out";return this},blendSourceAtop:function(){this.op="source-atop";return this},blendDestinationOver:function(){this.op="destination-over";return this},blendDestinationIn:function(){this.op="destination-in";return this},blendDestinationOut:function(){this.op="destination-out";return this},blendDestinationAtop:function(){this.op="destination-atop";return this},blendXor:function(){this.op="xor";return this},blendAdd:function(){this.op="lighter";return this},blendMultiply:function(){this.op="multiply";return this},blendScreen:function(){this.op="screen";return this},blendOverlay:function(){this.op="overlay";return this},blendDarken:function(){this.op="darken";return this},blendLighten:function(){this.op="lighten";return this},blendColorDodge:function(){this.op="color-dodge";return this},blendColorBurn:function(){this.op="color-burn";return this},blendHardLight:function(){this.op="hard-light";return this},blendSoftLight:function(){this.op="soft-light";return this},blendDifference:function(){this.op="difference";return this},blendExclusion:function(){this.op="exclusion";return this},blendHue:function(){this.op="hue";return this},blendSaturation:function(){this.op="saturation";return this},blendColor:function(){this.op="color";return this},blendLuminosity:function(){this.op="luminosity";return this}};Object.defineProperty(g.BitmapData.prototype,"smoothed",{get:function(){g.Canvas.getSmoothingEnabled(this.context)},set:function(p){g.Canvas.setSmoothingEnabled(this.context,p)}});Object.defineProperty(g.BitmapData.prototype,"op",{get:function(){return this.context.globalCompositeOperation},set:function(p){this.context.globalCompositeOperation=p}});g.BitmapData.getTransform=function(u,t,r,p,s,q){if(typeof u!=="number"){u=0}if(typeof t!=="number"){t=0}if(typeof r!=="number"){r=1}if(typeof p!=="number"){p=1}if(typeof s!=="number"){s=0}if(typeof q!=="number"){q=0}return{sx:r,sy:p,scaleX:r,scaleY:p,skewX:s,skewY:q,translateX:u,translateY:t,tx:u,ty:t}};g.BitmapData.prototype.constructor=g.BitmapData;PIXI.Graphics=function(){PIXI.DisplayObjectContainer.call(this);this.renderable=true;this.fillAlpha=1;this.lineWidth=0;this.lineColor=0;this.graphicsData=[];this.tint=16777215;this.blendMode=PIXI.blendModes.NORMAL;this.currentPath=null;this._webGL=[];this.isMask=false;this.boundsPadding=0;this._localBounds=new PIXI.Rectangle(0,0,1,1);this.dirty=true;this._boundsDirty=false;this.webGLDirty=false;this.cachedSpriteDirty=false};PIXI.Graphics.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);PIXI.Graphics.prototype.constructor=PIXI.Graphics;PIXI.Graphics.prototype.lineStyle=function(p,q,r){this.lineWidth=p||0;this.lineColor=q||0;this.lineAlpha=(r===undefined)?1:r;if(this.currentPath){if(this.currentPath.shape.points.length){this.drawShape(new PIXI.Polygon(this.currentPath.shape.points.slice(-2)))}else{this.currentPath.lineWidth=this.lineWidth;this.currentPath.lineColor=this.lineColor;this.currentPath.lineAlpha=this.lineAlpha}}return this};PIXI.Graphics.prototype.moveTo=function(p,q){this.drawShape(new PIXI.Polygon([p,q]));return this};PIXI.Graphics.prototype.lineTo=function(p,q){if(!this.currentPath){this.moveTo(0,0)}this.currentPath.shape.points.push(p,q);this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.quadraticCurveTo=function(x,t,z,w){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var p,u,q=20,A=this.currentPath.shape.points;if(A.length===0){this.moveTo(0,0)}var y=A[A.length-2];var v=A[A.length-1];var r=0;for(var s=1;s<=q;++s){r=s/q;p=y+((x-y)*r);u=v+((t-v)*r);A.push(p+(((x+((z-x)*r))-p)*r),u+(((t+((w-t)*r))-u)*r))}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.bezierCurveTo=function(C,y,B,u,E,A){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points=[0,0]}}else{this.moveTo(0,0)}var s=20,q,r,p,x,w,F=this.currentPath.shape.points;var D=F[F.length-2];var z=F[F.length-1];var t=0;for(var v=1;v<=s;++v){t=v/s;q=(1-t);r=q*q;p=r*q;x=t*t;w=x*t;F.push(p*D+3*r*t*C+3*q*x*B+w*E,p*z+3*r*t*y+3*q*x*u+w*A)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.arcTo=function(L,v,K,t,w){if(this.currentPath){if(this.currentPath.shape.points.length===0){this.currentPath.shape.points.push(L,v)}}else{this.moveTo(L,v)}var I=this.currentPath.shape.points,D=I[I.length-2],B=I[I.length-1],Q=B-v,y=D-L,P=t-v,x=K-L,J=Math.abs(Q*x-y*P);if(J<1e-8||w===0){if(I[I.length-2]!==L||I[I.length-1]!==v){I.push(L,v)}}else{var O=Q*Q+y*y,F=P*P+x*x,q=Q*P+y*x,A=w*Math.sqrt(O)/J,z=w*Math.sqrt(F)/J,r=A*q/O,p=z*q/F,u=A*x+z*y,s=A*P+z*Q,E=y*(z+r),C=Q*(z+r),N=x*(A+p),M=P*(A+p),H=Math.atan2(C-s,E-u),G=Math.atan2(M-s,N-u);this.arc(u+L,s+v,w,H,G,y*P>x*Q)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.arc=function(r,q,t,E,B,p,C){if(E===B){return this}if(p===undefined){p=false}if(C===undefined){C=40}if(!p&&B<=E){B+=Math.PI*2}else{if(p&&E<=B){E+=Math.PI*2}}var x=p?(E-B)*-1:(B-E);var A=Math.ceil(Math.abs(x)/(Math.PI*2))*C;if(x===0){return this}var K=r+Math.cos(E)*t;var I=q+Math.sin(E)*t;if(p&&this.filling){this.moveTo(r,q)}else{this.moveTo(K,I)}var H=this.currentPath.shape.points;var u=x/(A*2);var z=u*2;var D=Math.cos(u);var F=Math.sin(u);var M=A-1;var v=(M%1)/M;for(var G=0;G<=M;G++){var y=G+v*G;var J=((u)+E+(z*y));var L=Math.cos(J);var w=-Math.sin(J);H.push(((D*L)+(F*w))*t+r,((D*-w)+(F*L))*t+q)}this.dirty=true;this._boundsDirty=true;return this};PIXI.Graphics.prototype.beginFill=function(p,q){this.filling=true;this.fillColor=p||0;this.fillAlpha=(q===undefined)?1:q;if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.currentPath.fill=this.filling;this.currentPath.fillColor=this.fillColor;this.currentPath.fillAlpha=this.fillAlpha}}return this};PIXI.Graphics.prototype.endFill=function(){this.filling=false;this.fillColor=null;this.fillAlpha=1;return this};PIXI.Graphics.prototype.drawRect=function(q,s,r,p){this.drawShape(new PIXI.Rectangle(q,s,r,p));return this};PIXI.Graphics.prototype.drawRoundedRect=function(r,t,s,q,p){this.drawShape(new PIXI.RoundedRectangle(r,t,s,q,p));return this};PIXI.Graphics.prototype.drawCircle=function(p,r,q){this.drawShape(new PIXI.Circle(p,r,q));return this};PIXI.Graphics.prototype.drawEllipse=function(q,s,r,p){this.drawShape(new PIXI.Ellipse(q,s,r,p));return this};PIXI.Graphics.prototype.drawPolygon=function(r){if(r instanceof g.Polygon||r instanceof PIXI.Polygon){r=r.points}var q=r;if(!Array.isArray(q)){q=new Array(arguments.length);for(var p=0;p<q.length;++p){q[p]=arguments[p]}}this.drawShape(new g.Polygon(q));return this};PIXI.Graphics.prototype.clear=function(){this.lineWidth=0;this.filling=false;this.dirty=true;this._boundsDirty=true;this.clearDirty=true;this.graphicsData=[];this.updateLocalBounds();return this};PIXI.Graphics.prototype.generateTexture=function(p,r,u){if(p===undefined){p=1}if(r===undefined){r=PIXI.scaleModes.DEFAULT}if(u===undefined){u=0}var t=this.getBounds();t.width+=u;t.height+=u;var q=new PIXI.CanvasBuffer(t.width*p,t.height*p);var s=PIXI.Texture.fromCanvas(q.canvas,r);s.baseTexture.resolution=p;q.context.scale(p,p);q.context.translate(-t.x,-t.y);PIXI.CanvasGraphics.renderGraphics(this,q.context);return s};PIXI.Graphics.prototype._renderWebGL=function(q){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.worldAlpha=this.worldAlpha;PIXI.Sprite.prototype._renderWebGL.call(this._cachedSprite,q);return}else{q.spriteBatch.stop();q.blendModeManager.setBlendMode(this.blendMode);if(this._mask){q.maskManager.pushMask(this._mask,q)}if(this._filters){q.filterManager.pushFilter(this._filterBlock)}if(this.blendMode!==q.spriteBatch.currentBlendMode){q.spriteBatch.currentBlendMode=this.blendMode;var r=PIXI.blendModesWebGL[q.spriteBatch.currentBlendMode];q.spriteBatch.gl.blendFunc(r[0],r[1])}if(this.webGLDirty){this.dirty=true;this.webGLDirty=false}PIXI.WebGLGraphics.renderGraphics(this,q);if(this.children.length){q.spriteBatch.start();for(var p=0;p<this.children.length;p++){this.children[p]._renderWebGL(q)}q.spriteBatch.stop()}if(this._filters){q.filterManager.popFilter()}if(this._mask){q.maskManager.popMask(this.mask,q)}q.drawCount++;q.spriteBatch.start()}};PIXI.Graphics.prototype._renderCanvas=function(v){if(this.visible===false||this.alpha===0||this.isMask===true){return}if(this._prevTint!==this.tint){this.dirty=true;this._prevTint=this.tint}if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty){this._generateCachedSprite();this.updateCachedSpriteTexture();this.cachedSpriteDirty=false;this.dirty=false}this._cachedSprite.alpha=this.alpha;PIXI.Sprite.prototype._renderCanvas.call(this._cachedSprite,v);return}else{var u=v.context;var s=this.worldTransform;if(this.blendMode!==v.currentBlendMode){v.currentBlendMode=this.blendMode;u.globalCompositeOperation=PIXI.blendModesCanvas[v.currentBlendMode]}if(this._mask){v.maskManager.pushMask(this._mask,v)}var r=v.resolution;var q=(s.tx*v.resolution)+v.shakeX;var p=(s.ty*v.resolution)+v.shakeY;u.setTransform(s.a*r,s.b*r,s.c*r,s.d*r,q,p);PIXI.CanvasGraphics.renderGraphics(this,u);for(var t=0;t<this.children.length;t++){this.children[t]._renderCanvas(v)}if(this._mask){v.maskManager.popMask(v)}}};PIXI.Graphics.prototype.getBounds=function(A){if(!this._currentBounds){if(!this.renderable){return PIXI.EmptyRectangle}if(this.dirty){this.updateLocalBounds();this.webGLDirty=true;this.cachedSpriteDirty=true;this.dirty=false}var t=this._localBounds;var x=t.x;var w=t.width+t.x;var v=t.y;var u=t.height+t.y;var y=A||this.worldTransform;var M=y.a;var K=y.b;var J=y.c;var H=y.d;var N=y.tx;var L=y.ty;var D=M*w+J*u+N;var s=H*u+K*w+L;var C=M*x+J*u+N;var r=H*u+K*x+L;var B=M*x+J*v+N;var q=H*v+K*x+L;var z=M*w+J*v+N;var p=H*v+K*w+L;var G=D;var E=s;var I=D;var F=s;I=C<I?C:I;I=B<I?B:I;I=z<I?z:I;F=r<F?r:F;F=q<F?q:F;F=p<F?p:F;G=C>G?C:G;G=B>G?B:G;G=z>G?z:G;E=r>E?r:E;E=q>E?q:E;E=p>E?p:E;this._bounds.x=I;this._bounds.width=G-I;this._bounds.y=F;this._bounds.height=E-F;this._currentBounds=this._bounds}return this._currentBounds};PIXI.Graphics.prototype.getLocalBounds=function(){var p=this.worldTransform;this.worldTransform=PIXI.identityMatrix;for(var q=0;q<this.children.length;q++){this.children[q].updateTransform()}var r=this.getBounds();this.worldTransform=p;for(q=0;q<this.children.length;q++){this.children[q].updateTransform()}return r};PIXI.Graphics.prototype.containsPoint=function(p){this.worldTransform.applyInverse(p,tempPoint);var s=this.graphicsData;for(var q=0;q<s.length;q++){var r=s[q];if(!r.fill){continue}if(r.shape){if(r.shape.contains(tempPoint.x,tempPoint.y)){return true}}}return false};PIXI.Graphics.prototype.updateLocalBounds=function(){var s=Infinity;var q=-Infinity;var r=Infinity;var p=-Infinity;if(this.graphicsData.length){var B,H,F,D,G,z;for(var v=0;v<this.graphicsData.length;v++){var u=this.graphicsData[v];var C=u.type;var A=u.lineWidth;B=u.shape;if(C===PIXI.Graphics.RECT||C===PIXI.Graphics.RREC){F=B.x-A/2;D=B.y-A/2;G=B.width+A;z=B.height+A;s=F<s?F:s;q=F+G>q?F+G:q;r=D<r?D:r;p=D+z>p?D+z:p}else{if(C===PIXI.Graphics.CIRC){F=B.x;D=B.y;G=B.radius+A/2;z=B.radius+A/2;s=F-G<s?F-G:s;q=F+G>q?F+G:q;r=D-z<r?D-z:r;p=D+z>p?D+z:p}else{if(C===PIXI.Graphics.ELIP){F=B.x;D=B.y;G=B.width+A/2;z=B.height+A/2;s=F-G<s?F-G:s;q=F+G>q?F+G:q;r=D-z<r?D-z:r;p=D+z>p?D+z:p}else{H=B.points;for(var t=0;t<H.length;t++){if(H[t] instanceof g.Point){F=H[t].x;D=H[t].y}else{F=H[t];D=H[t+1];if(t<H.length-1){t++}}s=F-A<s?F-A:s;q=F+A>q?F+A:q;r=D-A<r?D-A:r;p=D+A>p?D+A:p}}}}}}else{s=0;q=0;r=0;p=0}var E=this.boundsPadding;this._localBounds.x=s-E;this._localBounds.width=(q-s)+E*2;this._localBounds.y=r-E;this._localBounds.height=(p-r)+E*2};PIXI.Graphics.prototype._generateCachedSprite=function(){var r=this.getLocalBounds();if(!this._cachedSprite){var p=new PIXI.CanvasBuffer(r.width,r.height);var q=PIXI.Texture.fromCanvas(p.canvas);this._cachedSprite=new PIXI.Sprite(q);this._cachedSprite.buffer=p;this._cachedSprite.worldTransform=this.worldTransform}else{this._cachedSprite.buffer.resize(r.width,r.height)}this._cachedSprite.anchor.x=-(r.x/r.width);this._cachedSprite.anchor.y=-(r.y/r.height);this._cachedSprite.buffer.context.translate(-r.x,-r.y);this.worldAlpha=1;PIXI.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};PIXI.Graphics.prototype.updateCachedSpriteTexture=function(){var r=this._cachedSprite;var q=r.texture;var p=r.buffer.canvas;q.baseTexture.width=p.width;q.baseTexture.height=p.height;q.crop.width=q.frame.width=p.width;q.crop.height=q.frame.height=p.height;r._width=p.width;r._height=p.height;q.baseTexture.dirty()};PIXI.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(true);this._cachedSprite=null};PIXI.Graphics.prototype.drawShape=function(p){if(this.currentPath){if(this.currentPath.shape.points.length<=2){this.graphicsData.pop()}}this.currentPath=null;if(p instanceof g.Polygon){p=p.clone();p.flatten()}var q=new PIXI.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,p);this.graphicsData.push(q);if(q.type===PIXI.Graphics.POLY){q.shape.closed=this.filling;this.currentPath=q}this.dirty=true;this._boundsDirty=true;return q};Object.defineProperty(PIXI.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(p){this._cacheAsBitmap=p;if(this._cacheAsBitmap){this._generateCachedSprite()}else{this.destroyCachedSprite()}this.dirty=true;this.webGLDirty=true}});PIXI.GraphicsData=function(p,u,r,v,s,t,q){this.lineWidth=p;this.lineColor=u;this.lineAlpha=r;this._lineTint=u;this.fillColor=v;this.fillAlpha=s;this._fillTint=v;this.fill=t;this.shape=q;this.type=q.type};PIXI.GraphicsData.prototype.constructor=PIXI.GraphicsData;PIXI.GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};PIXI.EarCut={};PIXI.EarCut.Triangulate=function(w,C,z){z=z||2;var A=C&&C.length,u=A?C[0]*z:w.length,B=PIXI.EarCut.linkedList(w,0,u,z,true),s=[];if(!B){return s}var t,r,q,p,E,D,F;if(A){B=PIXI.EarCut.eliminateHoles(w,C,B,z)}if(w.length>80*z){t=q=w[0];r=p=w[1];for(var v=z;v<u;v+=z){E=w[v];D=w[v+1];if(E<t){t=E}if(D<r){r=D}if(E>q){q=E}if(D>p){p=D}}F=Math.max(q-t,p-r)}PIXI.EarCut.earcutLinked(B,s,z,t,r,F);return s};PIXI.EarCut.linkedList=function(t,q,r,v,p){var w=0,u,s,x;for(u=q,s=r-v;u<r;u+=v){w+=(t[s]-t[u])*(t[u+1]+t[s+1]);s=u}if(p===(w>0)){for(u=q;u<r;u+=v){x=PIXI.EarCut.insertNode(u,t[u],t[u+1],x)}}else{for(u=r-v;u>=q;u-=v){x=PIXI.EarCut.insertNode(u,t[u],t[u+1],x)}}return x};PIXI.EarCut.filterPoints=function(t,q){if(!t){return t}if(!q){q=t}var s=t,r;do{r=false;if(!s.steiner&&(PIXI.EarCut.equals(s,s.next)||PIXI.EarCut.area(s.prev,s,s.next)===0)){PIXI.EarCut.removeNode(s);s=q=s.prev;if(s===s.next){return null}r=true}else{s=s.next}}while(r||s!==q);return q};PIXI.EarCut.earcutLinked=function(q,s,v,t,p,y,x){if(!q){return}if(!x&&y){PIXI.EarCut.indexCurve(q,t,p,y)}var w=q,r,u;while(q.prev!==q.next){r=q.prev;u=q.next;if(y?PIXI.EarCut.isEarHashed(q,t,p,y):PIXI.EarCut.isEar(q)){s.push(r.i/v);s.push(q.i/v);s.push(u.i/v);PIXI.EarCut.removeNode(q);q=u.next;w=u.next;continue}q=u;if(q===w){if(!x){PIXI.EarCut.earcutLinked(PIXI.EarCut.filterPoints(q),s,v,t,p,y,1)}else{if(x===1){q=PIXI.EarCut.cureLocalIntersections(q,s,v);PIXI.EarCut.earcutLinked(q,s,v,t,p,y,2)}else{if(x===2){PIXI.EarCut.splitEarcut(q,s,v,t,p,y)}}}break}}};PIXI.EarCut.isEar=function(s){var r=s.prev,q=s,u=s.next;if(PIXI.EarCut.area(r,q,u)>=0){return false}var t=s.next.next;while(t!==s.prev){if(PIXI.EarCut.pointInTriangle(r.x,r.y,q.x,q.y,u.x,u.y,t.x,t.y)&&PIXI.EarCut.area(t.prev,t,t.next)>=0){return false}t=t.next}return true};PIXI.EarCut.isEarHashed=function(v,w,u,C){var z=v.prev,y=v,x=v.next;if(PIXI.EarCut.area(z,y,x)>=0){return false}var D=z.x<y.x?(z.x<x.x?z.x:x.x):(y.x<x.x?y.x:x.x),A=z.y<y.y?(z.y<x.y?z.y:x.y):(y.y<x.y?y.y:x.y),t=z.x>y.x?(z.x>x.x?z.x:x.x):(y.x>x.x?y.x:x.x),s=z.y>y.y?(z.y>x.y?z.y:x.y):(y.y>x.y?y.y:x.y);var r=PIXI.EarCut.zOrder(D,A,w,u,C),B=PIXI.EarCut.zOrder(t,s,w,u,C);var q=v.nextZ;while(q&&q.z<=B){if(q!==v.prev&&q!==v.next&&PIXI.EarCut.pointInTriangle(z.x,z.y,y.x,y.y,x.x,x.y,q.x,q.y)&&PIXI.EarCut.area(q.prev,q,q.next)>=0){return false}q=q.nextZ}q=v.prevZ;while(q&&q.z>=r){if(q!==v.prev&&q!==v.next&&PIXI.EarCut.pointInTriangle(z.x,z.y,y.x,y.y,x.x,x.y,q.x,q.y)&&PIXI.EarCut.area(q.prev,q,q.next)>=0){return false}q=q.prevZ}return true};PIXI.EarCut.cureLocalIntersections=function(v,s,u){var t=v;do{var r=t.prev,q=t.next.next;if(PIXI.EarCut.intersects(r,t,t.next,q)&&PIXI.EarCut.locallyInside(r,q)&&PIXI.EarCut.locallyInside(q,r)){s.push(r.i/u);s.push(t.i/u);s.push(q.i/u);PIXI.EarCut.removeNode(t);PIXI.EarCut.removeNode(t.next);t=v=q}t=t.next}while(t!==v);return t};PIXI.EarCut.splitEarcut=function(p,r,t,s,q,x){var w=p;do{var v=w.next.next;while(v!==w.prev){if(w.i!==v.i&&PIXI.EarCut.isValidDiagonal(w,v)){var u=PIXI.EarCut.splitPolygon(w,v);w=PIXI.EarCut.filterPoints(w,w.next);u=PIXI.EarCut.filterPoints(u,u.next);PIXI.EarCut.earcutLinked(w,r,t,s,q,x);PIXI.EarCut.earcutLinked(u,r,t,s,q,x);return}v=v.next}w=w.next}while(w!==p)};PIXI.EarCut.eliminateHoles=function(r,y,u,t){var v=[],s,w,p,q,x;for(s=0,w=y.length;s<w;s++){p=y[s]*t;q=s<w-1?y[s+1]*t:r.length;x=PIXI.EarCut.linkedList(r,p,q,t,false);if(x===x.next){x.steiner=true}v.push(PIXI.EarCut.getLeftmost(x))}v.sort(compareX);for(s=0;s<v.length;s++){PIXI.EarCut.eliminateHole(v[s],u);u=PIXI.EarCut.filterPoints(u,u.next)}return u};PIXI.EarCut.compareX=function(q,p){return q.x-p.x};PIXI.EarCut.eliminateHole=function(r,q){q=PIXI.EarCut.findHoleBridge(r,q);if(q){var p=PIXI.EarCut.splitPolygon(q,r);PIXI.EarCut.filterPoints(p,p.next)}};PIXI.EarCut.findHoleBridge=function(q,u){var r=u,w=q.x,v=q.y,t=-Infinity,s;do{if(v<=r.y&&v>=r.next.y){var A=r.x+(v-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(A<=w&&A>t){t=A;s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==u);if(!s){return null}if(q.x===s.x){return s.prev}var z=s,B=Infinity,y;r=s.next;while(r!==z){if(w>=r.x&&r.x>=s.x&&PIXI.EarCut.pointInTriangle(v<s.y?w:t,v,s.x,s.y,v<s.y?t:w,v,r.x,r.y)){y=Math.abs(v-r.y)/(w-r.x);if((y<B||(y===B&&r.x>s.x))&&PIXI.EarCut.locallyInside(r,q)){s=r;B=y}}r=r.next}return s};PIXI.EarCut.indexCurve=function(u,q,t,r){var s=u;do{if(s.z===null){s.z=PIXI.EarCut.zOrder(s.x,s.y,q,t,r)}s.prevZ=s.prev;s.nextZ=s.next;s=s.next}while(s!==u);s.prevZ.nextZ=null;s.prevZ=null;PIXI.EarCut.sortLinked(s)};PIXI.EarCut.sortLinked=function(x){var u,t,s,w,y,r,z,v,A=1;do{t=x;x=null;y=null;r=0;while(t){r++;s=t;z=0;for(u=0;u<A;u++){z++;s=s.nextZ;if(!s){break}}v=A;while(z>0||(v>0&&s)){if(z===0){w=s;s=s.nextZ;v--}else{if(v===0||!s){w=t;t=t.nextZ;z--}else{if(t.z<=s.z){w=t;t=t.nextZ;z--}else{w=s;s=s.nextZ;v--}}}if(y){y.nextZ=w}else{x=w}w.prevZ=y;y=w}t=s}y.nextZ=null;A*=2}while(r>1);return x};PIXI.EarCut.zOrder=function(q,t,p,s,r){q=32767*(q-p)/r;t=32767*(t-s)/r;q=(q|(q<<8))&16711935;q=(q|(q<<4))&252645135;q=(q|(q<<2))&858993459;q=(q|(q<<1))&1431655765;t=(t|(t<<8))&16711935;t=(t|(t<<4))&252645135;t=(t|(t<<2))&858993459;t=(t|(t<<1))&1431655765;return q|(t<<1)};PIXI.EarCut.getLeftmost=function(s){var r=s,q=s;do{if(r.x<q.x){q=r}r=r.next}while(r!==s);return q};PIXI.EarCut.pointInTriangle=function(t,s,v,u,p,w,r,q){return(p-r)*(s-q)-(t-r)*(w-q)>=0&&(t-r)*(u-q)-(v-r)*(s-q)>=0&&(v-r)*(w-q)-(p-r)*(u-q)>=0};PIXI.EarCut.isValidDiagonal=function(q,p){return PIXI.EarCut.equals(q,p)||q.next.i!==p.i&&q.prev.i!==p.i&&!PIXI.EarCut.intersectsPolygon(q,p)&&PIXI.EarCut.locallyInside(q,p)&&PIXI.EarCut.locallyInside(p,q)&&PIXI.EarCut.middleInside(q,p)};PIXI.EarCut.area=function(u,t,s){return(t.y-u.y)*(s.x-t.x)-(t.x-u.x)*(s.y-t.y)};PIXI.EarCut.equals=function(q,p){return q.x===p.x&&q.y===p.y};PIXI.EarCut.intersects=function(r,p,q,s){return PIXI.EarCut.area(r,p,q)>0!==PIXI.EarCut.area(r,p,s)>0&&PIXI.EarCut.area(q,s,r)>0!==PIXI.EarCut.area(q,s,p)>0};PIXI.EarCut.intersectsPolygon=function(r,q){var s=r;do{if(s.i!==r.i&&s.next.i!==r.i&&s.i!==q.i&&s.next.i!==q.i&&PIXI.EarCut.intersects(s,s.next,r,q)){return true}s=s.next}while(s!==r);return false};PIXI.EarCut.locallyInside=function(q,p){return PIXI.EarCut.area(q.prev,q,q.next)<0?PIXI.EarCut.area(q,p,q.next)>=0&&PIXI.EarCut.area(q,q.prev,p)>=0:PIXI.EarCut.area(q,p,q.prev)<0||PIXI.EarCut.area(q,q.next,p)<0};PIXI.EarCut.middleInside=function(s,r){var v=s,q=false,u=(s.x+r.x)/2,t=(s.y+r.y)/2;do{if(((v.y>t)!==(v.next.y>t))&&(u<(v.next.x-v.x)*(t-v.y)/(v.next.y-v.y)+v.x)){q=!q}v=v.next}while(v!==s);return q};PIXI.EarCut.splitPolygon=function(r,q){var p=new PIXI.EarCut.Node(r.i,r.x,r.y),s=new PIXI.EarCut.Node(q.i,q.x,q.y),u=r.next,t=q.prev;r.next=q;q.prev=r;p.next=u;u.prev=p;s.next=p;p.prev=s;t.next=s;s.prev=t;return s};PIXI.EarCut.insertNode=function(r,q,u,s){var t=new PIXI.EarCut.Node(r,q,u);if(!s){t.prev=t;t.next=t}else{t.next=s.next;t.prev=s;s.next.prev=t;s.next=t}return t};PIXI.EarCut.removeNode=function(q){q.next.prev=q.prev;q.prev.next=q.next;if(q.prevZ){q.prevZ.nextZ=q.nextZ}if(q.nextZ){q.nextZ.prevZ=q.prevZ}};PIXI.EarCut.Node=function(q,p,r){this.i=q;this.x=p;this.y=r;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false};PIXI.WebGLGraphics=function(){};PIXI.WebGLGraphics.stencilBufferLimit=6;PIXI.WebGLGraphics.renderGraphics=function(w,x){var r=x.gl;var u=x.projection,p=x.offset,t=x.shaderManager.primitiveShader,s;if(w.dirty){PIXI.WebGLGraphics.updateGraphics(w,r)}var v=w._webGL[r.id];for(var q=0;q<v.data.length;q++){if(v.data[q].mode===1){s=v.data[q];x.stencilManager.pushStencil(w,s,x);r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(s.indices.length-4)*2);x.stencilManager.popStencil(w,s,x)}else{s=v.data[q];x.shaderManager.setShader(t);t=x.shaderManager.primitiveShader;r.uniformMatrix3fv(t.translationMatrix,false,w.worldTransform.toArray(true));r.uniform1f(t.flipY,1);r.uniform2f(t.projectionVector,u.x,-u.y);r.uniform2f(t.offsetVector,-p.x,-p.y);r.uniform3fv(t.tintColor,PIXI.hex2rgb(w.tint));r.uniform1f(t.alpha,w.worldAlpha);r.bindBuffer(r.ARRAY_BUFFER,s.buffer);r.vertexAttribPointer(t.aVertexPosition,2,r.FLOAT,false,4*6,0);r.vertexAttribPointer(t.colorAttribute,4,r.FLOAT,false,4*6,2*4);r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,s.indexBuffer);r.drawElements(r.TRIANGLE_STRIP,s.indices.length,r.UNSIGNED_SHORT,0)}}};PIXI.WebGLGraphics.updateGraphics=function(p,v){var t=p._webGL[v.id];if(!t){t=p._webGL[v.id]={lastIndex:0,data:[],gl:v}}p.dirty=false;var q;if(p.clearDirty){p.clearDirty=false;for(q=0;q<t.data.length;q++){var w=t.data[q];w.reset();PIXI.WebGLGraphics.graphicsDataPool.push(w)}t.data=[];t.lastIndex=0}var u;for(q=t.lastIndex;q<p.graphicsData.length;q++){var s=p.graphicsData[q];if(s.type===PIXI.Graphics.POLY){s.points=s.shape.points.slice();if(s.shape.closed){if(s.points[0]!==s.points[s.points.length-2]||s.points[1]!==s.points[s.points.length-1]){s.points.push(s.points[0],s.points[1])}}if(s.fill){if(s.points.length>=PIXI.WebGLGraphics.stencilBufferLimit){if(s.points.length<PIXI.WebGLGraphics.stencilBufferLimit*2){u=PIXI.WebGLGraphics.switchMode(t,0);var r=PIXI.WebGLGraphics.buildPoly(s,u);if(!r){u=PIXI.WebGLGraphics.switchMode(t,1);PIXI.WebGLGraphics.buildComplexPoly(s,u)}}else{u=PIXI.WebGLGraphics.switchMode(t,1);PIXI.WebGLGraphics.buildComplexPoly(s,u)}}}if(s.lineWidth>0){u=PIXI.WebGLGraphics.switchMode(t,0);PIXI.WebGLGraphics.buildLine(s,u)}}else{u=PIXI.WebGLGraphics.switchMode(t,0);if(s.type===PIXI.Graphics.RECT){PIXI.WebGLGraphics.buildRectangle(s,u)}else{if(s.type===PIXI.Graphics.CIRC||s.type===PIXI.Graphics.ELIP){PIXI.WebGLGraphics.buildCircle(s,u)}else{if(s.type===PIXI.Graphics.RREC){PIXI.WebGLGraphics.buildRoundedRectangle(s,u)}}}}t.lastIndex++}for(q=0;q<t.data.length;q++){u=t.data[q];if(u.dirty){u.upload()}}};PIXI.WebGLGraphics.switchMode=function(q,p){var r;if(!q.data.length){r=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(q.gl);r.mode=p;q.data.push(r)}else{r=q.data[q.data.length-1];if(r.mode!==p||p===1){r=PIXI.WebGLGraphics.graphicsDataPool.pop()||new PIXI.WebGLGraphicsData(q.gl);r.mode=p;q.data.push(r)}}r.dirty=true;return r};PIXI.WebGLGraphics.buildRectangle=function(H,v){var t=H.shape;var D=t.x;var C=t.y;var q=t.width;var G=t.height;if(H.fill){var u=PIXI.hex2rgb(H.fillColor);var s=H.fillAlpha;var p=u[0]*s;var w=u[1]*s;var B=u[2]*s;var E=v.points;var F=v.indices;var A=E.length/6;E.push(D,C);E.push(p,w,B,s);E.push(D+q,C);E.push(p,w,B,s);E.push(D,C+G);E.push(p,w,B,s);E.push(D+q,C+G);E.push(p,w,B,s);F.push(A,A,A+1,A+2,A+3,A+3)}if(H.lineWidth){var z=H.points;H.points=[D,C,D+q,C,D+q,C+G,D,C+G,D,C];PIXI.WebGLGraphics.buildLine(H,v);H.points=z}};PIXI.WebGLGraphics.buildRoundedRectangle=function(A,L){var p=A.shape;var z=p.x;var w=p.y;var E=p.width;var D=p.height;var s=p.radius;var B=[];B.push(z,w+s);B=B.concat(PIXI.WebGLGraphics.quadraticBezierCurve(z,w+D-s,z,w+D,z+s,w+D));B=B.concat(PIXI.WebGLGraphics.quadraticBezierCurve(z+E-s,w+D,z+E,w+D,z+E,w+D-s));B=B.concat(PIXI.WebGLGraphics.quadraticBezierCurve(z+E,w+s,z+E,w,z+E-s,w));B=B.concat(PIXI.WebGLGraphics.quadraticBezierCurve(z+s,w,z,w,z,w+s));if(A.fill){var G=PIXI.hex2rgb(A.fillColor);var t=A.fillAlpha;var C=G[0]*t;var I=G[1]*t;var J=G[2]*t;var K=L.points;var u=L.indices;var q=K.length/6;var F=PIXI.EarCut.Triangulate(B,null,2);var H=0;for(H=0;H<F.length;H+=3){u.push(F[H]+q);u.push(F[H]+q);u.push(F[H+1]+q);u.push(F[H+2]+q);u.push(F[H+2]+q)}for(H=0;H<B.length;H++){K.push(B[H],B[++H],C,I,J,t)}}if(A.lineWidth){var v=A.points;A.points=B;PIXI.WebGLGraphics.buildLine(A,L);A.points=v}};PIXI.WebGLGraphics.quadraticBezierCurve=function(E,A,C,v,F,B){var q,w,H,u,D,z,r=20,G=[];function p(I,y,x){var J=y-I;return I+(J*x)}var s=0;for(var t=0;t<=r;t++){s=t/r;q=p(E,C,s);w=p(A,v,s);H=p(C,F,s);u=p(v,B,s);D=p(q,H,s);z=p(w,u,s);G.push(D,z)}return G};PIXI.WebGLGraphics.buildCircle=function(w,K){var G=w.shape;var v=G.x;var u=G.y;var C;var B;if(w.type===PIXI.Graphics.CIRC){C=G.radius;B=G.radius}else{C=G.width;B=G.height}var z=40;var H=(Math.PI*2)/z;var E=0;if(w.fill){var D=PIXI.hex2rgb(w.fillColor);var q=w.fillAlpha;var A=D[0]*q;var F=D[1]*q;var I=D[2]*q;var J=K.points;var s=K.indices;var p=J.length/6;s.push(p);for(E=0;E<z+1;E++){J.push(v,u,A,F,I,q);J.push(v+Math.sin(H*E)*C,u+Math.cos(H*E)*B,A,F,I,q);s.push(p++,p++)}s.push(p-1)}if(w.lineWidth){var t=w.points;w.points=[];for(E=0;E<z+1;E++){w.points.push(v+Math.sin(H*E)*C,u+Math.cos(H*E)*B)}PIXI.WebGLGraphics.buildLine(w,K);w.points=t}};PIXI.WebGLGraphics.buildLine=function(ad,N){var Z=0;var Q=ad.points;if(Q.length===0){return}if(ad.lineWidth%2){for(Z=0;Z<Q.length;Z++){Q[Z]+=0.5}}var E=new PIXI.Point(Q[0],Q[1]);var x=new PIXI.Point(Q[Q.length-2],Q[Q.length-1]);if(E.x===x.x&&E.y===x.y){Q=Q.slice();Q.pop();Q.pop();x=new PIXI.Point(Q[Q.length-2],Q[Q.length-1]);var G=x.x+(E.x-x.x)*0.5;var D=x.y+(E.y-x.y)*0.5;Q.unshift(G,D);Q.push(G,D)}var aa=N.points;var v=N.indices;var F=Q.length/2;var C=Q.length;var ac=aa.length/6;var p=ad.lineWidth/2;var P=PIXI.hex2rgb(ad.lineColor);var Y=ad.lineAlpha;var V=P[0]*Y;var ab=P[1]*Y;var ae=P[2]*Y;var B,A,S,R,K,J,u,t;var U,T,I,H,s,q;var X,O,z,W,M,y;var af,L,w;S=Q[0];R=Q[1];K=Q[2];J=Q[3];U=-(R-J);T=S-K;w=Math.sqrt(U*U+T*T);U/=w;T/=w;U*=p;T*=p;aa.push(S-U,R-T,V,ab,ae,Y);aa.push(S+U,R+T,V,ab,ae,Y);for(Z=1;Z<F-1;Z++){S=Q[(Z-1)*2];R=Q[(Z-1)*2+1];K=Q[(Z)*2];J=Q[(Z)*2+1];u=Q[(Z+1)*2];t=Q[(Z+1)*2+1];U=-(R-J);T=S-K;w=Math.sqrt(U*U+T*T);U/=w;T/=w;U*=p;T*=p;I=-(J-t);H=K-u;w=Math.sqrt(I*I+H*H);I/=w;H/=w;I*=p;H*=p;X=(-T+R)-(-T+J);O=(-U+K)-(-U+S);z=(-U+S)*(-T+J)-(-U+K)*(-T+R);W=(-H+t)-(-H+J);M=(-I+K)-(-I+u);y=(-I+u)*(-H+J)-(-I+K)*(-H+t);af=X*M-W*O;if(Math.abs(af)<0.1){af+=10.1;aa.push(K-U,J-T,V,ab,ae,Y);aa.push(K+U,J+T,V,ab,ae,Y);continue}B=(O*y-M*z)/af;A=(W*z-X*y)/af;L=(B-K)*(B-K)+(A-J)+(A-J);if(L>140*140){s=U-I;q=T-H;w=Math.sqrt(s*s+q*q);s/=w;q/=w;s*=p;q*=p;aa.push(K-s,J-q);aa.push(V,ab,ae,Y);aa.push(K+s,J+q);aa.push(V,ab,ae,Y);aa.push(K-s,J-q);aa.push(V,ab,ae,Y);C++}else{aa.push(B,A);aa.push(V,ab,ae,Y);aa.push(K-(B-K),J-(A-J));aa.push(V,ab,ae,Y)}}S=Q[(F-2)*2];R=Q[(F-2)*2+1];K=Q[(F-1)*2];J=Q[(F-1)*2+1];U=-(R-J);T=S-K;w=Math.sqrt(U*U+T*T);U/=w;T/=w;U*=p;T*=p;aa.push(K-U,J-T);aa.push(V,ab,ae,Y);aa.push(K+U,J+T);aa.push(V,ab,ae,Y);v.push(ac);for(Z=0;Z<C;Z++){v.push(ac++)}v.push(ac-1)};PIXI.WebGLGraphics.buildComplexPoly=function(C,v){var A=C.points.slice();if(A.length<6){return}var B=v.indices;v.points=A;v.alpha=C.fillAlpha;v.color=PIXI.hex2rgb(C.fillColor);var t=Infinity;var q=-Infinity;var s=Infinity;var p=-Infinity;var z,w;for(var u=0;u<A.length;u+=2){z=A[u];w=A[u+1];t=z<t?z:t;q=z>q?z:q;s=w<s?w:s;p=w>p?w:p}A.push(t,s,q,s,q,p,t,p);var r=A.length/2;for(u=0;u<r;u++){B.push(u)}};PIXI.WebGLGraphics.buildPoly=function(D,w){var B=D.points;if(B.length<6){return}var A=w.points;var C=w.indices;var q=B.length/2;var u=PIXI.hex2rgb(D.fillColor);var t=D.fillAlpha;var p=u[0]*t;var x=u[1]*t;var z=u[2]*t;var s=PIXI.EarCut.Triangulate(B,null,2);if(!s){return false}var y=A.length/6;var v=0;for(v=0;v<s.length;v+=3){C.push(s[v]+y);C.push(s[v]+y);C.push(s[v+1]+y);C.push(s[v+2]+y);C.push(s[v+2]+y)}for(v=0;v<q;v++){A.push(B[v*2],B[v*2+1],p,x,z,t)}return true};PIXI.WebGLGraphics.graphicsDataPool=[];PIXI.WebGLGraphicsData=function(p){this.gl=p;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=p.createBuffer();this.indexBuffer=p.createBuffer();this.mode=1;this.alpha=1;this.dirty=true};PIXI.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[]};PIXI.WebGLGraphicsData.prototype.upload=function(){var p=this.gl;this.glPoints=new PIXI.Float32Array(this.points);p.bindBuffer(p.ARRAY_BUFFER,this.buffer);p.bufferData(p.ARRAY_BUFFER,this.glPoints,p.STATIC_DRAW);this.glIndicies=new PIXI.Uint16Array(this.indices);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,this.indexBuffer);p.bufferData(p.ELEMENT_ARRAY_BUFFER,this.glIndicies,p.STATIC_DRAW);this.dirty=false};PIXI.CanvasGraphics=function(){};PIXI.CanvasGraphics.renderGraphics=function(Q,s){var L=Q.worldAlpha;if(Q.dirty){this.updateGraphicsTint(Q);Q.dirty=false}for(var O=0;O<Q.graphicsData.length;O++){var S=Q.graphicsData[O];var r=S.shape;var A=S._fillTint;var q=S._lineTint;s.lineWidth=S.lineWidth;if(S.type===PIXI.Graphics.POLY){s.beginPath();var N=r.points;s.moveTo(N[0],N[1]);for(var M=1;M<N.length/2;M++){s.lineTo(N[M*2],N[M*2+1])}if(r.closed){s.lineTo(N[0],N[1])}if(N[0]===N[N.length-2]&&N[1]===N[N.length-1]){s.closePath()}if(S.fill){s.globalAlpha=S.fillAlpha*L;s.fillStyle="#"+("00000"+(A|0).toString(16)).substr(-6);s.fill()}if(S.lineWidth){s.globalAlpha=S.lineAlpha*L;s.strokeStyle="#"+("00000"+(q|0).toString(16)).substr(-6);s.stroke()}}else{if(S.type===PIXI.Graphics.RECT){if(S.fillColor||S.fillColor===0){s.globalAlpha=S.fillAlpha*L;s.fillStyle="#"+("00000"+(A|0).toString(16)).substr(-6);s.fillRect(r.x,r.y,r.width,r.height)}if(S.lineWidth){s.globalAlpha=S.lineAlpha*L;s.strokeStyle="#"+("00000"+(q|0).toString(16)).substr(-6);s.strokeRect(r.x,r.y,r.width,r.height)}}else{if(S.type===PIXI.Graphics.CIRC){s.beginPath();s.arc(r.x,r.y,r.radius,0,2*Math.PI);s.closePath();if(S.fill){s.globalAlpha=S.fillAlpha*L;s.fillStyle="#"+("00000"+(A|0).toString(16)).substr(-6);s.fill()}if(S.lineWidth){s.globalAlpha=S.lineAlpha*L;s.strokeStyle="#"+("00000"+(q|0).toString(16)).substr(-6);s.stroke()}}else{if(S.type===PIXI.Graphics.ELIP){var F=r.width*2;var P=r.height*2;var E=r.x-F/2;var D=r.y-P/2;s.beginPath();var G=0.5522848,z=(F/2)*G,u=(P/2)*G,K=E+F,p=D+P,H=E+F/2,R=D+P/2;s.moveTo(E,R);s.bezierCurveTo(E,R-u,H-z,D,H,D);s.bezierCurveTo(H+z,D,K,R-u,K,R);s.bezierCurveTo(K,R+u,H+z,p,H,p);s.bezierCurveTo(H-z,p,E,R+u,E,R);s.closePath();if(S.fill){s.globalAlpha=S.fillAlpha*L;s.fillStyle="#"+("00000"+(A|0).toString(16)).substr(-6);s.fill()}if(S.lineWidth){s.globalAlpha=S.lineAlpha*L;s.strokeStyle="#"+("00000"+(q|0).toString(16)).substr(-6);s.stroke()}}else{if(S.type===PIXI.Graphics.RREC){var B=r.x;var v=r.y;var J=r.width;var I=r.height;var t=r.radius;var C=Math.min(J,I)/2|0;t=t>C?C:t;s.beginPath();s.moveTo(B,v+t);s.lineTo(B,v+I-t);s.quadraticCurveTo(B,v+I,B+t,v+I);s.lineTo(B+J-t,v+I);s.quadraticCurveTo(B+J,v+I,B+J,v+I-t);s.lineTo(B+J,v+t);s.quadraticCurveTo(B+J,v,B+J-t,v);s.lineTo(B+t,v);s.quadraticCurveTo(B,v,B,v+t);s.closePath();if(S.fillColor||S.fillColor===0){s.globalAlpha=S.fillAlpha*L;s.fillStyle="#"+("00000"+(A|0).toString(16)).substr(-6);s.fill()}if(S.lineWidth){s.globalAlpha=S.lineAlpha*L;s.strokeStyle="#"+("00000"+(q|0).toString(16)).substr(-6);s.stroke()}}}}}}}};PIXI.CanvasGraphics.renderGraphicsMask=function(O,r){var M=O.graphicsData.length;if(M===0){return}r.beginPath();for(var L=0;L<M;L++){var Q=O.graphicsData[L];var q=Q.shape;if(Q.type===PIXI.Graphics.POLY){var K=q.points;r.moveTo(K[0],K[1]);for(var J=1;J<K.length/2;J++){r.lineTo(K[J*2],K[J*2+1])}if(K[0]===K[K.length-2]&&K[1]===K[K.length-1]){r.closePath()}}else{if(Q.type===PIXI.Graphics.RECT){r.rect(q.x,q.y,q.width,q.height);r.closePath()}else{if(Q.type===PIXI.Graphics.CIRC){r.arc(q.x,q.y,q.radius,0,2*Math.PI);r.closePath()}else{if(Q.type===PIXI.Graphics.ELIP){var D=q.width*2;var N=q.height*2;var C=q.x-D/2;var B=q.y-N/2;var E=0.5522848,v=(D/2)*E,t=(N/2)*E,I=C+D,p=B+N,F=C+D/2,P=B+N/2;r.moveTo(C,P);r.bezierCurveTo(C,P-t,F-v,B,F,B);r.bezierCurveTo(F+v,B,I,P-t,I,P);r.bezierCurveTo(I,P+t,F+v,p,F,p);r.bezierCurveTo(F-v,p,C,P+t,C,P);r.closePath()}else{if(Q.type===PIXI.Graphics.RREC){var z=q.x;var u=q.y;var H=q.width;var G=q.height;var s=q.radius;var A=Math.min(H,G)/2|0;s=s>A?A:s;r.moveTo(z,u+s);r.lineTo(z,u+G-s);r.quadraticCurveTo(z,u+G,z+s,u+G);r.lineTo(z+H-s,u+G);r.quadraticCurveTo(z+H,u+G,z+H,u+G-s);r.lineTo(z+H,u+s);r.quadraticCurveTo(z+H,u,z+H-s,u);r.lineTo(z+s,u);r.quadraticCurveTo(z,u,z,u+s);r.closePath()}}}}}}};PIXI.CanvasGraphics.updateGraphicsTint=function(r){if(r.tint===16777215){return}var q=(r.tint>>16&255)/255;var p=(r.tint>>8&255)/255;var u=(r.tint&255)/255;for(var s=0;s<r.graphicsData.length;s++){var t=r.graphicsData[s];var w=t.fillColor|0;var v=t.lineColor|0;t._fillTint=(((w>>16&255)/255*q*255<<16)+((w>>8&255)/255*p*255<<8)+(w&255)/255*u*255);t._lineTint=(((v>>16&255)/255*q*255<<16)+((v>>8&255)/255*p*255<<8)+(v&255)/255*u*255)}};g.Graphics=function(q,p,r){if(p===undefined){p=0}if(r===undefined){r=0}this.type=g.GRAPHICS;this.physicsType=g.SPRITE;this.anchor=new g.Point();PIXI.Graphics.call(this);g.Component.Core.init.call(this,q,p,r,"",null)};g.Graphics.prototype=Object.create(PIXI.Graphics.prototype);g.Graphics.prototype.constructor=g.Graphics;g.Component.Core.install.call(g.Graphics.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);g.Graphics.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Graphics.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Graphics.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Graphics.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Graphics.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Graphics.prototype.postUpdate=function(){g.Component.PhysicsBody.postUpdate.call(this);g.Component.FixedToCamera.postUpdate.call(this);if(this._boundsDirty){this.updateLocalBounds();this._boundsDirty=false}for(var p=0;p<this.children.length;p++){this.children[p].postUpdate()}};g.Graphics.prototype.destroy=function(p){this.clear();g.Component.Destroy.prototype.destroy.call(this,p)};g.Graphics.prototype.drawTriangle=function(r,q){if(q===undefined){q=false}var v=new g.Polygon(r);if(q){var t=new g.Point(this.game.camera.x-r[0].x,this.game.camera.y-r[0].y);var s=new g.Point(r[1].x-r[0].x,r[1].y-r[0].y);var p=new g.Point(r[1].x-r[2].x,r[1].y-r[2].y);var u=p.cross(s);if(t.dot(u)>0){this.drawPolygon(v)}}else{this.drawPolygon(v)}};g.Graphics.prototype.drawTriangles=function(r,w,p){if(p===undefined){p=false}var v=new g.Point();var t=new g.Point();var q=new g.Point();var u=[];var s;if(!w){if(r[0] instanceof g.Point){for(s=0;s<r.length/3;s++){this.drawTriangle([r[s*3],r[s*3+1],r[s*3+2]],p)}}else{for(s=0;s<r.length/6;s++){v.x=r[s*6+0];v.y=r[s*6+1];t.x=r[s*6+2];t.y=r[s*6+3];q.x=r[s*6+4];q.y=r[s*6+5];this.drawTriangle([v,t,q],p)}}}else{if(r[0] instanceof g.Point){for(s=0;s<w.length/3;s++){u.push(r[w[s*3]]);u.push(r[w[s*3+1]]);u.push(r[w[s*3+2]]);if(u.length===3){this.drawTriangle(u,p);u=[]}}}else{for(s=0;s<w.length;s++){v.x=r[w[s]*2];v.y=r[w[s]*2+1];u.push(v.copyTo({}));if(u.length===3){this.drawTriangle(u,p);u=[]}}}}};g.RenderTexture=function(q,u,p,s,t,r){if(s===undefined){s=""}if(t===undefined){t=g.scaleModes.DEFAULT}if(r===undefined){r=1}this.game=q;this.key=s;this.type=g.RENDERTEXTURE;this._tempMatrix=new PIXI.Matrix();PIXI.RenderTexture.call(this,u,p,this.game.renderer,t,r);this.render=g.RenderTexture.prototype.render};g.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);g.RenderTexture.prototype.constructor=g.RenderTexture;g.RenderTexture.prototype.renderXY=function(r,q,s,p){r.updateTransform();this._tempMatrix.copyFrom(r.worldTransform);this._tempMatrix.tx=q;this._tempMatrix.ty=s;if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this._tempMatrix,p)}else{this.renderCanvas(r,this._tempMatrix,p)}};g.RenderTexture.prototype.renderRawXY=function(r,q,s,p){this._tempMatrix.identity().translate(q,s);if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this._tempMatrix,p)}else{this.renderCanvas(r,this._tempMatrix,p)}};g.RenderTexture.prototype.render=function(r,q,p){if(q===undefined||q===null){this._tempMatrix.copyFrom(r.worldTransform)}else{this._tempMatrix.copyFrom(q)}if(this.renderer.type===PIXI.WEBGL_RENDERER){this.renderWebGL(r,this._tempMatrix,p)}else{this.renderCanvas(r,this._tempMatrix,p)}};g.Text=function(q,p,t,s,r){p=p||0;t=t||0;if(s===undefined||s===null){s=""}else{s=s.toString()}r=g.Utils.extend({},r);this.type=g.TEXT;this.physicsType=g.SPRITE;this.padding=new g.Point();this.textBounds=null;this.canvas=PIXI.CanvasPool.create(this);this.context=this.canvas.getContext("2d");this.colors=[];this.strokeColors=[];this.fontStyles=[];this.fontWeights=[];this.autoRound=false;this.useAdvancedWrap=false;this._res=q.renderer.resolution;this._text=s;this._fontComponents=null;this._lineSpacing=0;this._charCount=0;this._width=0;this._height=0;g.Sprite.call(this,q,p,t,PIXI.Texture.fromCanvas(this.canvas));this.setStyle(r);if(s!==""){this.updateText()}};g.Text.prototype=Object.create(g.Sprite.prototype);g.Text.prototype.constructor=g.Text;g.Text.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Text.prototype.update=function(){};g.Text.prototype.destroy=function(p){this.texture.destroy(true);g.Component.Destroy.prototype.destroy.call(this,p)};g.Text.prototype.setShadow=function(p,u,q,r,t,s){if(p===undefined){p=0}if(u===undefined){u=0}if(q===undefined){q="rgba(0, 0, 0, 1)"}if(r===undefined){r=0}if(t===undefined){t=true}if(s===undefined){s=true}this.style.shadowOffsetX=p;this.style.shadowOffsetY=u;this.style.shadowColor=q;this.style.shadowBlur=r;this.style.shadowStroke=t;this.style.shadowFill=s;this.dirty=true;return this};g.Text.prototype.setStyle=function(p,r){if(r===undefined){r=false}p=p||{};p.font=p.font||"bold 20pt Arial";p.backgroundColor=p.backgroundColor||null;p.fill=p.fill||"black";p.align=p.align||"left";p.boundsAlignH=p.boundsAlignH||"left";p.boundsAlignV=p.boundsAlignV||"top";p.stroke=p.stroke||"black";p.strokeThickness=p.strokeThickness||0;p.wordWrap=p.wordWrap||false;p.wordWrapWidth=p.wordWrapWidth||100;p.maxLines=p.maxLines||0;p.shadowOffsetX=p.shadowOffsetX||0;p.shadowOffsetY=p.shadowOffsetY||0;p.shadowColor=p.shadowColor||"rgba(0,0,0,0)";p.shadowBlur=p.shadowBlur||0;p.tabs=p.tabs||0;var q=this.fontToComponents(p.font);if(p.fontStyle){q.fontStyle=p.fontStyle}if(p.fontVariant){q.fontVariant=p.fontVariant}if(p.fontWeight){q.fontWeight=p.fontWeight}if(p.fontSize){if(typeof p.fontSize==="number"){p.fontSize=p.fontSize+"px"}q.fontSize=p.fontSize}this._fontComponents=q;p.font=this.componentsToFont(this._fontComponents);this.style=p;this.dirty=true;if(r){this.updateText()}return this};g.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var B=this.text;if(this.style.wordWrap){B=this.runWordWrap(this.text)}var q=B.split(/(?:\r\n|\r|\n)/);var E=this.style.tabs;var H=[];var C=0;var v=this.determineFontProperties(this.style.font);var w=q.length;if(this.style.maxLines>0&&this.style.maxLines<q.length){w=this.style.maxLines}this._charCount=0;for(var D=0;D<w;D++){if(E===0){var p=this.style.strokeThickness+this.padding.x;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){p+=this.measureLine(q[D])}else{p+=this.context.measureText(q[D]).width}if(this.style.wordWrap){p-=this.context.measureText(" ").width}}else{var y=q[D].split(/(?:\t)/);var p=this.padding.x+this.style.strokeThickness;if(Array.isArray(E)){var r=0;for(var G=0;G<y.length;G++){var x=0;if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){x=this.measureLine(y[G])}else{x=Math.ceil(this.context.measureText(y[G]).width)}if(G>0){r+=E[G-1]}p=r+x}}else{for(var G=0;G<y.length;G++){if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){p+=this.measureLine(y[G])}else{p+=Math.ceil(this.context.measureText(y[G]).width)}var z=this.game.math.snapToCeil(p,E)-p;p+=z}}}H[D]=Math.ceil(p);C=Math.max(C,H[D])}this.canvas.width=C*this._res;var s=v.fontSize+this.style.strokeThickness+this.padding.y;var A=s*w;var F=this._lineSpacing;if(F<0&&Math.abs(F)>s){F=-s}if(F!==0){A+=(F>0)?F*q.length:F*(q.length-1)}this.canvas.height=A*this._res;this.context.scale(this._res,this._res);if(navigator.isCocoonJS){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}if(this.style.backgroundColor){this.context.fillStyle=this.style.backgroundColor;this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}this.context.fillStyle=this.style.fill;this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.textBaseline="alphabetic";this.context.lineWidth=this.style.strokeThickness;this.context.lineCap="round";this.context.lineJoin="round";var u;var t;this._charCount=0;for(D=0;D<w;D++){u=this.style.strokeThickness/2;t=(this.style.strokeThickness/2+D*s)+v.ascent;if(D>0){t+=(F*D)}if(this.style.align==="right"){u+=C-H[D]}else{if(this.style.align==="center"){u+=(C-H[D])/2}}if(this.autoRound){u=Math.round(u);t=Math.round(t)}if(this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0){this.updateLine(q[D],u,t)}else{if(this.style.stroke&&this.style.strokeThickness){this.updateShadow(this.style.shadowStroke);if(E===0){this.context.strokeText(q[D],u,t)}else{this.renderTabLine(q[D],u,t,false)}}if(this.style.fill){this.updateShadow(this.style.shadowFill);if(E===0){this.context.fillText(q[D],u,t)}else{this.renderTabLine(q[D],u,t,true)}}}}this.updateTexture();this.dirty=false};g.Text.prototype.renderTabLine=function(A,u,s,z){var w=A.split(/(?:\t)/);var t=this.style.tabs;var q=0;if(Array.isArray(t)){var p=0;for(var r=0;r<w.length;r++){if(r>0){p+=t[r-1]}q=u+p;if(z){this.context.fillText(w[r],q,s)}else{this.context.strokeText(w[r],q,s)}}}else{for(var r=0;r<w.length;r++){var v=Math.ceil(this.context.measureText(w[r]).width);q=this.game.math.snapToCeil(u,t);if(z){this.context.fillText(w[r],q,s)}else{this.context.strokeText(w[r],q,s)}u=q+v}}};g.Text.prototype.updateShadow=function(p){if(p){this.context.shadowOffsetX=this.style.shadowOffsetX;this.context.shadowOffsetY=this.style.shadowOffsetY;this.context.shadowColor=this.style.shadowColor;this.context.shadowBlur=this.style.shadowBlur}else{this.context.shadowOffsetX=0;this.context.shadowOffsetY=0;this.context.shadowColor=0;this.context.shadowBlur=0}};g.Text.prototype.measureLine=function(q){var p=0;for(var r=0;r<q.length;r++){var t=q[r];if(this.fontWeights.length>0||this.fontStyles.length>0){var s=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){s.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){s.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(s)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill)}p+=this.context.measureText(t).width;this._charCount++}return Math.ceil(p)};g.Text.prototype.updateLine=function(q,p,u){for(var r=0;r<q.length;r++){var t=q[r];if(this.fontWeights.length>0||this.fontStyles.length>0){var s=this.fontToComponents(this.context.font);if(this.fontStyles[this._charCount]){s.fontStyle=this.fontStyles[this._charCount]}if(this.fontWeights[this._charCount]){s.fontWeight=this.fontWeights[this._charCount]}this.context.font=this.componentsToFont(s)}if(this.style.stroke&&this.style.strokeThickness){if(this.strokeColors[this._charCount]){this.context.strokeStyle=this.strokeColors[this._charCount]}this.updateShadow(this.style.shadowStroke);this.context.strokeText(t,p,u)}if(this.style.fill){if(this.colors[this._charCount]){this.context.fillStyle=this.colors[this._charCount]}this.updateShadow(this.style.shadowFill);this.context.fillText(t,p,u)}p+=this.context.measureText(t).width;this._charCount++}};g.Text.prototype.clearColors=function(){this.colors=[];this.strokeColors=[];this.dirty=true;return this};g.Text.prototype.clearFontValues=function(){this.fontStyles=[];this.fontWeights=[];this.dirty=true;return this};g.Text.prototype.addColor=function(q,p){this.colors[p]=q;this.dirty=true;return this};g.Text.prototype.addStrokeColor=function(q,p){this.strokeColors[p]=q;this.dirty=true;return this};g.Text.prototype.addFontStyle=function(q,p){this.fontStyles[p]=q;this.dirty=true;return this};g.Text.prototype.addFontWeight=function(q,p){this.fontWeights[p]=q;this.dirty=true;return this};g.Text.prototype.precalculateWordWrap=function(q){this.texture.baseTexture.resolution=this._res;this.context.font=this.style.font;var p=this.runWordWrap(q);return p.split(/(?:\r\n|\r|\n)/)};g.Text.prototype.runWordWrap=function(p){if(this.useAdvancedWrap){return this.advancedWordWrap(p)}else{return this.basicWordWrap(p)}};g.Text.prototype.advancedWordWrap=function(z){var s=this.context;var A=this.style.wordWrapWidth;var v="";var r=z.replace(/ +/gi," ").split(/\r?\n/gi);var G=r.length;for(var E=0;E<G;E++){var w=r[E];var F="";w=w.replace(/^ *|\s*$/gi,"");var q=s.measureText(w).width;if(q<A){v+=w+"\n";continue}var C=A;var B=w.split(" ");for(var D=0;D<B.length;D++){var H=B[D];var p=H+" ";var I=s.measureText(p).width;if(I>C){if(D===0){var t=p;while(t.length){t=t.slice(0,-1);I=s.measureText(t).width;if(I<=C){break}}if(!t.length){throw new Error("This text's wordWrapWidth setting is less than a single character!")}var x=H.substr(t.length);B[D]=x;F+=t}var u=(B[D].length)?D:D+1;var y=B.slice(u).join(" ").replace(/[ \n]*$/gi,"");r[E+1]=y+" "+(r[E+1]||"");G=r.length;break}else{F+=p;C-=I}}v+=F.replace(/[ \n]*$/gi,"")+"\n"}v=v.replace(/[\s|\n]*$/gi,"");return v};g.Text.prototype.basicWordWrap=function(u){var x="";var w=u.split("\n");for(var r=0;r<w.length;r++){var q=this.style.wordWrapWidth;var t=w[r].split(" ");for(var p=0;p<t.length;p++){var v=this.context.measureText(t[p]).width;var s=v+this.context.measureText(" ").width;if(s>q){if(p>0){x+="\n"}x+=t[p]+" ";q=this.style.wordWrapWidth-v}else{q-=s;x+=t[p]+" "}}if(r<w.length-1){x+="\n"}}return x};g.Text.prototype.updateFont=function(q){var p=this.componentsToFont(q);if(this.style.font!==p){this.style.font=p;this.dirty=true;if(this.parent){this.updateTransform()}}};g.Text.prototype.fontToComponents=function(q){var p=q.match(/^\s*(?:\b(normal|italic|oblique|inherit)?\b)\s*(?:\b(normal|small-caps|inherit)?\b)\s*(?:\b(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit)?\b)\s*(?:\b(xx-small|x-small|small|medium|large|x-large|xx-large|larger|smaller|0|\d*(?:[.]\d*)?(?:%|[a-z]{2,5}))?\b)\s*(.*)\s*$/);if(p){var r=p[5].trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(r)&&!/['",]/.exec(r)){r="'"+r+"'"}return{font:q,fontStyle:p[1]||"normal",fontVariant:p[2]||"normal",fontWeight:p[3]||"normal",fontSize:p[4]||"medium",fontFamily:r}}else{console.warn("Phaser.Text - unparsable CSS font: "+q);return{font:q}}};g.Text.prototype.componentsToFont=function(q){var r=[];var p;p=q.fontStyle;if(p&&p!=="normal"){r.push(p)}p=q.fontVariant;if(p&&p!=="normal"){r.push(p)}p=q.fontWeight;if(p&&p!=="normal"){r.push(p)}p=q.fontSize;if(p&&p!=="medium"){r.push(p)}p=q.fontFamily;if(p){r.push(p)}if(!r.length){r.push(q.font)}return r.join(" ")};g.Text.prototype.setText=function(q,p){if(p===undefined){p=false}this.text=q.toString()||"";if(p){this.updateText()}else{this.dirty=true}return this};g.Text.prototype.parseList=function(r){if(!Array.isArray(r)){return this}else{var q="";for(var p=0;p<r.length;p++){if(Array.isArray(r[p])){q+=r[p].join("\t");if(p<r.length-1){q+="\n"}}else{q+=r[p];if(p<r.length-1){q+="\t"}}}}this.text=q;this.dirty=true;return this};g.Text.prototype.setTextBounds=function(q,s,r,p){if(q===undefined){this.textBounds=null}else{if(!this.textBounds){this.textBounds=new g.Rectangle(q,s,r,p)}else{this.textBounds.setTo(q,s,r,p)}if(this.style.wordWrapWidth>r){this.style.wordWrapWidth=r}}this.updateTexture();return this};g.Text.prototype.updateTexture=function(){var t=this.texture.baseTexture;var s=this.texture.crop;var u=this.texture.frame;var q=this.canvas.width;var r=this.canvas.height;t.width=q;t.height=r;s.width=q;s.height=r;u.width=q;u.height=r;this.texture.width=q;this.texture.height=r;this._width=q;this._height=r;if(this.textBounds){var p=this.textBounds.x;var v=this.textBounds.y;if(this.style.boundsAlignH==="right"){p+=this.textBounds.width-this.canvas.width/this.resolution}else{if(this.style.boundsAlignH==="center"){p+=this.textBounds.halfWidth-(this.canvas.width/this.resolution/2)}}if(this.style.boundsAlignV==="bottom"){v+=this.textBounds.height-this.canvas.height/this.resolution}else{if(this.style.boundsAlignV==="middle"){v+=this.textBounds.halfHeight-(this.canvas.height/this.resolution/2)}}this.pivot.x=-p;this.pivot.y=-v}this.renderable=(q!==0&&r!==0);this.texture.requiresReTint=true;this.texture.baseTexture.dirty()};g.Text.prototype._renderWebGL=function(p){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderWebGL.call(this,p)};g.Text.prototype._renderCanvas=function(p){if(this.dirty){this.updateText();this.dirty=false}PIXI.Sprite.prototype._renderCanvas.call(this,p)};g.Text.prototype.determineFontProperties=function(u){var x=g.Text.fontPropertiesCache[u];if(!x){x={};var r=g.Text.fontPropertiesCanvas;var q=g.Text.fontPropertiesContext;q.font=u;var p=Math.ceil(q.measureText("|Mq").width);var w=Math.ceil(q.measureText("|Mq").width);var B=2*w;w=w*1.4|0;r.width=p;r.height=B;q.fillStyle="#f00";q.fillRect(0,0,p,B);q.font=u;q.textBaseline="alphabetic";q.fillStyle="#000";q.fillText("|Mq",0,w);if(!q.getImageData(0,0,p,B)){x.ascent=w;x.descent=w+6;x.fontSize=x.ascent+x.descent;g.Text.fontPropertiesCache[u]=x;return x}var y=q.getImageData(0,0,p,B).data;var s=y.length;var C=p*4;var v,t;var A=0;var z=false;for(v=0;v<w;v++){for(t=0;t<C;t+=4){if(y[A+t]!==255){z=true;break}}if(!z){A+=C}else{break}}x.ascent=w-v;A=s-C;z=false;for(v=B;v>w;v--){for(t=0;t<C;t+=4){if(y[A+t]!==255){z=true;break}}if(!z){A-=C}else{break}}x.descent=v-w;x.descent+=6;x.fontSize=x.ascent+x.descent;g.Text.fontPropertiesCache[u]=x}return x};g.Text.prototype.getBounds=function(p){if(this.dirty){this.updateText();this.dirty=false}return PIXI.Sprite.prototype.getBounds.call(this,p)};Object.defineProperty(g.Text.prototype,"text",{get:function(){return this._text},set:function(p){if(p!==this._text){this._text=p.toString()||"";this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(g.Text.prototype,"cssFont",{get:function(){return this.componentsToFont(this._fontComponents)},set:function(p){p=p||"bold 20pt Arial";this._fontComponents=this.fontToComponents(p);this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"font",{get:function(){return this._fontComponents.fontFamily},set:function(p){p=p||"Arial";p=p.trim();if(!/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(p)&&!/['",]/.exec(p)){p="'"+p+"'"}this._fontComponents.fontFamily=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontSize",{get:function(){var p=this._fontComponents.fontSize;if(p&&/(?:^0$|px$)/.exec(p)){return parseInt(p,10)}else{return p}},set:function(p){p=p||"0";if(typeof p==="number"){p=p+"px"}this._fontComponents.fontSize=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontWeight",{get:function(){return this._fontComponents.fontWeight||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontWeight=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontStyle",{get:function(){return this._fontComponents.fontStyle||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontStyle=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fontVariant",{get:function(){return this._fontComponents.fontVariant||"normal"},set:function(p){p=p||"normal";this._fontComponents.fontVariant=p;this.updateFont(this._fontComponents)}});Object.defineProperty(g.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(p){if(p!==this.style.fill){this.style.fill=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"align",{get:function(){return this.style.align},set:function(p){if(p!==this.style.align){this.style.align=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"resolution",{get:function(){return this._res},set:function(p){if(p!==this._res){this._res=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"tabs",{get:function(){return this.style.tabs},set:function(p){if(p!==this.style.tabs){this.style.tabs=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"boundsAlignH",{get:function(){return this.style.boundsAlignH},set:function(p){if(p!==this.style.boundsAlignH){this.style.boundsAlignH=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"boundsAlignV",{get:function(){return this.style.boundsAlignV},set:function(p){if(p!==this.style.boundsAlignV){this.style.boundsAlignV=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(p){if(p!==this.style.stroke){this.style.stroke=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(p){if(p!==this.style.strokeThickness){this.style.strokeThickness=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(p){if(p!==this.style.wordWrap){this.style.wordWrap=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(p){if(p!==this.style.wordWrapWidth){this.style.wordWrapWidth=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(p){if(p!==this._lineSpacing){this._lineSpacing=parseFloat(p);this.dirty=true;if(this.parent){this.updateTransform()}}}});Object.defineProperty(g.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(p){if(p!==this.style.shadowOffsetX){this.style.shadowOffsetX=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(p){if(p!==this.style.shadowOffsetY){this.style.shadowOffsetY=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(p){if(p!==this.style.shadowColor){this.style.shadowColor=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(p){if(p!==this.style.shadowBlur){this.style.shadowBlur=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowStroke",{get:function(){return this.style.shadowStroke},set:function(p){if(p!==this.style.shadowStroke){this.style.shadowStroke=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"shadowFill",{get:function(){return this.style.shadowFill},set:function(p){if(p!==this.style.shadowFill){this.style.shadowFill=p;this.dirty=true}}});Object.defineProperty(g.Text.prototype,"width",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.x*this.texture.frame.width},set:function(p){this.scale.x=p/this.texture.frame.width;this._width=p}});Object.defineProperty(g.Text.prototype,"height",{get:function(){if(this.dirty){this.updateText();this.dirty=false}return this.scale.y*this.texture.frame.height},set:function(p){this.scale.y=p/this.texture.frame.height;this._height=p}});g.Text.fontPropertiesCache={};g.Text.fontPropertiesCanvas=document.createElement("canvas");g.Text.fontPropertiesContext=g.Text.fontPropertiesCanvas.getContext("2d");g.BitmapText=function(r,p,v,q,t,s,u){p=p||0;v=v||0;q=q||"";t=t||"";s=s||32;u=u||"left";PIXI.DisplayObjectContainer.call(this);this.type=g.BITMAPTEXT;this.physicsType=g.SPRITE;this.textWidth=0;this.textHeight=0;this.anchor=new g.Point();this._prevAnchor=new g.Point();this._glyphs=[];this._maxWidth=0;this._text=t.toString()||"";this._data=r.cache.getBitmapFont(q);this._font=q;this._fontSize=s;this._align=u;this._tint=16777215;this.updateText();this.dirty=false;g.Component.Core.init.call(this,r,p,v,"",null)};g.BitmapText.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);g.BitmapText.prototype.constructor=g.BitmapText;g.Component.Core.install.call(g.BitmapText.prototype,["Angle","AutoCull","Bounds","Destroy","FixedToCamera","InputEnabled","InWorld","LifeSpan","PhysicsBody","Reset"]);g.BitmapText.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.BitmapText.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.BitmapText.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.BitmapText.prototype.preUpdateCore=g.Component.Core.preUpdate;g.BitmapText.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.BitmapText.prototype.postUpdate=function(){g.Component.PhysicsBody.postUpdate.call(this);g.Component.FixedToCamera.postUpdate.call(this);if(this.body&&this.body.type===g.Physics.ARCADE){if((this.textWidth!==this.body.sourceWidth)||(this.textHeight!==this.body.sourceHeight)){this.body.setSize(this.textWidth,this.textHeight)}}};g.BitmapText.prototype.setText=function(p){this.text=p};g.BitmapText.prototype.scanLine=function(u,r,F){var B=0;var C=0;var G=-1;var p=0;var y=null;var D=(this._maxWidth>0)?this._maxWidth:null;var A=[];for(var t=0;t<F.length;t++){var s=(t===F.length-1)?true:false;if(/(?:\r\n|\r|\n)/.test(F.charAt(t))){return{width:C,text:F.substr(0,t),end:s,chars:A}}else{var E=F.charCodeAt(t);var q=u.chars[E];var z=0;if(q===undefined){E=32;q=u.chars[E]}var v=(y&&q.kerning[y])?q.kerning[y]:0;if(/(\s)/.test(F.charAt(t))){G=t;p=C}z=(v+q.texture.width+q.xOffset)*r;if(D&&((C+z)>=D)&&G>-1){return{width:p||C,text:F.substr(0,t-(t-G)),end:s,chars:A}}else{C+=(q.xAdvance+v)*r;A.push(B+(q.xOffset+v)*r);B+=(q.xAdvance+v)*r;y=E}}}return{width:C,text:F,end:s,chars:A}};g.BitmapText.prototype.cleanText=function(u,p){if(p===undefined){p=""}var r=this._data.font;if(!r){return""}var v=/\r\n|\n\r|\n|\r/g;var w=u.replace(v,"\n").split("\n");for(var s=0;s<w.length;s++){var q="";var x=w[s];for(var t=0;t<x.length;t++){if(r.chars[x.charCodeAt(t)]){q=q.concat(x[t])}else{q=q.concat(p)}}w[s]=q}return w.join("\n")};g.BitmapText.prototype.updateText=function(){var u=this._data.font;if(!u){return}var B=this.text;var r=this._fontSize/u.size;var E=[];var z=0;this.textWidth=0;do{var F=this.scanLine(u,r,B);F.y=z;E.push(F);if(F.width>this.textWidth){this.textWidth=F.width}z+=(u.lineHeight*r);B=B.substr(F.text.length+1)}while(F.end===false);this.textHeight=z;var C=0;var w=0;var p=this.textWidth*this.anchor.x;var D=this.textHeight*this.anchor.y;for(var s=0;s<E.length;s++){var F=E[s];if(this._align==="right"){w=this.textWidth-F.width}else{if(this._align==="center"){w=(this.textWidth-F.width)/2}}for(var x=0;x<F.text.length;x++){var A=F.text.charCodeAt(x);var q=u.chars[A];if(q===undefined){A=32;q=u.chars[A]}var v=this._glyphs[C];if(v){v.texture=q.texture}else{v=new PIXI.Sprite(q.texture);v.name=F.text[x];this._glyphs.push(v)}v.position.x=(F.chars[x]+w)-p;v.position.y=(F.y+(q.yOffset*r))-D;v.scale.set(r);v.tint=this.tint;v.texture.requiresReTint=true;if(!v.parent){this.addChild(v)}C++}}for(s=C;s<this._glyphs.length;s++){this.removeChild(this._glyphs[s])}};g.BitmapText.prototype.purgeGlyphs=function(){var p=this._glyphs.length;var r=[];for(var q=0;q<this._glyphs.length;q++){if(this._glyphs[q].parent!==this){this._glyphs[q].destroy()}else{r.push(this._glyphs[q])}}this._glyphs=[];this._glyphs=r;this.updateText();return p-r.length};g.BitmapText.prototype.updateTransform=function(){if(this.dirty||!this.anchor.equals(this._prevAnchor)){this.updateText();this.dirty=false;this._prevAnchor.copyFrom(this.anchor)}PIXI.DisplayObjectContainer.prototype.updateTransform.call(this)};Object.defineProperty(g.BitmapText.prototype,"align",{get:function(){return this._align},set:function(p){if(p!==this._align&&(p==="left"||p==="center"||p==="right")){this._align=p;this.updateText()}}});Object.defineProperty(g.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(p){if(p!==this._tint){this._tint=p;this.updateText()}}});Object.defineProperty(g.BitmapText.prototype,"font",{get:function(){return this._font},set:function(p){if(p!==this._font){this._font=p.trim();this._data=this.game.cache.getBitmapFont(this._font);this.updateText()}}});Object.defineProperty(g.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(p){p=parseInt(p,10);if(p!==this._fontSize&&p>0){this._fontSize=p;this.updateText()}}});Object.defineProperty(g.BitmapText.prototype,"text",{get:function(){return this._text},set:function(p){if(p!==this._text){this._text=p.toString()||"";this.updateText()}}});Object.defineProperty(g.BitmapText.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(p){if(p!==this._maxWidth){this._maxWidth=p;this.updateText()}}});Object.defineProperty(g.BitmapText.prototype,"smoothed",{get:function(){return !this._data.base.scaleMode},set:function(p){if(p){this._data.base.scaleMode=0}else{this._data.base.scaleMode=1}}});g.RetroFont=function(E,D,q,w,A,C,B,y,x,v){if(!E.cache.checkImageKey(D)){return false}if(C===undefined||C===null){C=E.cache.getImage(D).width/q}this.characterWidth=q;this.characterHeight=w;this.characterSpacingX=B||0;this.characterSpacingY=y||0;this.characterPerRow=C;this.offsetX=x||0;this.offsetY=v||0;this.align="left";this.multiLine=false;this.autoUpperCase=true;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=E.cache.getImage(D);this._text="";this.grabData=[];this.frameData=new g.FrameData();var u=this.offsetX;var t=this.offsetY;var p=0;for(var z=0;z<A.length;z++){var s=this.frameData.addFrame(new g.Frame(z,u,t,this.characterWidth,this.characterHeight));this.grabData[A.charCodeAt(z)]=s.index;p++;if(p===this.characterPerRow){p=0;u=this.offsetX;t+=this.characterHeight+this.characterSpacingY}else{u+=this.characterWidth+this.characterSpacingX}}E.cache.updateFrameData(D,this.frameData);this.stamp=new g.Image(E,0,0,D,0);g.RenderTexture.call(this,E,100,100,"",g.scaleModes.NEAREST);this.type=g.RETROFONT};g.RetroFont.prototype=Object.create(g.RenderTexture.prototype);g.RetroFont.prototype.constructor=g.RetroFont;g.RetroFont.ALIGN_LEFT="left";g.RetroFont.ALIGN_RIGHT="right";g.RetroFont.ALIGN_CENTER="center";g.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";g.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";g.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";g.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";g.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";g.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";g.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";g.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";g.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";g.RetroFont.prototype.setFixedWidth=function(q,p){if(p===undefined){p="left"}this.fixedWidth=q;this.align=p};g.RetroFont.prototype.setText=function(s,t,r,u,q,p){this.multiLine=t||false;this.customSpacingX=r||0;this.customSpacingY=u||0;this.align=q||"left";if(p){this.autoUpperCase=false}else{this.autoUpperCase=true}if(s.length>0){this.text=s}};g.RetroFont.prototype.buildRetroFontText=function(){var p=0;var s=0;this.clear();if(this.multiLine){var q=this._text.split("\n");if(this.fixedWidth>0){this.resize(this.fixedWidth,(q.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}else{this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),(q.length*(this.characterHeight+this.customSpacingY))-this.customSpacingY,true)}for(var r=0;r<q.length;r++){p=0;if(this.align===g.RetroFont.ALIGN_RIGHT){p=this.width-(q[r].length*(this.characterWidth+this.customSpacingX))}else{if(this.align===g.RetroFont.ALIGN_CENTER){p=(this.width/2)-((q[r].length*(this.characterWidth+this.customSpacingX))/2);p+=this.customSpacingX/2}}if(p<0){p=0}this.pasteLine(q[r],p,s,this.customSpacingX);s+=this.characterHeight+this.customSpacingY}}else{if(this.fixedWidth>0){this.resize(this.fixedWidth,this.characterHeight,true)}else{this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,true)}p=0;if(this.align===g.RetroFont.ALIGN_RIGHT){p=this.width-(this._text.length*(this.characterWidth+this.customSpacingX))}else{if(this.align===g.RetroFont.ALIGN_CENTER){p=(this.width/2)-((this._text.length*(this.characterWidth+this.customSpacingX))/2);p+=this.customSpacingX/2}}if(p<0){p=0}this.pasteLine(this._text,p,0,this.customSpacingX)}this.requiresReTint=true};g.RetroFont.prototype.pasteLine=function(q,p,t,r){for(var s=0;s<q.length;s++){if(q.charAt(s)===" "){p+=this.characterWidth+r}else{if(this.grabData[q.charCodeAt(s)]>=0){this.stamp.frame=this.grabData[q.charCodeAt(s)];this.renderXY(this.stamp,p,t,false);p+=this.characterWidth+r;if(p>this.width){break}}}}};g.RetroFont.prototype.getLongestLine=function(){var q=0;if(this._text.length>0){var p=this._text.split("\n");for(var r=0;r<p.length;r++){if(p[r].length>q){q=p[r].length}}}return q};g.RetroFont.prototype.removeUnsupportedCharacters=function(s){var q="";for(var t=0;t<this._text.length;t++){var p=this._text[t];var r=p.charCodeAt(0);if(this.grabData[r]>=0||(!s&&p==="\n")){q=q.concat(p)}}return q};g.RetroFont.prototype.updateOffset=function(p,u){if(this.offsetX===p&&this.offsetY===u){return}var r=p-this.offsetX;var q=u-this.offsetY;var t=this.game.cache.getFrameData(this.stamp.key).getFrames();var s=t.length;while(s--){t[s].x+=r;t[s].y+=q}this.buildRetroFontText()};Object.defineProperty(g.RetroFont.prototype,"text",{get:function(){return this._text},set:function(q){var p;if(this.autoUpperCase){p=q.toUpperCase()}else{p=q}if(p!==this._text){this._text=p;this.removeUnsupportedCharacters(this.multiLine);this.buildRetroFontText()}}});Object.defineProperty(g.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(p){this.stamp.smoothed=p;this.buildRetroFontText()}});g.Rope=function(q,p,u,r,t,s){this.points=[];this.points=s;this._hasUpdateAnimation=false;this._updateAnimationCallback=null;p=p||0;u=u||0;r=r||null;t=t||null;this.type=g.ROPE;PIXI.Rope.call(this,g.Cache.DEFAULT,this.points);g.Component.Core.init.call(this,q,p,u,r,t)};g.Rope.prototype=Object.create(PIXI.Rope.prototype);g.Rope.prototype.constructor=g.Rope;g.Component.Core.install.call(g.Rope.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Crop","Delta","Destroy","FixedToCamera","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","ScaleMinMax","Smoothed"]);g.Rope.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.Rope.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.Rope.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.Rope.prototype.preUpdateCore=g.Component.Core.preUpdate;g.Rope.prototype.preUpdate=function(){if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.Rope.prototype.update=function(){if(this._hasUpdateAnimation){this.updateAnimation.call(this)}};g.Rope.prototype.reset=function(p,q){g.Component.Reset.prototype.reset.call(this,p,q);return this};Object.defineProperty(g.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(p){if(p&&typeof p==="function"){this._hasUpdateAnimation=true;this._updateAnimation=p}else{this._hasUpdateAnimation=false;this._updateAnimation=null}}});Object.defineProperty(g.Rope.prototype,"segments",{get:function(){var t=[];var u,r,x,p,w,q,y,v;for(var s=0;s<this.points.length;s++){u=s*4;r=this.vertices[u]*this.scale.x;x=this.vertices[u+1]*this.scale.y;p=this.vertices[u+4]*this.scale.x;w=this.vertices[u+3]*this.scale.y;q=g.Math.difference(r,p);y=g.Math.difference(x,w);r+=this.world.x;x+=this.world.y;v=new g.Rectangle(r,x,q,y);t.push(v)}return t}});g.TileSprite=function(r,q,w,t,p,s,v){q=q||0;w=w||0;t=t||256;p=p||256;s=s||null;v=v||null;this.type=g.TILESPRITE;this.physicsType=g.SPRITE;this._scroll=new g.Point();var u=r.cache.getImage("__default",true);PIXI.TilingSprite.call(this,new PIXI.Texture(u.base),t,p);g.Component.Core.init.call(this,r,q,w,s,v)};g.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);g.TileSprite.prototype.constructor=g.TileSprite;g.Component.Core.install.call(g.TileSprite.prototype,["Angle","Animation","AutoCull","Bounds","BringToTop","Destroy","FixedToCamera","Health","InCamera","InputEnabled","InWorld","LifeSpan","LoadTexture","Overlap","PhysicsBody","Reset","Smoothed"]);g.TileSprite.prototype.preUpdatePhysics=g.Component.PhysicsBody.preUpdate;g.TileSprite.prototype.preUpdateLifeSpan=g.Component.LifeSpan.preUpdate;g.TileSprite.prototype.preUpdateInWorld=g.Component.InWorld.preUpdate;g.TileSprite.prototype.preUpdateCore=g.Component.Core.preUpdate;g.TileSprite.prototype.preUpdate=function(){if(this._scroll.x!==0){this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed}if(this._scroll.y!==0){this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed}if(!this.preUpdatePhysics()||!this.preUpdateLifeSpan()||!this.preUpdateInWorld()){return false}return this.preUpdateCore()};g.TileSprite.prototype.autoScroll=function(p,q){this._scroll.set(p,q)};g.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};g.TileSprite.prototype.destroy=function(p){g.Component.Destroy.prototype.destroy.call(this,p);PIXI.TilingSprite.prototype.destroy.call(this)};g.TileSprite.prototype.reset=function(p,q){g.Component.Reset.prototype.reset.call(this,p,q);this.tilePosition.x=0;this.tilePosition.y=0;return this};g.Device=function(){this.deviceReadyAt=0;this.initialized=false;this.desktop=false;this.iOS=false;this.iOSVersion=0;this.cocoonJS=false;this.cocoonJSApp=false;this.cordova=false;this.node=false;this.nodeWebkit=false;this.electron=false;this.ejecta=false;this.crosswalk=false;this.android=false;this.chromeOS=false;this.linux=false;this.macOS=false;this.windows=false;this.windowsPhone=false;this.canvas=false;this.canvasBitBltShift=null;this.webGL=false;this.file=false;this.fileSystem=false;this.localStorage=false;this.worker=false;this.css3D=false;this.pointerLock=false;this.typedArray=false;this.vibration=false;this.getUserMedia=true;this.quirksMode=false;this.touch=false;this.mspointer=false;this.wheelEvent=null;this.arora=false;this.chrome=false;this.chromeVersion=0;this.epiphany=false;this.firefox=false;this.firefoxVersion=0;this.ie=false;this.ieVersion=0;this.trident=false;this.tridentVersion=0;this.edge=false;this.mobileSafari=false;this.midori=false;this.opera=false;this.safari=false;this.safariVersion=0;this.webApp=false;this.silk=false;this.audioData=false;this.webAudio=false;this.ogg=false;this.opus=false;this.mp3=false;this.wav=false;this.m4a=false;this.webm=false;this.dolby=false;this.oggVideo=false;this.h264Video=false;this.mp4Video=false;this.webmVideo=false;this.vp9Video=false;this.hlsVideo=false;this.iPhone=false;this.iPhone4=false;this.iPad=false;this.pixelRatio=0;this.littleEndian=false;this.LITTLE_ENDIAN=false;this.support32bit=false;this.fullscreen=false;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=false};g.Device=new g.Device();g.Device.onInitialized=new g.Signal();g.Device.whenReady=function(u,r,q){var s=this._readyCheck;if(this.deviceReadyAt||!s){u.call(r,this)}else{if(s._monitor||q){s._queue=s._queue||[];s._queue.push([u,r])}else{s._monitor=s.bind(this);s._queue=s._queue||[];s._queue.push([u,r]);var t=typeof window.cordova!=="undefined";var p=navigator.isCocoonJS;if(document.readyState==="complete"||document.readyState==="interactive"){window.setTimeout(s._monitor,0)}else{if(t&&!p){document.addEventListener("deviceready",s._monitor,false)}else{document.addEventListener("DOMContentLoaded",s._monitor,false);window.addEventListener("load",s._monitor,false)}}}}};g.Device._readyCheck=function(){var q=this._readyCheck;if(!document.body){window.setTimeout(q._monitor,20)}else{if(!this.deviceReadyAt){this.deviceReadyAt=Date.now();document.removeEventListener("deviceready",q._monitor);document.removeEventListener("DOMContentLoaded",q._monitor);window.removeEventListener("load",q._monitor);this._initialize();this.initialized=true;this.onInitialized.dispatch(this);var r;while((r=q._queue.shift())){var s=r[0];var p=r[1];s.call(p,this)}this._readyCheck=null;this._initialize=null;this.onInitialized=null}}};g.Device._initialize=function(){var s=this;function r(){var C=navigator.userAgent;if(/Playstation Vita/.test(C)){s.vita=true}else{if(/Kindle/.test(C)||/\bKF[A-Z][A-Z]+/.test(C)||/Silk.*Mobile Safari/.test(C)){s.kindle=true}else{if(/Android/.test(C)){s.android=true}else{if(/CrOS/.test(C)){s.chromeOS=true}else{if(/iP[ao]d|iPhone/i.test(C)){s.iOS=true;(navigator.appVersion).match(/OS (\d+)/);s.iOSVersion=parseInt(RegExp.$1,10)}else{if(/Linux/.test(C)){s.linux=true}else{if(/Mac OS/.test(C)){s.macOS=true}else{if(/Windows/.test(C)){s.windows=true}}}}}}}}if(/Windows Phone/i.test(C)||/IEMobile/i.test(C)){s.android=false;s.iOS=false;s.macOS=false;s.windows=true;s.windowsPhone=true}var B=/Silk/.test(C);if(s.windows||s.macOS||(s.linux&&!B)||s.chromeOS){s.desktop=true}if(s.windowsPhone||((/Windows NT/i.test(C))&&(/Touch/i.test(C)))){s.desktop=false}}function A(){s.canvas=!!window.CanvasRenderingContext2D||s.cocoonJS;try{s.localStorage=!!localStorage.getItem}catch(B){s.localStorage=false}s.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;s.fileSystem=!!window.requestFileSystem;s.webGL=(function(){try{var C=document.createElement("canvas");C.screencanvas=false;return !!window.WebGLRenderingContext&&(C.getContext("webgl")||C.getContext("experimental-webgl"))}catch(D){return false}})();s.webGL=!!s.webGL;s.worker=!!window.Worker;s.pointerLock="pointerLockElement" in document||"mozPointerLockElement" in document||"webkitPointerLockElement" in document;s.quirksMode=(document.compatMode==="CSS1Compat")?false:true;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;s.getUserMedia=s.getUserMedia&&!!navigator.getUserMedia&&!!window.URL;if(s.firefox&&s.firefoxVersion<21){s.getUserMedia=false}if(!s.iOS&&(s.ie||s.firefox||s.chrome)){s.canvasBitBltShift=true}if(s.safari||s.mobileSafari){s.canvasBitBltShift=false}}function z(){if("ontouchstart" in document.documentElement||(window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>=1)){s.touch=true}if(window.navigator.msPointerEnabled||window.navigator.pointerEnabled){s.mspointer=true}if(!s.cocoonJS){if("onwheel" in window||(s.ie&&"WheelEvent" in window)){s.wheelEvent="wheel"}else{if("onmousewheel" in window){s.wheelEvent="mousewheel"}else{if(s.firefox&&"MouseScrollEvent" in window){s.wheelEvent="DOMMouseScroll"}}}}}function x(){var C=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"];var E=document.createElement("div");for(var D=0;D<C.length;D++){if(E[C[D]]){s.fullscreen=true;s.requestFullscreen=C[D];break}}var B=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"];if(s.fullscreen){for(var D=0;D<B.length;D++){if(document[B[D]]){s.cancelFullscreen=B[D];break}}}if(window.Element&&Element.ALLOW_KEYBOARD_INPUT){s.fullscreenKeyboard=true}}function y(){var C=navigator.userAgent;if(/Arora/.test(C)){s.arora=true}else{if(/Edge\/\d+/.test(C)){s.edge=true}else{if(/Chrome\/(\d+)/.test(C)&&!s.windowsPhone){s.chrome=true;s.chromeVersion=parseInt(RegExp.$1,10)}else{if(/Epiphany/.test(C)){s.epiphany=true}else{if(/Firefox\D+(\d+)/.test(C)){s.firefox=true;s.firefoxVersion=parseInt(RegExp.$1,10)}else{if(/AppleWebKit/.test(C)&&s.iOS){s.mobileSafari=true}else{if(/MSIE (\d+\.\d+);/.test(C)){s.ie=true;s.ieVersion=parseInt(RegExp.$1,10)}else{if(/Midori/.test(C)){s.midori=true}else{if(/Opera/.test(C)){s.opera=true}else{if(/Safari\/(\d+)/.test(C)&&!s.windowsPhone){s.safari=true;if(/Version\/(\d+)\./.test(C)){s.safariVersion=parseInt(RegExp.$1,10)}}else{if(/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(C)){s.ie=true;s.trident=true;s.tridentVersion=parseInt(RegExp.$1,10);s.ieVersion=parseInt(RegExp.$3,10)}}}}}}}}}}}if(/Silk/.test(C)){s.silk=true}if(navigator.standalone){s.webApp=true}if(typeof window.cordova!=="undefined"){s.cordova=true}if(typeof process!=="undefined"&&typeof require!=="undefined"){s.node=true}if(s.node&&typeof process.versions==="object"){s.nodeWebkit=!!process.versions["node-webkit"];s.electron=!!process.versions.electron}if(navigator.isCocoonJS){s.cocoonJS=true}if(s.cocoonJS){try{s.cocoonJSApp=(typeof CocoonJS!=="undefined")}catch(B){s.cocoonJSApp=false}}if(typeof window.ejecta!=="undefined"){s.ejecta=true}if(/Crosswalk/.test(C)){s.crosswalk=true}}function t(){var C=document.createElement("video");var B=false;try{if(B=!!C.canPlayType){if(C.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")){s.oggVideo=true}if(C.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")){s.h264Video=true;s.mp4Video=true}if(C.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")){s.webmVideo=true}if(C.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")){s.vp9Video=true}if(C.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")){s.hlsVideo=true}}}catch(D){}}function w(){s.audioData=!!(window.Audio);s.webAudio=!!(window.AudioContext||window.webkitAudioContext);var F=document.createElement("audio");var B=false;try{if(B=!!F.canPlayType){if(F.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")){s.ogg=true}if(F.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||F.canPlayType("audio/opus;").replace(/^no$/,"")){s.opus=true}if(F.canPlayType("audio/mpeg;").replace(/^no$/,"")){s.mp3=true}if(F.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")){s.wav=true}if(F.canPlayType("audio/x-m4a;")||F.canPlayType("audio/aac;").replace(/^no$/,"")){s.m4a=true}if(F.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")){s.webm=true}if(F.canPlayType('audio/mp4;codecs="ec-3"')!==""){if(s.edge){s.dolby=true}else{if(s.safari&&s.safariVersion>=9){if(/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)){var C=parseInt(RegExp.$1,10);var D=parseInt(RegExp.$2,10);if((C===10&&D>=11)||C>10){s.dolby=true}}}}}}}catch(E){}}function v(){var C=new ArrayBuffer(4);var B=new Uint8Array(C);var D=new Uint32Array(C);B[0]=161;B[1]=178;B[2]=195;B[3]=212;if(D[0]===3569595041){return true}if(D[0]===2712847316){return false}else{return null}}function u(){if(Uint8ClampedArray===undefined){return false}var C=PIXI.CanvasPool.create(this,1,1);var B=C.getContext("2d");if(!B){return false}var D=B.createImageData(1,1);PIXI.CanvasPool.remove(this);return D.data instanceof Uint8ClampedArray}function p(){s.pixelRatio=window.devicePixelRatio||1;s.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!==-1;s.iPhone4=(s.pixelRatio===2&&s.iPhone);s.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!==-1;if(typeof Int8Array!=="undefined"){s.typedArray=true}else{s.typedArray=false}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"&&typeof Uint32Array!=="undefined"){s.littleEndian=v();s.LITTLE_ENDIAN=s.littleEndian}s.support32bit=(typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&s.littleEndian!==null&&u());navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;if(navigator.vibrate){s.vibration=true}}function q(){var D=document.createElement("p");var E;var C={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(D,null);for(var B in C){if(D.style[B]!==undefined){D.style[B]="translate3d(1px,1px,1px)";E=window.getComputedStyle(D).getPropertyValue(C[B])}}document.body.removeChild(D);s.css3D=(E!==undefined&&E.length>0&&E!=="none")}r();y();w();t();q();p();A();x();z()};g.Device.canPlayAudio=function(p){if(p==="mp3"&&this.mp3){return true}else{if(p==="ogg"&&(this.ogg||this.opus)){return true}else{if(p==="m4a"&&this.m4a){return true}else{if(p==="opus"&&this.opus){return true}else{if(p==="wav"&&this.wav){return true}else{if(p==="webm"&&this.webm){return true}else{if(p==="mp4"&&this.dolby){return true}}}}}}}return false};g.Device.canPlayVideo=function(p){if(p==="webm"&&(this.webmVideo||this.vp9Video)){return true}else{if(p==="mp4"&&(this.mp4Video||this.h264Video)){return true}else{if((p==="ogg"||p==="ogv")&&this.oggVideo){return true}else{if(p==="mpeg"&&this.hlsVideo){return true}}}}return false};g.Device.isConsoleOpen=function(){if(window.console&&window.console.firebug){return true}if(window.console){console.profile();console.profileEnd();if(console.clear){console.clear()}if(console.profiles){return console.profiles.length>0}}return false};g.Device.isAndroidStockBrowser=function(){var p=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return p&&p[1]<537};g.Canvas={create:function(t,s,p,u,r){s=s||256;p=p||256;var q=(r)?document.createElement("canvas"):PIXI.CanvasPool.create(t,s,p);if(typeof u==="string"&&u!==""){q.id=u}q.width=s;q.height=p;q.style.display="block";return q},setBackgroundColor:function(q,p){p=p||"rgb(0,0,0)";q.style.backgroundColor=p;return q},setTouchAction:function(p,q){q=q||"none";p.style.msTouchAction=q;p.style["ms-touch-action"]=q;p.style["touch-action"]=q;return p},setUserSelect:function(p,q){q=q||"none";p.style["-webkit-touch-callout"]=q;p.style["-webkit-user-select"]=q;p.style["-khtml-user-select"]=q;p.style["-moz-user-select"]=q;p.style["-ms-user-select"]=q;p.style["user-select"]=q;p.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)";return p},addToDOM:function(p,q,s){var r;if(s===undefined){s=true}if(q){if(typeof q==="string"){r=document.getElementById(q)}else{if(typeof q==="object"&&q.nodeType===1){r=q}}}if(!r){r=document.body}if(s&&r.style){r.style.overflow="hidden"}r.appendChild(p);return p},removeFromDOM:function(p){if(p.parentNode){p.parentNode.removeChild(p)}},setTransform:function(t,v,u,r,p,s,q){t.setTransform(r,s,q,p,v,u);return t},setSmoothingEnabled:function(p,r){var q=g.Canvas.getSmoothingPrefix(p);if(q){p[q]=r}return p},getSmoothingPrefix:function(p){var t=["i","webkitI","msI","mozI","oI"];for(var r in t){var q=t[r]+"mageSmoothingEnabled";if(q in p){return q}}return null},getSmoothingEnabled:function(p){var q=g.Canvas.getSmoothingPrefix(p);if(q){return p[q]}},setImageRenderingCrisp:function(p){var r=["optimizeSpeed","crisp-edges","-moz-crisp-edges","-webkit-optimize-contrast","optimize-contrast","pixelated"];for(var q=0;q<r.length;q++){p.style["image-rendering"]=r[q]}p.style.msInterpolationMode="nearest-neighbor";return p},setImageRenderingBicubic:function(p){p.style["image-rendering"]="auto";p.style.msInterpolationMode="bicubic";return p}};g.RequestAnimationFrame=function(q,r){if(r===undefined){r=false}this.game=q;this.isRunning=false;this.forceSetTimeOut=r;var s=["ms","moz","webkit","o"];for(var p=0;p<s.length&&!window.requestAnimationFrame;p++){window.requestAnimationFrame=window[s[p]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[s[p]+"CancelAnimationFrame"]}this._isSetTimeOut=false;this._onLoop=null;this._timeOutID=null};g.RequestAnimationFrame.prototype={start:function(){this.isRunning=true;var p=this;if(!window.requestAnimationFrame||this.forceSetTimeOut){this._isSetTimeOut=true;this._onLoop=function(){return p.updateSetTimeout()};this._timeOutID=window.setTimeout(this._onLoop,0)}else{this._isSetTimeOut=false;this._onLoop=function(q){return p.updateRAF(q)};this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateRAF:function(p){if(this.isRunning){this.game.update(Math.floor(p));this._timeOutID=window.requestAnimationFrame(this._onLoop)}},updateSetTimeout:function(){if(this.isRunning){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)}},stop:function(){if(this._isSetTimeOut){clearTimeout(this._timeOutID)}else{window.cancelAnimationFrame(this._timeOutID)}this.isRunning=false},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return(this._isSetTimeOut===false)}};g.RequestAnimationFrame.prototype.constructor=g.RequestAnimationFrame;g.Math={PI2:Math.PI*2,between:function(q,p){return Math.floor(Math.random()*(p-q+1)+q)},fuzzyEqual:function(q,p,r){if(r===undefined){r=0.0001}return Math.abs(q-p)<r},fuzzyLessThan:function(q,p,r){if(r===undefined){r=0.0001}return q<p+r},fuzzyGreaterThan:function(q,p,r){if(r===undefined){r=0.0001}return q>p-r},fuzzyCeil:function(p,q){if(q===undefined){q=0.0001}return Math.ceil(p-q)},fuzzyFloor:function(p,q){if(q===undefined){q=0.0001}return Math.floor(p+q)},average:function(){var r=0;var p=arguments.length;for(var q=0;q<p;q++){r+=(+arguments[q])}return r/p},shear:function(p){return p%1},snapTo:function(p,r,q){if(q===undefined){q=0}if(r===0){return p}p-=q;p=r*Math.round(p/r);return q+p},snapToFloor:function(p,r,q){if(q===undefined){q=0}if(r===0){return p}p-=q;p=r*Math.floor(p/r);return q+p},snapToCeil:function(p,r,q){if(q===undefined){q=0}if(r===0){return p}p-=q;p=r*Math.ceil(p/r);return q+p},roundTo:function(s,q,r){if(q===undefined){q=0}if(r===undefined){r=10}var t=Math.pow(r,-q);return Math.round(s*t)/t},floorTo:function(s,q,r){if(q===undefined){q=0}if(r===undefined){r=10}var t=Math.pow(r,-q);return Math.floor(s*t)/t},ceilTo:function(s,q,r){if(q===undefined){q=0}if(r===undefined){r=10}var t=Math.pow(r,-q);return Math.ceil(s*t)/t},rotateToAngle:function(q,r,p){if(p===undefined){p=0.05}if(q===r){return q}if(Math.abs(r-q)<=p||Math.abs(r-q)>=(g.Math.PI2-p)){q=r}else{if(Math.abs(r-q)>Math.PI){if(r<q){r+=g.Math.PI2}else{r-=g.Math.PI2}}if(r>q){q+=p}else{if(r<q){q-=p}}}return q},getShortestAngle:function(r,p){var s=p-r;if(s===0){return 0}var q=Math.floor((s-(-180))/360);return s-(q*360)},angleBetween:function(q,s,p,r){return Math.atan2(r-s,p-q)},angleBetweenY:function(q,s,p,r){return Math.atan2(p-q,r-s)},angleBetweenPoints:function(q,p){return Math.atan2(p.y-q.y,p.x-q.x)},angleBetweenPointsY:function(q,p){return Math.atan2(p.x-q.x,p.y-q.y)},reverseAngle:function(p){return this.normalizeAngle(p+Math.PI,true)},normalizeAngle:function(p){p=p%(2*Math.PI);return p>=0?p:p+2*Math.PI},maxAdd:function(r,q,p){return Math.min(r+q,p)},minSub:function(r,q,p){return Math.max(r-q,p)},wrap:function(t,s,q){var r=q-s;if(r<=0){return 0}var p=(t-s)%r;if(p<0){p+=r}return p+s},wrapValue:function(r,q,p){var s;r=Math.abs(r);q=Math.abs(q);p=Math.abs(p);s=(r+q)%p;return s},isOdd:function(p){return !!(p&1)},isEven:function(p){return !(p&1)},min:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var s=arguments[0]}else{var s=arguments}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r]<s[q]){q=r}}return s[q]},max:function(){if(arguments.length===1&&typeof arguments[0]==="object"){var s=arguments[0]}else{var s=arguments}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r]>s[q]){q=r}}return s[q]},minProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var s=arguments[1]}else{var s=arguments.slice(1)}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r][t]<s[q][t]){q=r}}return s[q][t]},maxProperty:function(t){if(arguments.length===2&&typeof arguments[1]==="object"){var s=arguments[1]}else{var s=arguments.slice(1)}for(var r=1,q=0,p=s.length;r<p;r++){if(s[r][t]>s[q][t]){q=r}}return s[q][t]},wrapAngle:function(q,p){return p?this.wrap(q,-Math.PI,Math.PI):this.wrap(q,-180,180)},linearInterpolation:function(r,q){var p=r.length-1;var t=p*q;var s=Math.floor(t);if(q<0){return this.linear(r[0],r[1],t)}if(q>1){return this.linear(r[p],r[p-1],p-t)}return this.linear(r[s],r[s+1>p?p:s+1],t-s)},bezierInterpolation:function(r,q){var p=0;var t=r.length-1;for(var s=0;s<=t;s++){p+=Math.pow(1-q,t-s)*Math.pow(q,s)*r[s]*this.bernstein(t,s)}return p},catmullRomInterpolation:function(r,q){var p=r.length-1;var t=p*q;var s=Math.floor(t);if(r[0]===r[p]){if(q<0){s=Math.floor(t=p*(1+q))}return this.catmullRom(r[(s-1+p)%p],r[s],r[(s+1)%p],r[(s+2)%p],t-s)}else{if(q<0){return r[0]-(this.catmullRom(r[0],r[0],r[1],r[1],-t)-r[0])}if(q>1){return r[p]-(this.catmullRom(r[p],r[p],r[p-1],r[p-1],t-p)-r[p])}return this.catmullRom(r[s?s-1:0],r[s],r[p<s+1?p:s+1],r[p<s+2?p:s+2],t-s)}},linear:function(r,q,p){return(q-r)*p+r},bernstein:function(q,p){return this.factorial(q)/this.factorial(p)/this.factorial(q-p)},factorial:function(q){if(q===0){return 1}var p=q;while(--q){p*=q}return p},catmullRom:function(x,w,u,s,y){var v=(u-x)*0.5,r=(s-w)*0.5,q=y*y,p=y*q;return(2*w-2*u+v+r)*p+(-3*w+3*u-2*v-r)*q+v*y+w},difference:function(q,p){return Math.abs(q-p)},roundAwayFromZero:function(p){return(p>0)?Math.ceil(p):Math.floor(p)},sinCosGenerator:function(p,w,q,u){if(w===undefined){w=1}if(q===undefined){q=1}if(u===undefined){u=1}var v=w;var y=q;var s=u*Math.PI/p;var r=[];var x=[];for(var t=0;t<p;t++){y-=v*s;v+=y*s;r[t]=y;x[t]=v}return{sin:x,cos:r,length:p}},distance:function(s,u,r,t){var q=s-r;var p=u-t;return Math.sqrt(q*q+p*p)},distanceSq:function(s,u,r,t){var q=s-r;var p=u-t;return q*q+p*p},distancePow:function(q,s,p,r,t){if(t===undefined){t=2}return Math.sqrt(Math.pow(p-q,t)+Math.pow(r-s,t))},clamp:function(q,r,p){if(q<r){return r}else{if(p<q){return p}else{return q}}},clampBottom:function(p,q){return p<q?q:p},within:function(q,p,r){return(Math.abs(q-p)<=r)},mapLinear:function(q,r,p,t,s){return t+(q-r)*(s-t)/(p-r)},smoothstep:function(q,r,p){q=Math.max(0,Math.min(1,(q-r)/(p-r)));return q*q*(3-2*q)},smootherstep:function(q,r,p){q=Math.max(0,Math.min(1,(q-r)/(p-r)));return q*q*q*(q*(q*6-15)+10)},sign:function(p){return(p<0)?-1:((p>0)?1:0)},percent:function(q,p,r){if(r===undefined){r=0}if(q>p||r>p){return 1}else{if(q<r||r>q){return 0}else{return(q-r)/p}}}};var f=Math.PI/180;var c=180/Math.PI;g.Math.degToRad=function o(p){return p*f};g.Math.radToDeg=function h(p){return p*c};g.RandomDataGenerator=function(p){if(p===undefined){p=[]}this.c=1;this.s0=0;this.s1=0;this.s2=0;if(typeof p==="string"){this.state(p)}else{this.sow(p)}};g.RandomDataGenerator.prototype={rnd:function(){var p=2091639*this.s0+this.c*2.3283064365386963e-10;this.c=p|0;this.s0=this.s1;this.s1=this.s2;this.s2=p-this.c;return this.s2},sow:function(q){this.s0=this.hash(" ");this.s1=this.hash(this.s0);this.s2=this.hash(this.s1);this.c=1;if(!q){return}for(var r=0;r<q.length&&(q[r]!=null);r++){var p=q[r];this.s0-=this.hash(p);this.s0+=~~(this.s0<0);this.s1-=this.hash(p);this.s1+=~~(this.s1<0);this.s2-=this.hash(p);this.s2+=~~(this.s2<0)}},hash:function(r){var q,p,s;s=4022871197;r=r.toString();for(p=0;p<r.length;p++){s+=r.charCodeAt(p);q=0.02519603282416938*s;s=q>>>0;q-=s;q*=s;s=q>>>0;q-=s;s+=q*4294967296}return(s>>>0)*2.3283064365386963e-10},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*1.1102230246251565e-16},real:function(){return this.integer()+this.frac()},integerInRange:function(q,p){return Math.floor(this.realInRange(0,p-q+1)+q)},between:function(q,p){return this.integerInRange(q,p)},realInRange:function(q,p){return this.frac()*(p-q)+q},normal:function(){return 1-2*this.frac()},uuid:function(){var q="";var p="";for(p=q="";q++<36;p+=~q%5|q*3&4?(q^15?8^this.frac()*(q^20?16:4):4).toString(16):"-"){}return p},pick:function(p){return p[this.integerInRange(0,p.length-1)]},sign:function(){return this.pick([-1,1])},weightedPick:function(p){return p[~~(Math.pow(this.frac(),2)*(p.length-1)+0.5)]},timestamp:function(q,p){return this.realInRange(q||946684800000,p||1577862000000)},angle:function(){return this.integerInRange(-180,180)},state:function(p){if(typeof p==="string"&&p.match(/^!rnd/)){p=p.split(",");this.c=parseFloat(p[1]);this.s0=parseFloat(p[2]);this.s1=parseFloat(p[3]);this.s2=parseFloat(p[4])}return["!rnd",this.c,this.s0,this.s1,this.s2].join(",")}};g.RandomDataGenerator.prototype.constructor=g.RandomDataGenerator;g.QuadTree=function(q,v,t,p,s,r,u){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(q,v,t,p,s,r,u)};g.QuadTree.prototype={reset:function(q,v,t,p,s,r,u){this.maxObjects=s||10;this.maxLevels=r||4;this.level=u||0;this.bounds={x:Math.round(q),y:Math.round(v),width:t,height:p,subWidth:Math.floor(t/2),subHeight:Math.floor(p/2),right:Math.round(q)+Math.floor(t/2),bottom:Math.round(v)+Math.floor(p/2)};this.objects.length=0;this.nodes.length=0},populate:function(p){p.forEach(this.populateHandler,this,true)},populateHandler:function(p){if(p.body&&p.exists){this.insert(p.body)}},split:function(){this.nodes[0]=new g.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[1]=new g.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[2]=new g.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1));this.nodes[3]=new g.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,(this.level+1))},insert:function(p){var r=0;var q;if(this.nodes[0]!=null){q=this.getIndex(p);if(q!==-1){this.nodes[q].insert(p);return}}this.objects.push(p);if(this.objects.length>this.maxObjects&&this.level<this.maxLevels){if(this.nodes[0]==null){this.split()}while(r<this.objects.length){q=this.getIndex(this.objects[r]);if(q!==-1){this.nodes[q].insert(this.objects.splice(r,1)[0])}else{r++}}}},getIndex:function(q){var p=-1;if(q.x<this.bounds.right&&q.right<this.bounds.right){if(q.y<this.bounds.bottom&&q.bottom<this.bounds.bottom){p=1}else{if(q.y>this.bounds.bottom){p=2}}}else{if(q.x>this.bounds.right){if(q.y<this.bounds.bottom&&q.bottom<this.bounds.bottom){p=0}else{if(q.y>this.bounds.bottom){p=3}}}}return p},retrieve:function(q){if(q instanceof g.Rectangle){var r=this.objects;var p=this.getIndex(q)}else{if(!q.body){return this._empty}var r=this.objects;var p=this.getIndex(q.body)}if(this.nodes[0]){if(p!==-1){r=r.concat(this.nodes[p].retrieve(q))}else{r=r.concat(this.nodes[0].retrieve(q));r=r.concat(this.nodes[1].retrieve(q));r=r.concat(this.nodes[2].retrieve(q));r=r.concat(this.nodes[3].retrieve(q))}}return r},clear:function(){this.objects.length=0;var p=this.nodes.length;while(p--){this.nodes[p].clear();this.nodes.splice(p,1)}this.nodes.length=0}};g.QuadTree.prototype.constructor=g.QuadTree;g.Net=function(p){this.game=p};g.Net.prototype={getHostName:function(){if(window.location&&window.location.hostname){return window.location.hostname}return null},checkDomainName:function(p){return window.location.hostname.indexOf(p)!==-1},updateQueryString:function(r,t,w,q){if(w===undefined){w=false}if(q===undefined||q===""){q=window.location.href}var p="";var s=new RegExp("([?|&])"+r+"=.*?(&|#|$)(.*)","gi");if(s.test(q)){if(typeof t!=="undefined"&&t!==null){p=q.replace(s,"$1"+r+"="+t+"$2$3")}else{p=q.replace(s,"$1$3").replace(/(&|\?)$/,"")}}else{if(typeof t!=="undefined"&&t!==null){var v=q.indexOf("?")!==-1?"&":"?";var u=q.split("#");q=u[0]+v+r+"="+t;if(u[1]){q+="#"+u[1]}p=q}else{p=q}}if(w){window.location.href=p}else{return p}},getQueryString:function(t){if(t===undefined){t=""}var q={};var p=location.search.substring(1).split("&");for(var s in p){var r=p[s].split("=");if(r.length>1){if(t&&t===this.decodeURI(r[0])){return this.decodeURI(r[1])}else{q[this.decodeURI(r[0])]=this.decodeURI(r[1])}}}return q},decodeURI:function(p){return decodeURIComponent(p.replace(/\+/g," "))}};g.Net.prototype.constructor=g.Net;g.TweenManager=function(p){this.game=p;this.frameBased=false;this._tweens=[];this._add=[];this.easeMap={Power0:g.Easing.Power0,Power1:g.Easing.Power1,Power2:g.Easing.Power2,Power3:g.Easing.Power3,Power4:g.Easing.Power4,Linear:g.Easing.Linear.None,Quad:g.Easing.Quadratic.Out,Cubic:g.Easing.Cubic.Out,Quart:g.Easing.Quartic.Out,Quint:g.Easing.Quintic.Out,Sine:g.Easing.Sinusoidal.Out,Expo:g.Easing.Exponential.Out,Circ:g.Easing.Circular.Out,Elastic:g.Easing.Elastic.Out,Back:g.Easing.Back.Out,Bounce:g.Easing.Bounce.Out,"Quad.easeIn":g.Easing.Quadratic.In,"Cubic.easeIn":g.Easing.Cubic.In,"Quart.easeIn":g.Easing.Quartic.In,"Quint.easeIn":g.Easing.Quintic.In,"Sine.easeIn":g.Easing.Sinusoidal.In,"Expo.easeIn":g.Easing.Exponential.In,"Circ.easeIn":g.Easing.Circular.In,"Elastic.easeIn":g.Easing.Elastic.In,"Back.easeIn":g.Easing.Back.In,"Bounce.easeIn":g.Easing.Bounce.In,"Quad.easeOut":g.Easing.Quadratic.Out,"Cubic.easeOut":g.Easing.Cubic.Out,"Quart.easeOut":g.Easing.Quartic.Out,"Quint.easeOut":g.Easing.Quintic.Out,"Sine.easeOut":g.Easing.Sinusoidal.Out,"Expo.easeOut":g.Easing.Exponential.Out,"Circ.easeOut":g.Easing.Circular.Out,"Elastic.easeOut":g.Easing.Elastic.Out,"Back.easeOut":g.Easing.Back.Out,"Bounce.easeOut":g.Easing.Bounce.Out,"Quad.easeInOut":g.Easing.Quadratic.InOut,"Cubic.easeInOut":g.Easing.Cubic.InOut,"Quart.easeInOut":g.Easing.Quartic.InOut,"Quint.easeInOut":g.Easing.Quintic.InOut,"Sine.easeInOut":g.Easing.Sinusoidal.InOut,"Expo.easeInOut":g.Easing.Exponential.InOut,"Circ.easeInOut":g.Easing.Circular.InOut,"Elastic.easeInOut":g.Easing.Elastic.InOut,"Back.easeInOut":g.Easing.Back.InOut,"Bounce.easeInOut":g.Easing.Bounce.InOut};this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};g.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var p=0;p<this._tweens.length;p++){this._tweens[p].pendingDelete=true}this._add=[]},removeFrom:function(s,r){if(r===undefined){r=true}var q;var p;if(Array.isArray(s)){for(q=0,p=s.length;q<p;q++){this.removeFrom(s[q])}}else{if(s.type===g.GROUP&&r){for(var q=0,p=s.children.length;q<p;q++){this.removeFrom(s.children[q])}}else{for(q=0,p=this._tweens.length;q<p;q++){if(s===this._tweens[q].target){this.remove(this._tweens[q])}}for(q=0,p=this._add.length;q<p;q++){if(s===this._add[q].target){this.remove(this._add[q])}}}}},add:function(p){p._manager=this;this._add.push(p)},create:function(p){return new g.Tween(p,this.game,this)},remove:function(q){var p=this._tweens.indexOf(q);if(p!==-1){this._tweens[p].pendingDelete=true}else{p=this._add.indexOf(q);if(p!==-1){this._add[p].pendingDelete=true}}},update:function(){var r=this._add.length;var q=this._tweens.length;if(q===0&&r===0){return false}var p=0;while(p<q){if(this._tweens[p].update(this.game.time.time)){p++}else{this._tweens.splice(p,1);q--}}if(r>0){this._tweens=this._tweens.concat(this._add);this._add.length=0}return true},isTweening:function(p){return this._tweens.some(function(q){return q.target===p})},_pauseAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p]._pause()}},_resumeAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p]._resume()}},pauseAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p].pause()}},resumeAll:function(){for(var p=this._tweens.length-1;p>=0;p--){this._tweens[p].resume(true)}}};g.TweenManager.prototype.constructor=g.TweenManager;g.Tween=function(r,p,q){this.game=p;this.target=r;this.manager=q;this.timeline=[];this.reverse=false;this.timeScale=1;this.repeatCounter=0;this.pendingDelete=false;this.onStart=new g.Signal();this.onLoop=new g.Signal();this.onRepeat=new g.Signal();this.onChildComplete=new g.Signal();this.onComplete=new g.Signal();this.isRunning=false;this.current=0;this.properties={};this.chainedTween=null;this.isPaused=false;this.frameBased=q.frameBased;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._pausedTime=0;this._codePaused=false;this._hasStarted=false};g.Tween.prototype={to:function(r,u,v,q,p,t,s){if(u===undefined||u<=0){u=1000}if(v===undefined||v===null){v=g.Easing.Default}if(q===undefined){q=false}if(p===undefined){p=0}if(t===undefined){t=0}if(s===undefined){s=false}if(typeof v==="string"&&this.manager.easeMap[v]){v=this.manager.easeMap[v]}if(this.isRunning){console.warn("Phaser.Tween.to cannot be called after Tween.start");return this}this.timeline.push(new g.TweenData(this).to(r,u,v,p,t,s));if(q){this.start()}return this},from:function(r,u,v,q,p,t,s){if(u===undefined){u=1000}if(v===undefined||v===null){v=g.Easing.Default}if(q===undefined){q=false}if(p===undefined){p=0}if(t===undefined){t=0}if(s===undefined){s=false}if(typeof v==="string"&&this.manager.easeMap[v]){v=this.manager.easeMap[v]}if(this.isRunning){console.warn("Phaser.Tween.from cannot be called after Tween.start");return this}this.timeline.push(new g.TweenData(this).from(r,u,v,p,t,s));if(q){this.start()}return this},start:function(p){if(p===undefined){p=0}if(this.game===null||this.target===null||this.timeline.length===0||this.isRunning){return this}for(var q=0;q<this.timeline.length;q++){for(var r in this.timeline[q].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var q=0;q<this.timeline.length;q++){this.timeline[q].loadValues()}this.manager.add(this);this.isRunning=true;if(p<0||p>this.timeline.length-1){p=0}this.current=p;this.timeline[this.current].start();return this},stop:function(p){if(p===undefined){p=false}this.isRunning=false;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;if(p){this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}}this.manager.remove(this);return this},updateTweenData:function(s,r,p){if(this.timeline.length===0){return this}if(p===undefined){p=0}if(p===-1){for(var q=0;q<this.timeline.length;q++){this.timeline[q][s]=r}}else{this.timeline[p][s]=r}return this},delay:function(q,p){return this.updateTweenData("delay",q,p)},repeat:function(q,r,p){if(r===undefined){r=0}this.updateTweenData("repeatCounter",q,p);return this.updateTweenData("repeatDelay",r,p)},repeatDelay:function(q,p){return this.updateTweenData("repeatDelay",q,p)},yoyo:function(q,r,p){if(r===undefined){r=0}this.updateTweenData("yoyo",q,p);return this.updateTweenData("yoyoDelay",r,p)},yoyoDelay:function(q,p){return this.updateTweenData("yoyoDelay",q,p)},easing:function(q,p){if(typeof q==="string"&&this.manager.easeMap[q]){q=this.manager.easeMap[q]}return this.updateTweenData("easingFunction",q,p)},interpolation:function(p,r,q){if(r===undefined){r=g.Math}this.updateTweenData("interpolationFunction",p,q);return this.updateTweenData("interpolationContext",r,q)},repeatAll:function(p){if(p===undefined){p=0}this.repeatCounter=p;return this},chain:function(){var p=arguments.length;while(p--){if(p>0){arguments[p-1].chainedTween=arguments[p]}else{this.chainedTween=arguments[p]}}return this},loop:function(p){if(p===undefined){p=true}this.repeatCounter=(p)?-1:0;return this},onUpdateCallback:function(q,p){this._onUpdateCallback=q;this._onUpdateCallbackContext=p;return this},pause:function(){this.isPaused=true;this._codePaused=true;this._pausedTime=this.game.time.time},_pause:function(){if(!this._codePaused){this.isPaused=true;this._pausedTime=this.game.time.time}},resume:function(){if(this.isPaused){this.isPaused=false;this._codePaused=false;for(var p=0;p<this.timeline.length;p++){if(!this.timeline[p].isRunning){this.timeline[p].startTime+=(this.game.time.time-this._pausedTime)}}}},_resume:function(){if(this._codePaused){return}else{this.resume()}},update:function(r){if(this.pendingDelete||!this.target){return false}if(this.isPaused){return true}var q=this.timeline[this.current].update(r);if(q===g.TweenData.PENDING){return true}else{if(q===g.TweenData.RUNNING){if(!this._hasStarted){this.onStart.dispatch(this.target,this);this._hasStarted=true}if(this._onUpdateCallback!==null){this._onUpdateCallback.call(this._onUpdateCallbackContext,this,this.timeline[this.current].value,this.timeline[this.current])}return this.isRunning}else{if(q===g.TweenData.LOOPED){if(this.timeline[this.current].repeatCounter===-1){this.onLoop.dispatch(this.target,this)}else{this.onRepeat.dispatch(this.target,this)}return true}else{if(q===g.TweenData.COMPLETE){var p=false;if(this.reverse){this.current--;if(this.current<0){this.current=this.timeline.length-1;p=true}}else{this.current++;if(this.current===this.timeline.length){this.current=0;p=true}}if(p){if(this.repeatCounter===-1){this.timeline[this.current].start();this.onLoop.dispatch(this.target,this);return true}else{if(this.repeatCounter>0){this.repeatCounter--;this.timeline[this.current].start();this.onRepeat.dispatch(this.target,this);return true}else{this.isRunning=false;this.onComplete.dispatch(this.target,this);this._hasStarted=false;if(this.chainedTween){this.chainedTween.start()}return false}}}else{this.onChildComplete.dispatch(this.target,this);this.timeline[this.current].start();return true}}}}}},generateData:function(p,s){if(this.game===null||this.target===null){return null}if(p===undefined){p=60}if(s===undefined){s=[]}for(var q=0;q<this.timeline.length;q++){for(var r in this.timeline[q].vEnd){this.properties[r]=this.target[r]||0;if(!Array.isArray(this.properties[r])){this.properties[r]*=1}}}for(var q=0;q<this.timeline.length;q++){this.timeline[q].loadValues()}for(var q=0;q<this.timeline.length;q++){s=s.concat(this.timeline[q].generateData(p))}return s}};Object.defineProperty(g.Tween.prototype,"totalDuration",{get:function(){var q=0;for(var p=0;p<this.timeline.length;p++){q+=this.timeline[p].duration}return q}});g.Tween.prototype.constructor=g.Tween;g.TweenData=function(p){this.parent=p;this.game=p.game;this.vStart={};this.vStartCache={};this.vEnd={};this.vEndCache={};this.duration=1000;this.percent=0;this.value=0;this.repeatCounter=0;this.repeatDelay=0;this.repeatTotal=0;this.interpolate=false;this.yoyo=false;this.yoyoDelay=0;this.inReverse=false;this.delay=0;this.dt=0;this.startTime=null;this.easingFunction=g.Easing.Default;this.interpolationFunction=g.Math.linearInterpolation;this.interpolationContext=g.Math;this.isRunning=false;this.isFrom=false};g.TweenData.PENDING=0;g.TweenData.RUNNING=1;g.TweenData.LOOPED=2;g.TweenData.COMPLETE=3;g.TweenData.prototype={to:function(q,t,u,p,s,r){this.vEnd=q;this.duration=t;this.easingFunction=u;this.delay=p;this.repeatTotal=s;this.yoyo=r;this.isFrom=false;return this},from:function(q,t,u,p,s,r){this.vEnd=q;this.duration=t;this.easingFunction=u;this.delay=p;this.repeatTotal=s;this.yoyo=r;this.isFrom=true;return this},start:function(){this.startTime=this.game.time.time+this.delay;if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}if(this.delay>0){this.isRunning=false}else{this.isRunning=true}if(this.isFrom){for(var p in this.vStartCache){this.vStart[p]=this.vEndCache[p];this.vEnd[p]=this.vStartCache[p];this.parent.target[p]=this.vStart[p]}}this.value=0;this.yoyoCounter=0;this.repeatCounter=this.repeatTotal;return this},loadValues:function(){for(var p in this.parent.properties){this.vStart[p]=this.parent.properties[p];if(Array.isArray(this.vEnd[p])){if(this.vEnd[p].length===0){continue}if(this.percent===0){this.vEnd[p]=[this.vStart[p]].concat(this.vEnd[p])}}if(typeof this.vEnd[p]!=="undefined"){if(typeof this.vEnd[p]==="string"){this.vEnd[p]=this.vStart[p]+parseFloat(this.vEnd[p],10)}this.parent.properties[p]=this.vEnd[p]}else{this.vEnd[p]=this.vStart[p]}this.vStartCache[p]=this.vStart[p];this.vEndCache[p]=this.vEnd[p]}return this},update:function(s){if(!this.isRunning){if(s>=this.startTime){this.isRunning=true}else{return g.TweenData.PENDING}}else{if(s<this.startTime){return g.TweenData.RUNNING}}var q=(this.parent.frameBased)?this.game.time.physicsElapsedMS:this.game.time.elapsedMS;if(this.parent.reverse){this.dt-=q*this.parent.timeScale;this.dt=Math.max(this.dt,0)}else{this.dt+=q*this.parent.timeScale;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);for(var r in this.vEnd){var t=this.vStart[r];var p=this.vEnd[r];if(Array.isArray(p)){this.parent.target[r]=this.interpolationFunction.call(this.interpolationContext,p,this.value)}else{this.parent.target[r]=t+((p-t)*this.value)}}if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){return this.repeat()}return g.TweenData.RUNNING},generateData:function(x){if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}var v=[];var r=false;var s=(1/x)*1000;do{if(this.parent.reverse){this.dt-=s;this.dt=Math.max(this.dt,0)}else{this.dt+=s;this.dt=Math.min(this.dt,this.duration)}this.percent=this.dt/this.duration;this.value=this.easingFunction(this.percent);var p={};for(var w in this.vEnd){var q=this.vStart[w];var t=this.vEnd[w];if(Array.isArray(t)){p[w]=this.interpolationFunction(t,this.value)}else{p[w]=q+((t-q)*this.value)}}v.push(p);if((!this.parent.reverse&&this.percent===1)||(this.parent.reverse&&this.percent===0)){r=true}}while(!r);if(this.yoyo){var u=v.slice();u.reverse();v=v.concat(u)}return v},repeat:function(){if(this.yoyo){if(this.inReverse&&this.repeatCounter===0){for(var p in this.vStartCache){this.vStart[p]=this.vStartCache[p];this.vEnd[p]=this.vEndCache[p]}this.inReverse=false;return g.TweenData.COMPLETE}this.inReverse=!this.inReverse}else{if(this.repeatCounter===0){return g.TweenData.COMPLETE}}if(this.inReverse){for(var p in this.vStartCache){this.vStart[p]=this.vEndCache[p];this.vEnd[p]=this.vStartCache[p]}}else{for(var p in this.vStartCache){this.vStart[p]=this.vStartCache[p];this.vEnd[p]=this.vEndCache[p]}if(this.repeatCounter>0){this.repeatCounter--}}this.startTime=this.game.time.time;if(this.yoyo&&this.inReverse){this.startTime+=this.yoyoDelay}else{if(!this.inReverse){this.startTime+=this.repeatDelay}}if(this.parent.reverse){this.dt=this.duration}else{this.dt=0}return g.TweenData.LOOPED}};g.TweenData.prototype.constructor=g.TweenData;g.Easing={Linear:{None:function(p){return p}},Quadratic:{In:function(p){return p*p},Out:function(p){return p*(2-p)},InOut:function(p){if((p*=2)<1){return 0.5*p*p}return -0.5*(--p*(p-2)-1)}},Cubic:{In:function(p){return p*p*p},Out:function(p){return --p*p*p+1},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p}return 0.5*((p-=2)*p*p+2)}},Quartic:{In:function(p){return p*p*p*p},Out:function(p){return 1-(--p*p*p*p)},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p*p}return -0.5*((p-=2)*p*p*p-2)}},Quintic:{In:function(p){return p*p*p*p*p},Out:function(p){return --p*p*p*p*p+1},InOut:function(p){if((p*=2)<1){return 0.5*p*p*p*p*p}return 0.5*((p-=2)*p*p*p*p+2)}},Sinusoidal:{In:function(p){if(p===0){return 0}if(p===1){return 1}return 1-Math.cos(p*Math.PI/2)},Out:function(p){if(p===0){return 0}if(p===1){return 1}return Math.sin(p*Math.PI/2)},InOut:function(p){if(p===0){return 0}if(p===1){return 1}return 0.5*(1-Math.cos(Math.PI*p))}},Exponential:{In:function(p){return p===0?0:Math.pow(1024,p-1)},Out:function(p){return p===1?1:1-Math.pow(2,-10*p)},InOut:function(p){if(p===0){return 0}if(p===1){return 1}if((p*=2)<1){return 0.5*Math.pow(1024,p-1)}return 0.5*(-Math.pow(2,-10*(p-1))+2)}},Circular:{In:function(p){return 1-Math.sqrt(1-p*p)},Out:function(p){return Math.sqrt(1-(--p*p))},InOut:function(p){if((p*=2)<1){return -0.5*(Math.sqrt(1-p*p)-1)}return 0.5*(Math.sqrt(1-(p-=2)*p)+1)}},Elastic:{In:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}return -(q*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u))},Out:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}return(q*Math.pow(2,-10*r)*Math.sin((r-t)*(2*Math.PI)/u)+1)},InOut:function(r){var t,q=0.1,u=0.4;if(r===0){return 0}if(r===1){return 1}if(!q||q<1){q=1;t=u/4}else{t=u*Math.asin(1/q)/(2*Math.PI)}if((r*=2)<1){return -0.5*(q*Math.pow(2,10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u))}return q*Math.pow(2,-10*(r-=1))*Math.sin((r-t)*(2*Math.PI)/u)*0.5+1}},Back:{In:function(p){var q=1.70158;return p*p*((q+1)*p-q)},Out:function(p){var q=1.70158;return --p*p*((q+1)*p+q)+1},InOut:function(p){var q=1.70158*1.525;if((p*=2)<1){return 0.5*(p*p*((q+1)*p-q))}return 0.5*((p-=2)*p*((q+1)*p+q)+2)}},Bounce:{In:function(p){return 1-g.Easing.Bounce.Out(1-p)},Out:function(p){if(p<(1/2.75)){return 7.5625*p*p}else{if(p<(2/2.75)){return 7.5625*(p-=(1.5/2.75))*p+0.75}else{if(p<(2.5/2.75)){return 7.5625*(p-=(2.25/2.75))*p+0.9375}else{return 7.5625*(p-=(2.625/2.75))*p+0.984375}}}},InOut:function(p){if(p<0.5){return g.Easing.Bounce.In(p*2)*0.5}return g.Easing.Bounce.Out(p*2-1)*0.5+0.5}}};g.Easing.Default=g.Easing.Linear.None;g.Easing.Power0=g.Easing.Linear.None;g.Easing.Power1=g.Easing.Quadratic.Out;g.Easing.Power2=g.Easing.Cubic.Out;g.Easing.Power3=g.Easing.Quartic.Out;g.Easing.Power4=g.Easing.Quintic.Out;g.Time=function(p){this.game=p;this.time=0;this.prevTime=0;this.now=0;this.elapsed=0;this.elapsedMS=0;this.physicsElapsed=1/60;this.physicsElapsedMS=(1/60)*1000;this.desiredFpsMult=1/60;this._desiredFps=60;this.suggestedFps=this.desiredFps;this.slowMotion=1;this.advancedTiming=false;this.frames=0;this.fps=0;this.fpsMin=1000;this.fpsMax=0;this.msMin=1000;this.msMax=0;this.pauseDuration=0;this.timeToCall=0;this.timeExpected=0;this.events=new g.Timer(this.game,false);this._frameCount=0;this._elapsedAccumulator=0;this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=false;this._timers=[]};g.Time.prototype={boot:function(){this._started=Date.now();this.time=Date.now();this.events.start();this.timeExpected=this.time},add:function(p){this._timers.push(p);return p},create:function(p){if(p===undefined){p=true}var q=new g.Timer(this.game,p);this._timers.push(q);return q},removeAll:function(){for(var p=0;p<this._timers.length;p++){this._timers[p].destroy()}this._timers=[];this.events.removeAll()},refresh:function(){var p=this.time;this.time=Date.now();this.elapsedMS=this.time-p},update:function(q){var p=this.time;this.time=Date.now();this.elapsedMS=this.time-p;this.prevTime=this.now;this.now=q;this.elapsed=this.now-this.prevTime;if(this.game.raf._isSetTimeOut){this.timeToCall=Math.floor(Math.max(0,(1000/this._desiredFps)-(this.timeExpected-q)));this.timeExpected=q+this.timeToCall}if(this.advancedTiming){this.updateAdvancedTiming()}if(!this.game.paused){this.events.update(this.time);if(this._timers.length){this.updateTimers()}}},updateTimers:function(){var q=0;var p=this._timers.length;while(q<p){if(this._timers[q].update(this.time)){q++}else{this._timers.splice(q,1);p--}}},updateAdvancedTiming:function(){this._frameCount++;this._elapsedAccumulator+=this.elapsed;if(this._frameCount>=this._desiredFps*2){this.suggestedFps=Math.floor(200/(this._elapsedAccumulator/this._frameCount))*5;this._frameCount=0;this._elapsedAccumulator=0}this.msMin=Math.min(this.msMin,this.elapsed);this.msMax=Math.max(this.msMax,this.elapsed);this.frames++;if(this.now>this._timeLastSecond+1000){this.fps=Math.round((this.frames*1000)/(this.now-this._timeLastSecond));this.fpsMin=Math.min(this.fpsMin,this.fps);this.fpsMax=Math.max(this.fpsMax,this.fps);this._timeLastSecond=this.now;this.frames=0}},gamePaused:function(){this._pauseStarted=Date.now();this.events.pause();var p=this._timers.length;while(p--){this._timers[p]._pause()}},gameResumed:function(){this.time=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();var p=this._timers.length;while(p--){this._timers[p]._resume()}},totalElapsedSeconds:function(){return(this.time-this._started)*0.001},elapsedSince:function(p){return this.time-p},elapsedSecondsSince:function(p){return(this.time-p)*0.001},reset:function(){this._started=this.time;this.removeAll()}};Object.defineProperty(g.Time.prototype,"desiredFps",{get:function(){return this._desiredFps},set:function(p){this._desiredFps=p;this.physicsElapsed=1/p;this.physicsElapsedMS=this.physicsElapsed*1000;this.desiredFpsMult=1/p}});g.Time.prototype.constructor=g.Time;g.Timer=function(p,q){if(q===undefined){q=true}this.game=p;this.running=false;this.autoDestroy=q;this.expired=false;this.elapsed=0;this.events=[];this.onComplete=new g.Signal();this.nextTick=0;this.timeCap=1000;this.paused=false;this._codePaused=false;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};g.Timer.MINUTE=60000;g.Timer.SECOND=1000;g.Timer.HALF=500;g.Timer.QUARTER=250;g.Timer.prototype={create:function(t,p,r,w,q,s){t=Math.round(t);var u=t;if(this._now===0){u+=this.game.time.time}else{u+=this._now}var v=new g.TimerEvent(this,t,u,r,p,w,q,s);this.events.push(v);this.order();this.expired=false;return v},add:function(q,r,p){return this.create(q,false,0,r,p,Array.prototype.slice.call(arguments,3))},repeat:function(r,q,s,p){return this.create(r,false,q,s,p,Array.prototype.slice.call(arguments,4))},loop:function(q,r,p){return this.create(q,true,0,r,p,Array.prototype.slice.call(arguments,3))},start:function(p){if(this.running){return}this._started=this.game.time.time+(p||0);this.running=true;for(var q=0;q<this.events.length;q++){this.events[q].tick=this.events[q].delay+this._started}},stop:function(p){this.running=false;if(p===undefined){p=true}if(p){this.events.length=0}},remove:function(q){for(var p=0;p<this.events.length;p++){if(this.events[p]===q){this.events[p].pendingDelete=true;return true}}return false},order:function(){if(this.events.length>0){this.events.sort(this.sortHandler);this.nextTick=this.events[0].tick}},sortHandler:function(q,p){if(q.tick<p.tick){return -1}else{if(q.tick>p.tick){return 1}}return 0},clearPendingEvents:function(){this._i=this.events.length;while(this._i--){if(this.events[this._i].pendingDelete){this.events.splice(this._i,1)}}this._len=this.events.length;this._i=0},update:function(p){if(this.paused){return true}this.elapsed=p-this._now;this._now=p;if(this.elapsed>this.timeCap){this.adjustEvents(p-this.elapsed)}this._marked=0;this.clearPendingEvents();if(this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running){if(this._now>=this.events[this._i].tick&&!this.events[this._i].pendingDelete){this._newTick=(this._now+this.events[this._i].delay)-(this._now-this.events[this._i].tick);if(this._newTick<0){this._newTick=this._now+this.events[this._i].delay}if(this.events[this._i].loop===true){this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{if(this.events[this._i].repeatCount>0){this.events[this._i].repeatCount--;this.events[this._i].tick=this._newTick;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}else{this._marked++;this.events[this._i].pendingDelete=true;this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)}}this._i++}else{break}}if(this.events.length>this._marked){this.order()}else{this.expired=true;this.onComplete.dispatch(this)}}if(this.expired&&this.autoDestroy){return false}else{return true}},pause:function(){if(!this.running){return}this._codePaused=true;if(this.paused){return}this._pauseStarted=this.game.time.time;this.paused=true},_pause:function(){if(this.paused||!this.running){return}this._pauseStarted=this.game.time.time;this.paused=true},adjustEvents:function(s){for(var q=0;q<this.events.length;q++){if(!this.events[q].pendingDelete){var p=this.events[q].tick-s;if(p<0){p=0}this.events[q].tick=this._now+p}}var r=this.nextTick-s;if(r<0){this.nextTick=this._now}else{this.nextTick=this._now+r}},resume:function(){if(!this.paused){return}var p=this.game.time.time;this._pauseTotal+=p-this._now;this._now=p;this.adjustEvents(this._pauseStarted);this.paused=false;this._codePaused=false},_resume:function(){if(this._codePaused){return}else{this.resume()}},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=false;this.events=[];this._len=0;this._i=0}};Object.defineProperty(g.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(g.Timer.prototype,"duration",{get:function(){if(this.running&&this.nextTick>this._now){return this.nextTick-this._now}else{return 0}}});Object.defineProperty(g.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(g.Timer.prototype,"ms",{get:function(){if(this.running){return this._now-this._started-this._pauseTotal}else{return 0}}});Object.defineProperty(g.Timer.prototype,"seconds",{get:function(){if(this.running){return this.ms*0.001}else{return 0}}});g.Timer.prototype.constructor=g.Timer;g.TimerEvent=function(w,t,u,r,p,v,q,s){this.timer=w;this.delay=t;this.tick=u;this.repeatCount=r-1;this.loop=p;this.callback=v;this.callbackContext=q;this.args=s;this.pendingDelete=false};g.TimerEvent.prototype.constructor=g.TimerEvent;g.AnimationManager=function(p){this.sprite=p;this.game=p.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=true;this.isLoaded=false;this._frameData=null;this._anims={};this._outputFrames=[]};g.AnimationManager.prototype={loadFrameData:function(p,r){if(p===undefined){return false}if(this.isLoaded){for(var q in this._anims){this._anims[q].updateFrameData(p)}}this._frameData=p;if(r===undefined||r===null){this.frame=0}else{if(typeof r==="string"){this.frameName=r}else{this.frame=r}}this.isLoaded=true;return true},copyFrameData:function(p,r){this._frameData=p.clone();if(this.isLoaded){for(var q in this._anims){this._anims[q].updateFrameData(this._frameData)}}if(r===undefined||r===null){this.frame=0}else{if(typeof r==="string"){this.frameName=r}else{this.frame=r}}this.isLoaded=true;return true},add:function(s,t,r,q,p){t=t||[];r=r||60;if(q===undefined){q=false}if(p===undefined){if(t&&typeof t[0]==="number"){p=true}else{p=false}}this._outputFrames=[];this._frameData.getFrameIndexes(t,p,this._outputFrames);this._anims[s]=new g.Animation(this.game,this.sprite,s,this._frameData,this._outputFrames,r,q);this.currentAnim=this._anims[s];if(this.sprite.tilingTexture){this.sprite.refreshTexture=true}return this._anims[s]},validateFrames:function(r,p){if(p===undefined){p=true}for(var q=0;q<r.length;q++){if(p===true){if(r[q]>this._frameData.total){return false}}else{if(this._frameData.checkFrameName(r[q])===false){return false}}}return true},play:function(s,r,q,p){if(this._anims[s]){if(this.currentAnim===this._anims[s]){if(this.currentAnim.isPlaying===false){this.currentAnim.paused=false;return this.currentAnim.play(r,q,p)}return this.currentAnim}else{if(this.currentAnim&&this.currentAnim.isPlaying){this.currentAnim.stop()}this.currentAnim=this._anims[s];this.currentAnim.paused=false;this.currentFrame=this.currentAnim.currentFrame;return this.currentAnim.play(r,q,p)}}},stop:function(q,p){if(p===undefined){p=false}if(this.currentAnim&&(typeof q!=="string"||q===this.currentAnim.name)){this.currentAnim.stop(p)}},update:function(){if(this.updateIfVisible&&!this.sprite.visible){return false}if(this.currentAnim&&this.currentAnim.update()){this.currentFrame=this.currentAnim.currentFrame;return true}return false},next:function(p){if(this.currentAnim){this.currentAnim.next(p);this.currentFrame=this.currentAnim.currentFrame}},previous:function(p){if(this.currentAnim){this.currentAnim.previous(p);this.currentFrame=this.currentAnim.currentFrame}},getAnimation:function(p){if(typeof p==="string"){if(this._anims[p]){return this._anims[p]}}return null},refreshFrame:function(){},destroy:function(){var p=null;for(var p in this._anims){if(this._anims.hasOwnProperty(p)){this._anims[p].destroy()}}this._anims={};this._outputFrames=[];this._frameData=null;this.currentAnim=null;this.currentFrame=null;this.sprite=null;this.game=null}};g.AnimationManager.prototype.constructor=g.AnimationManager;Object.defineProperty(g.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(g.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(g.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(p){this.currentAnim.paused=p}});Object.defineProperty(g.AnimationManager.prototype,"name",{get:function(){if(this.currentAnim){return this.currentAnim.name}}});Object.defineProperty(g.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame){return this.currentFrame.index}},set:function(p){if(typeof p==="number"&&this._frameData&&this._frameData.getFrame(p)!==null){this.currentFrame=this._frameData.getFrame(p);if(this.currentFrame){this.sprite.setFrame(this.currentFrame)}}}});Object.defineProperty(g.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame){return this.currentFrame.name}},set:function(p){if(typeof p==="string"&&this._frameData&&this._frameData.getFrameByName(p)!==null){this.currentFrame=this._frameData.getFrameByName(p);if(this.currentFrame){this._frameIndex=this.currentFrame.index;this.sprite.setFrame(this.currentFrame)}}else{console.warn("Cannot set frameName: "+p)}}});g.Animation=function(q,u,s,t,v,r,p){if(p===undefined){p=false}this.game=q;this._parent=u;this._frameData=t;this.name=s;this._frames=[];this._frames=this._frames.concat(v);this.delay=1000/r;this.loop=p;this.loopCount=0;this.killOnComplete=false;this.isFinished=false;this.isPlaying=false;this.isPaused=false;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new g.Signal();this.onUpdate=null;this.onComplete=new g.Signal();this.onLoop=new g.Signal();this.isReversed=false;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};g.Animation.prototype={play:function(r,q,p){if(typeof r==="number"){this.delay=1000/r}if(typeof q==="boolean"){this.loop=q}if(typeof p!=="undefined"){this.killOnComplete=p}this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=this.isReversed?this._frames.length-1:0;this.updateCurrentFrame(false,true);this._parent.events.onAnimationStart$dispatch(this._parent,this);this.onStart.dispatch(this._parent,this);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;return this},restart:function(){this.isPlaying=true;this.isFinished=false;this.paused=false;this.loopCount=0;this._timeLastFrame=this.game.time.time;this._timeNextFrame=this.game.time.time+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this._parent.animations.currentAnim=this;this._parent.animations.currentFrame=this.currentFrame;this.onStart.dispatch(this._parent,this)},reverse:function(){this.reversed=!this.reversed;return this},reverseOnce:function(){this.onComplete.addOnce(this.reverse,this);return this.reverse()},setFrame:function(r,p){var s;if(p===undefined){p=false}if(typeof r==="string"){for(var q=0;q<this._frames.length;q++){if(this._frameData.getFrame(this._frames[q]).name===r){s=q}}}else{if(typeof r==="number"){if(p){s=r}else{for(var q=0;q<this._frames.length;q++){if(this._frames[q]===r){s=q}}}}}if(s){this._frameIndex=s-1;this._timeNextFrame=this.game.time.time;this.update()}},stop:function(p,q){if(p===undefined){p=false}if(q===undefined){q=false}this.isPlaying=false;this.isFinished=true;this.paused=false;if(p){this.currentFrame=this._frameData.getFrame(this._frames[0]);this._parent.setFrame(this.currentFrame)}if(q){this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this)}},onPause:function(){if(this.isPlaying){this._frameDiff=this._timeNextFrame-this.game.time.time}},onResume:function(){if(this.isPlaying){this._timeNextFrame=this.game.time.time+this._frameDiff}},update:function(){if(this.isPaused){return false}if(this.isPlaying&&this.game.time.time>=this._timeNextFrame){this._frameSkip=1;this._frameDiff=this.game.time.time-this._timeNextFrame;this._timeLastFrame=this.game.time.time;if(this._frameDiff>this.delay){this._frameSkip=Math.floor(this._frameDiff/this.delay);this._frameDiff-=(this._frameSkip*this.delay)}this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff);if(this.isReversed){this._frameIndex-=this._frameSkip}else{this._frameIndex+=this._frameSkip}if(!this.isReversed&&this._frameIndex>=this._frames.length||this.isReversed&&this._frameIndex<=-1){if(this.loop){this._frameIndex=Math.abs(this._frameIndex)%this._frames.length;if(this.isReversed){this._frameIndex=this._frames.length-1-this._frameIndex}this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame){this._parent.setFrame(this.currentFrame)}this.loopCount++;this._parent.events.onAnimationLoop$dispatch(this._parent,this);this.onLoop.dispatch(this._parent,this);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame);return !!this._frameData}else{return true}}else{this.complete();return false}}else{return this.updateCurrentFrame(true)}}return false},updateCurrentFrame:function(r,q){if(q===undefined){q=false}if(!this._frameData){return false}var p=this.currentFrame.index;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);if(this.currentFrame&&(q||(!q&&p!==this.currentFrame.index))){this._parent.setFrame(this.currentFrame)}if(this.onUpdate&&r){this.onUpdate.dispatch(this,this.currentFrame);return !!this._frameData}else{return true}},next:function(p){if(p===undefined){p=1}var q=this._frameIndex+p;if(q>=this._frames.length){if(this.loop){q%=this._frames.length}else{q=this._frames.length-1}}if(q!==this._frameIndex){this._frameIndex=q;this.updateCurrentFrame(true)}},previous:function(p){if(p===undefined){p=1}var q=this._frameIndex-p;if(q<0){if(this.loop){q=this._frames.length+q}else{q++}}if(q!==this._frameIndex){this._frameIndex=q;this.updateCurrentFrame(true)}},updateFrameData:function(p){this._frameData=p;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){if(!this._frameData){return}this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=false;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();if(this.onUpdate){this.onUpdate.dispose()}},complete:function(){this._frameIndex=this._frames.length-1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.isPlaying=false;this.isFinished=true;this.paused=false;this._parent.events.onAnimationComplete$dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);if(this.killOnComplete){this._parent.kill()}}};g.Animation.prototype.constructor=g.Animation;Object.defineProperty(g.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(p){this.isPaused=p;if(p){this._pauseStartTime=this.game.time.time}else{if(this.isPlaying){this._timeNextFrame=this.game.time.time+this.delay}}}});Object.defineProperty(g.Animation.prototype,"reversed",{get:function(){return this.isReversed},set:function(p){this.isReversed=p}});Object.defineProperty(g.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(g.Animation.prototype,"frame",{get:function(){if(this.currentFrame!==null){return this.currentFrame.index}else{return this._frameIndex}},set:function(p){this.currentFrame=this._frameData.getFrame(this._frames[p]);if(this.currentFrame!==null){this._frameIndex=p;this._parent.setFrame(this.currentFrame);if(this.onUpdate){this.onUpdate.dispatch(this,this.currentFrame)}}}});Object.defineProperty(g.Animation.prototype,"speed",{get:function(){return 1000/this.delay},set:function(p){if(p>0){this.delay=1000/p}}});Object.defineProperty(g.Animation.prototype,"enableUpdate",{get:function(){return(this.onUpdate!==null)},set:function(p){if(p&&this.onUpdate===null){this.onUpdate=new g.Signal()}else{if(!p&&this.onUpdate!==null){this.onUpdate.dispose();this.onUpdate=null}}}});g.Animation.generateFrameNames=function(t,w,r,u,s){if(u===undefined){u=""}var p=[];var v="";if(w<r){for(var q=w;q<=r;q++){if(typeof s==="number"){v=g.Utils.pad(q.toString(),s,"0",1)}else{v=q.toString()}v=t+v+u;p.push(v)}}else{for(var q=w;q>=r;q--){if(typeof s==="number"){v=g.Utils.pad(q.toString(),s,"0",1)}else{v=q.toString()}v=t+v+u;p.push(v)}}return p};g.Frame=function(s,q,u,t,p,r){this.index=s;this.x=q;this.y=u;this.width=t;this.height=p;this.name=r;this.centerX=Math.floor(t/2);this.centerY=Math.floor(p/2);this.distance=g.Math.distance(0,0,t,p);this.rotated=false;this.rotationDirection="cw";this.trimmed=false;this.sourceSizeW=t;this.sourceSizeH=p;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};g.Frame.prototype={resize:function(q,p){this.width=q;this.height=p;this.centerX=Math.floor(q/2);this.centerY=Math.floor(p/2);this.distance=g.Math.distance(0,0,q,p);this.sourceSizeW=q;this.sourceSizeH=p;this.right=this.x+q;this.bottom=this.y+p},setTrim:function(t,s,v,q,p,r,u){this.trimmed=t;if(t){this.sourceSizeW=s;this.sourceSizeH=v;this.centerX=Math.floor(s/2);this.centerY=Math.floor(v/2);this.spriteSourceSizeX=q;this.spriteSourceSizeY=p;this.spriteSourceSizeW=r;this.spriteSourceSizeH=u}},clone:function(){var p=new g.Frame(this.index,this.x,this.y,this.width,this.height,this.name);for(var q in this){if(this.hasOwnProperty(q)){p[q]=this[q]}}return p},getRect:function(p){if(p===undefined){p=new g.Rectangle(this.x,this.y,this.width,this.height)}else{p.setTo(this.x,this.y,this.width,this.height)}return p}};g.Frame.prototype.constructor=g.Frame;g.FrameData=function(){this._frames=[];this._frameNames=[]};g.FrameData.prototype={addFrame:function(p){p.index=this._frames.length;this._frames.push(p);if(p.name!==""){this._frameNames[p.name]=p.index}return p},getFrame:function(p){if(p>=this._frames.length){p=0}return this._frames[p]},getFrameByName:function(p){if(typeof this._frameNames[p]==="number"){return this._frames[this._frameNames[p]]}return null},checkFrameName:function(p){if(this._frameNames[p]==null){return false}return true},clone:function(){var q=new g.FrameData();for(var r=0;r<this._frames.length;r++){q._frames.push(this._frames[r].clone())}for(var s in this._frameNames){if(this._frameNames.hasOwnProperty(s)){q._frameNames.push(this._frameNames[s])}}return q},getFrameRange:function(s,p,q){if(q===undefined){q=[]}for(var r=s;r<=p;r++){q.push(this._frames[r])}return q},getFrames:function(s,p,q){if(p===undefined){p=true}if(q===undefined){q=[]}if(s===undefined||s.length===0){for(var r=0;r<this._frames.length;r++){q.push(this._frames[r])}}else{for(var r=0;r<s.length;r++){if(p){q.push(this.getFrame(s[r]))}else{q.push(this.getFrameByName(s[r]))}}}return q},getFrameIndexes:function(s,p,q){if(p===undefined){p=true}if(q===undefined){q=[]}if(s===undefined||s.length===0){for(var r=0;r<this._frames.length;r++){q.push(this._frames[r].index)}}else{for(var r=0;r<s.length;r++){if(p&&this._frames[s[r]]){q.push(this._frames[s[r]].index)}else{if(this.getFrameByName(s[r])){q.push(this.getFrameByName(s[r]).index)}}}}return q},destroy:function(){this._frames=null;this._frameNames=null}};g.FrameData.prototype.constructor=g.FrameData;Object.defineProperty(g.FrameData.prototype,"total",{get:function(){return this._frames.length}});g.AnimationParser={spriteSheet:function(G,E,C,s,r,t,z){var w=E;if(typeof E==="string"){w=G.cache.getImage(E)}if(w===null){return null}var p=w.width;var F=w.height;if(C<=0){C=Math.floor(-p/Math.min(-1,C))}if(s<=0){s=Math.floor(-F/Math.min(-1,s))}var H=Math.floor((p-t)/(C+z));var q=Math.floor((F-t)/(s+z));var B=H*q;if(r!==-1){B=r}if(p===0||F===0||p<C||F<s||B===0){console.warn("Phaser.AnimationParser.spriteSheet: '"+E+"'s width/height zero or width/height < given frameWidth/frameHeight");return null}var v=new g.FrameData();var D=t;var A=t;for(var u=0;u<B;u++){v.addFrame(new g.Frame(u,D,A,C,s,""));D+=C+z;if(D+C>p){D=t;A+=s+z}}return v},JSONData:function(p,r){if(!r.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(r);return}var s=new g.FrameData();var t=r.frames;var u;for(var q=0;q<t.length;q++){u=s.addFrame(new g.Frame(q,t[q].frame.x,t[q].frame.y,t[q].frame.w,t[q].frame.h,t[q].filename));if(t[q].trimmed){u.setTrim(t[q].trimmed,t[q].sourceSize.w,t[q].sourceSize.h,t[q].spriteSourceSize.x,t[q].spriteSourceSize.y,t[q].spriteSourceSize.w,t[q].spriteSourceSize.h)}}return s},JSONDataPyxel:function(v,w){var p=["layers","tilewidth","tileheight","tileswide","tileshigh"];p.forEach(function(y){if(!w[y]){console.warn('Phaser.AnimationParser.JSONDataPyxel: Invalid Pyxel Tilemap JSON given, missing "'+y+'" key.');console.log(w);return}});if(w.layers.length!==1){console.warn("Phaser.AnimationParser.JSONDataPyxel: Too many layers, this parser only supports flat Tilemaps.");console.log(w);return}var s=new g.FrameData();var q=w.tileheight;var x=w.tilewidth;var u=w.layers[0]["tiles"];var t;for(var r=0;r<u.length;r++){t=s.addFrame(new g.Frame(r,u[r].x,u[r].y,x,q,"frame_"+r));t.setTrim(false)}return s},JSONDataHash:function(p,s){if(!s.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(s);return}var t=new g.FrameData();var u=s.frames;var v;var r=0;for(var q in u){v=t.addFrame(new g.Frame(r,u[q].frame.x,u[q].frame.y,u[q].frame.w,u[q].frame.h,q));if(u[q].trimmed){v.setTrim(u[q].trimmed,u[q].sourceSize.w,u[q].sourceSize.h,u[q].spriteSourceSize.x,u[q].spriteSourceSize.y,u[q].spriteSourceSize.w,u[q].spriteSourceSize.h)}r++}return t},XMLData:function(G,w){if(!w.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}var u=new g.FrameData();var z=w.getElementsByTagName("SubTexture");var v;var p;var r;var D;var B;var q;var F;var E;var C;var A;var s;for(var t=0;t<z.length;t++){r=z[t].attributes;p=r.name.value;D=parseInt(r.x.value,10);B=parseInt(r.y.value,10);q=parseInt(r.width.value,10);F=parseInt(r.height.value,10);E=null;C=null;if(r.frameX){E=Math.abs(parseInt(r.frameX.value,10));C=Math.abs(parseInt(r.frameY.value,10));A=parseInt(r.frameWidth.value,10);s=parseInt(r.frameHeight.value,10)}v=u.addFrame(new g.Frame(t,D,B,q,F,p));if(E!==null||C!==null){v.setTrim(true,q,F,E,C,A,s)}}return u}};g.Cache=function(p){this.game=p;this.autoResolveURL=false;this._cache={canvas:{},image:{},texture:{},sound:{},video:{},text:{},json:{},xml:{},physics:{},tilemap:{},binary:{},bitmapData:{},bitmapFont:{},shader:{},renderTexture:{}};this._urlMap={};this._urlResolver=new Image();this._urlTemp=null;this.onSoundUnlock=new g.Signal();this._cacheMap=[];this._cacheMap[g.Cache.CANVAS]=this._cache.canvas;this._cacheMap[g.Cache.IMAGE]=this._cache.image;this._cacheMap[g.Cache.TEXTURE]=this._cache.texture;this._cacheMap[g.Cache.SOUND]=this._cache.sound;this._cacheMap[g.Cache.TEXT]=this._cache.text;this._cacheMap[g.Cache.PHYSICS]=this._cache.physics;this._cacheMap[g.Cache.TILEMAP]=this._cache.tilemap;this._cacheMap[g.Cache.BINARY]=this._cache.binary;this._cacheMap[g.Cache.BITMAPDATA]=this._cache.bitmapData;this._cacheMap[g.Cache.BITMAPFONT]=this._cache.bitmapFont;this._cacheMap[g.Cache.JSON]=this._cache.json;this._cacheMap[g.Cache.XML]=this._cache.xml;this._cacheMap[g.Cache.VIDEO]=this._cache.video;this._cacheMap[g.Cache.SHADER]=this._cache.shader;this._cacheMap[g.Cache.RENDER_TEXTURE]=this._cache.renderTexture;this.addDefaultImage();this.addMissingImage()};g.Cache.CANVAS=1;g.Cache.IMAGE=2;g.Cache.TEXTURE=3;g.Cache.SOUND=4;g.Cache.TEXT=5;g.Cache.PHYSICS=6;g.Cache.TILEMAP=7;g.Cache.BINARY=8;g.Cache.BITMAPDATA=9;g.Cache.BITMAPFONT=10;g.Cache.JSON=11;g.Cache.XML=12;g.Cache.VIDEO=13;g.Cache.SHADER=14;g.Cache.RENDER_TEXTURE=15;g.Cache.DEFAULT=null;g.Cache.MISSING=null;g.Cache.prototype={addCanvas:function(r,p,q){if(q===undefined){q=p.getContext("2d")}this._cache.canvas[r]={canvas:p,context:q}},addImage:function(r,q,s){if(this.checkImageKey(r)){this.removeImage(r)}var p={key:r,url:q,data:s,base:new PIXI.BaseTexture(s),frame:new g.Frame(0,0,0,s.width,s.height,r),frameData:new g.FrameData()};p.frameData.addFrame(new g.Frame(0,0,0,s.width,s.height,q));this._cache.image[r]=p;this._resolveURL(q,p);if(r==="__default"){g.Cache.DEFAULT=new PIXI.Texture(p.base)}else{if(r==="__missing"){g.Cache.MISSING=new PIXI.Texture(p.base)}}return p},addDefaultImage:function(){var p=new Image();p.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";var q=this.addImage("__default",null,p);q.base.skipRender=true;g.Cache.DEFAULT=new PIXI.Texture(q.base)},addMissingImage:function(){var p=new Image();p.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";var q=this.addImage("__missing",null,p);g.Cache.MISSING=new PIXI.Texture(q.base)},addSound:function(s,r,u,q,t){if(q===undefined){q=true;t=false}if(t===undefined){q=false;t=true}var p=false;if(t){p=true}this._cache.sound[s]={url:r,data:u,isDecoding:false,decoded:p,webAudio:q,audioTag:t,locked:this.game.sound.touchLocked};this._resolveURL(r,this._cache.sound[s])},addText:function(q,p,r){this._cache.text[q]={url:p,data:r};this._resolveURL(p,this._cache.text[q])},addPhysicsData:function(q,p,r,s){this._cache.physics[q]={url:p,data:r,format:s};this._resolveURL(p,this._cache.physics[q])},addTilemap:function(q,p,s,r){this._cache.tilemap[q]={url:p,data:s,format:r};this._resolveURL(p,this._cache.tilemap[q])},addBinary:function(q,p){this._cache.binary[q]=p},addBitmapData:function(p,r,q){r.key=p;if(q===undefined){q=new g.FrameData();q.addFrame(r.textureFrame)}this._cache.bitmapData[p]={data:r,frameData:q};return r},addBitmapFont:function(s,r,v,q,p,u,t){var w={url:r,data:v,font:null,base:new PIXI.BaseTexture(v)};if(u===undefined){u=0}if(t===undefined){t=0}if(p==="json"){w.font=g.LoaderParser.jsonBitmapFont(q,w.base,u,t)}else{w.font=g.LoaderParser.xmlBitmapFont(q,w.base,u,t)}this._cache.bitmapFont[s]=w;this._resolveURL(r,w)},addJSON:function(q,p,r){this._cache.json[q]={url:p,data:r};this._resolveURL(p,this._cache.json[q])},addXML:function(q,p,r){this._cache.xml[q]={url:p,data:r};this._resolveURL(p,this._cache.xml[q])},addVideo:function(r,q,s,p){this._cache.video[r]={url:q,data:s,isBlob:p,locked:true};this._resolveURL(q,this._cache.video[r])},addShader:function(q,p,r){this._cache.shader[q]={url:p,data:r};this._resolveURL(p,this._cache.shader[q])},addRenderTexture:function(p,q){this._cache.renderTexture[p]={texture:q,frame:new g.Frame(0,0,0,q.width,q.height,"","")}},addSpriteSheet:function(x,p,u,w,r,q,s,v){if(q===undefined){q=-1}if(s===undefined){s=0}if(v===undefined){v=0}var t={key:x,url:p,data:u,frameWidth:w,frameHeight:r,margin:s,spacing:v,base:new PIXI.BaseTexture(u),frameData:g.AnimationParser.spriteSheet(this.game,u,w,r,q,s,v)};this._cache.image[x]=t;this._resolveURL(p,t)},addTextureAtlas:function(r,q,s,p,u){var t={key:r,url:q,data:s,base:new PIXI.BaseTexture(s)};if(u===g.Loader.TEXTURE_ATLAS_XML_STARLING){t.frameData=g.AnimationParser.XMLData(this.game,p,r)}else{if(u===g.Loader.TEXTURE_ATLAS_JSON_PYXEL){t.frameData=g.AnimationParser.JSONDataPyxel(this.game,p,r)}else{if(Array.isArray(p.frames)){t.frameData=g.AnimationParser.JSONData(this.game,p,r)}else{t.frameData=g.AnimationParser.JSONDataHash(this.game,p,r)}}}this._cache.image[r]=t;this._resolveURL(q,t)},reloadSound:function(p){var r=this;var q=this.getSound(p);if(q){q.data.src=q.url;q.data.addEventListener("canplaythrough",function(){return r.reloadSoundComplete(p)},false);q.data.load()}},reloadSoundComplete:function(p){var q=this.getSound(p);if(q){q.locked=false;this.onSoundUnlock.dispatch(p)}},updateSound:function(p,r,q){var s=this.getSound(p);if(s){s[r]=q}},decodedSound:function(p,q){var r=this.getSound(p);r.data=q;r.decoded=true;r.isDecoding=false},isSoundDecoded:function(p){var q=this.getItem(p,g.Cache.SOUND,"isSoundDecoded");if(q){return q.decoded}},isSoundReady:function(p){var q=this.getItem(p,g.Cache.SOUND,"isSoundDecoded");if(q){return(q.decoded&&!this.game.sound.touchLocked)}},checkKey:function(p,q){if(this._cacheMap[p][q]){return true}return false},checkURL:function(p){if(this._urlMap[this._resolveURL(p)]){return true}return false},checkCanvasKey:function(p){return this.checkKey(g.Cache.CANVAS,p)},checkImageKey:function(p){return this.checkKey(g.Cache.IMAGE,p)},checkTextureKey:function(p){return this.checkKey(g.Cache.TEXTURE,p)},checkSoundKey:function(p){return this.checkKey(g.Cache.SOUND,p)},checkTextKey:function(p){return this.checkKey(g.Cache.TEXT,p)},checkPhysicsKey:function(p){return this.checkKey(g.Cache.PHYSICS,p)},checkTilemapKey:function(p){return this.checkKey(g.Cache.TILEMAP,p)},checkBinaryKey:function(p){return this.checkKey(g.Cache.BINARY,p)},checkBitmapDataKey:function(p){return this.checkKey(g.Cache.BITMAPDATA,p)},checkBitmapFontKey:function(p){return this.checkKey(g.Cache.BITMAPFONT,p)},checkJSONKey:function(p){return this.checkKey(g.Cache.JSON,p)},checkXMLKey:function(p){return this.checkKey(g.Cache.XML,p)},checkVideoKey:function(p){return this.checkKey(g.Cache.VIDEO,p)},checkShaderKey:function(p){return this.checkKey(g.Cache.SHADER,p)},checkRenderTextureKey:function(p){return this.checkKey(g.Cache.RENDER_TEXTURE,p)},getItem:function(q,p,s,r){if(!this.checkKey(p,q)){if(s){console.warn("Phaser.Cache."+s+': Key "'+q+'" not found in Cache.')}}else{if(r===undefined){return this._cacheMap[p][q]}else{return this._cacheMap[p][q][r]}}return null},getCanvas:function(p){return this.getItem(p,g.Cache.CANVAS,"getCanvas","canvas")},getImage:function(r,q){if(r===undefined||r===null){r="__default"}if(q===undefined){q=false}var p=this.getItem(r,g.Cache.IMAGE,"getImage");if(p===null){p=this.getItem("__missing",g.Cache.IMAGE,"getImage")}if(q){return p}else{return p.data}},getTextureFrame:function(p){return this.getItem(p,g.Cache.TEXTURE,"getTextureFrame","frame")},getSound:function(p){return this.getItem(p,g.Cache.SOUND,"getSound")},getSoundData:function(p){return this.getItem(p,g.Cache.SOUND,"getSoundData","data")},getText:function(p){return this.getItem(p,g.Cache.TEXT,"getText","data")},getPhysicsData:function(r,q,p){var u=this.getItem(r,g.Cache.PHYSICS,"getPhysicsData","data");if(u===null||q===undefined||q===null){return u}else{if(u[q]){var s=u[q];if(s&&p){for(var t in s){t=s[t];if(t.fixtureKey===p){return t}}console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+p+" in "+r+'"')}else{return s}}else{console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+r+" / "+q+'"')}}return null},getTilemapData:function(p){return this.getItem(p,g.Cache.TILEMAP,"getTilemapData")},getBinary:function(p){return this.getItem(p,g.Cache.BINARY,"getBinary")},getBitmapData:function(p){return this.getItem(p,g.Cache.BITMAPDATA,"getBitmapData","data")},getBitmapFont:function(p){return this.getItem(p,g.Cache.BITMAPFONT,"getBitmapFont")},getJSON:function(p,r){var q=this.getItem(p,g.Cache.JSON,"getJSON","data");if(q){if(r){return g.Utils.extend(true,Array.isArray(q)?[]:{},q)}else{return q}}else{return null}},getXML:function(p){return this.getItem(p,g.Cache.XML,"getXML","data")},getVideo:function(p){return this.getItem(p,g.Cache.VIDEO,"getVideo")},getShader:function(p){return this.getItem(p,g.Cache.SHADER,"getShader","data")},getRenderTexture:function(p){return this.getItem(p,g.Cache.RENDER_TEXTURE,"getRenderTexture")},getBaseTexture:function(q,p){if(p===undefined){p=g.Cache.IMAGE}return this.getItem(q,p,"getBaseTexture","base")},getFrame:function(q,p){if(p===undefined){p=g.Cache.IMAGE}return this.getItem(q,p,"getFrame","frame")},getFrameCount:function(q,p){var r=this.getFrameData(q,p);if(r){return r.total}else{return 0}},getFrameData:function(q,p){if(p===undefined){p=g.Cache.IMAGE}return this.getItem(q,p,"getFrameData","frameData")},hasFrameData:function(q,p){if(p===undefined){p=g.Cache.IMAGE}return(this.getItem(q,p,"","frameData")!==null)},updateFrameData:function(q,r,p){if(p===undefined){p=g.Cache.IMAGE}if(this._cacheMap[p][q]){this._cacheMap[p][q].frameData=r}},getFrameByIndex:function(r,q,p){var s=this.getFrameData(r,p);if(s){return s.getFrame(q)}else{return null}},getFrameByName:function(r,q,p){var s=this.getFrameData(r,p);if(s){return s.getFrameByName(q)}else{return null}},getURL:function(p){var p=this._resolveURL(p);if(p){return this._urlMap[p]}else{console.warn('Phaser.Cache.getUrl: Invalid url: "'+p+'" or Cache.autoResolveURL was false');return null}},getKeys:function(p){if(p===undefined){p=g.Cache.IMAGE}var q=[];if(this._cacheMap[p]){for(var r in this._cacheMap[p]){if(r!=="__default"&&r!=="__missing"){q.push(r)}}}return q},removeCanvas:function(p){delete this._cache.canvas[p]},removeImage:function(q,r){if(r===undefined){r=true}var p=this.getImage(q,true);if(r&&p.base){p.base.destroy()}delete this._cache.image[q]},removeSound:function(p){delete this._cache.sound[p]},removeText:function(p){delete this._cache.text[p]},removePhysics:function(p){delete this._cache.physics[p]},removeTilemap:function(p){delete this._cache.tilemap[p]},removeBinary:function(p){delete this._cache.binary[p]},removeBitmapData:function(p){delete this._cache.bitmapData[p]},removeBitmapFont:function(p){delete this._cache.bitmapFont[p]},removeJSON:function(p){delete this._cache.json[p]},removeXML:function(p){delete this._cache.xml[p]},removeVideo:function(p){delete this._cache.video[p]},removeShader:function(p){delete this._cache.shader[p]},removeRenderTexture:function(p){delete this._cache.renderTexture[p]},removeSpriteSheet:function(p){delete this._cache.spriteSheet[p]},removeTextureAtlas:function(p){delete this._cache.atlas[p]},clearGLTextures:function(){for(var p in this._cache.image){this._cache.image[p].base._glTextures=[]}},_resolveURL:function(p,q){if(!this.autoResolveURL){return null}this._urlResolver.src=this.game.load.baseURL+p;this._urlTemp=this._urlResolver.src;this._urlResolver.src="";if(q){this._urlMap[this._urlTemp]=q}return this._urlTemp},destroy:function(){for(var r=0;r<this._cacheMap.length;r++){var p=this._cacheMap[r];for(var q in p){if(q!=="__default"&&q!=="__missing"){if(p[q]["destroy"]){p[q].destroy()}delete p[q]}}}this._urlMap=null;this._urlResolver=null;this._urlTemp=null}};g.Cache.prototype.constructor=g.Cache;g.Loader=function(p){this.game=p;this.cache=p.cache;this.resetLocked=false;this.isLoading=false;this.hasLoaded=false;this.preloadSprite=null;this.crossOrigin=false;this.baseURL="";this.path="";this.headers={requestedWith:false,json:"application/json",xml:"application/xml"};this.onLoadStart=new g.Signal();this.onLoadComplete=new g.Signal();this.onPackComplete=new g.Signal();this.onFileStart=new g.Signal();this.onFileComplete=new g.Signal();this.onFileError=new g.Signal();this.useXDomainRequest=false;this._warnedAboutXDomainRequest=false;this.enableParallel=true;this.maxParallelDownloads=4;this._withSyncPointDepth=0;this._fileList=[];this._flightQueue=[];this._processingHead=0;this._fileLoadStarted=false;this._totalPackCount=0;this._totalFileCount=0;this._loadedPackCount=0;this._loadedFileCount=0};g.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;g.Loader.TEXTURE_ATLAS_JSON_HASH=1;g.Loader.TEXTURE_ATLAS_XML_STARLING=2;g.Loader.PHYSICS_LIME_CORONA_JSON=3;g.Loader.PHYSICS_PHASER_JSON=4;g.Loader.TEXTURE_ATLAS_JSON_PYXEL=5;g.Loader.prototype={setPreloadSprite:function(p,q){q=q||0;this.preloadSprite={sprite:p,direction:q,width:p.width,height:p.height,rect:null};if(q===0){this.preloadSprite.rect=new g.Rectangle(0,0,1,p.height)}else{this.preloadSprite.rect=new g.Rectangle(0,0,p.width,1)}p.crop(this.preloadSprite.rect);p.visible=true},resize:function(){if(this.preloadSprite&&this.preloadSprite.height!==this.preloadSprite.sprite.height){this.preloadSprite.rect.height=this.preloadSprite.sprite.height}},checkKeyExists:function(q,p){return this.getAssetIndex(q,p)>-1},getAssetIndex:function(s,r){var t=-1;for(var q=0;q<this._fileList.length;q++){var p=this._fileList[q];if(p.type===s&&p.key===r){t=q;if(!p.loaded&&!p.loading){break}}}return t},getAsset:function(q,p){var r=this.getAssetIndex(q,p);if(r>-1){return{index:r,file:this._fileList[r]}}return false},reset:function(q,p){if(p===undefined){p=false}if(this.resetLocked){return}if(q){this.preloadSprite=null}this.isLoading=false;this._processingHead=0;this._fileList.length=0;this._flightQueue.length=0;this._fileLoadStarted=false;this._totalFileCount=0;this._totalPackCount=0;this._loadedPackCount=0;this._loadedFileCount=0;if(p){this.onLoadStart.removeAll();this.onLoadComplete.removeAll();this.onPackComplete.removeAll();this.onFileStart.removeAll();this.onFileComplete.removeAll();this.onFileError.removeAll()}},addToFileList:function(w,y,q,v,u,x){if(u===undefined){u=false}if(y===undefined||y===""){console.warn("Phaser.Loader: Invalid or no key given of type "+w);return this}if(q===undefined||q===null){if(x){q=y+x}else{console.warn("Phaser.Loader: No URL given for file type: "+w+" key: "+y);return this}}var t={type:w,key:y,path:this.path,url:q,syncPoint:this._withSyncPointDepth>0,data:null,loading:false,loaded:false,error:false};if(v){for(var p in v){t[p]=v[p]}}var s=this.getAssetIndex(w,y);if(u&&s>-1){var r=this._fileList[s];if(!r.loading&&!r.loaded){this._fileList[s]=t}else{this._fileList.push(t);this._totalFileCount++}}else{if(s===-1){this._fileList.push(t);this._totalFileCount++}}return this},replaceInFileList:function(s,r,p,q){return this.addToFileList(s,r,p,q,true)},pack:function(u,q,v,p){if(q===undefined){q=null}if(v===undefined){v=null}if(p===undefined){p=null}if(!q&&!v){console.warn("Phaser.Loader.pack - Both url and data are null. One must be set.");return this}var t={type:"packfile",key:u,url:q,path:this.path,syncPoint:true,data:null,loading:false,loaded:false,error:false,callbackContext:p};if(v){if(typeof v==="string"){v=JSON.parse(v)}t.data=v||{};t.loaded=true}for(var s=0;s<this._fileList.length+1;s++){var r=this._fileList[s];if(!r||(!r.loaded&&!r.loading&&r.type!=="packfile")){this._fileList.splice(s,0,t);this._totalPackCount++;break}}return this},image:function(r,q,p){return this.addToFileList("image",r,q,undefined,p,".png")},images:function(q,r){if(Array.isArray(r)){for(var p=0;p<q.length;p++){this.image(q[p],r[p])}}else{for(var p=0;p<q.length;p++){this.image(q[p])}}return this},text:function(r,q,p){return this.addToFileList("text",r,q,undefined,p,".txt")},json:function(r,q,p){return this.addToFileList("json",r,q,undefined,p,".json")},shader:function(r,q,p){return this.addToFileList("shader",r,q,undefined,p,".frag")},xml:function(r,q,p){return this.addToFileList("xml",r,q,undefined,p,".xml")},script:function(r,q,s,p){if(s===undefined){s=false}if(s!==false&&p===undefined){p=this}return this.addToFileList("script",r,q,{syncPoint:true,callback:s,callbackContext:p},false,".js")},binary:function(r,q,s,p){if(s===undefined){s=false}if(s!==false&&p===undefined){p=s}return this.addToFileList("binary",r,q,{callback:s,callbackContext:p},false,".bin")},spritesheet:function(s,r,p,q,u,t,v){if(u===undefined){u=-1}if(t===undefined){t=0}if(v===undefined){v=0}return this.addToFileList("spritesheet",s,r,{frameWidth:p,frameHeight:q,frameMax:u,margin:t,spacing:v},false,".png")},audio:function(q,r,p){if(this.game.sound.noAudio){return this}if(p===undefined){p=true}if(typeof r==="string"){r=[r]}return this.addToFileList("audio",q,r,{buffer:null,autoDecode:p})},audioSprite:function(q,t,s,r,p){if(this.game.sound.noAudio){return this}if(s===undefined){s=null}if(r===undefined){r=null}if(p===undefined){p=true}this.audio(q,t,p);if(s){this.json(q+"-audioatlas",s)}else{if(r){if(typeof r==="string"){r=JSON.parse(r)}this.cache.addJSON(q+"-audioatlas","",r)}else{console.warn("Phaser.Loader.audiosprite - You must specify either a jsonURL or provide a jsonData object")}}return this},audiosprite:function(q,t,s,r,p){return this.audioSprite(q,t,s,r,p)},video:function(q,s,r,p){if(r===undefined){if(this.game.device.firefox){r="loadeddata"}else{r="canplaythrough"}}if(p===undefined){p=false}if(typeof s==="string"){s=[s]}return this.addToFileList("video",q,s,{buffer:null,asBlob:p,loadEvent:r})},tilemap:function(q,p,r,s){if(p===undefined){p=null}if(r===undefined){r=null}if(s===undefined){s=g.Tilemap.CSV}if(!p&&!r){if(s===g.Tilemap.CSV){p=q+".csv"}else{p=q+".json"}}if(r){switch(s){case g.Tilemap.CSV:break;case g.Tilemap.TILED_JSON:if(typeof r==="string"){r=JSON.parse(r)}break}this.cache.addTilemap(q,null,r,s)}else{this.addToFileList("tilemap",q,p,{format:s})}return this},physics:function(q,p,r,s){if(p===undefined){p=null}if(r===undefined){r=null}if(s===undefined){s=g.Physics.LIME_CORONA_JSON}if(!p&&!r){p=q+".json"}if(r){if(typeof r==="string"){r=JSON.parse(r)}this.cache.addPhysicsData(q,null,r,s)}else{this.addToFileList("physics",q,p,{format:s})}return this},bitmapFont:function(v,p,w,q,u,t){if(p===undefined||p===null){p=v+".png"}if(w===undefined){w=null}if(q===undefined){q=null}if(w===null&&q===null){w=v+".xml"}if(u===undefined){u=0}if(t===undefined){t=0}if(w){this.addToFileList("bitmapfont",v,p,{atlasURL:w,xSpacing:u,ySpacing:t})}else{if(typeof q==="string"){var x,r;try{x=JSON.parse(q)}catch(s){r=this.parseXml(q)}if(!r&&!x){throw new Error("Phaser.Loader. Invalid Bitmap Font atlas given")}this.addToFileList("bitmapfont",v,p,{atlasURL:null,atlasData:x||r,atlasType:(!!x?"json":"xml"),xSpacing:u,ySpacing:t})}}return this},atlasJSONArray:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(r,q,s,p){return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(r,q,s,p){if(s===undefined){s=null}if(p===undefined){p=null}if(!s&&!p){s=r+".xml"}return this.atlas(r,q,s,p,g.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(s,r,t,p,u){if(r===undefined||r===null){r=s+".png"}if(t===undefined){t=null}if(p===undefined){p=null}if(u===undefined){u=g.Loader.TEXTURE_ATLAS_JSON_ARRAY}if(!t&&!p){if(u===g.Loader.TEXTURE_ATLAS_XML_STARLING){t=s+".xml"}else{t=s+".json"}}if(t){this.addToFileList("textureatlas",s,r,{atlasURL:t,format:u})}else{switch(u){case g.Loader.TEXTURE_ATLAS_JSON_ARRAY:if(typeof p==="string"){p=JSON.parse(p)}break;case g.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof p==="string"){var q=this.parseXml(p);if(!q){throw new Error("Phaser.Loader. Invalid Texture Atlas XML given")}p=q}break}this.addToFileList("textureatlas",s,r,{atlasURL:null,atlasData:p,format:u})}return this},withSyncPoint:function(q,p){this._withSyncPointDepth++;try{q.call(p||this,this)}finally{this._withSyncPointDepth--}return this},addSyncPoint:function(r,p){var q=this.getAsset(r,p);if(q){q.file.syncPoint=true}return this},removeFile:function(r,p){var q=this.getAsset(r,p);if(q){if(!q.loaded&&!q.loading){this._fileList.splice(q.index,1)}}},removeAll:function(){this._fileList.length=0;this._flightQueue.length=0},start:function(){if(this.isLoading){return}this.hasLoaded=false;this.isLoading=true;this.updateProgress();this.processLoadQueue()},processLoadQueue:function(){if(!this.isLoading){console.warn("Phaser.Loader - active loading canceled / reset");this.finishedLoading(true);return}for(var s=0;s<this._flightQueue.length;s++){var r=this._flightQueue[s];if(r.loaded||r.error){this._flightQueue.splice(s,1);s--;r.loading=false;r.requestUrl=null;r.requestObject=null;if(r.error){this.onFileError.dispatch(r.key,r)}if(r.type!=="packfile"){this._loadedFileCount++;this.onFileComplete.dispatch(this.progress,r.key,!r.error,this._loadedFileCount,this._totalFileCount)}else{if(r.type==="packfile"&&r.error){this._loadedPackCount++;this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)}}}}var p=false;var q=this.enableParallel?g.Math.clamp(this.maxParallelDownloads,1,12):1;for(var s=this._processingHead;s<this._fileList.length;s++){var r=this._fileList[s];if(r.type==="packfile"&&!r.error&&r.loaded&&s===this._processingHead){this.processPack(r);this._loadedPackCount++;this.onPackComplete.dispatch(r.key,!r.error,this._loadedPackCount,this._totalPackCount)}if(r.loaded||r.error){if(s===this._processingHead){this._processingHead=s+1}}else{if(!r.loading&&this._flightQueue.length<q){if(r.type==="packfile"&&!r.data){this._flightQueue.push(r);r.loading=true;this.loadFile(r)}else{if(!p){if(!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this._flightQueue.push(r);r.loading=true;this.onFileStart.dispatch(this.progress,r.key,r.url);this.loadFile(r)}}}}if(!r.loaded&&r.syncPoint){p=true}if(this._flightQueue.length>=q||(p&&this._loadedPackCount===this._totalPackCount)){break}}this.updateProgress();if(this._processingHead>=this._fileList.length){this.finishedLoading()}else{if(!this._flightQueue.length){console.warn("Phaser.Loader - aborting: processing queue empty, loading may have stalled");var t=this;setTimeout(function(){t.finishedLoading(true)},2000)}}},finishedLoading:function(p){if(this.hasLoaded){return}this.hasLoaded=true;this.isLoading=false;if(!p&&!this._fileLoadStarted){this._fileLoadStarted=true;this.onLoadStart.dispatch()}this.onLoadComplete.dispatch();this.game.state.loadComplete();this.reset()},asyncComplete:function(q,p){if(p===undefined){p=""}q.loaded=true;q.error=!!p;if(p){q.errorMessage=p;console.warn("Phaser.Loader - "+q.type+"["+q.key+"]: "+p)}this.processLoadQueue()},processPack:function(s){var p=s.data[s.key];if(!p){console.warn("Phaser.Loader - "+s.key+": pack has data, but not for pack key");return}for(var r=0;r<p.length;r++){var q=p[r];switch(q.type){case"image":this.image(q.key,q.url,q.overwrite);break;case"text":this.text(q.key,q.url,q.overwrite);break;case"json":this.json(q.key,q.url,q.overwrite);break;case"xml":this.xml(q.key,q.url,q.overwrite);break;case"script":this.script(q.key,q.url,q.callback,s.callbackContext||this);break;case"binary":this.binary(q.key,q.url,q.callback,s.callbackContext||this);break;case"spritesheet":this.spritesheet(q.key,q.url,q.frameWidth,q.frameHeight,q.frameMax,q.margin,q.spacing);break;case"video":this.video(q.key,q.urls);break;case"audio":this.audio(q.key,q.urls,q.autoDecode);break;case"audiosprite":this.audiosprite(q.key,q.urls,q.jsonURL,q.jsonData,q.autoDecode);break;case"tilemap":this.tilemap(q.key,q.url,q.data,g.Tilemap[q.format]);break;case"physics":this.physics(q.key,q.url,q.data,g.Loader[q.format]);break;case"bitmapFont":this.bitmapFont(q.key,q.textureURL,q.atlasURL,q.atlasData,q.xSpacing,q.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlasXML":this.atlasXML(q.key,q.textureURL,q.atlasURL,q.atlasData);break;case"atlas":this.atlas(q.key,q.textureURL,q.atlasURL,q.atlasData,g.Loader[q.format]);break;case"shader":this.shader(q.key,q.url,q.overwrite);break}}},transformUrl:function(p,q){if(!p){return false}if(p.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)){return p}else{return this.baseURL+q.path+p}},loadFile:function(p){switch(p.type){case"packfile":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.fileComplete);break;case"image":case"spritesheet":case"textureatlas":case"bitmapfont":this.loadImageTag(p);break;case"audio":p.url=this.getAudioURL(p.url);if(p.url){if(this.game.sound.usingWebAudio){this.xhrLoad(p,this.transformUrl(p.url,p),"arraybuffer",this.fileComplete)}else{if(this.game.sound.usingAudioTag){this.loadAudioTag(p)}}}else{this.fileError(p,null,"No supported audio URL specified or device does not have audio playback support")}break;case"video":p.url=this.getVideoURL(p.url);if(p.url){if(p.asBlob){this.xhrLoad(p,this.transformUrl(p.url,p),"blob",this.fileComplete)}else{this.loadVideoTag(p)}}else{this.fileError(p,null,"No supported video URL specified or device does not have video playback support")}break;case"json":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.jsonLoadComplete);break;case"xml":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.xmlLoadComplete);break;case"tilemap":if(p.format===g.Tilemap.TILED_JSON){this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.jsonLoadComplete)}else{if(p.format===g.Tilemap.CSV){this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.csvLoadComplete)}else{this.asyncComplete(p,"invalid Tilemap format: "+p.format)}}break;case"text":case"script":case"shader":case"physics":this.xhrLoad(p,this.transformUrl(p.url,p),"text",this.fileComplete);break;case"binary":this.xhrLoad(p,this.transformUrl(p.url,p),"arraybuffer",this.fileComplete);break}},loadImageTag:function(p){var q=this;p.data=new Image();p.data.name=p.key;if(this.crossOrigin){}p.data.onload=function(){if(p.data.onload){p.data.onload=null;p.data.onerror=null;q.fileComplete(p)}};p.data.onerror=function(){if(p.data.onload){p.data.onload=null;p.data.onerror=null;q.fileError(p)}};p.data.src=p.url;if(p.data.complete&&p.data.width&&p.data.height){p.data.onload=null;p.data.onerror=null;this.fileComplete(p)}},loadVideoTag:function(p){var r=this;p.data=document.createElement("video");p.data.name=p.key;p.data.controls=false;p.data.autoplay=false;var q=function(){p.data.removeEventListener(p.loadEvent,q,false);p.data.onerror=null;p.data.canplay=true;g.GAMES[r.game.id].load.fileComplete(p)};p.data.onerror=function(){p.data.removeEventListener(p.loadEvent,q,false);p.data.onerror=null;p.data.canplay=false;r.fileError(p)};p.data.addEventListener(p.loadEvent,q,false);p.data.src=p.url;p.data.load()},loadAudioTag:function(q){var r=this;if(this.game.sound.touchLocked){q.data=new Audio();q.data.name=q.key;q.data.preload="auto";q.data.src=q.url;this.fileComplete(q)}else{q.data=new Audio();q.data.name=q.key;var p=function(){q.data.removeEventListener("canplaythrough",p,false);q.data.onerror=null;r.fileComplete(q)};q.data.onerror=function(){q.data.removeEventListener("canplaythrough",p,false);q.data.onerror=null;r.fileError(q)};q.data.preload="auto";q.data.src=q.url;q.data.addEventListener("canplaythrough",p,false);q.data.load()}},xhrLoad:function(r,q,s,t,p){if(this.useXDomainRequest&&window.XDomainRequest){this.xhrLoadWithXDR(r,q,s,t,p);return}var u=new XMLHttpRequest();u.open("GET",q,true);u.responseType=s;if(this.headers.requestedWith!==false){u.setRequestHeader("X-Requested-With",this.headers.requestedWith)}if(this.headers[r.type]){u.setRequestHeader("Accept",this.headers[r.type])}p=p||this.fileError;var v=this;u.onload=function(){try{if(u.readyState===4&&u.status>=400&&u.status<=599){return p.call(v,r,u)}else{return t.call(v,r,u)}}catch(w){if(!v.hasLoaded){v.asyncComplete(r,w.message||"Exception")}else{if(window.console){console.error(w)}}}};u.onerror=function(){try{return p.call(v,r,u)}catch(w){if(!v.hasLoaded){v.asyncComplete(r,w.message||"Exception")}else{if(window.console){console.error(w)}}}};r.requestObject=u;r.requestUrl=q;u.send()},xhrLoadWithXDR:function(r,q,s,t,p){if(!this._warnedAboutXDomainRequest&&(!this.game.device.ie||this.game.device.ieVersion>=10)){this._warnedAboutXDomainRequest=true;console.warn("Phaser.Loader - using XDomainRequest outside of IE 9")}var u=new window.XDomainRequest();u.open("GET",q,true);u.responseType=s;u.timeout=3000;p=p||this.fileError;var v=this;u.onerror=function(){try{return p.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};u.ontimeout=function(){try{return p.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};u.onprogress=function(){};u.onload=function(){try{if(u.readyState===4&&u.status>=400&&u.status<=599){return p.call(v,r,u)}else{return t.call(v,r,u)}return t.call(v,r,u)}catch(w){v.asyncComplete(r,w.message||"Exception")}};r.requestObject=u;r.requestUrl=q;setTimeout(function(){u.send()},0)},getVideoURL:function(s){for(var q=0;q<s.length;q++){var p=s[q];var r;if(p.uri){r=p.type;p=p.uri;if(this.game.device.canPlayVideo(r)){return p}}else{if(p.indexOf("blob:")===0||p.indexOf("data:")===0){return p}if(p.indexOf("?")>=0){p=p.substr(0,p.indexOf("?"))}var t=p.substr((Math.max(0,p.lastIndexOf("."))||Infinity)+1);r=t.toLowerCase();if(this.game.device.canPlayVideo(r)){return s[q]}}}return null},getAudioURL:function(s){if(this.game.sound.noAudio){return null}for(var r=0;r<s.length;r++){var q=s[r];var p;if(q.uri){p=q.type;q=q.uri;if(this.game.device.canPlayAudio(p)){return q}}else{if(q.indexOf("blob:")===0||q.indexOf("data:")===0){return q}if(q.indexOf("?")>=0){q=q.substr(0,q.indexOf("?"))}var t=q.substr((Math.max(0,q.lastIndexOf("."))||Infinity)+1);p=t.toLowerCase();if(this.game.device.canPlayAudio(p)){return s[r]}}}return null},fileError:function(q,t,s){var p=q.requestUrl||this.transformUrl(q.url,q);var r="error loading asset from URL "+p;if(!s&&t){s=t.status}if(s){r=r+" ("+s+")"}this.asyncComplete(q,r)},fileComplete:function(p,t){var s=true;switch(p.type){case"packfile":var q=JSON.parse(t.responseText);p.data=q||{};break;case"image":this.cache.addImage(p.key,p.url,p.data);break;case"spritesheet":this.cache.addSpriteSheet(p.key,p.url,p.data,p.frameWidth,p.frameHeight,p.frameMax,p.margin,p.spacing);break;case"textureatlas":if(p.atlasURL==null){this.cache.addTextureAtlas(p.key,p.url,p.data,p.atlasData,p.format)}else{s=false;if(p.format===g.Loader.TEXTURE_ATLAS_JSON_ARRAY||p.format===g.Loader.TEXTURE_ATLAS_JSON_HASH||p.format===g.Loader.TEXTURE_ATLAS_JSON_PYXEL){this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",this.jsonLoadComplete)}else{if(p.format===g.Loader.TEXTURE_ATLAS_XML_STARLING){this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",this.xmlLoadComplete)}else{throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+p.format)}}}break;case"bitmapfont":if(!p.atlasURL){this.cache.addBitmapFont(p.key,p.url,p.data,p.atlasData,p.atlasType,p.xSpacing,p.ySpacing)}else{s=false;this.xhrLoad(p,this.transformUrl(p.atlasURL,p),"text",function(v,x){var u;try{u=JSON.parse(x.responseText)}catch(w){}if(!!u){v.atlasType="json";this.jsonLoadComplete(v,x)}else{v.atlasType="xml";this.xmlLoadComplete(v,x)}})}break;case"video":if(p.asBlob){try{p.data=t.response}catch(r){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+p.key)}}this.cache.addVideo(p.key,p.url,p.data,p.asBlob);break;case"audio":if(this.game.sound.usingWebAudio){p.data=t.response;this.cache.addSound(p.key,p.url,p.data,true,false);if(p.autoDecode){this.game.sound.decode(p.key)}}else{this.cache.addSound(p.key,p.url,p.data,false,true)}break;case"text":p.data=t.responseText;this.cache.addText(p.key,p.url,p.data);break;case"shader":p.data=t.responseText;this.cache.addShader(p.key,p.url,p.data);break;case"physics":var q=JSON.parse(t.responseText);this.cache.addPhysicsData(p.key,p.url,q,p.format);break;case"script":p.data=document.createElement("script");p.data.language="javascript";p.data.type="text/javascript";p.data.defer=false;p.data.text=t.responseText;document.head.appendChild(p.data);if(p.callback){p.data=p.callback.call(p.callbackContext,p.key,t.responseText)}break;case"binary":if(p.callback){p.data=p.callback.call(p.callbackContext,p.key,t.response)}else{p.data=t.response}this.cache.addBinary(p.key,p.data);break}if(s){this.asyncComplete(p)}},jsonLoadComplete:function(p,r){var q=JSON.parse(r.responseText);if(p.type==="tilemap"){this.cache.addTilemap(p.key,p.url,q,p.format)}else{if(p.type==="bitmapfont"){this.cache.addBitmapFont(p.key,p.url,p.data,q,p.atlasType,p.xSpacing,p.ySpacing)}else{if(p.type==="json"){this.cache.addJSON(p.key,p.url,q)}else{this.cache.addTextureAtlas(p.key,p.url,p.data,q,p.format)}}}this.asyncComplete(p)},csvLoadComplete:function(p,r){var q=r.responseText;this.cache.addTilemap(p.key,p.url,q,p.format);this.asyncComplete(p)},xmlLoadComplete:function(r,t){var s=t.responseText;var q=this.parseXml(s);if(!q){var p=t.responseType||t.contentType;console.warn("Phaser.Loader - "+r.key+": invalid XML ("+p+")");this.asyncComplete(r,"invalid XML");return}if(r.type==="bitmapfont"){this.cache.addBitmapFont(r.key,r.url,r.data,q,r.atlasType,r.xSpacing,r.ySpacing)}else{if(r.type==="textureatlas"){this.cache.addTextureAtlas(r.key,r.url,r.data,q,r.format)}else{if(r.type==="xml"){this.cache.addXML(r.key,r.url,q)}}}this.asyncComplete(r)},parseXml:function(q){var p;try{if(window.DOMParser){var s=new DOMParser();p=s.parseFromString(q,"text/xml")}else{p=new ActiveXObject("Microsoft.XMLDOM");p.async="false";p.loadXML(q)}}catch(r){p=null}if(!p||!p.documentElement||p.getElementsByTagName("parsererror").length){return null}else{return p}},updateProgress:function(){if(this.preloadSprite){if(this.preloadSprite.direction===0){this.preloadSprite.rect.width=Math.floor((this.preloadSprite.width/100)*this.progress)}else{this.preloadSprite.rect.height=Math.floor((this.preloadSprite.height/100)*this.progress)}if(this.preloadSprite.sprite){this.preloadSprite.sprite.updateCrop()}else{this.preloadSprite=null}}},totalLoadedFiles:function(){return this._loadedFileCount},totalQueuedFiles:function(){return this._totalFileCount-this._loadedFileCount},totalLoadedPacks:function(){return this._totalPackCount},totalQueuedPacks:function(){return this._totalPackCount-this._loadedPackCount}};Object.defineProperty(g.Loader.prototype,"progressFloat",{get:function(){var p=(this._loadedFileCount/this._totalFileCount)*100;return g.Math.clamp(p||0,0,100)}});Object.defineProperty(g.Loader.prototype,"progress",{get:function(){return Math.round(this.progressFloat)}});g.Loader.prototype.constructor=g.Loader;g.LoaderParser={bitmapFont:function(p,s,r,q){return this.xmlBitmapFont(p,s,r,q)},xmlBitmapFont:function(w,p,A,x){var t={};var r=w.getElementsByTagName("info")[0];var y=w.getElementsByTagName("common")[0];t.font=r.getAttribute("face");t.size=parseInt(r.getAttribute("size"),10);t.lineHeight=parseInt(y.getAttribute("lineHeight"),10)+x;t.chars={};var z=w.getElementsByTagName("char");for(var s=0;s<z.length;s++){var C=parseInt(z[s].getAttribute("id"),10);t.chars[C]={x:parseInt(z[s].getAttribute("x"),10),y:parseInt(z[s].getAttribute("y"),10),width:parseInt(z[s].getAttribute("width"),10),height:parseInt(z[s].getAttribute("height"),10),xOffset:parseInt(z[s].getAttribute("xoffset"),10),yOffset:parseInt(z[s].getAttribute("yoffset"),10),xAdvance:parseInt(z[s].getAttribute("xadvance"),10)+A,kerning:{}}}var B=w.getElementsByTagName("kerning");for(s=0;s<B.length;s++){var v=parseInt(B[s].getAttribute("first"),10);var q=parseInt(B[s].getAttribute("second"),10);var u=parseInt(B[s].getAttribute("amount"),10);t.chars[q].kerning[v]=u}return this.finalizeBitmapFont(p,t)},jsonBitmapFont:function(q,t,s,r){var u={font:q.font.info._face,size:parseInt(q.font.info._size,10),lineHeight:parseInt(q.font.common._lineHeight,10)+r,chars:{}};q.font.chars["char"].forEach(function p(x){var w=parseInt(x._id,10);u.chars[w]={x:parseInt(x._x,10),y:parseInt(x._y,10),width:parseInt(x._width,10),height:parseInt(x._height,10),xOffset:parseInt(x._xoffset,10),yOffset:parseInt(x._yoffset,10),xAdvance:parseInt(x._xadvance,10)+s,kerning:{}}});if(q.font.kernings&&q.font.kernings.kerning){q.font.kernings.kerning.forEach(function v(w){u.chars[w._second].kerning[w._first]=parseInt(w._amount,10)})}return this.finalizeBitmapFont(t,u)},finalizeBitmapFont:function(p,q){Object.keys(q.chars).forEach(function r(s){var t=q.chars[s];t.texture=new PIXI.Texture(p,new g.Rectangle(t.x,t.y,t.width,t.height))});return q}};g.AudioSprite=function(r,s){this.game=r;this.key=s;this.config=this.game.cache.getJSON(s+"-audioatlas");this.autoplayKey=null;this.autoplay=false;this.sounds={};for(var q in this.config.spritemap){var p=this.config.spritemap[q];var t=this.game.add.sound(this.key);t.addMarker(q,p.start,(p.end-p.start),null,p.loop);this.sounds[q]=t}if(this.config.autoplay){this.autoplayKey=this.config.autoplay;this.play(this.autoplayKey);this.autoplay=this.sounds[this.autoplayKey]}};g.AudioSprite.prototype={play:function(p,q){if(q===undefined){q=1}return this.sounds[p].play(p,null,q)},stop:function(p){if(!p){for(var q in this.sounds){this.sounds[q].stop()}}else{this.sounds[p].stop()}},get:function(p){return this.sounds[p]}};g.AudioSprite.prototype.constructor=g.AudioSprite;g.Sound=function(r,s,t,p,q){if(t===undefined){t=1}if(p===undefined){p=false}if(q===undefined){q=r.sound.connectToMaster}this.game=r;this.name=s;this.key=s;this.loop=p;this.markers={};this.context=null;this.autoplay=false;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=false;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=false;this.currentMarker="";this.fadeTween=null;this.pendingPlayback=false;this.override=false;this.allowMultiple=false;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this._sound=null;if(this.usingWebAudio){this.context=this.game.sound.context;this.masterGainNode=this.game.sound.masterGain;if(this.context.createGain===undefined){this.gainNode=this.context.createGainNode()}else{this.gainNode=this.context.createGain()}this.gainNode.gain.value=t*this.game.sound.volume;if(q){this.gainNode.connect(this.masterGainNode)}}else{if(this.usingAudioTag){if(this.game.cache.getSound(s)&&this.game.cache.isSoundReady(s)){this._sound=this.game.cache.getSoundData(s);this.totalDuration=0;if(this._sound.duration){this.totalDuration=this._sound.duration}}else{this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this)}}}this.onDecoded=new g.Signal();this.onPlay=new g.Signal();this.onPause=new g.Signal();this.onResume=new g.Signal();this.onLoop=new g.Signal();this.onStop=new g.Signal();this.onMute=new g.Signal();this.onMarkerComplete=new g.Signal();this.onFadeComplete=new g.Signal();this._volume=t;this._buffer=null;this._muted=false;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._tempPause=0;this._muteVolume=0;this._tempLoop=0;this._paused=false;this._onDecodedEventDispatched=false};g.Sound.prototype={soundHasUnlocked:function(p){if(p===this.key){this._sound=this.game.cache.getSoundData(this.key);this.totalDuration=this._sound.duration}},addMarker:function(q,t,s,r,p){if(s===undefined||s===null){s=1}if(r===undefined||r===null){r=1}if(p===undefined){p=false}this.markers[q]={name:q,start:t,stop:t+s,volume:r,duration:s,durationMS:s*1000,loop:p}},removeMarker:function(p){delete this.markers[p]},onEndedHandler:function(){this._sound.onended=null;this.isPlaying=false;this.currentTime=this.durationMS;this.stop()},update:function(){if(!this.game.cache.checkSoundKey(this.key)){this.destroy();return}if(this.isDecoded&&!this._onDecodedEventDispatched){this.onDecoded.dispatch(this);this._onDecodedEventDispatched=true}if(this.pendingPlayback&&this.game.cache.isSoundReady(this.key)){this.pendingPlayback=false;this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop)}if(this.isPlaying){this.currentTime=this.game.time.time-this.startTime;if(this.currentTime>=this.durationMS){if(this.usingWebAudio){if(this.loop){this.onLoop.dispatch(this);this.isPlaying=false;if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time;this.isPlaying=true}else{this.onMarkerComplete.dispatch(this.currentMarker,this);this.play(this.currentMarker,0,this.volume,true,true)}}else{if(this.currentMarker!==""){this.stop()}}}else{if(this.loop){this.onLoop.dispatch(this);if(this.currentMarker===""){this.currentTime=0;this.startTime=this.game.time.time}this.isPlaying=false;this.play(this.currentMarker,0,this.volume,true,true)}else{this.stop()}}}}},loopFull:function(p){return this.play(null,0,p,true)},play:function(r,p,t,q,s){if(r===undefined||r===false||r===null){r=""}if(s===undefined){s=true}if(this.isPlaying&&!this.allowMultiple&&!s&&!this.override){return this}if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||s)){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(u){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else{if(this.gainNode){this._sound.disconnect(this.gainNode)}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}this.isPlaying=false}if(r===""&&Object.keys(this.markers).length>0){return this}if(r!==""){if(this.markers[r]){this.currentMarker=r;this.position=this.markers[r].start;this.volume=this.markers[r].volume;this.loop=this.markers[r].loop;this.duration=this.markers[r].duration;this.durationMS=this.markers[r].durationMS;if(typeof t!=="undefined"){this.volume=t}if(typeof q!=="undefined"){this.loop=q}this._tempMarker=r;this._tempPosition=this.position;this._tempVolume=this.volume;this._tempLoop=this.loop}else{console.warn("Phaser.Sound.play: audio marker "+r+" doesn't exist");return this}}else{p=p||0;if(t===undefined){t=this._volume}if(q===undefined){q=this.loop}this.position=Math.max(0,p);this.volume=t;this.loop=q;this.duration=0;this.durationMS=0;this._tempMarker=r;this._tempPosition=p;this._tempVolume=t;this._tempLoop=q}if(this.usingWebAudio){if(this.game.cache.isSoundDecoded(this.key)){this._sound=this.context.createBufferSource();if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}this._buffer=this.game.cache.getSoundData(this.key);this._sound.buffer=this._buffer;if(this.loop&&r===""){this._sound.loop=true}if(!this.loop&&r===""){this._sound.onended=this.onEndedHandler.bind(this)}this.totalDuration=this._sound.buffer.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=Math.ceil(this.totalDuration*1000)}if(this._sound.start===undefined){this._sound.noteGrainOn(0,this.position,this.duration)}else{if(this.loop&&r===""){this._sound.start(0,0)}else{this._sound.start(0,this.position,this.duration)}}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true;if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===false){this.game.sound.decode(this.key,this)}}}else{if(this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked){this.game.cache.reloadSound(this.key);this.pendingPlayback=true}else{if(this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)){this._sound.play();this.totalDuration=this._sound.duration;if(this.duration===0){this.duration=this.totalDuration;this.durationMS=this.totalDuration*1000}this._sound.currentTime=this.position;this._sound.muted=this._muted;if(this._muted||this.game.sound.mute){this._sound.volume=0}else{this._sound.volume=this._volume}this.isPlaying=true;this.startTime=this.game.time.time;this.currentTime=0;this.stopTime=this.startTime+this.durationMS;this.onPlay.dispatch(this)}else{this.pendingPlayback=true}}}return this},restart:function(r,p,s,q){r=r||"";p=p||0;s=s||1;if(q===undefined){q=false}this.play(r,p,s,q,true)},pause:function(){if(this.isPlaying&&this._sound){this.paused=true;this.pausedPosition=this.currentTime;this.pausedTime=this.game.time.time;this._tempPause=this._sound.currentTime;this.onPause.dispatch(this);this.stop()}},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var r=Math.max(0,this.position+(this.pausedPosition/1000));this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;if(this.externalNode){this._sound.connect(this.externalNode)}else{this._sound.connect(this.gainNode)}if(this.loop){this._sound.loop=true}if(!this.loop&&this.currentMarker===""){this._sound.onended=this.onEndedHandler.bind(this)}var q=this.duration-(this.pausedPosition/1000);if(this._sound.start===undefined){this._sound.noteGrainOn(0,r,q)}else{if(this.loop&&this.game.device.chrome){if(this.game.device.chromeVersion===42){this._sound.start(0)}else{this._sound.start(0,r)}}else{this._sound.start(0,r,q)}}}else{this._sound.currentTime=this._tempPause;this._sound.play()}this.isPlaying=true;this.paused=false;this.startTime+=(this.game.time.time-this.pausedTime);this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound){if(this.usingWebAudio){if(this._sound.stop===undefined){this._sound.noteOff(0)}else{try{this._sound.stop(0)}catch(q){}}if(this.externalNode){this._sound.disconnect(this.externalNode)}else{if(this.gainNode){this._sound.disconnect(this.gainNode)}}}else{if(this.usingAudioTag){this._sound.pause();this._sound.currentTime=0}}}this.pendingPlayback=false;this.isPlaying=false;if(!this.paused){var p=this.currentMarker;if(this.currentMarker!==""){this.onMarkerComplete.dispatch(this.currentMarker,this)}this.currentMarker="";if(this.fadeTween!==null){this.fadeTween.stop()}this.onStop.dispatch(this,p)}},fadeIn:function(r,q,p){if(q===undefined){q=false}if(p===undefined){p=this.currentMarker}if(this.paused){return}this.play(p,0,0,q);this.fadeTo(r,1)},fadeOut:function(p){this.fadeTo(p,0)},fadeTo:function(q,p){if(!this.isPlaying||this.paused||p===this.volume){return}if(q===undefined){q=1000}if(p===undefined){console.warn("Phaser.Sound.fadeTo: No Volume Specified.");return}this.fadeTween=this.game.add.tween(this).to({volume:p},q,g.Easing.Linear.None,true);this.fadeTween.onComplete.add(this.fadeComplete,this)},fadeComplete:function(){this.onFadeComplete.dispatch(this,this.volume);if(this.volume===0){this.stop()}},updateGlobalVolume:function(p){if(this.usingAudioTag&&this._sound){this._sound.volume=p*this._volume}},destroy:function(p){if(p===undefined){p=true}this.stop();if(p){this.game.sound.remove(this)}else{this.markers={};this.context=null;this._buffer=null;this.externalNode=null;this.onDecoded.dispose();this.onPlay.dispose();this.onPause.dispose();this.onResume.dispose();this.onLoop.dispose();this.onStop.dispose();this.onMute.dispose();this.onMarkerComplete.dispose()}}};g.Sound.prototype.constructor=g.Sound;Object.defineProperty(g.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(g.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(g.Sound.prototype,"mute",{get:function(){return(this._muted||this.game.sound.mute)},set:function(p){p=p||false;if(p===this._muted){return}if(p){this._muted=true;this._muteVolume=this._tempVolume;if(this.usingWebAudio){this.gainNode.gain.value=0}else{if(this.usingAudioTag&&this._sound){this._sound.volume=0}}}else{this._muted=false;if(this.usingWebAudio){this.gainNode.gain.value=this._muteVolume}else{if(this.usingAudioTag&&this._sound){this._sound.volume=this._muteVolume}}}this.onMute.dispatch(this)}});Object.defineProperty(g.Sound.prototype,"volume",{get:function(){return this._volume},set:function(p){if(this.game.device.firefox&&this.usingAudioTag){p=this.game.math.clamp(p,0,1)}if(this._muted){this._muteVolume=p;return}this._tempVolume=p;this._volume=p;if(this.usingWebAudio){this.gainNode.gain.value=p}else{if(this.usingAudioTag&&this._sound){this._sound.volume=p}}}});g.SoundManager=function(p){this.game=p;this.onSoundDecode=new g.Signal();this.onVolumeChange=new g.Signal();this.onMute=new g.Signal();this.onUnMute=new g.Signal();this.context=null;this.usingWebAudio=false;this.usingAudioTag=false;this.noAudio=false;this.connectToMaster=true;this.touchLocked=false;this.channels=32;this.muteOnPause=true;this._codeMuted=false;this._muted=false;this._unlockSource=null;this._volume=1;this._sounds=[];this._watchList=new g.ArraySet();this._watching=false;this._watchCallback=null;this._watchContext=null};g.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===false){this.channels=1}if(window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===true){this.noAudio=true;this.touchLocked=false;return}if(window.PhaserGlobal.disableWebAudio===true){this.usingAudioTag=true;this.touchLocked=false;return}}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext){this.context=window.PhaserGlobal.audioContext}else{if(!!window.AudioContext){try{this.context=new window.AudioContext()}catch(p){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}else{if(!!window.webkitAudioContext){try{this.context=new window.webkitAudioContext()}catch(p){this.context=null;this.usingWebAudio=false;this.touchLocked=false}}}}if(this.context===null){if(window.Audio===undefined){this.noAudio=true;return}else{this.usingAudioTag=true}}else{this.usingWebAudio=true;if(this.context.createGain===undefined){this.masterGain=this.context.createGainNode()}else{this.masterGain=this.context.createGain()}this.masterGain.gain.value=1;this.masterGain.connect(this.context.destination)}if(!this.noAudio){if(!this.game.device.cocoonJS&&this.game.device.iOS||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.setTouchLock()}}},setTouchLock:function(){if(this.noAudio||(window.PhaserGlobal&&window.PhaserGlobal.disableAudio===true)){return}if(this.game.device.iOSVersion>8){this.game.input.touch.addTouchLockCallback(this.unlock,this,true)}else{this.game.input.touch.addTouchLockCallback(this.unlock,this)}this.touchLocked=true},unlock:function(){if(this.noAudio||!this.touchLocked||this._unlockSource!==null){return true}if(this.usingAudioTag){this.touchLocked=false;this._unlockSource=null}else{if(this.usingWebAudio){var p=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=p;this._unlockSource.connect(this.context.destination);if(this._unlockSource.start===undefined){this._unlockSource.noteOn(0)}else{this._unlockSource.start(0)}}}return true},stopAll:function(){if(this.noAudio){return}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].stop()}}},pauseAll:function(){if(this.noAudio){return}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].pause()}}},resumeAll:function(){if(this.noAudio){return}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].resume()}}},decode:function(q,s){s=s||null;var p=this.game.cache.getSoundData(q);if(p){if(this.game.cache.isSoundDecoded(q)===false){this.game.cache.updateSound(q,"isDecoding",true);var t=this;try{this.context.decodeAudioData(p,function(u){if(u){t.game.cache.decodedSound(q,u);t.onSoundDecode.dispatch(q,s)}})}catch(r){}}}},setDecodedCallback:function(r,s,p){if(typeof r==="string"){r=[r]}this._watchList.reset();for(var q=0;q<r.length;q++){if(r[q] instanceof g.Sound){if(!this.game.cache.isSoundDecoded(r[q].key)){this._watchList.add(r[q].key)}}else{if(!this.game.cache.isSoundDecoded(r[q])){this._watchList.add(r[q])}}}if(this._watchList.total===0){this._watching=false;s.call(p)}else{this._watching=true;this._watchCallback=s;this._watchContext=p}},update:function(){if(this.noAudio){return}if(this.touchLocked&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)){this.touchLocked=false;this._unlockSource=null}for(var q=0;q<this._sounds.length;q++){this._sounds[q].update()}if(this._watching){var p=this._watchList.first;while(p){if(this.game.cache.isSoundDecoded(p)){this._watchList.remove(p)}p=this._watchList.next}if(this._watchList.total===0){this._watching=false;this._watchCallback.call(this._watchContext)}}},add:function(r,s,p,q){if(s===undefined){s=1}if(p===undefined){p=false}if(q===undefined){q=this.connectToMaster}var t=new g.Sound(this.game,r,s,p,q);this._sounds.push(t);return t},addSprite:function(q){var p=new g.AudioSprite(this.game,q);return p},remove:function(q){var p=this._sounds.length;while(p--){if(this._sounds[p]===q){this._sounds[p].destroy(false);this._sounds.splice(p,1);return true}}return false},removeByKey:function(q){var p=this._sounds.length;var r=0;while(p--){if(this._sounds[p].key===q){this._sounds[p].destroy(false);this._sounds.splice(p,1);r++}}return r},play:function(q,r,p){if(this.noAudio){return}var s=this.add(q,r,p);s.play();return s},setMute:function(){if(this._muted){return}this._muted=true;if(this.usingWebAudio){this._muteVolume=this.masterGain.gain.value;this.masterGain.gain.value=0}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].mute=true}}this.onMute.dispatch()},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;if(this.usingWebAudio){this.masterGain.gain.value=this._muteVolume}for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].mute=false}}this.onUnMute.dispatch()},destroy:function(){this.stopAll();for(var p=0;p<this._sounds.length;p++){if(this._sounds[p]){this._sounds[p].destroy()}}this._sounds=[];this.onSoundDecode.dispose();if(this.context){if(window.PhaserGlobal){window.PhaserGlobal.audioContext=this.context}else{if(this.context.close){this.context.close()}}}}};g.SoundManager.prototype.constructor=g.SoundManager;Object.defineProperty(g.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(p){p=p||false;if(p){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(g.SoundManager.prototype,"volume",{get:function(){return this._volume},set:function(q){if(q<0){q=0}else{if(q>1){q=1}}if(this._volume!==q){this._volume=q;if(this.usingWebAudio){this.masterGain.gain.value=q}else{for(var p=0;p<this._sounds.length;p++){if(this._sounds[p].usingAudioTag){this._sounds[p].updateGlobalVolume(q)}}}this.onVolumeChange.dispatch(q)}}});g.ScaleManager=function(q,r,p){this.game=q;this.dom=g.DOM;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new g.Point();this.forceLandscape=false;this.forcePortrait=false;this.incorrectOrientation=false;this._pageAlignHorizontally=false;this._pageAlignVertically=false;this.onOrientationChange=new g.Signal();this.enterIncorrectOrientation=new g.Signal();this.leaveIncorrectOrientation=new g.Signal();this.hasPhaserSetFullScreen=false;this.fullScreenTarget=null;this._createdFullScreenTarget=null;this.onFullScreenInit=new g.Signal();this.onFullScreenChange=new g.Signal();this.onFullScreenError=new g.Signal();this.screenOrientation=this.dom.getScreenOrientation();this.scaleFactor=new g.Point(1,1);this.scaleFactorInversed=new g.Point(1,1);this.margin={left:0,top:0,right:0,bottom:0,x:0,y:0};this.bounds=new g.Rectangle();this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.windowConstraints={right:"layout",bottom:""};this.compatibility={supportsFullScreen:false,orientationFallback:null,noMargins:false,scrollTo:null,forceMinimumDocumentHeight:false,canExpandParent:true,clickTrampoline:""};this._scaleMode=g.ScaleManager.NO_SCALE;this._fullScreenScaleMode=g.ScaleManager.NO_SCALE;this.parentIsWindow=false;this.parentNode=null;this.parentScaleFactor=new g.Point(1,1);this.trackParentInterval=2000;this.onSizeChange=new g.Signal();this.onResize=null;this.onResizeContext=null;this._pendingScaleMode=null;this._fullScreenRestore=null;this._gameSize=new g.Rectangle();this._userScaleFactor=new g.Point(1,1);this._userScaleTrim=new g.Point(0,0);this._lastUpdate=0;this._updateThrottle=0;this._updateThrottleReset=100;this._parentBounds=new g.Rectangle();this._tempBounds=new g.Rectangle();this._lastReportedCanvasSize=new g.Rectangle();this._lastReportedGameSize=new g.Rectangle();this._booted=false;if(q.config){this.parseConfig(q.config)}this.setupScale(r,p)};g.ScaleManager.EXACT_FIT=0;g.ScaleManager.NO_SCALE=1;g.ScaleManager.SHOW_ALL=2;g.ScaleManager.RESIZE=3;g.ScaleManager.USER_SCALE=4;g.ScaleManager.prototype={boot:function(){var p=this.compatibility;p.supportsFullScreen=this.game.device.fullscreen&&!this.game.device.cocoonJS;if(!this.game.device.iPad&&!this.game.device.webApp&&!this.game.device.desktop){if(this.game.device.android&&!this.game.device.chrome){p.scrollTo=new g.Point(0,1)}else{p.scrollTo=new g.Point(0,0)}}if(this.game.device.desktop){p.orientationFallback="screen";p.clickTrampoline="when-not-mouse"}else{p.orientationFallback="";p.clickTrampoline=""}var q=this;this._orientationChange=function(r){return q.orientationChange(r)};this._windowResize=function(r){return q.windowResize(r)};window.addEventListener("orientationchange",this._orientationChange,false);window.addEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){this._fullScreenChange=function(r){return q.fullScreenChange(r)};this._fullScreenError=function(r){return q.fullScreenError(r)};document.addEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.addEventListener("mozfullscreenchange",this._fullScreenChange,false);document.addEventListener("MSFullscreenChange",this._fullScreenChange,false);document.addEventListener("fullscreenchange",this._fullScreenChange,false);document.addEventListener("webkitfullscreenerror",this._fullScreenError,false);document.addEventListener("mozfullscreenerror",this._fullScreenError,false);document.addEventListener("MSFullscreenError",this._fullScreenError,false);document.addEventListener("fullscreenerror",this._fullScreenError,false)}this.game.onResume.add(this._gameResumed,this);this.dom.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.setGameSize(this.game.width,this.game.height);this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);if(g.FlexGrid){this.grid=new g.FlexGrid(this,this.width,this.height)}this._booted=true;if(this._pendingScaleMode!==null){this.scaleMode=this._pendingScaleMode;this._pendingScaleMode=null}},parseConfig:function(p){if(p.scaleMode!==undefined){if(this._booted){this.scaleMode=p.scaleMode}else{this._pendingScaleMode=p.scaleMode}}if(p.fullScreenScaleMode!==undefined){this.fullScreenScaleMode=p.fullScreenScaleMode}if(p.fullScreenTarget){this.fullScreenTarget=p.fullScreenTarget}},setupScale:function(r,p){var u;var t=new g.Rectangle();if(this.game.parent!==""){if(typeof this.game.parent==="string"){u=document.getElementById(this.game.parent)}else{if(this.game.parent&&this.game.parent.nodeType===1){u=this.game.parent}}}if(!u){this.parentNode=null;this.parentIsWindow=true;t.width=this.dom.visualBounds.width;t.height=this.dom.visualBounds.height;this.offset.set(0,0)}else{this.parentNode=u;this.parentIsWindow=false;this.getParentBounds(this._parentBounds);t.width=this._parentBounds.width;t.height=this._parentBounds.height;this.offset.set(this._parentBounds.x,this._parentBounds.y)}var s=0;var q=0;if(typeof r==="number"){s=r}else{this.parentScaleFactor.x=parseInt(r,10)/100;s=t.width*this.parentScaleFactor.x}if(typeof p==="number"){q=p}else{this.parentScaleFactor.y=parseInt(p,10)/100;q=t.height*this.parentScaleFactor.y}s=Math.floor(s);q=Math.floor(q);this._gameSize.setTo(0,0,s,q);this.updateDimensions(s,q,false)},_gameResumed:function(){this.queueUpdate(true)},setGameSize:function(q,p){this._gameSize.setTo(0,0,q,p);if(this.currentScaleMode!==g.ScaleManager.RESIZE){this.updateDimensions(q,p,true)}this.queueUpdate(true)},setUserScale:function(q,s,r,p){this._userScaleFactor.setTo(q,s);this._userScaleTrim.setTo(r|0,p|0);this.queueUpdate(true)},setResizeCallback:function(q,p){this.onResize=q;this.onResizeContext=p},signalSizeChange:function(){if(!g.Rectangle.sameDimensions(this,this._lastReportedCanvasSize)||!g.Rectangle.sameDimensions(this.game,this._lastReportedGameSize)){var q=this.width;var p=this.height;this._lastReportedCanvasSize.setTo(0,0,q,p);this._lastReportedGameSize.setTo(0,0,this.game.width,this.game.height);if(this.grid){this.grid.onResize(q,p)}this.onSizeChange.dispatch(this,q,p);if(this.currentScaleMode===g.ScaleManager.RESIZE){this.game.state.resize(q,p);this.game.load.resize(q,p)}}},setMinMax:function(p,s,r,q){this.minWidth=p;this.minHeight=s;if(typeof r!=="undefined"){this.maxWidth=r}if(typeof q!=="undefined"){this.maxHeight=q}},preUpdate:function(){if(this.game.time.time<(this._lastUpdate+this._updateThrottle)){return}var q=this._updateThrottle;this._updateThrottleReset=q>=400?0:100;this.dom.getOffset(this.game.canvas,this.offset);var t=this._parentBounds.width;var v=this._parentBounds.height;var s=this.getParentBounds(this._parentBounds);var r=s.width!==t||s.height!==v;var p=this.updateOrientationState();if(r||p){if(this.onResize){this.onResize.call(this.onResizeContext,this,s)}this.updateLayout();this.signalSizeChange()}var u=this._updateThrottle*2;if(this._updateThrottle<q){u=Math.min(q,this._updateThrottleReset)}this._updateThrottle=g.Math.clamp(u,25,this.trackParentInterval);this._lastUpdate=this.game.time.time},pauseUpdate:function(){this.preUpdate();this._updateThrottle=this.trackParentInterval},updateDimensions:function(r,p,q){this.width=r*this.parentScaleFactor.x;this.height=p*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.updateScalingAndBounds();if(q){this.game.renderer.resize(this.width,this.height);this.game.camera.setSize(this.width,this.height);this.game.world.resize(this.width,this.height)}},updateScalingAndBounds:function(){this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.aspectRatio=this.width/this.height;if(this.game.canvas){this.dom.getOffset(this.game.canvas,this.offset)}this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);if(this.game.input&&this.game.input.scale){this.game.input.scale.setTo(this.scaleFactor.x,this.scaleFactor.y)}},forceOrientation:function(q,p){if(p===undefined){p=false}this.forceLandscape=q;this.forcePortrait=p;this.queueUpdate(true)},classifyOrientation:function(p){if(p==="portrait-primary"||p==="portrait-secondary"){return"portrait"}else{if(p==="landscape-primary"||p==="landscape-secondary"){return"landscape"}else{return null}}},updateOrientationState:function(){var r=this.screenOrientation;var q=this.incorrectOrientation;this.screenOrientation=this.dom.getScreenOrientation(this.compatibility.orientationFallback);this.incorrectOrientation=(this.forceLandscape&&!this.isLandscape)||(this.forcePortrait&&!this.isPortrait);var s=r!==this.screenOrientation;var p=q!==this.incorrectOrientation;if(p){if(this.incorrectOrientation){this.enterIncorrectOrientation.dispatch()}else{this.leaveIncorrectOrientation.dispatch()}}if(s||p){this.onOrientationChange.dispatch(this,r,q)}return s||p},orientationChange:function(p){this.event=p;this.queueUpdate(true)},windowResize:function(p){this.event=p;this.queueUpdate(true)},scrollTop:function(){var p=this.compatibility.scrollTo;if(p){window.scrollTo(p.x,p.y)}},refresh:function(){this.scrollTop();this.queueUpdate(true)},updateLayout:function(){var p=this.currentScaleMode;if(p===g.ScaleManager.RESIZE){this.reflowGame();return}this.scrollTop();if(this.compatibility.forceMinimumDocumentHeight){document.documentElement.style.minHeight=window.innerHeight+"px"}if(this.incorrectOrientation){this.setMaximum()}else{if(p===g.ScaleManager.EXACT_FIT){this.setExactFit()}else{if(p===g.ScaleManager.SHOW_ALL){if(!this.isFullScreen&&this.boundingParent&&this.compatibility.canExpandParent){this.setShowAll(true);this.resetCanvas();this.setShowAll()}else{this.setShowAll()}}else{if(p===g.ScaleManager.NO_SCALE){this.width=this.game.width;this.height=this.game.height}else{if(p===g.ScaleManager.USER_SCALE){this.width=(this.game.width*this._userScaleFactor.x)-this._userScaleTrim.x;this.height=(this.game.height*this._userScaleFactor.y)-this._userScaleTrim.y}}}}}if(!this.compatibility.canExpandParent&&(p===g.ScaleManager.SHOW_ALL||p===g.ScaleManager.USER_SCALE)){var q=this.getParentBounds(this._tempBounds);this.width=Math.min(this.width,q.width);this.height=Math.min(this.height,q.height)}this.width=this.width|0;this.height=this.height|0;this.reflowCanvas()},getParentBounds:function(v){var p=v||new g.Rectangle();var u=this.boundingParent;var s=this.dom.visualBounds;var x=this.dom.layoutBounds;if(!u){p.setTo(0,0,s.width,s.height)}else{var q=u.getBoundingClientRect();var w=(u.offsetParent)?u.offsetParent.getBoundingClientRect():u.getBoundingClientRect();p.setTo(q.left-w.left,q.top-w.top,q.width,q.height);var t=this.windowConstraints;if(t.right){var r=t.right==="layout"?x:s;p.right=Math.min(p.right,r.width)}if(t.bottom){var r=t.bottom==="layout"?x:s;p.bottom=Math.min(p.bottom,r.height)}}p.setTo(Math.round(p.x),Math.round(p.y),Math.round(p.width),Math.round(p.height));return p},alignCanvas:function(q,s){var x=this.getParentBounds(this._tempBounds);var r=this.game.canvas;var t=this.margin;if(q){t.left=t.right=0;var w=r.getBoundingClientRect();if(this.width<x.width&&!this.incorrectOrientation){var p=w.left-x.x;var v=(x.width/2)-(this.width/2);v=Math.max(v,0);var u=v-p;t.left=Math.round(u)}r.style.marginLeft=t.left+"px";if(t.left!==0){t.right=-(x.width-w.width-t.left);r.style.marginRight=t.right+"px"}}if(s){t.top=t.bottom=0;var w=r.getBoundingClientRect();if(this.height<x.height&&!this.incorrectOrientation){var p=w.top-x.y;var v=(x.height/2)-(this.height/2);v=Math.max(v,0);var u=v-p;t.top=Math.round(u)}r.style.marginTop=t.top+"px";if(t.top!==0){t.bottom=-(x.height-w.height-t.top);r.style.marginBottom=t.bottom+"px"}}t.x=t.left;t.y=t.top},reflowGame:function(){this.resetCanvas("","");var p=this.getParentBounds(this._tempBounds);this.updateDimensions(p.width,p.height,true)},reflowCanvas:function(){if(!this.incorrectOrientation){this.width=g.Math.clamp(this.width,this.minWidth||0,this.maxWidth||this.width);this.height=g.Math.clamp(this.height,this.minHeight||0,this.maxHeight||this.height)}this.resetCanvas();if(!this.compatibility.noMargins){if(this.isFullScreen&&this._createdFullScreenTarget){this.alignCanvas(true,true)}else{this.alignCanvas(this.pageAlignHorizontally,this.pageAlignVertically)}}this.updateScalingAndBounds()},resetCanvas:function(r,q){if(r===undefined){r=this.width+"px"}if(q===undefined){q=this.height+"px"}var p=this.game.canvas;if(!this.compatibility.noMargins){p.style.marginLeft="";p.style.marginTop="";p.style.marginRight="";p.style.marginBottom=""}p.style.width=r;p.style.height=q},queueUpdate:function(p){if(p){this._parentBounds.width=0;this._parentBounds.height=0}this._updateThrottle=this._updateThrottleReset},reset:function(p){if(p&&this.grid){this.grid.reset()}},setMaximum:function(){this.width=this.dom.visualBounds.width;this.height=this.dom.visualBounds.height},setShowAll:function(t){var r=this.getParentBounds(this._tempBounds);var q=r.width;var p=r.height;var s;if(t){s=Math.max((p/this.game.height),(q/this.game.width))}else{s=Math.min((p/this.game.height),(q/this.game.width))}this.width=Math.round(this.game.width*s);this.height=Math.round(this.game.height*s)},setExactFit:function(){var p=this.getParentBounds(this._tempBounds);this.width=p.width;this.height=p.height;if(this.isFullScreen){return}if(this.maxWidth){this.width=Math.min(this.width,this.maxWidth)}if(this.maxHeight){this.height=Math.min(this.height,this.maxHeight)}},createFullScreenTarget:function(){var p=document.createElement("div");p.style.margin="0";p.style.padding="0";p.style.background="#000";return p},startFullScreen:function(q,v){if(this.isFullScreen){return false}if(!this.compatibility.supportsFullScreen){var w=this;setTimeout(function(){w.fullScreenError()},10);return}if(this.compatibility.clickTrampoline==="when-not-mouse"){var r=this.game.input;if(r.activePointer&&r.activePointer!==r.mousePointer&&(v||v!==false)){r.activePointer.addClickTrampoline("startFullScreen",this.startFullScreen,this,[q,false]);return}}if(q!==undefined&&this.game.renderType===g.CANVAS){this.game.stage.smoothed=q}var u=this.fullScreenTarget;if(!u){this.cleanupCreatedTarget();this._createdFullScreenTarget=this.createFullScreenTarget();u=this._createdFullScreenTarget}var p={targetElement:u};this.hasPhaserSetFullScreen=true;this.onFullScreenInit.dispatch(this,p);if(this._createdFullScreenTarget){var s=this.game.canvas;var t=s.parentNode;t.insertBefore(u,s);u.appendChild(s)}if(this.game.device.fullscreenKeyboard){u[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT)}else{u[this.game.device.requestFullscreen]()}return true},stopFullScreen:function(){if(!this.isFullScreen||!this.compatibility.supportsFullScreen){return false}this.hasPhaserSetFullScreen=false;document[this.game.device.cancelFullscreen]();return true},cleanupCreatedTarget:function(){var q=this._createdFullScreenTarget;if(q&&q.parentNode){var p=q.parentNode;p.insertBefore(this.game.canvas,q);p.removeChild(q)}this._createdFullScreenTarget=null},prepScreenMode:function(r){var p=!!this._createdFullScreenTarget;var q=this._createdFullScreenTarget||this.fullScreenTarget;if(r){if(p||this.fullScreenScaleMode===g.ScaleManager.EXACT_FIT){if(q!==this.game.canvas){this._fullScreenRestore={targetWidth:q.style.width,targetHeight:q.style.height};q.style.width="100%";q.style.height="100%"}}}else{if(this._fullScreenRestore){q.style.width=this._fullScreenRestore.targetWidth;q.style.height=this._fullScreenRestore.targetHeight;this._fullScreenRestore=null}this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.resetCanvas()}},fullScreenChange:function(p){this.event=p;if(this.isFullScreen){this.prepScreenMode(true);this.updateLayout();this.queueUpdate(true)}else{this.prepScreenMode(false);this.cleanupCreatedTarget();this.updateLayout();this.queueUpdate(true)}this.onFullScreenChange.dispatch(this,this.width,this.height)},fullScreenError:function(p){this.event=p;this.cleanupCreatedTarget();console.warn("Phaser.ScaleManager: requestFullscreen failed or device does not support the Fullscreen API");this.onFullScreenError.dispatch(this)},scaleSprite:function(v,q,w,p){if(q===undefined){q=this.width}if(w===undefined){w=this.height}if(p===undefined){p=false}if(!v||!v.scale){return v}v.scale.x=1;v.scale.y=1;if((v.width<=0)||(v.height<=0)||(q<=0)||(w<=0)){return v}var s=q;var x=(v.height*q)/v.width;var r=(v.width*w)/v.height;var u=w;var t=(r>q);if(t){t=p}else{t=!p}if(t){v.width=Math.floor(s);v.height=Math.floor(x)}else{v.width=Math.floor(r);v.height=Math.floor(u)}return v},destroy:function(){this.game.onResume.remove(this._gameResumed,this);window.removeEventListener("orientationchange",this._orientationChange,false);window.removeEventListener("resize",this._windowResize,false);if(this.compatibility.supportsFullScreen){document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,false);document.removeEventListener("mozfullscreenchange",this._fullScreenChange,false);document.removeEventListener("MSFullscreenChange",this._fullScreenChange,false);document.removeEventListener("fullscreenchange",this._fullScreenChange,false);document.removeEventListener("webkitfullscreenerror",this._fullScreenError,false);document.removeEventListener("mozfullscreenerror",this._fullScreenError,false);document.removeEventListener("MSFullscreenError",this._fullScreenError,false);document.removeEventListener("fullscreenerror",this._fullScreenError,false)}}};g.ScaleManager.prototype.constructor=g.ScaleManager;Object.defineProperty(g.ScaleManager.prototype,"boundingParent",{get:function(){if(this.parentIsWindow||(this.isFullScreen&&this.hasPhaserSetFullScreen&&!this._createdFullScreenTarget)){return null}var p=this.game.canvas&&this.game.canvas.parentNode;return p||null}});Object.defineProperty(g.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(p){if(p!==this._scaleMode){if(!this.isFullScreen){this.updateDimensions(this._gameSize.width,this._gameSize.height,true);this.queueUpdate(true)}this._scaleMode=p}return this._scaleMode}});Object.defineProperty(g.ScaleManager.prototype,"fullScreenScaleMode",{get:function(){return this._fullScreenScaleMode},set:function(p){if(p!==this._fullScreenScaleMode){if(this.isFullScreen){this.prepScreenMode(false);this._fullScreenScaleMode=p;this.prepScreenMode(true);this.queueUpdate(true)}else{this._fullScreenScaleMode=p}}return this._fullScreenScaleMode}});Object.defineProperty(g.ScaleManager.prototype,"currentScaleMode",{get:function(){return this.isFullScreen?this._fullScreenScaleMode:this._scaleMode}});Object.defineProperty(g.ScaleManager.prototype,"pageAlignHorizontally",{get:function(){return this._pageAlignHorizontally},set:function(p){if(p!==this._pageAlignHorizontally){this._pageAlignHorizontally=p;this.queueUpdate(true)}}});Object.defineProperty(g.ScaleManager.prototype,"pageAlignVertically",{get:function(){return this._pageAlignVertically},set:function(p){if(p!==this._pageAlignVertically){this._pageAlignVertically=p;this.queueUpdate(true)}}});Object.defineProperty(g.ScaleManager.prototype,"isFullScreen",{get:function(){return !!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)}});Object.defineProperty(g.ScaleManager.prototype,"isPortrait",{get:function(){return this.classifyOrientation(this.screenOrientation)==="portrait"}});Object.defineProperty(g.ScaleManager.prototype,"isLandscape",{get:function(){return this.classifyOrientation(this.screenOrientation)==="landscape"}});Object.defineProperty(g.ScaleManager.prototype,"isGamePortrait",{get:function(){return(this.height>this.width)}});Object.defineProperty(g.ScaleManager.prototype,"isGameLandscape",{get:function(){return(this.width>this.height)}});g.Utils.Debug=function(p){this.game=p;this.sprite=null;this.bmd=null;this.canvas=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=true;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=false};g.Utils.Debug.prototype={boot:function(){if(this.game.renderType===g.CANVAS){this.context=this.game.context}else{this.bmd=new g.BitmapData(this.game,"__DEBUG",this.game.width,this.game.height,true);this.sprite=this.game.make.image(0,0,this.bmd);this.game.stage.addChild(this.sprite);this.game.scale.onSizeChange.add(this.resize,this);this.canvas=PIXI.CanvasPool.create(this,this.game.width,this.game.height);this.context=this.canvas.getContext("2d")}},resize:function(q,r,p){this.bmd.resize(r,p);this.canvas.width=r;this.canvas.height=p},preUpdate:function(){if(this.dirty&&this.sprite){this.bmd.clear();this.bmd.draw(this.canvas,0,0);this.context.clearRect(0,0,this.game.width,this.game.height);this.dirty=false}},reset:function(){if(this.context){this.context.clearRect(0,0,this.game.width,this.game.height)}if(this.sprite){this.bmd.clear()}},start:function(p,s,q,r){if(typeof p!=="number"){p=0}if(typeof s!=="number"){s=0}q=q||"rgb(255,255,255)";if(r===undefined){r=0}this.currentX=p;this.currentY=s;this.currentColor=q;this.columnWidth=r;this.dirty=true;this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=q;this.context.fillStyle=q;this.context.font=this.font;this.context.globalAlpha=this.currentAlpha},stop:function(){this.context.restore()},line:function(){var p=this.currentX;for(var q=0;q<arguments.length;q++){if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(arguments[q],p+1,this.currentY+1);this.context.fillStyle=this.currentColor}this.context.fillText(arguments[q],p,this.currentY);p+=this.columnWidth}this.currentY+=this.lineHeight},soundInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sound: "+r.key+" Locked: "+r.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(r.key)+" Pending Playback: "+r.pendingPlayback);this.line("Decoded: "+r.isDecoded+" Decoding: "+r.isDecoding);this.line("Total Duration: "+r.totalDuration+" Playing: "+r.isPlaying);this.line("Time: "+r.currentTime);this.line("Volume: "+r.volume+" Muted: "+r.mute);this.line("WebAudio: "+r.usingWebAudio+" Audio: "+r.usingAudioTag);if(r.currentMarker!==""){this.line("Marker: "+r.currentMarker+" Duration: "+r.duration+" (ms: "+r.durationMS+")");this.line("Start: "+r.markers[r.currentMarker].start+" Stop: "+r.markers[r.currentMarker].stop);this.line("Position: "+r.position)}this.stop()},cameraInfo:function(r,p,s,q){this.start(p,s,q);this.line("Camera ("+r.width+" x "+r.height+")");this.line("X: "+r.x+" Y: "+r.y);if(r.bounds){this.line("Bounds x: "+r.bounds.x+" Y: "+r.bounds.y+" w: "+r.bounds.width+" h: "+r.bounds.height)}this.line("View x: "+r.view.x+" Y: "+r.view.y+" w: "+r.view.width+" h: "+r.view.height);this.line("Total in view: "+r.totalInView);this.stop()},timer:function(s,p,r,q){this.start(p,r,q);this.line("Timer (running: "+s.running+" expired: "+s.expired+")");this.line("Next Tick: "+s.next+" Duration: "+s.duration);this.line("Paused: "+s.paused+" Length: "+s.length);this.stop()},pointer:function(t,s,q,r,p){if(t==null){return}if(s===undefined){s=false}q=q||"rgba(0,255,0,0.5)";r=r||"rgba(255,0,0,0.5)";if(s===true&&t.isUp===true){return}this.start(t.x,t.y-100,p);this.context.beginPath();this.context.arc(t.x,t.y,t.circle.radius,0,Math.PI*2);if(t.active){this.context.fillStyle=q}else{this.context.fillStyle=r}this.context.fill();this.context.closePath();this.context.beginPath();this.context.moveTo(t.positionDown.x,t.positionDown.y);this.context.lineTo(t.position.x,t.position.y);this.context.lineWidth=2;this.context.stroke();this.context.closePath();this.line("ID: "+t.id+" Active: "+t.active);this.line("World X: "+t.worldX+" World Y: "+t.worldY);this.line("Screen X: "+t.x+" Screen Y: "+t.y+" In: "+t.withinGame);this.line("Duration: "+t.duration+" ms");this.line("is Down: "+t.isDown+" is Up: "+t.isUp);this.stop()},spriteInputInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sprite Input: ("+r.width+" x "+r.height+")");this.line("x: "+r.input.pointerX().toFixed(1)+" y: "+r.input.pointerY().toFixed(1));this.line("over: "+r.input.pointerOver()+" duration: "+r.input.overDuration().toFixed(0));this.line("down: "+r.input.pointerDown()+" duration: "+r.input.downDuration().toFixed(0));this.line("just over: "+r.input.justOver()+" just out: "+r.input.justOut());this.stop()},key:function(r,p,s,q){this.start(p,s,q,150);this.line("Key:",r.keyCode,"isDown:",r.isDown);this.line("justDown:",r.justDown,"justUp:",r.justUp);this.line("Time Down:",r.timeDown.toFixed(0),"duration:",r.duration.toFixed(0));this.stop()},inputInfo:function(p,r,q){this.start(p,r,q);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(q,p,s){var r=q.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,p,s)},ropeSegments:function(t,q,s){var r=t.segments;var p=this;r.forEach(function(u){p.rectangle(u,q,s)},this)},spriteInfo:function(r,p,s,q){this.start(p,s,q);this.line("Sprite:  ("+r.width+" x "+r.height+") anchor: "+r.anchor.x+" x "+r.anchor.y);this.line("x: "+r.x.toFixed(1)+" y: "+r.y.toFixed(1));this.line("angle: "+r.angle.toFixed(1)+" rotation: "+r.rotation.toFixed(1));this.line("visible: "+r.visible+" in camera: "+r.inCamera);this.line("bounds x: "+r._bounds.x.toFixed(1)+" y: "+r._bounds.y.toFixed(1)+" w: "+r._bounds.width.toFixed(1)+" h: "+r._bounds.height.toFixed(1));this.stop()},spriteCoords:function(r,p,s,q){this.start(p,s,q,100);if(r.name){this.line(r.name)}this.line("x:",r.x.toFixed(2),"y:",r.y.toFixed(2));this.line("pos x:",r.position.x.toFixed(2),"pos y:",r.position.y.toFixed(2));this.line("world x:",r.world.x.toFixed(2),"world y:",r.world.y.toFixed(2));this.stop()},lineInfo:function(q,p,s,r){this.start(p,s,r,80);this.line("start.x:",q.start.x.toFixed(2),"start.y:",q.start.y.toFixed(2));this.line("end.x:",q.end.x.toFixed(2),"end.y:",q.end.y.toFixed(2));this.line("length:",q.length.toFixed(2),"angle:",q.angle);this.stop()},pixel:function(p,s,q,r){r=r||2;this.start();this.context.fillStyle=q;this.context.fillRect(p,s,r,r);this.stop()},geom:function(q,p,s,r){if(s===undefined){s=true}if(r===undefined){r=0}p=p||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=p;this.context.strokeStyle=p;if(q instanceof g.Rectangle||r===1){if(s){this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}else{this.context.strokeRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}}else{if(q instanceof g.Circle||r===2){this.context.beginPath();this.context.arc(q.x-this.game.camera.x,q.y-this.game.camera.y,q.radius,0,Math.PI*2,false);this.context.closePath();if(s){this.context.fill()}else{this.context.stroke()}}else{if(q instanceof g.Point||r===3){this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,4,4)}else{if(q instanceof g.Line||r===4){this.context.lineWidth=1;this.context.beginPath();this.context.moveTo((q.start.x+0.5)-this.game.camera.x,(q.start.y+0.5)-this.game.camera.y);this.context.lineTo((q.end.x+0.5)-this.game.camera.x,(q.end.y+0.5)-this.game.camera.y);this.context.closePath();this.context.stroke()}}}}this.stop()},rectangle:function(q,p,r){if(r===undefined){r=true}p=p||"rgba(0, 255, 0, 0.4)";this.start();if(r){this.context.fillStyle=p;this.context.fillRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}else{this.context.strokeStyle=p;this.context.strokeRect(q.x-this.game.camera.x,q.y-this.game.camera.y,q.width,q.height)}this.stop()},text:function(s,p,t,r,q){r=r||"rgb(255,255,255)";q=q||"16px Courier";this.start();this.context.font=q;if(this.renderShadow){this.context.fillStyle="rgb(0,0,0)";this.context.fillText(s,p+1,t+1)}this.context.fillStyle=r;this.context.fillText(s,p,t);this.stop()},quadTree:function(p,q){q=q||"rgba(255,0,0,0.3)";this.start();var s=p.bounds;if(p.nodes.length===0){this.context.strokeStyle=q;this.context.strokeRect(s.x,s.y,s.width,s.height);this.text("size: "+p.objects.length,s.x+4,s.y+16,"rgb(0,200,0)","12px Courier");this.context.strokeStyle="rgb(0,255,0)";for(var r=0;r<p.objects.length;r++){this.context.strokeRect(p.objects[r].x,p.objects[r].y,p.objects[r].width,p.objects[r].height)}}else{for(var r=0;r<p.nodes.length;r++){this.quadTree(p.nodes[r])}}this.stop()},body:function(q,p,r){if(q.body){this.start();if(q.body.type===g.Physics.ARCADE){g.Physics.Arcade.Body.render(this.context,q.body,p,r)}else{if(q.body.type===g.Physics.NINJA){g.Physics.Ninja.Body.render(this.context,q.body,p,r)}else{if(q.body.type===g.Physics.BOX2D){g.Physics.Box2D.renderBody(this.context,q.body,p)}}}this.stop()}},bodyInfo:function(r,p,s,q){if(r.body){this.start(p,s,q,210);if(r.body.type===g.Physics.ARCADE){g.Physics.Arcade.Body.renderBodyInfo(this,r.body)}else{if(r.body.type===g.Physics.BOX2D){this.game.physics.box2d.renderBodyInfo(this,r.body)}}this.stop()}},box2dWorld:function(){this.start();this.context.translate(-this.game.camera.view.x,-this.game.camera.view.y,0);this.game.physics.box2d.renderDebugDraw(this.context);this.stop()},box2dBody:function(p,q){this.start();g.Physics.Box2D.renderBody(this.context,p,q);this.stop()},displayList:function(q){if(q===undefined){q=this.game.world}if(q.hasOwnProperty("renderOrderID")){console.log("["+q.renderOrderID+"]",q)}else{console.log("[]",q)}if(q.children&&q.children.length>0){for(var p=0;p<q.children.length;p++){this.game.debug.displayList(q.children[p])}}},destroy:function(){PIXI.CanvasPool.remove(this)}};g.Utils.Debug.prototype.constructor=g.Utils.Debug;g.DOM={getOffset:function(q,p){p=p||new g.Point();var r=q.getBoundingClientRect();var s=g.DOM.scrollY;var t=g.DOM.scrollX;var v=document.documentElement.clientTop;var u=document.documentElement.clientLeft;p.x=r.left+t-u;p.y=r.top+s-v;return p},getBounds:function(q,p){if(p===undefined){p=0}q=q&&!q.nodeType?q[0]:q;if(!q||q.nodeType!==1){return false}else{return this.calibrate(q.getBoundingClientRect(),p)}},calibrate:function(r,q){q=+q||0;var p={width:0,height:0,left:0,right:0,top:0,bottom:0};p.width=(p.right=r.right+q)-(p.left=r.left-q);p.height=(p.bottom=r.bottom+q)-(p.top=r.top-q);return p},getAspectRatio:function(q){q=null==q?this.visualBounds:1===q.nodeType?this.getBounds(q):q;var p=q.width;var r=q.height;if(typeof p==="function"){p=p.call(q)}if(typeof r==="function"){r=r.call(q)}return p/r},inLayoutViewport:function(q,p){var s=this.getBounds(q,p);return !!s&&s.bottom>=0&&s.right>=0&&s.top<=this.layoutBounds.width&&s.left<=this.layoutBounds.height},getScreenOrientation:function(t){var q=window.screen;var p=q.orientation||q.mozOrientation||q.msOrientation;if(p&&typeof p.type==="string"){return p.type}else{if(typeof p==="string"){return p}}var s="portrait-primary";var r="landscape-primary";if(t==="screen"){return(q.height>q.width)?s:r}else{if(t==="viewport"){return(this.visualBounds.height>this.visualBounds.width)?s:r}else{if(t==="window.orientation"&&typeof window.orientation==="number"){return(window.orientation===0||window.orientation===180)?s:r}else{if(window.matchMedia){if(window.matchMedia("(orientation: portrait)").matches){return s}else{if(window.matchMedia("(orientation: landscape)").matches){return r}}}}}}return(this.visualBounds.height>this.visualBounds.width)?s:r},visualBounds:new g.Rectangle(),layoutBounds:new g.Rectangle(),documentBounds:new g.Rectangle()};g.Device.whenReady(function(r){var u=window&&("pageXOffset" in window)?function(){return window.pageXOffset}:function(){return document.documentElement.scrollLeft};var s=window&&("pageYOffset" in window)?function(){return window.pageYOffset}:function(){return document.documentElement.scrollTop};Object.defineProperty(g.DOM,"scrollX",{get:u});Object.defineProperty(g.DOM,"scrollY",{get:s});Object.defineProperty(g.DOM.visualBounds,"x",{get:u});Object.defineProperty(g.DOM.visualBounds,"y",{get:s});Object.defineProperty(g.DOM.layoutBounds,"x",{value:0});Object.defineProperty(g.DOM.layoutBounds,"y",{value:0});var q=r.desktop&&(document.documentElement.clientWidth<=window.innerWidth)&&(document.documentElement.clientHeight<=window.innerHeight);if(q){var t=function(){return Math.max(window.innerWidth,document.documentElement.clientWidth)};var p=function(){return Math.max(window.innerHeight,document.documentElement.clientHeight)};Object.defineProperty(g.DOM.visualBounds,"width",{get:t});Object.defineProperty(g.DOM.visualBounds,"height",{get:p});Object.defineProperty(g.DOM.layoutBounds,"width",{get:t});Object.defineProperty(g.DOM.layoutBounds,"height",{get:p})}else{Object.defineProperty(g.DOM.visualBounds,"width",{get:function(){return window.innerWidth}});Object.defineProperty(g.DOM.visualBounds,"height",{get:function(){return window.innerHeight}});Object.defineProperty(g.DOM.layoutBounds,"width",{get:function(){var w=document.documentElement.clientWidth;var v=window.innerWidth;return w<v?v:w}});Object.defineProperty(g.DOM.layoutBounds,"height",{get:function(){var w=document.documentElement.clientHeight;var v=window.innerHeight;return w<v?v:w}})}Object.defineProperty(g.DOM.documentBounds,"x",{value:0});Object.defineProperty(g.DOM.documentBounds,"y",{value:0});Object.defineProperty(g.DOM.documentBounds,"width",{get:function(){var v=document.documentElement;return Math.max(v.clientWidth,v.offsetWidth,v.scrollWidth)}});Object.defineProperty(g.DOM.documentBounds,"height",{get:function(){var v=document.documentElement;return Math.max(v.clientHeight,v.offsetHeight,v.scrollHeight)}})},null,true);g.ArraySet=function(p){this.position=0;this.list=p||[]};g.ArraySet.prototype={add:function(p){if(!this.exists(p)){this.list.push(p)}return p},getIndex:function(p){return this.list.indexOf(p)},getByKey:function(r,q){var p=this.list.length;while(p--){if(this.list[p][r]===q){return this.list[p]}}return null},exists:function(p){return(this.list.indexOf(p)>-1)},reset:function(){this.list.length=0},remove:function(q){var p=this.list.indexOf(q);if(p>-1){this.list.splice(p,1);return q}},setAll:function(q,r){var p=this.list.length;while(p--){if(this.list[p]){this.list[p][q]=r}}},callAll:function(r){var p=Array.prototype.slice.call(arguments,1);var q=this.list.length;while(q--){if(this.list[q]&&this.list[q][r]){this.list[q][r].apply(this.list[q],p)}}},removeAll:function(q){if(q===undefined){q=false}var p=this.list.length;while(p--){if(this.list[p]){var r=this.remove(this.list[p]);if(q){r.destroy()}}}this.position=0;this.list=[]}};Object.defineProperty(g.ArraySet.prototype,"total",{get:function(){return this.list.length}});Object.defineProperty(g.ArraySet.prototype,"first",{get:function(){this.position=0;if(this.list.length>0){return this.list[0]}else{return null}}});Object.defineProperty(g.ArraySet.prototype,"next",{get:function(){if(this.position<this.list.length){this.position++;return this.list[this.position]}else{return null}}});g.ArraySet.prototype.constructor=g.ArraySet;g.ArrayUtils={getRandomItem:function(r,s,q){if(r===null){return null}if(s===undefined){s=0}if(q===undefined){q=r.length}var p=s+Math.floor(Math.random()*q);return r[p]===undefined?null:r[p]},removeRandomItem:function(r,t,q){if(r==null){return null}if(t===undefined){t=0}if(q===undefined){q=r.length}var p=t+Math.floor(Math.random()*q);if(p<r.length){var s=r.splice(p,1);return s[0]===undefined?null:s[0]}else{return null}},shuffle:function(s){for(var r=s.length-1;r>0;r--){var q=Math.floor(Math.random()*(r+1));var p=s[r];s[r]=s[q];s[q]=p}return s},transposeMatrix:function(u){var t=u.length;var q=u[0].length;var p=new Array(q);for(var s=0;s<q;s++){p[s]=new Array(t);for(var r=t-1;r>-1;r--){p[s][r]=u[r][s]}}return p},rotateMatrix:function(p,r){if(typeof r!=="string"){r=((r%360)+360)%360}if(r===90||r===-270||r==="rotateLeft"){p=g.ArrayUtils.transposeMatrix(p);p=p.reverse()}else{if(r===-90||r===270||r==="rotateRight"){p=p.reverse();p=g.ArrayUtils.transposeMatrix(p)}else{if(Math.abs(r)===180||r==="rotate180"){for(var q=0;q<p.length;q++){p[q].reverse()}p=p.reverse()}}}return p},findClosest:function(t,q){if(!q.length){return NaN}else{if(q.length===1||t<q[0]){return q[0]}}var r=1;while(q[r]<t){r++}var p=q[r-1];var s=(r<q.length)?q[r]:Number.POSITIVE_INFINITY;return((s-t)<=(t-p))?s:p},rotateRight:function(q){var p=q.pop();q.unshift(p);return p},rotateLeft:function(q){var p=q.shift();q.push(p);return p},rotate:function(q){var p=q.shift();q.push(p);return p},numberArray:function(s,q){var p=[];for(var r=s;r<=q;r++){p.push(r)}return p},numberArrayStep:function(u,q,t){if(u===undefined||u===null){u=0}if(q===undefined||q===null){q=u;u=0}if(t===undefined){t=1}var p=[];var s=Math.max(g.Math.roundAwayFromZero((q-u)/(t||1)),0);for(var r=0;r<s;r++){p.push(u);u+=t}return p}};g.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};g.LinkedList.prototype={add:function(p){if(this.total===0&&this.first===null&&this.last===null){this.first=p;this.last=p;this.next=p;p.prev=this;this.total++;return p}this.last.next=p;p.prev=this.last;this.last=p;this.total++;return p},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(p){if(this.total===1){this.reset();p.next=p.prev=null;return}if(p===this.first){this.first=this.first.next}else{if(p===this.last){this.last=this.last.prev}}if(p.prev){p.prev.next=p.next}if(p.next){p.next.prev=p.prev}p.next=p.prev=null;if(this.first===null){this.last=null}this.total--},callAll:function(q){if(!this.first||!this.last){return}var p=this.first;do{if(p&&p[q]){p[q].call(p)}p=p.next}while(p!==this.last.next)}};g.LinkedList.prototype.constructor=g.LinkedList;g.Create=function(p){this.game=p;this.bmd=null;this.canvas=null;this.ctx=null;this.palettes=[{0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"},{0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"},{0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"},{0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"}]};g.Create.PALETTE_ARNE=0;g.Create.PALETTE_JMP=1;g.Create.PALETTE_CGA=2;g.Create.PALETTE_C64=3;g.Create.PALETTE_JAPANESE_MACHINE=4;g.Create.prototype={texture:function(B,r,t,q,p){if(t===undefined){t=8}if(q===undefined){q=t}if(p===undefined){p=0}var A=r[0].length*t;var s=r.length*q;if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(A,s);this.bmd.clear();for(var v=0;v<r.length;v++){var C=r[v];for(var z=0;z<C.length;z++){var u=C[z];if(u!=="."&&u!==" "){this.ctx.fillStyle=this.palettes[p][u];this.ctx.fillRect(z*t,v*q,t,q)}}}return this.bmd.generateTexture(B)},grid:function(t,v,r,u,q,s){if(this.bmd===null){this.bmd=this.game.make.bitmapData();this.canvas=this.bmd.canvas;this.ctx=this.bmd.context}this.bmd.resize(v,r);this.ctx.fillStyle=s;for(var w=0;w<r;w+=q){this.ctx.fillRect(0,w,v,1)}for(var p=0;p<v;p+=u){this.ctx.fillRect(p,0,1,r)}return this.bmd.generateTexture(t)}};g.Create.prototype.constructor=g.Create;g.FlexGrid=function(q,r,p){this.game=q.game;this.manager=q;this.width=r;this.height=p;this.boundsCustom=new g.Rectangle(0,0,r,p);this.boundsFluid=new g.Rectangle(0,0,r,p);this.boundsFull=new g.Rectangle(0,0,r,p);this.boundsNone=new g.Rectangle(0,0,r,p);this.positionCustom=new g.Point(0,0);this.positionFluid=new g.Point(0,0);this.positionFull=new g.Point(0,0);this.positionNone=new g.Point(0,0);this.scaleCustom=new g.Point(1,1);this.scaleFluid=new g.Point(1,1);this.scaleFluidInversed=new g.Point(1,1);this.scaleFull=new g.Point(1,1);this.scaleNone=new g.Point(1,1);this.customWidth=0;this.customHeight=0;this.customOffsetX=0;this.customOffsetY=0;this.ratioH=r/p;this.ratioV=p/r;this.multiplier=0;this.layers=[]};g.FlexGrid.prototype={setSize:function(q,p){this.width=q;this.height=p;this.ratioH=q/p;this.ratioV=p/q;this.scaleNone=new g.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createCustomLayer:function(t,p,r,s){if(s===undefined){s=true}this.customWidth=t;this.customHeight=p;this.boundsCustom.width=t;this.boundsCustom.height=p;var q=new g.FlexLayer(this,this.positionCustom,this.boundsCustom,this.scaleCustom);if(s){this.game.world.add(q)}this.layers.push(q);if(typeof r!=="undefined"&&typeof r!==null){q.addMultiple(r)}return q},createFluidLayer:function(q,r){if(r===undefined){r=true}var p=new g.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);if(r){this.game.world.add(p)}this.layers.push(p);if(typeof q!=="undefined"&&typeof q!==null){p.addMultiple(q)}return p},createFullLayer:function(q){var p=new g.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);this.game.world.add(p);this.layers.push(p);if(typeof q!=="undefined"){p.addMultiple(q)}return p},createFixedLayer:function(q){var p=new g.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);this.game.world.add(p);this.layers.push(p);if(typeof q!=="undefined"){p.addMultiple(q)}return p},reset:function(){var p=this.layers.length;while(p--){if(!this.layers[p].persist){this.layers[p].position=null;this.layers[p].scale=null;this.layers.slice(p,1)}}},onResize:function(q,p){this.ratioH=q/p;this.ratioV=p/q;this.refresh(q,p)},refresh:function(){this.multiplier=Math.min((this.manager.height/this.height),(this.manager.width/this.width));this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=Math.round(this.manager.width*this.scaleFluidInversed.x);this.boundsFull.height=Math.round(this.manager.height*this.scaleFluidInversed.y);this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},fitSprite:function(p){this.manager.scaleSprite(p);p.x=this.manager.bounds.centerX;p.y=this.manager.bounds.centerY},debug:function(){this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",false)}};g.FlexGrid.prototype.constructor=g.FlexGrid;g.FlexLayer=function(q,p,r,s){g.Group.call(this,q.game,null,"__flexLayer"+q.game.rnd.uuid(),false);this.manager=q.manager;this.grid=q;this.persist=false;this.position=p;this.bounds=r;this.scale=s;this.topLeft=r.topLeft;this.topMiddle=new g.Point(r.halfWidth,0);this.topRight=r.topRight;this.bottomLeft=r.bottomLeft;this.bottomMiddle=new g.Point(r.halfWidth,r.bottom);this.bottomRight=r.bottomRight};g.FlexLayer.prototype=Object.create(g.Group.prototype);g.FlexLayer.prototype.constructor=g.FlexLayer;g.FlexLayer.prototype.resize=function(){};g.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",false);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};g.Color={packPixel:function(t,s,p,q){if(g.Device.LITTLE_ENDIAN){return((q<<24)|(p<<16)|(s<<8)|t)>>>0}else{return((t<<24)|(s<<16)|(p<<8)|q)>>>0}},unpackPixel:function(s,r,p,q){if(r===undefined||r===null){r=g.Color.createColor()}if(p===undefined||p===null){p=false}if(q===undefined||q===null){q=false}if(g.Device.LITTLE_ENDIAN){r.a=((s&4278190080)>>>24);r.b=((s&16711680)>>>16);r.g=((s&65280)>>>8);r.r=((s&255))}else{r.r=((s&4278190080)>>>24);r.g=((s&16711680)>>>16);r.b=((s&65280)>>>8);r.a=((s&255))}r.color=s;r.rgba="rgba("+r.r+","+r.g+","+r.b+","+(r.a/255)+")";if(p){g.Color.RGBtoHSL(r.r,r.g,r.b,r)}if(q){g.Color.RGBtoHSV(r.r,r.g,r.b,r)}return r},fromRGBA:function(q,p){if(!p){p=g.Color.createColor()}p.r=((q&4278190080)>>>24);p.g=((q&16711680)>>>16);p.b=((q&65280)>>>8);p.a=((q&255));p.rgba="rgba("+p.r+","+p.g+","+p.b+","+p.a+")";return p},toRGBA:function(t,s,p,q){return(t<<24)|(s<<16)|(p<<8)|q},toABGR:function(t,s,p,q){return((q<<24)|(p<<16)|(s<<8)|t)>>>0},RGBtoHSL:function(v,u,q,s){if(!s){s=g.Color.createColor(v,u,q,1)}v/=255;u/=255;q/=255;var t=Math.min(v,u,q);var p=Math.max(v,u,q);s.h=0;s.s=0;s.l=(p+t)/2;if(p!==t){var w=p-t;s.s=s.l>0.5?w/(2-p-t):w/(p+t);if(p===v){s.h=(u-q)/w+(u<q?6:0)}else{if(p===u){s.h=(q-v)/w+2}else{if(p===q){s.h=(v-u)/w+4}}}s.h/=6}return s},HSLtoRGB:function(v,u,r,t){if(!t){t=g.Color.createColor(r,r,r)}else{t.r=r;t.g=r;t.b=r}if(u!==0){var w=r<0.5?r*(1+u):r+u-r*u;var x=2*r-w;t.r=g.Color.hueToColor(x,w,v+1/3);t.g=g.Color.hueToColor(x,w,v);t.b=g.Color.hueToColor(x,w,v-1/3)}t.r=Math.floor((t.r*255|0));t.g=Math.floor((t.g*255|0));t.b=Math.floor((t.b*255|0));g.Color.updateColor(t);return t},RGBtoHSV:function(v,u,q,s){if(!s){s=g.Color.createColor(v,u,q,255)}v/=255;u/=255;q/=255;var t=Math.min(v,u,q);var p=Math.max(v,u,q);var w=p-t;s.h=0;s.s=p===0?0:w/p;s.v=p;if(p!==t){if(p===v){s.h=(u-q)/w+(u<q?6:0)}else{if(p===u){s.h=(q-v)/w+2}else{if(p===q){s.h=(v-u)/w+4}}}s.h/=6}return s},HSVtoRGB:function(A,G,E,y){if(y===undefined){y=g.Color.createColor(0,0,0,1,A,G,0,E)}var u,B,D;var z=Math.floor(A*6);var C=A*6-z;var x=E*(1-G);var w=E*(1-C*G);var F=E*(1-(1-C)*G);switch(z%6){case 0:u=E;B=F;D=x;break;case 1:u=w;B=E;D=x;break;case 2:u=x;B=E;D=F;break;case 3:u=x;B=w;D=E;break;case 4:u=F;B=x;D=E;break;case 5:u=E;B=x;D=w;break}y.r=Math.floor(u*255);y.g=Math.floor(B*255);y.b=Math.floor(D*255);g.Color.updateColor(y);return y},hueToColor:function(u,s,r){if(r<0){r+=1}if(r>1){r-=1}if(r<1/6){return u+(s-u)*6*r}if(r<1/2){return s}if(r<2/3){return u+(s-u)*(2/3-r)*6}return u},createColor:function(p,w,x,y,u,A,q,z){var t={r:p||0,g:w||0,b:x||0,a:y||1,h:u||0,s:A||0,l:q||0,v:z||0,color:0,color32:0,rgba:""};return g.Color.updateColor(t)},updateColor:function(p){p.rgba="rgba("+p.r.toString()+","+p.g.toString()+","+p.b.toString()+","+p.a.toString()+")";p.color=g.Color.getColor(p.r,p.g,p.b);p.color32=g.Color.getColor32(p.a*255,p.r,p.g,p.b);return p},getColor32:function(q,t,s,p){return q<<24|t<<16|s<<8|p},getColor:function(s,q,p){return s<<16|q<<8|p},RGBtoString:function(t,s,p,q,u){if(q===undefined){q=255}if(u===undefined){u="#"}if(u==="#"){return"#"+((1<<24)+(t<<16)+(s<<8)+p).toString(16).slice(1)}else{return"0x"+g.Color.componentToHex(q)+g.Color.componentToHex(t)+g.Color.componentToHex(s)+g.Color.componentToHex(p)}},hexToRGB:function(q){var p=g.Color.hexToColor(q);if(p){return g.Color.getColor32(p.a,p.r,p.g,p.b)}},hexToColor:function(v,s){v=v.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(x,z,y,w){return z+z+y+y+w+w});var q=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(v);if(q){var u=parseInt(q[1],16);var t=parseInt(q[2],16);var p=parseInt(q[3],16);if(!s){s=g.Color.createColor(u,t,p)}else{s.r=u;s.g=t;s.b=p}}return s},webToColor:function(q,r){if(!r){r=g.Color.createColor()}var p=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(q);if(p){r.r=parseInt(p[1],10);r.g=parseInt(p[2],10);r.b=parseInt(p[3],10);r.a=p[4]!==undefined?parseFloat(p[4]):1;g.Color.updateColor(r)}return r},valueToColor:function(r,q){if(!q){q=g.Color.createColor()}if(typeof r==="string"){if(r.indexOf("rgb")===0){return g.Color.webToColor(r,q)}else{q.a=1;return g.Color.hexToColor(r,q)}}else{if(typeof r==="number"){var p=g.Color.getRGB(r);q.r=p.r;q.g=p.g;q.b=p.b;q.a=p.a/255;return q}else{return q}}},componentToHex:function(p){var q=p.toString(16);return(q.length===1)?"0"+q:q},HSVColorWheel:function(r,q){if(r===undefined){r=1}if(q===undefined){q=1}var p=[];for(var t=0;t<=359;t++){p.push(g.Color.HSVtoRGB(t/359,r,q))}return p},HSLColorWheel:function(r,q){if(r===undefined){r=0.5}if(q===undefined){q=0.5}var p=[];for(var t=0;t<=359;t++){p.push(g.Color.HSLtoRGB(t/359,r,q))}return p},interpolateColor:function(z,y,x,q,u){if(u===undefined){u=255}var t=g.Color.getRGB(z);var s=g.Color.getRGB(y);var p=(((s.red-t.red)*q)/x)+t.red;var v=(((s.green-t.green)*q)/x)+t.green;var w=(((s.blue-t.blue)*q)/x)+t.blue;return g.Color.getColor32(u,p,v,w)},interpolateColorWithRGB:function(u,q,w,y,x,s){var p=g.Color.getRGB(u);var v=(((q-p.red)*s)/x)+p.red;var z=(((w-p.green)*s)/x)+p.green;var t=(((y-p.blue)*s)/x)+p.blue;return g.Color.getColor(v,z,t)},interpolateRGB:function(u,q,z,t,A,x,y,s){var p=(((t-u)*s)/y)+u;var v=(((A-q)*s)/y)+q;var w=(((x-z)*s)/y)+z;return g.Color.getColor(p,v,w)},getRandomColor:function(r,q,u){if(r===undefined){r=0}if(q===undefined){q=255}if(u===undefined){u=255}if(q>255||r>q){return g.Color.getColor(255,255,255)}var t=r+Math.round(Math.random()*(q-r));var s=r+Math.round(Math.random()*(q-r));var p=r+Math.round(Math.random()*(q-r));return g.Color.getColor32(u,t,s,p)},getRGB:function(p){if(p>16777215){return{alpha:p>>>24,red:p>>16&255,green:p>>8&255,blue:p&255,a:p>>>24,r:p>>16&255,g:p>>8&255,b:p&255}}else{return{alpha:255,red:p>>16&255,green:p>>8&255,blue:p&255,a:255,r:p>>16&255,g:p>>8&255,b:p&255}}},getWebRGB:function(p){if(typeof p==="object"){return"rgba("+p.r.toString()+","+p.g.toString()+","+p.b.toString()+","+(p.a/255).toString()+")"}else{var q=g.Color.getRGB(p);return"rgba("+q.r.toString()+","+q.g.toString()+","+q.b.toString()+","+(q.a/255).toString()+")"}},getAlpha:function(p){return p>>>24},getAlphaFloat:function(p){return(p>>>24)/255},getRed:function(p){return p>>16&255},getGreen:function(p){return p>>8&255},getBlue:function(p){return p&255},blendNormal:function(p){return p},blendLighten:function(q,p){return(p>q)?p:q},blendDarken:function(q,p){return(p>q)?q:p},blendMultiply:function(q,p){return(q*p)/255},blendAverage:function(q,p){return(q+p)/2},blendAdd:function(q,p){return Math.min(255,q+p)},blendSubtract:function(q,p){return Math.max(0,q+p-255)},blendDifference:function(q,p){return Math.abs(q-p)},blendNegation:function(q,p){return 255-Math.abs(255-q-p)},blendScreen:function(q,p){return 255-(((255-q)*(255-p))>>8)},blendExclusion:function(q,p){return q+p-2*q*p/255},blendOverlay:function(q,p){return p<128?(2*q*p/255):(255-2*(255-q)*(255-p)/255)},blendSoftLight:function(q,p){return p<128?(2*((q>>1)+64))*(p/255):255-(2*(255-((q>>1)+64))*(255-p)/255)},blendHardLight:function(q,p){return g.Color.blendOverlay(p,q)},blendColorDodge:function(q,p){return p===255?p:Math.min(255,((q<<8)/(255-p)))},blendColorBurn:function(q,p){return p===0?p:Math.max(0,(255-((255-q)<<8)/p))},blendLinearDodge:function(q,p){return g.Color.blendAdd(q,p)},blendLinearBurn:function(q,p){return g.Color.blendSubtract(q,p)},blendLinearLight:function(q,p){return p<128?g.Color.blendLinearBurn(q,2*p):g.Color.blendLinearDodge(q,(2*(p-128)))},blendVividLight:function(q,p){return p<128?g.Color.blendColorBurn(q,2*p):g.Color.blendColorDodge(q,(2*(p-128)))},blendPinLight:function(q,p){return p<128?g.Color.blendDarken(q,2*p):g.Color.blendLighten(q,(2*(p-128)))},blendHardMix:function(q,p){return g.Color.blendVividLight(q,p)<128?0:255},blendReflect:function(q,p){return p===255?p:Math.min(255,(q*q/(255-p)))},blendGlow:function(q,p){return g.Color.blendReflect(p,q)},blendPhoenix:function(q,p){return Math.min(q,p)-Math.max(q,p)+255}};g.Physics=function(p,q){q=q||{};this.game=p;this.config=q;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.matter=null;this.parseConfig()};g.Physics.ARCADE=0;g.Physics.P2JS=1;g.Physics.NINJA=2;g.Physics.BOX2D=3;g.Physics.CHIPMUNK=4;g.Physics.MATTERJS=5;g.Physics.prototype={parseConfig:function(){if((!this.config.hasOwnProperty("arcade")||this.config.arcade===true)&&g.Physics.hasOwnProperty("Arcade")){this.arcade=new g.Physics.Arcade(this.game)}if(this.config.hasOwnProperty("ninja")&&this.config.ninja===true&&g.Physics.hasOwnProperty("Ninja")){this.ninja=new g.Physics.Ninja(this.game)}if(this.config.hasOwnProperty("p2")&&this.config.p2===true&&g.Physics.hasOwnProperty("P2")){this.p2=new g.Physics.P2(this.game,this.config)}if(this.config.hasOwnProperty("box2d")&&this.config.box2d===true&&g.Physics.hasOwnProperty("BOX2D")){this.box2d=new g.Physics.BOX2D(this.game,this.config)}if(this.config.hasOwnProperty("matter")&&this.config.matter===true&&g.Physics.hasOwnProperty("Matter")){this.matter=new g.Physics.Matter(this.game,this.config)}},startSystem:function(p){if(p===g.Physics.ARCADE){this.arcade=new g.Physics.Arcade(this.game)}else{if(p===g.Physics.P2JS){if(this.p2===null){this.p2=new g.Physics.P2(this.game,this.config)}else{this.p2.reset()}}else{if(p===g.Physics.NINJA){this.ninja=new g.Physics.Ninja(this.game)}else{if(p===g.Physics.BOX2D){if(this.box2d===null){this.box2d=new g.Physics.Box2D(this.game,this.config)}else{this.box2d.reset()}}else{if(p===g.Physics.MATTERJS){if(this.matter===null){this.matter=new g.Physics.Matter(this.game,this.config)}else{this.matter.reset()}}}}}}},enable:function(q,r,p){if(r===undefined){r=g.Physics.ARCADE}if(p===undefined){p=false}if(r===g.Physics.ARCADE){this.arcade.enable(q)}else{if(r===g.Physics.P2JS&&this.p2){this.p2.enable(q,p)}else{if(r===g.Physics.NINJA&&this.ninja){this.ninja.enableAABB(q)}else{if(r===g.Physics.BOX2D&&this.box2d){this.box2d.enable(q)}else{if(r===g.Physics.MATTERJS&&this.matter){this.matter.enable(q)}else{console.warn(q.key+" is attempting to enable a physics body using an unknown physics system.")}}}}}},preUpdate:function(){if(this.p2){this.p2.preUpdate()}if(this.box2d){this.box2d.preUpdate()}if(this.matter){this.matter.preUpdate()}},update:function(){if(this.p2){this.p2.update()}if(this.box2d){this.box2d.update()}if(this.matter){this.matter.update()}},setBoundsToWorld:function(){if(this.arcade){this.arcade.setBoundsToWorld()}if(this.ninja){this.ninja.setBoundsToWorld()}if(this.p2){this.p2.setBoundsToWorld()}if(this.box2d){this.box2d.setBoundsToWorld()}if(this.matter){this.matter.setBoundsToWorld()}},clear:function(){if(this.p2){this.p2.clear()}if(this.box2d){this.box2d.clear()}if(this.matter){this.matter.clear()}},reset:function(){if(this.p2){this.p2.reset()}if(this.box2d){this.box2d.reset()}if(this.matter){this.matter.reset()}},destroy:function(){if(this.p2){this.p2.destroy()}if(this.box2d){this.box2d.destroy()}if(this.matter){this.matter.destroy()}this.arcade=null;this.ninja=null;this.p2=null;this.box2d=null;this.matter=null}};g.Physics.prototype.constructor=g.Physics;g.Physics.Arcade=function(p){this.game=p;this.gravity=new g.Point();this.bounds=new g.Rectangle(0,0,p.world.width,p.world.height);this.checkCollision={up:true,down:true,left:true,right:true};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.forceX=false;this.sortDirection=g.Physics.Arcade.LEFT_RIGHT;this.skipQuadTree=true;this.isPaused=false;this.quadTree=new g.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._total=0;this.setBoundsToWorld()};g.Physics.Arcade.prototype.constructor=g.Physics.Arcade;g.Physics.Arcade.SORT_NONE=0;g.Physics.Arcade.LEFT_RIGHT=1;g.Physics.Arcade.RIGHT_LEFT=2;g.Physics.Arcade.TOP_BOTTOM=3;g.Physics.Arcade.BOTTOM_TOP=4;g.Physics.Arcade.prototype={setBounds:function(q,s,r,p){this.bounds.setTo(q,s,r,p)},setBoundsToWorld:function(){this.bounds.copyFrom(this.game.world.bounds)},enable:function(p,r){if(r===undefined){r=true}var q=1;if(Array.isArray(p)){q=p.length;while(q--){if(p[q] instanceof g.Group){this.enable(p[q].children,r)}else{this.enableBody(p[q]);if(r&&p[q].hasOwnProperty("children")&&p[q].children.length>0){this.enable(p[q],true)}}}}else{if(p instanceof g.Group){this.enable(p.children,r)}else{this.enableBody(p);if(r&&p.hasOwnProperty("children")&&p.children.length>0){this.enable(p.children,true)}}}},enableBody:function(p){if(p.hasOwnProperty("body")&&p.body===null){p.body=new g.Physics.Arcade.Body(p);if(p.parent&&p.parent instanceof g.Group){p.parent.addToHash(p)}}},updateMotion:function(p){var q=this.computeVelocity(0,p,p.angularVelocity,p.angularAcceleration,p.angularDrag,p.maxAngular)-p.angularVelocity;p.angularVelocity+=q;p.rotation+=(p.angularVelocity*this.game.time.physicsElapsed);p.velocity.x=this.computeVelocity(1,p,p.velocity.x,p.acceleration.x,p.drag.x,p.maxVelocity.x);p.velocity.y=this.computeVelocity(2,p,p.velocity.y,p.acceleration.y,p.drag.y,p.maxVelocity.y)},computeVelocity:function(s,q,u,t,r,p){if(p===undefined){p=10000}if(s===1&&q.allowGravity){u+=(this.gravity.x+q.gravity.x)*this.game.time.physicsElapsed}else{if(s===2&&q.allowGravity){u+=(this.gravity.y+q.gravity.y)*this.game.time.physicsElapsed}}if(t){u+=t*this.game.time.physicsElapsed}else{if(r){r*=this.game.time.physicsElapsed;if(u-r>0){u-=r}else{if(u+r<0){u+=r}else{u=0}}}}if(u>p){u=p}else{if(u<-p){u=-p}}return u},overlap:function(v,u,p,t,q){p=p||null;t=t||null;q=q||p;this._total=0;if(!Array.isArray(v)&&Array.isArray(u)){for(var s=0;s<u.length;s++){this.collideHandler(v,u[s],p,t,q,true)}}else{if(Array.isArray(v)&&!Array.isArray(u)){for(var s=0;s<v.length;s++){this.collideHandler(v[s],u,p,t,q,true)}}else{if(Array.isArray(v)&&Array.isArray(u)){for(var s=0;s<v.length;s++){for(var r=0;r<u.length;r++){this.collideHandler(v[s],u[r],p,t,q,true)}}}else{this.collideHandler(v,u,p,t,q,true)}}}return(this._total>0)},collide:function(v,u,t,s,p){t=t||null;s=s||null;p=p||t;this._total=0;if(!Array.isArray(v)&&Array.isArray(u)){for(var r=0;r<u.length;r++){this.collideHandler(v,u[r],t,s,p,false)}}else{if(Array.isArray(v)&&!Array.isArray(u)){for(var r=0;r<v.length;r++){this.collideHandler(v[r],u,t,s,p,false)}}else{if(Array.isArray(v)&&Array.isArray(u)){for(var r=0;r<v.length;r++){for(var q=0;q<u.length;q++){this.collideHandler(v[r],u[q],t,s,p,false)}}}else{this.collideHandler(v,u,t,s,p,false)}}}return(this._total>0)},sortLeftRight:function(q,p){if(!q.body||!p.body){return 0}return q.body.x-p.body.x},sortRightLeft:function(q,p){if(!q.body||!p.body){return 0}return p.body.x-q.body.x},sortTopBottom:function(q,p){if(!q.body||!p.body){return 0}return q.body.y-p.body.y},sortBottomTop:function(q,p){if(!q.body||!p.body){return 0}return p.body.y-q.body.y},sort:function(q,p){if(q.physicsSortDirection!==null){p=q.physicsSortDirection}else{if(p===undefined){p=this.sortDirection}}if(p===g.Physics.Arcade.LEFT_RIGHT){q.hash.sort(this.sortLeftRight)}else{if(p===g.Physics.Arcade.RIGHT_LEFT){q.hash.sort(this.sortRightLeft)}else{if(p===g.Physics.Arcade.TOP_BOTTOM){q.hash.sort(this.sortTopBottom)}else{if(p===g.Physics.Arcade.BOTTOM_TOP){q.hash.sort(this.sortBottomTop)}}}}},collideHandler:function(u,t,s,r,p,q){if(t===undefined&&u.physicsType===g.GROUP){this.sort(u);this.collideGroupVsSelf(u,s,r,p,q);return}if(!u||!t||!u.exists||!t.exists){return}if(this.sortDirection!==g.Physics.Arcade.SORT_NONE){if(u.physicsType===g.GROUP){this.sort(u)}if(t.physicsType===g.GROUP){this.sort(t)}}if(u.physicsType===g.SPRITE){if(t.physicsType===g.SPRITE){this.collideSpriteVsSprite(u,t,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideSpriteVsGroup(u,t,s,r,p,q)}else{if(t.physicsType===g.TILEMAPLAYER){this.collideSpriteVsTilemapLayer(u,t,s,r,p,q)}}}}else{if(u.physicsType===g.GROUP){if(t.physicsType===g.SPRITE){this.collideSpriteVsGroup(t,u,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideGroupVsGroup(u,t,s,r,p,q)}else{if(t.physicsType===g.TILEMAPLAYER){this.collideGroupVsTilemapLayer(u,t,s,r,p,q)}}}}else{if(u.physicsType===g.TILEMAPLAYER){if(t.physicsType===g.SPRITE){this.collideSpriteVsTilemapLayer(t,u,s,r,p,q)}else{if(t.physicsType===g.GROUP){this.collideGroupVsTilemapLayer(t,u,s,r,p,q)}}}}}},collideSpriteVsSprite:function(u,t,s,r,p,q){if(!u.body||!t.body){return false}if(this.separate(u.body,t.body,r,p,q)){if(s){s.call(p,u,t)}this._total++}return true},collideSpriteVsGroup:function(x,w,y,q,r,u){if(w.length===0||!x.body){return}if(this.skipQuadTree||x.body.skipQuadTree){var p={};for(var s=0;s<w.hash.length;s++){var v=w.hash[s];if(!v||!v.exists||!v.body){continue}p=v.body.getBounds(p);if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){if(x.body.right<p.x){break}else{if(p.right<x.body.x){continue}}}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){if(x.body.x>p.right){break}else{if(p.x>x.body.right){continue}}}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){if(x.body.bottom<p.y){break}else{if(p.bottom<x.body.y){continue}}}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){if(x.body.y>p.bottom){break}else{if(p.y>x.body.bottom){continue}}}}}}this.collideSpriteVsSprite(x,v,y,q,r,u)}}else{this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(w);var t=this.quadTree.retrieve(x);for(var s=0;s<t.length;s++){if(this.separate(x.body,t[s],q,r,u)){if(y){y.call(r,x,t[s].sprite)}this._total++}}}},collideGroupVsSelf:function(y,z,r,s,v){if(y.length===0){return}for(var u=0;u<y.hash.length;u++){var q={};var x=y.hash[u];if(!x||!x.exists||!x.body){continue}q=x.body.getBounds(q);for(var t=u+1;t<y.hash.length;t++){var p={};var w=y.hash[t];if(!w||!w.exists||!w.body){continue}p=w.body.getBounds(p);if(this.sortDirection===g.Physics.Arcade.LEFT_RIGHT){if(q.right<p.x){break}else{if(p.right<q.x){continue}}}else{if(this.sortDirection===g.Physics.Arcade.RIGHT_LEFT){if(q.x>p.right){continue}else{if(p.x>q.right){break}}}else{if(this.sortDirection===g.Physics.Arcade.TOP_BOTTOM){if(q.bottom<p.y){continue}else{if(p.bottom<q.y){break}}}else{if(this.sortDirection===g.Physics.Arcade.BOTTOM_TOP){if(q.y>p.bottom){continue}else{if(p.y>x.body.bottom){break}}}}}}this.collideSpriteVsSprite(x,w,z,r,s,v)}}},collideGroupVsGroup:function(p,v,u,t,q,r){if(p.length===0||v.length===0){return}for(var s=0;s<p.children.length;s++){if(p.children[s].exists){if(p.children[s].physicsType===g.GROUP){this.collideGroupVsGroup(p.children[s],v,u,t,q,r)}else{this.collideSpriteVsGroup(p.children[s],v,u,t,q,r)}}}},separate:function(p,A,s,t,w){if(!p.enable||!A.enable||p.checkCollision.none||A.checkCollision.none||!this.intersects(p,A)){return false}if(s&&s.call(t,p.sprite,A.sprite)===false){return false}if(p.isCircle&&A.isCircle){return this.separateCircle(p,A,w)}if(p.isCircle!==A.isCircle){var y=(p.isCircle)?A:p;var r=(p.isCircle)?p:A;var x={x:y.x,y:y.y,right:y.right,bottom:y.bottom};var q={x:r.x+r.radius,y:r.y+r.radius};if(q.y<x.y||q.y>x.bottom){if(q.x<x.x||q.x>x.right){return this.separateCircle(p,A,w)}}}var v=false;var u=false;if(this.forceX||Math.abs(this.gravity.y+p.gravity.y)<Math.abs(this.gravity.x+p.gravity.x)){v=this.separateX(p,A,w);if(this.intersects(p,A)){u=this.separateY(p,A,w)}}else{u=this.separateY(p,A,w);if(this.intersects(p,A)){v=this.separateX(p,A,w)}}var z=(v||u);if(z){if(w){if(p.onOverlap){p.onOverlap.dispatch(p.sprite,A.sprite)}if(A.onOverlap){A.onOverlap.dispatch(A.sprite,p.sprite)}}else{if(p.onCollide){p.onCollide.dispatch(p.sprite,A.sprite)}if(A.onCollide){A.onCollide.dispatch(A.sprite,p.sprite)}}}return z},intersects:function(q,p){if(q===p){return false}if(q.isCircle){if(p.isCircle){return g.Math.distance(q.center.x,q.center.y,p.center.x,p.center.y)<=(q.radius+p.radius)}else{return this.circleBodyIntersects(q,p)}}else{if(p.isCircle){return this.circleBodyIntersects(p,q)}else{if(q.right<=p.position.x){return false}if(q.bottom<=p.position.y){return false}if(q.position.x>=p.right){return false}if(q.position.y>=p.bottom){return false}return true}}},circleBodyIntersects:function(t,q){var p=g.Math.clamp(t.center.x,q.left,q.right);var u=g.Math.clamp(t.center.y,q.top,q.bottom);var s=(t.center.x-p)*(t.center.x-p);var r=(t.center.y-u)*(t.center.y-u);return(s+r)<=(t.radius*t.radius)},separateCircle:function(p,A,u){this.getOverlapX(p,A);this.getOverlapY(p,A);var B=A.center.x-p.center.x;var z=A.center.y-p.center.y;var r=Math.atan2(z,B);var x=0;if(p.isCircle!==A.isCircle){var v={x:(A.isCircle)?p.position.x:A.position.x,y:(A.isCircle)?p.position.y:A.position.y,right:(A.isCircle)?p.right:A.right,bottom:(A.isCircle)?p.bottom:A.bottom};var q={x:(p.isCircle)?(p.position.x+p.radius):(A.position.x+A.radius),y:(p.isCircle)?(p.position.y+p.radius):(A.position.y+A.radius),radius:(p.isCircle)?p.radius:A.radius};if(q.y<v.y){if(q.x<v.x){x=g.Math.distance(q.x,q.y,v.x,v.y)-q.radius}else{if(q.x>v.right){x=g.Math.distance(q.x,q.y,v.right,v.y)-q.radius}}}else{if(q.y>v.bottom){if(q.x<v.x){x=g.Math.distance(q.x,q.y,v.x,v.bottom)-q.radius}else{if(q.x>v.right){x=g.Math.distance(q.x,q.y,v.right,v.bottom)-q.radius}}}}x*=-1}else{x=(p.radius+A.radius)-g.Math.distance(p.center.x,p.center.y,A.center.x,A.center.y)}if(u||x===0||(p.immovable&&A.immovable)||p.customSeparateX||A.customSeparateX){if(x!==0){if(p.onOverlap){p.onOverlap.dispatch(p.sprite,A.sprite)}if(A.onOverlap){A.onOverlap.dispatch(A.sprite,p.sprite)}}return(x!==0)}var y={x:p.velocity.x*Math.cos(r)+p.velocity.y*Math.sin(r),y:p.velocity.x*Math.sin(r)-p.velocity.y*Math.cos(r)};var w={x:A.velocity.x*Math.cos(r)+A.velocity.y*Math.sin(r),y:A.velocity.x*Math.sin(r)-A.velocity.y*Math.cos(r)};var t=((p.mass-A.mass)*y.x+2*A.mass*w.x)/(p.mass+A.mass);var s=(2*p.mass*y.x+(A.mass-p.mass)*w.x)/(p.mass+A.mass);if(!p.immovable){p.velocity.x=(t*Math.cos(r)-y.y*Math.sin(r))*p.bounce.x;p.velocity.y=(y.y*Math.cos(r)+t*Math.sin(r))*p.bounce.y}if(!A.immovable){A.velocity.x=(s*Math.cos(r)-w.y*Math.sin(r))*A.bounce.x;A.velocity.y=(w.y*Math.cos(r)+s*Math.sin(r))*A.bounce.y}if(Math.abs(r)<Math.PI/2){if((p.velocity.x>0)&&!p.immovable&&(A.velocity.x>p.velocity.x)){p.velocity.x*=-1}else{if((A.velocity.x<0)&&!A.immovable&&(p.velocity.x<A.velocity.x)){A.velocity.x*=-1}else{if((p.velocity.y>0)&&!p.immovable&&(A.velocity.y>p.velocity.y)){p.velocity.y*=-1}else{if((A.velocity.y<0)&&!A.immovable&&(p.velocity.y<A.velocity.y)){A.velocity.y*=-1}}}}}else{if(Math.abs(r)>Math.PI/2){if((p.velocity.x<0)&&!p.immovable&&(A.velocity.x<p.velocity.x)){p.velocity.x*=-1}else{if((A.velocity.x>0)&&!A.immovable&&(p.velocity.x>A.velocity.x)){A.velocity.x*=-1}else{if((p.velocity.y<0)&&!p.immovable&&(A.velocity.y<p.velocity.y)){p.velocity.y*=-1}else{if((A.velocity.y>0)&&!A.immovable&&(p.velocity.x>A.velocity.y)){A.velocity.y*=-1}}}}}}if(!p.immovable){p.x+=(p.velocity.x*this.game.time.physicsElapsed)-x*Math.cos(r);p.y+=(p.velocity.y*this.game.time.physicsElapsed)-x*Math.sin(r)}if(!A.immovable){A.x+=(A.velocity.x*this.game.time.physicsElapsed)+x*Math.cos(r);A.y+=(A.velocity.y*this.game.time.physicsElapsed)+x*Math.sin(r)}if(p.onCollide){p.onCollide.dispatch(p.sprite,A.sprite)}if(A.onCollide){A.onCollide.dispatch(A.sprite,p.sprite)}return true},getOverlapX:function(s,q,r){var p=0;var t=s.deltaAbsX()+q.deltaAbsX()+this.OVERLAP_BIAS;if(s.deltaX()===0&&q.deltaX()===0){s.embedded=true;q.embedded=true}else{if(s.deltaX()>q.deltaX()){p=s.right-q.x;if((p>t&&!r)||s.checkCollision.right===false||q.checkCollision.left===false){p=0}else{s.touching.none=false;s.touching.right=true;q.touching.none=false;q.touching.left=true}}else{if(s.deltaX()<q.deltaX()){p=s.x-q.width-q.x;if((-p>t&&!r)||s.checkCollision.left===false||q.checkCollision.right===false){p=0}else{s.touching.none=false;s.touching.left=true;q.touching.none=false;q.touching.right=true}}}}s.overlapX=p;q.overlapX=p;return p},getOverlapY:function(s,q,r){var p=0;var t=s.deltaAbsY()+q.deltaAbsY()+this.OVERLAP_BIAS;if(s.deltaY()===0&&q.deltaY()===0){s.embedded=true;q.embedded=true}else{if(s.deltaY()>q.deltaY()){p=s.bottom-q.y;if((p>t&&!r)||s.checkCollision.down===false||q.checkCollision.up===false){p=0}else{s.touching.none=false;s.touching.down=true;q.touching.none=false;q.touching.up=true}}else{if(s.deltaY()<q.deltaY()){p=s.y-q.bottom;if((-p>t&&!r)||s.checkCollision.up===false||q.checkCollision.down===false){p=0}else{s.touching.none=false;s.touching.up=true;q.touching.none=false;q.touching.down=true}}}}s.overlapY=p;q.overlapY=p;return p},separateX:function(p,x,r){var v=this.getOverlapX(p,x,r);if(r||v===0||(p.immovable&&x.immovable)||p.customSeparateX||x.customSeparateX){return(v!==0)||(p.embedded&&x.embedded)}var w=p.velocity.x;var u=x.velocity.x;if(!p.immovable&&!x.immovable){v*=0.5;p.x-=v;x.x+=v;var t=Math.sqrt((u*u*x.mass)/p.mass)*((u>0)?1:-1);var s=Math.sqrt((w*w*p.mass)/x.mass)*((w>0)?1:-1);var q=(t+s)*0.5;t-=q;s-=q;p.velocity.x=q+t*p.bounce.x;x.velocity.x=q+s*x.bounce.x}else{if(!p.immovable){p.x-=v;p.velocity.x=u-w*p.bounce.x;if(x.moves){p.y+=(x.y-x.prev.y)*x.friction.y}}else{x.x+=v;x.velocity.x=w-u*x.bounce.x;if(p.moves){x.y+=(p.y-p.prev.y)*p.friction.y}}}return true},separateY:function(p,x,r){var v=this.getOverlapY(p,x,r);if(r||v===0||(p.immovable&&x.immovable)||p.customSeparateY||x.customSeparateY){return(v!==0)||(p.embedded&&x.embedded)}var w=p.velocity.y;var u=x.velocity.y;if(!p.immovable&&!x.immovable){v*=0.5;p.y-=v;x.y+=v;var t=Math.sqrt((u*u*x.mass)/p.mass)*((u>0)?1:-1);var s=Math.sqrt((w*w*p.mass)/x.mass)*((w>0)?1:-1);var q=(t+s)*0.5;t-=q;s-=q;p.velocity.y=q+t*p.bounce.y;x.velocity.y=q+s*x.bounce.y}else{if(!p.immovable){p.y-=v;p.velocity.y=u-w*p.bounce.y;if(x.moves){p.x+=(x.x-x.prev.x)*x.friction.x}}else{x.y+=v;x.velocity.y=w-u*x.bounce.y;if(p.moves){x.x+=(p.x-p.prev.x)*p.friction.x}}}return true},getObjectsUnderPointer:function(r,q,s,p){if(q.length===0||!r.exists){return}return this.getObjectsAtLocation(r.x,r.y,q,s,p,r)},getObjectsAtLocation:function(w,u,z,A,q,s){this.quadTree.clear();this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this.quadTree.populate(z);var v=new g.Rectangle(w,u,1,1);var p=[];var t=this.quadTree.retrieve(v);for(var r=0;r<t.length;r++){if(t[r].hitTest(w,u)){if(A){A.call(q,s,t[r].sprite)}p.push(t[r].sprite)}}return p},moveToObject:function(t,p,r,q){if(r===undefined){r=60}if(q===undefined){q=0}var s=Math.atan2(p.y-t.y,p.x-t.x);if(q>0){r=this.distanceBetween(t,p)/(q/1000)}t.body.velocity.x=Math.cos(s)*r;t.body.velocity.y=Math.sin(s)*r;return s},moveToPointer:function(t,q,s,p){if(q===undefined){q=60}s=s||this.game.input.activePointer;if(p===undefined){p=0}var r=this.angleToPointer(t,s);if(p>0){q=this.distanceToPointer(t,s)/(p/1000)}t.body.velocity.x=Math.cos(r)*q;t.body.velocity.y=Math.sin(r)*q;return r},moveToXY:function(t,p,u,r,q){if(r===undefined){r=60}if(q===undefined){q=0}var s=Math.atan2(u-t.y,p-t.x);if(q>0){r=this.distanceToXY(t,p,u)/(q/1000)}t.body.velocity.x=Math.cos(s)*r;t.body.velocity.y=Math.sin(s)*r;return s},velocityFromAngle:function(r,q,p){if(q===undefined){q=60}p=p||new g.Point();return p.setTo((Math.cos(this.game.math.degToRad(r))*q),(Math.sin(this.game.math.degToRad(r))*q))},velocityFromRotation:function(q,r,p){if(r===undefined){r=60}p=p||new g.Point();return p.setTo((Math.cos(q)*r),(Math.sin(q)*r))},accelerationFromRotation:function(q,r,p){if(r===undefined){r=60}p=p||new g.Point();return p.setTo((Math.cos(q)*r),(Math.sin(q)*r))},accelerateToObject:function(t,q,r,p,u){if(r===undefined){r=60}if(p===undefined){p=1000}if(u===undefined){u=1000}var s=this.angleBetween(t,q);t.body.acceleration.setTo(Math.cos(s)*r,Math.sin(s)*r);t.body.maxVelocity.setTo(p,u);return s},accelerateToPointer:function(t,s,q,p,u){if(q===undefined){q=60}if(s===undefined){s=this.game.input.activePointer}if(p===undefined){p=1000}if(u===undefined){u=1000}var r=this.angleToPointer(t,s);t.body.acceleration.setTo(Math.cos(r)*q,Math.sin(r)*q);t.body.maxVelocity.setTo(p,u);return r},accelerateToXY:function(t,q,v,r,p,u){if(r===undefined){r=60}if(p===undefined){p=1000}if(u===undefined){u=1000}var s=this.angleToXY(t,q,v);t.body.acceleration.setTo(Math.cos(s)*r,Math.sin(s)*r);t.body.maxVelocity.setTo(p,u);return s},distanceBetween:function(s,t,r){if(r===undefined){r=false}var q=(r)?s.world.x-t.world.x:s.x-t.x;var p=(r)?s.world.y-t.world.y:s.y-t.y;return Math.sqrt(q*q+p*p)},distanceToXY:function(t,p,u,s){if(s===undefined){s=false}var r=(s)?t.world.x-p:t.x-p;var q=(s)?t.world.y-u:t.y-u;return Math.sqrt(r*r+q*q)},distanceToPointer:function(t,s,r){if(s===undefined){s=this.game.input.activePointer}if(r===undefined){r=false}var q=(r)?t.world.x-s.worldX:t.x-s.worldX;var p=(r)?t.world.y-s.worldY:t.y-s.worldY;return Math.sqrt(q*q+p*p)},angleBetween:function(q,r,p){if(p===undefined){p=false}if(p){return Math.atan2(r.world.y-q.world.y,r.world.x-q.world.x)}else{return Math.atan2(r.y-q.y,r.x-q.x)}},angleBetweenCenters:function(r,s){var q=s.centerX-r.centerX;var p=s.centerY-r.centerY;return Math.atan2(p,q)},angleToXY:function(r,p,s,q){if(q===undefined){q=false}if(q){return Math.atan2(s-r.world.y,p-r.world.x)}else{return Math.atan2(s-r.y,p-r.x)}},angleToPointer:function(r,q,p){if(q===undefined){q=this.game.input.activePointer}if(p===undefined){p=false}if(p){return Math.atan2(q.worldY-r.world.y,q.worldX-r.world.x)}else{return Math.atan2(q.worldY-r.y,q.worldX-r.x)}},worldAngleToPointer:function(q,p){return this.angleToPointer(q,p,true)}};g.Physics.Arcade.Body=function(p){this.sprite=p;this.game=p.game;this.type=g.Physics.ARCADE;this.enable=true;this.isCircle=false;this.radius=0;this.offset=new g.Point();this.position=new g.Point(p.x,p.y);this.prev=new g.Point(this.position.x,this.position.y);this.allowRotation=true;this.rotation=p.angle;this.preRotation=p.angle;this.width=p.width;this.height=p.height;this.sourceWidth=p.width;this.sourceHeight=p.height;if(p.texture){this.sourceWidth=p.texture.frame.width;this.sourceHeight=p.texture.frame.height}this.halfWidth=Math.abs(p.width/2);this.halfHeight=Math.abs(p.height/2);this.center=new g.Point(p.x+this.halfWidth,p.y+this.halfHeight);this.velocity=new g.Point();this.newVelocity=new g.Point();this.deltaMax=new g.Point();this.acceleration=new g.Point();this.drag=new g.Point();this.allowGravity=true;this.gravity=new g.Point();this.bounce=new g.Point();this.worldBounce=null;this.onWorldBounds=null;this.onCollide=null;this.onOverlap=null;this.maxVelocity=new g.Point(10000,10000);this.friction=new g.Point(1,0);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1000;this.mass=1;this.angle=0;this.speed=0;this.facing=g.NONE;this.immovable=false;this.moves=true;this.customSeparateX=false;this.customSeparateY=false;this.overlapX=0;this.overlapY=0;this.overlapR=0;this.embedded=false;this.collideWorldBounds=false;this.checkCollision={none:false,any:true,up:true,down:true,left:true,right:true};this.touching={none:true,up:false,down:false,left:false,right:false};this.wasTouching={none:true,up:false,down:false,left:false,right:false};this.blocked={up:false,down:false,left:false,right:false};this.tilePadding=new g.Point();this.dirty=false;this.skipQuadTree=false;this.syncBounds=false;this.isMoving=false;this.stopVelocityOnCollide=true;this.moveTimer=0;this.moveDistance=0;this.moveDuration=0;this.moveTarget=null;this.moveEnd=null;this.onMoveComplete=new g.Signal();this.movementCallback=null;this.movementCallbackContext=null;this._reset=true;this._sx=p.scale.x;this._sy=p.scale.y;this._dx=0;this._dy=0};g.Physics.Arcade.Body.prototype={updateBounds:function(){if(this.syncBounds){var p=this.sprite.getBounds();p.ceilAll();if(p.width!==this.width||p.height!==this.height){this.width=p.width;this.height=p.height;this._reset=true}}else{var r=Math.abs(this.sprite.scale.x);var q=Math.abs(this.sprite.scale.y);if(r!==this._sx||q!==this._sy){this.width=this.sourceWidth*r;this.height=this.sourceHeight*q;this._sx=r;this._sy=q;this._reset=true}}if(this._reset){this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}},preUpdate:function(){if(!this.enable||this.game.physics.arcade.isPaused){return}this.dirty=true;this.wasTouching.none=this.touching.none;this.wasTouching.up=this.touching.up;this.wasTouching.down=this.touching.down;this.wasTouching.left=this.touching.left;this.wasTouching.right=this.touching.right;this.touching.none=true;this.touching.up=false;this.touching.down=false;this.touching.left=false;this.touching.right=false;this.blocked.up=false;this.blocked.down=false;this.blocked.left=false;this.blocked.right=false;this.embedded=false;this.updateBounds();this.position.x=(this.sprite.world.x-(this.sprite.anchor.x*this.sprite.width))+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=(this.sprite.world.y-(this.sprite.anchor.y*this.sprite.height))+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.rotation=this.sprite.angle;this.preRotation=this.rotation;if(this._reset||this.sprite.fresh){this.prev.x=this.position.x;this.prev.y=this.position.y}if(this.moves){this.game.physics.arcade.updateMotion(this);this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed);this.position.x+=this.newVelocity.x;this.position.y+=this.newVelocity.y;if(this.position.x!==this.prev.x||this.position.y!==this.prev.y){this.angle=Math.atan2(this.velocity.y,this.velocity.x)}this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y);if(this.collideWorldBounds){if(this.checkWorldBounds()&&this.onWorldBounds){this.onWorldBounds.dispatch(this.sprite,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)}}}this._dx=this.deltaX();this._dy=this.deltaY();this._reset=false},updateMovement:function(){var r=0;var q=(this.overlapX!==0||this.overlapY!==0);if(this.moveDuration>0){this.moveTimer+=this.game.time.elapsedMS;r=this.moveTimer/this.moveDuration}else{this.moveTarget.end.set(this.position.x,this.position.y);r=this.moveTarget.length/this.moveDistance}if(this.movementCallback){var p=this.movementCallback.call(this.movementCallbackContext,this,this.velocity,r)}if(q||r>=1||(p!==undefined&&p!==true)){this.stopMovement((r>=1)||(this.stopVelocityOnCollide&&q));return false}return true},stopMovement:function(p){if(this.isMoving){this.isMoving=false;if(p){this.velocity.set(0)}this.onMoveComplete.dispatch(this.sprite,(this.overlapX!==0||this.overlapY!==0))}},postUpdate:function(){if(!this.enable||!this.dirty){return}if(this.isMoving){this.updateMovement()}this.dirty=false;if(this.deltaX()<0){this.facing=g.LEFT}else{if(this.deltaX()>0){this.facing=g.RIGHT}}if(this.deltaY()<0){this.facing=g.UP}else{if(this.deltaY()>0){this.facing=g.DOWN}}if(this.moves){this._dx=this.deltaX();this._dy=this.deltaY();if(this.deltaMax.x!==0&&this._dx!==0){if(this._dx<0&&this._dx<-this.deltaMax.x){this._dx=-this.deltaMax.x}else{if(this._dx>0&&this._dx>this.deltaMax.x){this._dx=this.deltaMax.x}}}if(this.deltaMax.y!==0&&this._dy!==0){if(this._dy<0&&this._dy<-this.deltaMax.y){this._dy=-this.deltaMax.y}else{if(this._dy>0&&this._dy>this.deltaMax.y){this._dy=this.deltaMax.y}}}this.sprite.position.x+=this._dx;this.sprite.position.y+=this._dy;this._reset=true}this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);if(this.allowRotation){this.sprite.angle+=this.deltaZ()}this.prev.x=this.position.x;this.prev.y=this.position.y},checkWorldBounds:function(){var u=this.position;var r=this.game.physics.arcade.bounds;var p=this.game.physics.arcade.checkCollision;var t=(this.worldBounce)?-this.worldBounce.x:-this.bounce.x;var s=(this.worldBounce)?-this.worldBounce.y:-this.bounce.y;if(this.isCircle){var q={x:this.center.x-this.radius,y:this.center.y-this.radius,right:this.center.x+this.radius,bottom:this.center.y+this.radius};if(q.x<r.x&&p.left){u.x=r.x-this.halfWidth+this.radius;this.velocity.x*=t;this.blocked.left=true}else{if(q.right>r.right&&p.right){u.x=r.right-this.halfWidth-this.radius;this.velocity.x*=t;this.blocked.right=true}}if(q.y<r.y&&p.up){u.y=r.y-this.halfHeight+this.radius;this.velocity.y*=s;this.blocked.up=true}else{if(q.bottom>r.bottom&&p.down){u.y=r.bottom-this.halfHeight-this.radius;this.velocity.y*=s;this.blocked.down=true}}}else{if(u.x<r.x&&p.left){u.x=r.x;this.velocity.x*=t;this.blocked.left=true}else{if(this.right>r.right&&p.right){u.x=r.right-this.width;this.velocity.x*=t;this.blocked.right=true}}if(u.y<r.y&&p.up){u.y=r.y;this.velocity.y*=s;this.blocked.up=true}else{if(this.bottom>r.bottom&&p.down){u.y=r.bottom-this.height;this.velocity.y*=s;this.blocked.down=true}}}return(this.blocked.up||this.blocked.down||this.blocked.left||this.blocked.right)},moveFrom:function(r,p,q){if(p===undefined){p=this.speed}if(p===0){return false}var s;if(q===undefined){s=this.angle;q=this.game.math.radToDeg(s)}else{s=this.game.math.degToRad(q)}this.moveTimer=0;this.moveDuration=r;if(q===0||q===180){this.velocity.set(Math.cos(s)*p,0)}else{if(q===90||q===270){this.velocity.set(0,Math.sin(s)*p)}else{this.velocity.set(Math.cos(s)*p,Math.sin(s)*p)}}this.isMoving=true;return true},moveTo:function(r,t,q){var p=t/(r/1000);if(p===0){return false}var s;if(q===undefined){s=this.angle;q=this.game.math.radToDeg(s)}else{s=this.game.math.degToRad(q)}t=Math.abs(t);this.moveDuration=0;this.moveDistance=t;if(this.moveTarget===null){this.moveTarget=new g.Line();this.moveEnd=new g.Point()}this.moveTarget.fromAngle(this.x,this.y,s,t);this.moveEnd.set(this.moveTarget.end.x,this.moveTarget.end.y);this.moveTarget.setTo(this.x,this.y,this.x,this.y);if(q===0||q===180){this.velocity.set(Math.cos(s)*p,0)}else{if(q===90||q===270){this.velocity.set(0,Math.sin(s)*p)}else{this.velocity.set(Math.cos(s)*p,Math.sin(s)*p)}}this.isMoving=true;return true},setSize:function(r,q,p,s){if(p===undefined){p=this.offset.x}if(s===undefined){s=this.offset.y}this.sourceWidth=r;this.sourceHeight=q;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(p,s);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight);this.isCircle=false;this.radius=0},setCircle:function(q,p,r){if(p===undefined){p=this.offset.x}if(r===undefined){r=this.offset.y}if(q>0){this.isCircle=true;this.radius=q;this.sourceWidth=q*2;this.sourceHeight=q*2;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(p,r);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)}else{this.isCircle=false}},reset:function(p,q){this.velocity.set(0);this.acceleration.set(0);this.speed=0;this.angularVelocity=0;this.angularAcceleration=0;this.position.x=(p-(this.sprite.anchor.x*this.sprite.width))+this.sprite.scale.x*this.offset.x;this.position.x-=this.sprite.scale.x<0?this.width:0;this.position.y=(q-(this.sprite.anchor.y*this.sprite.height))+this.sprite.scale.y*this.offset.y;this.position.y-=this.sprite.scale.y<0?this.height:0;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},getBounds:function(p){if(this.isCircle){p.x=this.center.x-this.radius;p.y=this.center.y-this.radius;p.right=this.center.x+this.radius;p.bottom=this.center.y+this.radius}else{p.x=this.x;p.y=this.y;p.right=this.right;p.bottom=this.bottom}return p},hitTest:function(p,q){return(this.isCircle)?g.Circle.contains(this,p,q):g.Rectangle.contains(this,p,q)},onFloor:function(){return this.blocked.down},onCeiling:function(){return this.blocked.up},onWall:function(){return(this.blocked.left||this.blocked.right)},deltaAbsX:function(){return(this.deltaX()>0?this.deltaX():-this.deltaX())},deltaAbsY:function(){return(this.deltaY()>0?this.deltaY():-this.deltaY())},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation},destroy:function(){if(this.sprite.parent&&this.sprite.parent instanceof g.Group){this.sprite.parent.removeFromHash(this.sprite)}this.sprite.body=null;this.sprite=null}};Object.defineProperty(g.Physics.Arcade.Body.prototype,"left",{get:function(){return this.position.x}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"top",{get:function(){return this.position.y}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(p){this.position.x=p}});Object.defineProperty(g.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(p){this.position.y=p}});g.Physics.Arcade.Body.render=function(r,p,q,s){if(s===undefined){s=true}q=q||"rgba(0,255,0,0.4)";r.fillStyle=q;r.strokeStyle=q;if(p.isCircle){r.beginPath();r.arc(p.center.x-p.game.camera.x,p.center.y-p.game.camera.y,p.radius,0,2*Math.PI);if(s){r.fill()}else{r.stroke()}}else{if(s){r.fillRect(p.position.x-p.game.camera.x,p.position.y-p.game.camera.y,p.width,p.height)}else{r.strokeRect(p.position.x-p.game.camera.x,p.position.y-p.game.camera.y,p.width,p.height)}}};g.Physics.Arcade.Body.renderBodyInfo=function(q,p){q.line("x: "+p.x.toFixed(2),"y: "+p.y.toFixed(2),"width: "+p.width,"height: "+p.height);q.line("velocity x: "+p.velocity.x.toFixed(2),"y: "+p.velocity.y.toFixed(2),"deltaX: "+p._dx.toFixed(2),"deltaY: "+p._dy.toFixed(2));q.line("acceleration x: "+p.acceleration.x.toFixed(2),"y: "+p.acceleration.y.toFixed(2),"speed: "+p.speed.toFixed(2),"angle: "+p.angle.toFixed(2));q.line("gravity x: "+p.gravity.x,"y: "+p.gravity.y,"bounce x: "+p.bounce.x.toFixed(2),"y: "+p.bounce.y.toFixed(2));q.line("touching left: "+p.touching.left,"right: "+p.touching.right,"up: "+p.touching.up,"down: "+p.touching.down);q.line("blocked left: "+p.blocked.left,"right: "+p.blocked.right,"up: "+p.blocked.up,"down: "+p.blocked.down)};g.Physics.Arcade.Body.prototype.constructor=g.Physics.Arcade.Body;g.Physics.Arcade.TilemapCollision=function(){};g.Physics.Arcade.TilemapCollision.prototype={TILE_BIAS:16,collideSpriteVsTilemapLayer:function(t,p,v,u,q,r){if(!t.body){return}var w=p.getTiles(t.body.position.x-t.body.tilePadding.x,t.body.position.y-t.body.tilePadding.y,t.body.width+t.body.tilePadding.x,t.body.height+t.body.tilePadding.y,false,false);if(w.length===0){return}for(var s=0;s<w.length;s++){if(u){if(u.call(q,t,w[s])){if(this.separateTile(s,t.body,w[s],p,r)){this._total++;if(v){v.call(q,t,w[s])}}}}else{if(this.separateTile(s,t.body,w[s],p,r)){this._total++;if(v){v.call(q,t,w[s])}}}}},collideGroupVsTilemapLayer:function(v,p,u,t,q,r){if(v.length===0){return}for(var s=0;s<v.children.length;s++){if(v.children[s].exists){this.collideSpriteVsTilemapLayer(v.children[s],p,u,t,q,r)}}},separateTile:function(w,x,y,p,z){if(!x.enable){return false}var s=(!p.fixedToCamera)?p.position.x:0;var r=(!p.fixedToCamera)?p.position.y:0;if(!y.intersects((x.position.x-s),(x.position.y-r),(x.right-s),(x.bottom-r))){return false}else{if(z){return true}}if(y.collisionCallback&&!y.collisionCallback.call(y.collisionCallbackContext,x.sprite,y)){return false}else{if(typeof y.layer.callbacks!=="undefined"&&y.layer.callbacks[y.index]&&!y.layer.callbacks[y.index].callback.call(y.layer.callbacks[y.index].callbackContext,x.sprite,y)){return false}}if(!y.faceLeft&&!y.faceRight&&!y.faceTop&&!y.faceBottom){return false}var t=0;var q=0;var v=0;var u=1;if(x.deltaAbsX()>x.deltaAbsY()){v=-1}else{if(x.deltaAbsX()<x.deltaAbsY()){u=-1}}if(x.deltaX()!==0&&x.deltaY()!==0&&(y.faceLeft||y.faceRight)&&(y.faceTop||y.faceBottom)){v=Math.min(Math.abs((x.position.x-s)-y.right),Math.abs((x.right-s)-y.left));u=Math.min(Math.abs((x.position.y-r)-y.bottom),Math.abs((x.bottom-r)-y.top))}if(v<u){if(y.faceLeft||y.faceRight){t=this.tileCheckX(x,y,p);if(t!==0&&!y.intersects((x.position.x-s),(x.position.y-r),(x.right-s),(x.bottom-r))){return true}}if(y.faceTop||y.faceBottom){q=this.tileCheckY(x,y,p)}}else{if(y.faceTop||y.faceBottom){q=this.tileCheckY(x,y,p);if(q!==0&&!y.intersects((x.position.x-s),(x.position.y-r),(x.right-s),(x.bottom-r))){return true}}if(y.faceLeft||y.faceRight){t=this.tileCheckX(x,y,p)}}return(t!==0||q!==0)},tileCheckX:function(p,s,q){var r=0;var t=(!q.fixedToCamera)?q.position.x:0;if(p.deltaX()<0&&!p.blocked.left&&s.collideRight&&p.checkCollision.left){if(s.faceRight&&(p.x-t)<s.right){r=(p.x-t)-s.right;if(r<-this.TILE_BIAS){r=0}}}else{if(p.deltaX()>0&&!p.blocked.right&&s.collideLeft&&p.checkCollision.right){if(s.faceLeft&&(p.right-t)>s.left){r=(p.right-t)-s.left;if(r>this.TILE_BIAS){r=0}}}}if(r!==0){if(p.customSeparateX){p.overlapX=r}else{this.processTileSeparationX(p,r)}}return r},tileCheckY:function(p,s,r){var q=0;var t=(!r.fixedToCamera)?r.position.y:0;if(p.deltaY()<0&&!p.blocked.up&&s.collideDown&&p.checkCollision.up){if(s.faceBottom&&(p.y-t)<s.bottom){q=(p.y-t)-s.bottom;if(q<-this.TILE_BIAS){q=0}}}else{if(p.deltaY()>0&&!p.blocked.down&&s.collideUp&&p.checkCollision.down){if(s.faceTop&&(p.bottom-t)>s.top){q=(p.bottom-t)-s.top;if(q>this.TILE_BIAS){q=0}}}}if(q!==0){if(p.customSeparateY){p.overlapY=q}else{this.processTileSeparationY(p,q)}}return q},processTileSeparationX:function(q,p){if(p<0){q.blocked.left=true}else{if(p>0){q.blocked.right=true}}q.position.x-=p;if(q.bounce.x===0){q.velocity.x=0}else{q.velocity.x=-q.velocity.x*q.bounce.x}},processTileSeparationY:function(p,q){if(q<0){p.blocked.up=true}else{if(q>0){p.blocked.down=true}}p.position.y-=q;if(p.bounce.y===0){p.velocity.y=0}else{p.velocity.y=-p.velocity.y*p.bounce.y}}};g.Utils.mixinPrototype(g.Physics.Arcade.prototype,g.Physics.Arcade.TilemapCollision.prototype);p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;g.Physics.P2=function(p,q){this.game=p;if(q===undefined){q={gravity:[0,0],broadphase:new p2.SAPBroadphase()}}else{if(!q.hasOwnProperty("gravity")){q.gravity=[0,0]}if(!q.hasOwnProperty("broadphase")){q.broadphase=new p2.SAPBroadphase()}}this.config=q;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=false;this.paused=false;this.materials=[];this.gravity=new g.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new g.Signal();this.onBodyRemoved=new g.Signal();this.onSpringAdded=new g.Signal();this.onSpringRemoved=new g.Signal();this.onConstraintAdded=new g.Signal();this.onConstraintRemoved=new g.Signal();this.onContactMaterialAdded=new g.Signal();this.onContactMaterialRemoved=new g.Signal();this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new g.Signal();this.onEndContact=new g.Signal();if(q.hasOwnProperty("mpx")&&q.hasOwnProperty("pxm")&&q.hasOwnProperty("mpxi")&&q.hasOwnProperty("pxmi")){this.mpx=q.mpx;this.mpxi=q.mpxi;this.pxm=q.pxm;this.pxmi=q.pxmi}this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new g.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new g.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new g.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this._boundsLeft=true;this._boundsRight=true;this._boundsTop=true;this._boundsBottom=true;this._boundsOwnGroup=false;this.setBoundsToWorld(true,true,true,true,false)};g.Physics.P2.prototype={removeBodyNextStep:function(p){this._toRemove.push(p)},preUpdate:function(){var p=this._toRemove.length;while(p--){this.removeBody(this._toRemove[p])}this._toRemove.length=0},enable:function(q,p,s){if(p===undefined){p=false}if(s===undefined){s=true}var r=1;if(Array.isArray(q)){r=q.length;while(r--){if(q[r] instanceof g.Group){this.enable(q[r].children,p,s)}else{this.enableBody(q[r],p);if(s&&q[r].hasOwnProperty("children")&&q[r].children.length>0){this.enable(q[r],p,true)}}}}else{if(q instanceof g.Group){this.enable(q.children,p,s)}else{this.enableBody(q,p);if(s&&q.hasOwnProperty("children")&&q.children.length>0){this.enable(q.children,p,true)}}}},enableBody:function(q,p){if(q.hasOwnProperty("body")&&q.body===null){q.body=new g.Physics.P2.Body(this.game,q,q.x,q.y,1);q.body.debug=p;if(typeof q.anchor!=="undefined"){q.anchor.set(0.5)}}},setImpactEvents:function(p){if(p){this.world.on("impact",this.impactHandler,this)}else{this.world.off("impact",this.impactHandler,this)}},setPostBroadphaseCallback:function(q,p){this.postBroadphaseCallback=q;this.callbackContext=p;if(q!==null){this.world.on("postBroadphase",this.postBroadphaseHandler,this)}else{this.world.off("postBroadphase",this.postBroadphaseHandler,this)}},postBroadphaseHandler:function(q){if(!this.postBroadphaseCallback||q.pairs.length===0){return}for(var p=q.pairs.length-2;p>=0;p-=2){if(q.pairs[p].parent&&q.pairs[p+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,q.pairs[p].parent,q.pairs[p+1].parent)){q.pairs.splice(p,2)}}},impactHandler:function(r){if(r.bodyA.parent&&r.bodyB.parent){var q=r.bodyA.parent;var p=r.bodyB.parent;if(q._bodyCallbacks[r.bodyB.id]){q._bodyCallbacks[r.bodyB.id].call(q._bodyCallbackContext[r.bodyB.id],q,p,r.shapeA,r.shapeB)}if(p._bodyCallbacks[r.bodyA.id]){p._bodyCallbacks[r.bodyA.id].call(p._bodyCallbackContext[r.bodyA.id],p,q,r.shapeB,r.shapeA)}if(q._groupCallbacks[r.shapeB.collisionGroup]){q._groupCallbacks[r.shapeB.collisionGroup].call(q._groupCallbackContext[r.shapeB.collisionGroup],q,p,r.shapeA,r.shapeB)}if(p._groupCallbacks[r.shapeA.collisionGroup]){p._groupCallbacks[r.shapeA.collisionGroup].call(p._groupCallbackContext[r.shapeA.collisionGroup],p,q,r.shapeB,r.shapeA)}}},beginContactHandler:function(p){if(p.bodyA&&p.bodyB){this.onBeginContact.dispatch(p.bodyA,p.bodyB,p.shapeA,p.shapeB,p.contactEquations);if(p.bodyA.parent){p.bodyA.parent.onBeginContact.dispatch(p.bodyB.parent,p.bodyB,p.shapeA,p.shapeB,p.contactEquations)}if(p.bodyB.parent){p.bodyB.parent.onBeginContact.dispatch(p.bodyA.parent,p.bodyA,p.shapeB,p.shapeA,p.contactEquations)}}},endContactHandler:function(p){if(p.bodyA&&p.bodyB){this.onEndContact.dispatch(p.bodyA,p.bodyB,p.shapeA,p.shapeB);if(p.bodyA.parent){p.bodyA.parent.onEndContact.dispatch(p.bodyB.parent,p.bodyB,p.shapeA,p.shapeB)}if(p.bodyB.parent){p.bodyB.parent.onEndContact.dispatch(p.bodyA.parent,p.bodyA,p.shapeB,p.shapeA)}}},setBoundsToWorld:function(t,q,s,p,r){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,t,q,s,p,r)},setWorldMaterial:function(r,t,q,s,p){if(t===undefined){t=true}if(q===undefined){q=true}if(s===undefined){s=true}if(p===undefined){p=true}if(t&&this.walls.left){this.walls.left.shapes[0].material=r}if(q&&this.walls.right){this.walls.right.shapes[0].material=r}if(s&&this.walls.top){this.walls.top.shapes[0].material=r}if(p&&this.walls.bottom){this.walls.bottom.shapes[0].material=r}},updateBoundsCollisionGroup:function(q){if(q===undefined){q=true}var p=(q)?this.boundsCollisionGroup.mask:this.everythingCollisionGroup.mask;if(this.walls.left){this.walls.left.shapes[0].collisionGroup=p}if(this.walls.right){this.walls.right.shapes[0].collisionGroup=p}if(this.walls.top){this.walls.top.shapes[0].collisionGroup=p}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionGroup=p}this._boundsOwnGroup=q},setBounds:function(v,t,q,z,r,w,u,p,s){if(r===undefined){r=this._boundsLeft}if(w===undefined){w=this._boundsRight}if(u===undefined){u=this._boundsTop}if(p===undefined){p=this._boundsBottom}if(s===undefined){s=this._boundsOwnGroup}this.setupWall(r,"left",v,t,1.5707963267948966,s);this.setupWall(w,"right",v+q,t,-1.5707963267948966,s);this.setupWall(u,"top",v,t,-3.141592653589793,s);this.setupWall(p,"bottom",v,t+z,0,s);this._boundsLeft=r;this._boundsRight=w;this._boundsTop=u;this._boundsBottom=p;this._boundsOwnGroup=s},setupWall:function(r,q,p,u,t,s){if(r){if(this.walls[q]){this.walls[q].position=[this.pxmi(p),this.pxmi(u)]}else{this.walls[q]=new p2.Body({mass:0,position:[this.pxmi(p),this.pxmi(u)],angle:t});this.walls[q].addShape(new p2.Plane());this.world.addBody(this.walls[q])}if(s){this.walls[q].shapes[0].collisionGroup=this.boundsCollisionGroup.mask}}else{if(this.walls[q]){this.world.removeBody(this.walls[q]);this.walls[q]=null}}},pause:function(){this.paused=true},resume:function(){this.paused=false},update:function(){if(this.paused){return}if(this.useElapsedTime){this.world.step(this.game.time.physicsElapsed)}else{this.world.step(this.frameRate)}},reset:function(){this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.nothingCollisionGroup=new g.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new g.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new g.Physics.P2.CollisionGroup(2147483648);this._collisionGroupID=2;this.setBoundsToWorld(true,true,true,true,false)},clear:function(){this.world.time=0;this.world.fixedStepTime=0;if(this.world.solver&&this.world.solver.equations.length){this.world.solver.removeAllEquations()}var t=this.world.constraints;for(var s=t.length-1;s>=0;s--){this.world.removeConstraint(t[s])}var p=this.world.bodies;for(var s=p.length-1;s>=0;s--){this.world.removeBody(p[s])}var r=this.world.springs;for(var s=r.length-1;s>=0;s--){this.world.removeSpring(r[s])}var q=this.world.contactMaterials;for(var s=q.length-1;s>=0;s--){this.world.removeContactMaterial(q[s])}this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this.boundsCollidesWith=[];this.walls={left:null,right:null,top:null,bottom:null}},destroy:function(){this.clear();this.game=null},addBody:function(p){if(p.data.world){return false}else{this.world.addBody(p.data);this.onBodyAdded.dispatch(p);return true}},removeBody:function(p){if(p.data.world===this.world){this.world.removeBody(p.data);this.onBodyRemoved.dispatch(p)}return p},addSpring:function(p){if(p instanceof g.Physics.P2.Spring||p instanceof g.Physics.P2.RotationalSpring){this.world.addSpring(p.data)}else{this.world.addSpring(p)}this.onSpringAdded.dispatch(p);return p},removeSpring:function(p){if(p instanceof g.Physics.P2.Spring||p instanceof g.Physics.P2.RotationalSpring){this.world.removeSpring(p.data)}else{this.world.removeSpring(p)}this.onSpringRemoved.dispatch(p);return p},createDistanceConstraint:function(t,s,u,q,p,r){t=this.getBody(t);s=this.getBody(s);if(!t||!s){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.DistanceConstraint(this,t,s,u,q,p,r))}},createGearConstraint:function(s,q,r,p){s=this.getBody(s);q=this.getBody(q);if(!s||!q){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.GearConstraint(this,s,q,r,p))}},createRevoluteConstraint:function(u,t,s,r,q,p){u=this.getBody(u);s=this.getBody(s);if(!u||!s){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.RevoluteConstraint(this,u,t,s,r,q,p))}},createLockConstraint:function(t,q,s,r,p){t=this.getBody(t);q=this.getBody(q);if(!t||!q){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.LockConstraint(this,t,q,s,r,p))}},createPrismaticConstraint:function(v,u,r,q,p,s,t){v=this.getBody(v);u=this.getBody(u);if(!v||!u){console.warn("Cannot create Constraint, invalid body objects given")}else{return this.addConstraint(new g.Physics.P2.PrismaticConstraint(this,v,u,r,q,p,s,t))}},addConstraint:function(p){this.world.addConstraint(p);this.onConstraintAdded.dispatch(p);return p},removeConstraint:function(p){this.world.removeConstraint(p);this.onConstraintRemoved.dispatch(p);return p},addContactMaterial:function(p){this.world.addContactMaterial(p);this.onContactMaterialAdded.dispatch(p);return p},removeContactMaterial:function(p){this.world.removeContactMaterial(p);this.onContactMaterialRemoved.dispatch(p);return p},getContactMaterial:function(q,p){return this.world.getContactMaterial(q,p)},setMaterial:function(r,p){var q=p.length;while(q--){p[q].setMaterial(r)}},createMaterial:function(q,p){q=q||"";var r=new g.Physics.P2.Material(q);this.materials.push(r);if(typeof p!=="undefined"){p.setMaterial(r)}return r},createContactMaterial:function(s,r,q){if(s===undefined){s=this.createMaterial()}if(r===undefined){r=this.createMaterial()}var p=new g.Physics.P2.ContactMaterial(s,r,q);return this.addContactMaterial(p)},getBodies:function(){var p=[];var q=this.world.bodies.length;while(q--){p.push(this.world.bodies[q].parent)}return p},getBody:function(p){if(p instanceof p2.Body){return p}else{if(p instanceof g.Physics.P2.Body){return p.data}else{if(p.body&&p.body.type===g.Physics.P2JS){return p.body.data}}}return null},getSprings:function(){var p=[];var q=this.world.springs.length;while(q--){p.push(this.world.springs[q].parent)}return p},getConstraints:function(){var p=[];var q=this.world.constraints.length;while(q--){p.push(this.world.constraints[q])}return p},hitTest:function(t,r,q,v){if(r===undefined){r=this.world.bodies}if(q===undefined){q=5}if(v===undefined){v=false}var p=[this.pxmi(t.x),this.pxmi(t.y)];var u=[];var s=r.length;while(s--){if(r[s] instanceof g.Physics.P2.Body&&!(v&&r[s].data.type===p2.Body.STATIC)){u.push(r[s].data)}else{if(r[s] instanceof p2.Body&&r[s].parent&&!(v&&r[s].type===p2.Body.STATIC)){u.push(r[s])}else{if(r[s] instanceof g.Sprite&&r[s].hasOwnProperty("body")&&!(v&&r[s].body.data.type===p2.Body.STATIC)){u.push(r[s].body.data)}}}}return this.world.hitTest(p,u,q)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(q){var p=Math.pow(2,this._collisionGroupID);if(this.walls.left){this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|p}if(this.walls.right){this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|p}if(this.walls.top){this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|p}if(this.walls.bottom){this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|p}this._collisionGroupID++;var r=new g.Physics.P2.CollisionGroup(p);this.collisionGroups.push(r);if(q){this.setCollisionGroup(q,r)}return r},setCollisionGroup:function(p,r){if(p instanceof g.Group){for(var q=0;q<p.total;q++){if(p.children[q]["body"]&&p.children[q]["body"].type===g.Physics.P2JS){p.children[q].body.setCollisionGroup(r)}}}else{p.body.setCollisionGroup(r)}},createSpring:function(s,r,p,v,t,x,w,u,q){s=this.getBody(s);r=this.getBody(r);if(!s||!r){console.warn("Cannot create Spring, invalid body objects given")}else{return this.addSpring(new g.Physics.P2.Spring(this,s,r,p,v,t,x,w,u,q))}},createRotationalSpring:function(t,s,q,p,r){t=this.getBody(t);s=this.getBody(s);if(!t||!s){console.warn("Cannot create Rotational Spring, invalid body objects given")}else{return this.addSpring(new g.Physics.P2.RotationalSpring(this,t,s,q,p,r))}},createBody:function(r,w,t,u,s,v){if(u===undefined){u=false}var q=new g.Physics.P2.Body(this.game,null,r,w,t);if(v){var p=q.addPolygon(s,v);if(!p){return false}}if(u){this.world.addBody(q.data)}return q},createParticle:function(r,w,t,u,s,v){if(u===undefined){u=false}var q=new g.Physics.P2.Body(this.game,null,r,w,t);if(v){var p=q.addPolygon(s,v);if(!p){return false}}if(u){this.world.addBody(q.data)}return q},convertCollisionObjects:function(w,u,v){if(v===undefined){v=true}var r=[];for(var t=0,q=w.collision[u].length;t<q;t++){var s=w.collision[u][t];var p=this.createBody(s.x,s.y,0,v,{},s.polyline);if(p){r.push(p)}}return r},clearTilemapLayerBodies:function(r,q){q=r.getLayer(q);var p=r.layers[q].bodies.length;while(p--){r.layers[q].bodies[p].destroy()}r.layers[q].bodies.length=0},convertTilemap:function(p,u,r,A){u=p.getLayer(u);if(r===undefined){r=true}if(A===undefined){A=true}this.clearTilemapLayerBodies(p,u);var q=0;var D=0;var B=0;for(var z=0,s=p.layers[u].height;z<s;z++){q=0;for(var C=0,E=p.layers[u].width;C<E;C++){var v=p.layers[u].data[z][C];if(v&&v.index>-1&&v.collides){if(A){var F=p.getTileRight(u,C,z);if(q===0){D=v.x*v.width;B=v.y*v.height;q=v.width}if(F&&F.collides){q+=v.width}else{var t=this.createBody(D,B,0,false);t.addRectangle(q,v.height,q/2,v.height/2,0);if(r){this.addBody(t)}p.layers[u].bodies.push(t);q=0}}else{var t=this.createBody(v.x*v.width,v.y*v.height,0,false);t.addRectangle(v.width,v.height,v.width/2,v.height/2,0);if(r){this.addBody(t)}p.layers[u].bodies.push(t)}}}}return p.layers[u].bodies},mpx:function(p){return p*=20},pxm:function(p){return p*0.05},mpxi:function(p){return p*=-20},pxmi:function(p){return p*-0.05}};Object.defineProperty(g.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(p){this.world.defaultContactMaterial.friction=p}});Object.defineProperty(g.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(p){this.world.defaultContactMaterial.restitution=p}});Object.defineProperty(g.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(p){this.world.defaultContactMaterial=p}});Object.defineProperty(g.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(p){this.world.applySpringForces=p}});Object.defineProperty(g.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(p){this.world.applyDamping=p}});Object.defineProperty(g.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(p){this.world.applyGravity=p}});Object.defineProperty(g.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(p){this.world.solveConstraints=p}});Object.defineProperty(g.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(g.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(p){this.world.emitImpactEvent=p}});Object.defineProperty(g.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(p){this.world.sleepMode=p}});Object.defineProperty(g.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});g.Physics.P2.FixtureList=function(p){if(!Array.isArray(p)){p=[p]}this.rawList=p;this.init();this.parse(this.rawList)};g.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(q,p){var r=function(s){s.collisionGroup=q};this.getFixtures(p).forEach(r)},setMask:function(q,p){var r=function(s){s.collisionMask=q};this.getFixtures(p).forEach(r)},setSensor:function(q,p){var r=function(s){s.sensor=q};this.getFixtures(p).forEach(r)},setMaterial:function(q,p){var r=function(s){s.material=q};this.getFixtures(p).forEach(r)},getFixtures:function(r){var q=[];if(r){if(!(r instanceof Array)){r=[r]}var p=this;r.forEach(function(s){if(p.namedFixtures[s]){q.push(p.namedFixtures[s])}});return this.flatten(q)}else{return this.allFixtures}},getFixtureByKey:function(p){return this.namedFixtures[p]},getGroup:function(p){return this.groupedFixtures[p]},parse:function(){var q,s,r,p;r=this.rawList;p=[];for(q in r){s=r[q];if(!isNaN(q-0)){this.groupedFixtures[q]=this.groupedFixtures[q]||[];this.groupedFixtures[q]=this.groupedFixtures[q].concat(s)}else{this.namedFixtures[q]=this.flatten(s)}p.push(this.allFixtures=this.flatten(this.groupedFixtures))}},flatten:function(r){var p,q;p=[];q=arguments.callee;r.forEach(function(s){return Array.prototype.push.apply(p,(Array.isArray(s)?q(s):[s]))});return p}};g.Physics.P2.PointProxy=function(q,p){this.world=q;this.destination=p};g.Physics.P2.PointProxy.prototype.constructor=g.Physics.P2.PointProxy;Object.defineProperty(g.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(p){this.destination[0]=this.world.pxm(p)}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(p){this.destination[1]=this.world.pxm(p)}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(p){this.destination[0]=p}});Object.defineProperty(g.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(p){this.destination[1]=p}});g.Physics.P2.InversePointProxy=function(q,p){this.world=q;this.destination=p};g.Physics.P2.InversePointProxy.prototype.constructor=g.Physics.P2.InversePointProxy;Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(p){this.destination[0]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(p){this.destination[1]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(p){this.destination[0]=-p}});Object.defineProperty(g.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(p){this.destination[1]=-p}});g.Physics.P2.Body=function(q,s,p,t,r){s=s||null;p=p||0;t=t||0;if(r===undefined){r=1}this.game=q;this.world=q.physics.p2;this.sprite=s;this.type=g.Physics.P2JS;this.offset=new g.Point();this.data=new p2.Body({position:[this.world.pxmi(p),this.world.pxmi(t)],mass:r});this.data.parent=this;this.velocity=new g.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new g.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new g.Point();this.onBeginContact=new g.Signal();this.onEndContact=new g.Signal();this.collidesWith=[];this.removeNextStep=false;this.debugBody=null;this.dirty=false;this._collideWorldBounds=true;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this._reset=false;if(s){this.setRectangleFromSprite(s);if(s.exists){this.game.physics.p2.addBody(this)}}};g.Physics.P2.Body.prototype={createBodyCallback:function(q,s,p){var r=-1;if(q.id){r=q.id}else{if(q.body){r=q.body.id}}if(r>-1){if(s===null){delete (this._bodyCallbacks[r]);delete (this._bodyCallbackContext[r])}else{this._bodyCallbacks[r]=s;this._bodyCallbackContext[r]=p}}},createGroupCallback:function(q,r,p){if(r===null){delete (this._groupCallbacks[q.mask]);delete (this._groupCallbackContext[q.mask])}else{this._groupCallbacks[q.mask]=r;this._groupCallbackContext[q.mask]=p}},getCollisionMask:function(){var p=0;if(this._collideWorldBounds){p=this.game.physics.p2.boundsCollisionGroup.mask}for(var q=0;q<this.collidesWith.length;q++){p=p|this.collidesWith[q].mask}return p},updateCollisionMask:function(q){var p=this.getCollisionMask();if(q===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionMask=p}}else{q.collisionMask=p}},setCollisionGroup:function(s,q){var p=this.getCollisionMask();if(q===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){this.data.shapes[r].collisionGroup=s.mask;this.data.shapes[r].collisionMask=p}}else{q.collisionGroup=s.mask;q.collisionMask=p}},clearCollision:function(q,s,p){if(q===undefined){q=true}if(s===undefined){s=true}if(p===undefined){for(var r=this.data.shapes.length-1;r>=0;r--){if(q){this.data.shapes[r].collisionGroup=null}if(s){this.data.shapes[r].collisionMask=null}}}else{if(q){p.collisionGroup=null}if(s){p.collisionMask=null}}if(q){this.collidesWith.length=0}},removeCollisionGroup:function(u,t,q){if(t===undefined){t=true}var r;if(Array.isArray(u)){for(var s=0;s<u.length;s++){r=this.collidesWith.indexOf(u[s]);if(r>-1){this.collidesWith.splice(r,1);if(t){delete (this._groupCallbacks[u.mask]);delete (this._groupCallbackContext[u.mask])}}}}else{r=this.collidesWith.indexOf(u);if(r>-1){this.collidesWith.splice(r,1);if(t){delete (this._groupCallbacks[u.mask]);delete (this._groupCallbackContext[u.mask])}}}var p=this.getCollisionMask();if(q===undefined){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionMask=p}}else{q.collisionMask=p}},collides:function(t,u,r,q){if(Array.isArray(t)){for(var s=0;s<t.length;s++){if(this.collidesWith.indexOf(t[s])===-1){this.collidesWith.push(t[s]);if(u){this.createGroupCallback(t[s],u,r)}}}}else{if(this.collidesWith.indexOf(t)===-1){this.collidesWith.push(t);if(u){this.createGroupCallback(t,u,r)}}}var p=this.getCollisionMask();if(q===undefined){for(var s=this.data.shapes.length-1;s>=0;s--){this.data.shapes[s].collisionMask=p}}else{q.collisionMask=p}},adjustCenterOfMass:function(){this.data.adjustCenterOfMass();this.shapeChanged()},getVelocityAtPoint:function(p,q){return this.data.getVelocityAtPoint(p,q)},applyDamping:function(p){this.data.applyDamping(p)},applyImpulse:function(r,q,p){this.data.applyImpulse(r,[this.world.pxmi(q),this.world.pxmi(p)])},applyImpulseLocal:function(r,q,p){this.data.applyImpulseLocal(r,[this.world.pxmi(q),this.world.pxmi(p)])},applyForce:function(r,q,p){this.data.applyForce(r,[this.world.pxmi(q),this.world.pxmi(p)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(p,q){return this.data.toLocalFrame(p,q)},toWorldFrame:function(p,q){return this.data.toWorldFrame(p,q)},rotateLeft:function(p){this.data.angularVelocity=this.world.pxm(-p)},rotateRight:function(p){this.data.angularVelocity=this.world.pxm(p)},moveForward:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.velocity[0]=p*Math.cos(r);this.data.velocity[1]=p*Math.sin(r)},moveBackward:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.velocity[0]=-(p*Math.cos(r));this.data.velocity[1]=-(p*Math.sin(r))},thrust:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.force[0]+=p*Math.cos(r);this.data.force[1]+=p*Math.sin(r)},thrustLeft:function(q){var p=this.world.pxmi(-q);var r=this.data.angle;this.data.force[0]+=p*Math.cos(r);this.data.force[1]+=p*Math.sin(r)},thrustRight:function(q){var p=this.world.pxmi(-q);var r=this.data.angle;this.data.force[0]-=p*Math.cos(r);this.data.force[1]-=p*Math.sin(r)},reverse:function(q){var p=this.world.pxmi(-q);var r=this.data.angle+Math.PI/2;this.data.force[0]-=p*Math.cos(r);this.data.force[1]-=p*Math.sin(r)},moveLeft:function(p){this.data.velocity[0]=this.world.pxmi(-p)},moveRight:function(p){this.data.velocity[0]=this.world.pxmi(p)},moveUp:function(p){this.data.velocity[1]=this.world.pxmi(-p)},moveDown:function(p){this.data.velocity[1]=this.world.pxmi(p)},preUpdate:function(){this.dirty=true;if(this.removeNextStep){this.removeFromWorld();this.removeNextStep=false}},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0])+this.offset.x;this.sprite.y=this.world.mpxi(this.data.position[1])+this.offset.y;if(!this.fixedRotation){this.sprite.rotation=this.data.angle}if(this.debugBody){this.debugBody.updateSpriteTransform()}this.dirty=false},reset:function(p,s,r,q){if(r===undefined){r=false}if(q===undefined){q=false}this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();if(r){this.setZeroDamping()}if(q){this.mass=1}this.x=p;this.y=s},addToWorld:function(){if(this.game.physics.p2._toRemove){for(var p=0;p<this.game.physics.p2._toRemove.length;p++){if(this.game.physics.p2._toRemove[p]===this){this.game.physics.p2._toRemove.splice(p,1)}}}if(this.data.world!==this.game.physics.p2.world){this.game.physics.p2.addBody(this)}},removeFromWorld:function(){if(this.data.world===this.game.physics.p2.world){this.game.physics.p2.removeBodyNextStep(this)}},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};if(this.debugBody){this.debugBody.destroy(true,true)}this.debugBody=null;if(this.sprite){this.sprite.body=null;this.sprite=null}},clearShapes:function(){var p=this.data.shapes.length;while(p--){this.data.removeShape(this.data.shapes[p])}this.shapeChanged()},addShape:function(q,p,s,r){if(p===undefined){p=0}if(s===undefined){s=0}if(r===undefined){r=0}this.data.addShape(q,[this.world.pxmi(p),this.world.pxmi(s)],r);this.shapeChanged();return q},addCircle:function(q,p,t,s){var r=new p2.Circle({radius:this.world.pxm(q)});return this.addShape(r,p,t,s)},addRectangle:function(t,q,p,u,s){var r=new p2.Box({width:this.world.pxm(t),height:this.world.pxm(q)});return this.addShape(r,p,u,s)},addPlane:function(p,s,r){var q=new p2.Plane();return this.addShape(q,p,s,r)},addParticle:function(p,s,r){var q=new p2.Particle();return this.addShape(q,p,s,r)},addLine:function(s,p,t,r){var q=new p2.Line({length:this.world.pxm(s)});return this.addShape(q,p,t,r)},addCapsule:function(t,q,p,u,s){var r=new p2.Capsule({length:this.world.pxm(t),radius:this.world.pxm(q)});return this.addShape(r,p,u,s)},addPolygon:function(t,v){t=t||{};if(!Array.isArray(v)){v=Array.prototype.slice.call(arguments,1)}var x=[];if(v.length===1&&Array.isArray(v[0])){x=v[0].slice(0)}else{if(Array.isArray(v[0])){x=v.slice()}else{if(typeof v[0]==="number"){for(var u=0,s=v.length;u<s;u+=2){x.push([v[u],v[u+1]])}}}}var r=x.length-1;if(x[r][0]===x[0][0]&&x[r][1]===x[0][1]){x.pop()}for(var w=0;w<x.length;w++){x[w][0]=this.world.pxmi(x[w][0]);x[w][1]=this.world.pxmi(x[w][1])}var q=this.data.fromPolygon(x,t);this.shapeChanged();return q},removeShape:function(q){var p=this.data.removeShape(q);this.shapeChanged();return p},setCircle:function(q,p,s,r){this.clearShapes();return this.addCircle(q,p,s,r)},setRectangle:function(s,q,p,t,r){if(s===undefined){s=16}if(q===undefined){q=16}this.clearShapes();return this.addRectangle(s,q,p,t,r)},setRectangleFromSprite:function(p){if(p===undefined){p=this.sprite}this.clearShapes();return this.addRectangle(p.width,p.height,0,0,p.rotation)},setMaterial:function(r,p){if(p===undefined){for(var q=this.data.shapes.length-1;q>=0;q--){this.data.shapes[q].material=r}}else{p.material=r}},shapeChanged:function(){if(this.debugBody){this.debugBody.draw()}},addPhaserPolygon:function(s,q){var u=this.game.cache.getPhysicsData(s,q);var v=[];for(var r=0;r<u.length;r++){var t=u[r];var p=this.addFixture(t);v[t.filter.group]=v[t.filter.group]||[];v[t.filter.group]=v[t.filter.group].concat(p);if(t.fixtureKey){v[t.fixtureKey]=p}}this.data.aabbNeedsUpdate=true;this.shapeChanged();return v},addFixture:function(p){var u=[];if(p.circle){var y=new p2.Circle({radius:this.world.pxm(p.circle.radius)});y.collisionGroup=p.filter.categoryBits;y.collisionMask=p.filter.maskBits;y.sensor=p.isSensor;var t=p2.vec2.create();t[0]=this.world.pxmi(p.circle.position[0]-this.sprite.width/2);t[1]=this.world.pxmi(p.circle.position[1]-this.sprite.height/2);this.data.addShape(y,t);u.push(y)}else{var z=p.polygons;var A=p2.vec2.create();for(var w=0;w<z.length;w++){var q=z[w];var x=[];for(var C=0;C<q.length;C+=2){x.push([this.world.pxmi(q[C]),this.world.pxmi(q[C+1])])}var y=new p2.Convex({vertices:x});for(var r=0;r!==y.vertices.length;r++){var B=y.vertices[r];p2.vec2.sub(B,B,y.centerOfMass)}p2.vec2.scale(A,y.centerOfMass,1);A[0]-=this.world.pxmi(this.sprite.width/2);A[1]-=this.world.pxmi(this.sprite.height/2);y.updateTriangles();y.updateCenterOfMass();y.updateBoundingRadius();y.collisionGroup=p.filter.categoryBits;y.collisionMask=p.filter.maskBits;y.sensor=p.isSensor;this.data.addShape(y,A);u.push(y)}}return u},loadPolygon:function(z,p){if(z===null){var r=p}else{var r=this.game.cache.getPhysicsData(z,p)}var x=p2.vec2.create();for(var t=0;t<r.length;t++){var u=[];for(var A=0;A<r[t].shape.length;A+=2){u.push([this.world.pxmi(r[t].shape[A]),this.world.pxmi(r[t].shape[A+1])])}var w=new p2.Convex({vertices:u});for(var q=0;q!==w.vertices.length;q++){var y=w.vertices[q];p2.vec2.sub(y,y,w.centerOfMass)}p2.vec2.scale(x,w.centerOfMass,1);x[0]-=this.world.pxmi(this.sprite.width/2);x[1]-=this.world.pxmi(this.sprite.height/2);w.updateTriangles();w.updateCenterOfMass();w.updateBoundingRadius();this.data.addShape(w,x)}this.data.aabbNeedsUpdate=true;this.shapeChanged();return true}};g.Physics.P2.Body.prototype.constructor=g.Physics.P2.Body;g.Physics.P2.Body.DYNAMIC=1;g.Physics.P2.Body.STATIC=2;g.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(g.Physics.P2.Body.prototype,"static",{get:function(){return(this.data.type===g.Physics.P2.Body.STATIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.STATIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}else{if(!p&&this.data.type===g.Physics.P2.Body.STATIC){this.data.type=g.Physics.P2.Body.DYNAMIC;this.mass=1}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"dynamic",{get:function(){return(this.data.type===g.Physics.P2.Body.DYNAMIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.DYNAMIC){this.data.type=g.Physics.P2.Body.DYNAMIC;this.mass=1}else{if(!p&&this.data.type===g.Physics.P2.Body.DYNAMIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"kinematic",{get:function(){return(this.data.type===g.Physics.P2.Body.KINEMATIC)},set:function(p){if(p&&this.data.type!==g.Physics.P2.Body.KINEMATIC){this.data.type=g.Physics.P2.Body.KINEMATIC;this.mass=4}else{if(!p&&this.data.type===g.Physics.P2.Body.KINEMATIC){this.data.type=g.Physics.P2.Body.STATIC;this.mass=0}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(p){if(p!==this.data.allowSleep){this.data.allowSleep=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"angle",{get:function(){return g.Math.wrapAngle(g.Math.radToDeg(this.data.angle))},set:function(p){this.data.angle=g.Math.degToRad(g.Math.wrapAngle(p))}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(p){this.data.angularDamping=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(p){this.data.angularForce=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(p){this.data.angularVelocity=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(p){this.data.damping=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(p){if(p!==this.data.fixedRotation){this.data.fixedRotation=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(p){this.data.inertia=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(p){if(p!==this.data.mass){this.data.mass=p;this.data.updateMassProperties()}}});Object.defineProperty(g.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(p){if(p!==this.data.type){this.data.type=p}}});Object.defineProperty(g.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(p){this.data.angle=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(p){this.data.sleepSpeedLimit=p}});Object.defineProperty(g.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(p){this.data.position[0]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(p){this.data.position[1]=this.world.pxmi(p)}});Object.defineProperty(g.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(g.Physics.P2.Body.prototype,"debug",{get:function(){return(this.debugBody!==null)},set:function(p){if(p&&!this.debugBody){this.debugBody=new g.Physics.P2.BodyDebug(this.game,this.data)}else{if(!p&&this.debugBody){this.debugBody.destroy();this.debugBody=null}}}});Object.defineProperty(g.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(p){if(p&&!this._collideWorldBounds){this._collideWorldBounds=true;this.updateCollisionMask()}else{if(!p&&this._collideWorldBounds){this._collideWorldBounds=false;this.updateCollisionMask()}}}});g.Physics.P2.BodyDebug=function(q,p,s){g.Group.call(this,q);var r={pixelsPerLengthUnit:q.physics.p2.mpx(1),debugPolygons:false,lineWidth:1,alpha:0.5};this.settings=g.Utils.extend(r,s);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=p;this.canvas=new g.Graphics(q);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw();this.updateSpriteTransform()};g.Physics.P2.BodyDebug.prototype=Object.create(g.Group.prototype);g.Physics.P2.BodyDebug.prototype.constructor=g.Physics.P2.BodyDebug;g.Utils.extend(g.Physics.P2.BodyDebug.prototype,{updateSpriteTransform:function(){this.position.x=this.body.position[0]*this.ppu;this.position.y=this.body.position[1]*this.ppu;this.rotation=this.body.angle},draw:function(){var s,p,x,B,z,C,q,A,y,F,E,D,w,u,t;A=this.body;F=this.canvas;F.clear();x=parseInt(this.randomPastelHex(),16);C=16711680;q=this.lineWidth;if(A instanceof p2.Body&&A.shapes.length){var r=A.shapes.length;B=0;while(B!==r){p=A.shapes[B];y=p.position||0;s=p.angle||0;if(p instanceof p2.Circle){this.drawCircle(F,y[0]*this.ppu,y[1]*this.ppu,s,p.radius*this.ppu,x,q)}else{if(p instanceof p2.Capsule){this.drawCapsule(F,y[0]*this.ppu,y[1]*this.ppu,s,p.length*this.ppu,p.radius*this.ppu,C,x,q)}else{if(p instanceof p2.Plane){this.drawPlane(F,y[0]*this.ppu,-y[1]*this.ppu,x,C,q*5,q*10,q*10,this.ppu*100,s)}else{if(p instanceof p2.Line){this.drawLine(F,p.length*this.ppu,C,q)}else{if(p instanceof p2.Box){this.drawRectangle(F,y[0]*this.ppu,y[1]*this.ppu,s,p.width*this.ppu,p.height*this.ppu,C,x,q)}else{if(p instanceof p2.Convex){D=[];w=p2.vec2.create();for(z=u=0,t=p.vertices.length;0<=t?u<t:u>t;z=0<=t?++u:--u){E=p.vertices[z];p2.vec2.rotate(w,E,s);D.push([(w[0]+y[0])*this.ppu,-(w[1]+y[1])*this.ppu])}this.drawConvex(F,D,p.triangles,C,x,q,this.settings.debugPolygons,[y[0]*this.ppu,-y[1]*this.ppu])}}}}}}B++}}},drawRectangle:function(u,z,v,q,A,s,r,p,t){if(t===undefined){t=1}if(r===undefined){r=0}u.lineStyle(t,r,1);u.beginFill(p);u.drawRect(z-A/2,v-s/2,A,s)},drawCircle:function(t,r,v,u,q,s,p){if(p===undefined){p=1}if(s===undefined){s=16777215}t.lineStyle(p,0,1);t.beginFill(s,1);t.drawCircle(r,v,-q*2);t.endFill();t.moveTo(r,v);t.lineTo(r+q*Math.cos(-u),v+q*Math.sin(-u))},drawLine:function(s,q,r,p){if(p===undefined){p=1}if(r===undefined){r=0}s.lineStyle(p*5,r,1);s.moveTo(-q/2,0);s.lineTo(q/2,0)},drawConvex:function(H,K,E,F,u,p,D,w){var A,G,C,s,q,B,J,I,z,t,r;if(p===undefined){p=1}if(F===undefined){F=0}if(!D){H.lineStyle(p,F,1);H.beginFill(u);G=0;while(G!==K.length){C=K[G];B=C[0];z=C[1];if(G===0){H.moveTo(B,-z)}else{H.lineTo(B,-z)}G++}H.endFill();if(K.length>2){H.moveTo(K[K.length-1][0],-K[K.length-1][1]);return H.lineTo(K[0][0],-K[0][1])}}else{A=[16711680,65280,255];G=0;while(G!==K.length+1){s=K[G%K.length];q=K[(G+1)%K.length];J=s[0];t=s[1];I=q[0];r=q[1];H.lineStyle(p,A[G%A.length],1);H.moveTo(J,-t);H.lineTo(I,-r);H.drawCircle(J,-t,p*2);G++}H.lineStyle(p,0,1);return H.drawCircle(w[0],w[1],p*2)}},drawPath:function(I,B,E,s,p){var J,G,D,C,r,q,w,t,H,F,A,z,u;if(p===undefined){p=1}if(E===undefined){E=0}I.lineStyle(p,E,1);if(typeof s==="number"){I.beginFill(s)}D=null;C=null;G=0;while(G<B.length){A=B[G];z=A[0];u=A[1];if(z!==D||u!==C){if(G===0){I.moveTo(z,u)}else{r=D;q=C;w=z;t=u;H=B[(G+1)%B.length][0];F=B[(G+1)%B.length][1];J=((w-r)*(F-q))-((H-r)*(t-q));if(J!==0){I.lineTo(z,u)}}D=z;C=u}G++}if(typeof s==="number"){I.endFill()}if(B.length>2&&typeof s==="number"){I.moveTo(B[B.length-1][0],B[B.length-1][1]);I.lineTo(B[0][0],B[0][1])}},drawPlane:function(w,s,r,u,A,x,v,p,q,t){var z,B,y;if(x===undefined){x=1}if(u===undefined){u=16777215}w.lineStyle(x,A,11);w.beginFill(u);z=q;w.moveTo(s,-r);B=s+Math.cos(t)*this.game.width;y=r+Math.sin(t)*this.game.height;w.lineTo(B,-y);w.moveTo(s,-r);B=s+Math.cos(t)*-this.game.width;y=r+Math.sin(t)*-this.game.height;w.lineTo(B,-y)},drawCapsule:function(u,B,A,q,v,w,r,p,t){if(t===undefined){t=1}if(r===undefined){r=0}u.lineStyle(t,r,1);var z=Math.cos(q);var C=Math.sin(q);u.beginFill(p,1);u.drawCircle(-v/2*z+B,-v/2*C+A,-w*2);u.drawCircle(v/2*z+B,v/2*C+A,-w*2);u.endFill();u.lineStyle(t,r,0);u.beginFill(p,1);u.moveTo(-v/2*z+w*C+B,-v/2*C+w*z+A);u.lineTo(v/2*z+w*C+B,v/2*C+w*z+A);u.lineTo(v/2*z-w*C+B,v/2*C-w*z+A);u.lineTo(-v/2*z-w*C+B,-v/2*C-w*z+A);u.endFill();u.lineStyle(t,r,1);u.moveTo(-v/2*z+w*C+B,-v/2*C+w*z+A);u.lineTo(v/2*z+w*C+B,v/2*C+w*z+A);u.moveTo(-v/2*z-w*C+B,-v/2*C-w*z+A);u.lineTo(v/2*z-w*C+B,v/2*C-w*z+A)},randomPastelHex:function(){var p,r,q,s;q=[255,255,255];s=Math.floor(Math.random()*256);r=Math.floor(Math.random()*256);p=Math.floor(Math.random()*256);s=Math.floor((s+3*q[0])/4);r=Math.floor((r+3*q[1])/4);p=Math.floor((p+3*q[2])/4);return this.rgbToHex(s,r,p)},rgbToHex:function(s,q,p){return this.componentToHex(s)+this.componentToHex(q)+this.componentToHex(p)},componentToHex:function(q){var p;p=q.toString(16);if(p.length===2){return p}else{return p+"0"}}});g.Physics.P2.Spring=function(v,t,r,p,w,u,y,x,s,q){this.game=v.game;this.world=v;if(p===undefined){p=1}if(w===undefined){w=100}if(u===undefined){u=1}p=v.pxm(p);var z={restLength:p,stiffness:w,damping:u};if(typeof y!=="undefined"&&y!==null){z.worldAnchorA=[v.pxm(y[0]),v.pxm(y[1])]}if(typeof x!=="undefined"&&x!==null){z.worldAnchorB=[v.pxm(x[0]),v.pxm(x[1])]}if(typeof s!=="undefined"&&s!==null){z.localAnchorA=[v.pxm(s[0]),v.pxm(s[1])]}if(typeof q!=="undefined"&&q!==null){z.localAnchorB=[v.pxm(q[0]),v.pxm(q[1])]}this.data=new p2.LinearSpring(t,r,z);this.data.parent=this};g.Physics.P2.Spring.prototype.constructor=g.Physics.P2.Spring;g.Physics.P2.RotationalSpring=function(t,v,u,q,p,s){this.game=t.game;this.world=t;if(q===undefined){q=null}if(p===undefined){p=100}if(s===undefined){s=1}if(q){q=t.pxm(q)}var r={restAngle:q,stiffness:p,damping:s};this.data=new p2.RotationalSpring(v,u,r);this.data.parent=this};g.Physics.P2.Spring.prototype.constructor=g.Physics.P2.Spring;g.Physics.P2.Material=function(p){this.name=p;p2.Material.call(this)};g.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);g.Physics.P2.Material.prototype.constructor=g.Physics.P2.Material;g.Physics.P2.ContactMaterial=function(r,q,p){p2.ContactMaterial.call(this,r,q,p)};g.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);g.Physics.P2.ContactMaterial.prototype.constructor=g.Physics.P2.ContactMaterial;g.Physics.P2.CollisionGroup=function(p){this.mask=p};g.Physics.P2.DistanceConstraint=function(s,v,u,w,r,q,t){if(w===undefined){w=100}if(r===undefined){r=[0,0]}if(q===undefined){q=[0,0]}if(t===undefined){t=Number.MAX_VALUE}this.game=s.game;this.world=s;w=s.pxm(w);r=[s.pxmi(r[0]),s.pxmi(r[1])];q=[s.pxmi(q[0]),s.pxmi(q[1])];var p={distance:w,localAnchorA:r,localAnchorB:q,maxForce:t};p2.DistanceConstraint.call(this,v,u,p)};g.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);g.Physics.P2.DistanceConstraint.prototype.constructor=g.Physics.P2.DistanceConstraint;g.Physics.P2.GearConstraint=function(r,u,s,t,q){if(t===undefined){t=0}if(q===undefined){q=1}this.game=r.game;this.world=r;var p={angle:t,ratio:q};p2.GearConstraint.call(this,u,s,p)};g.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);g.Physics.P2.GearConstraint.prototype.constructor=g.Physics.P2.GearConstraint;g.Physics.P2.LockConstraint=function(q,v,s,u,t,r){if(u===undefined){u=[0,0]}if(t===undefined){t=0}if(r===undefined){r=Number.MAX_VALUE}this.game=q.game;this.world=q;u=[q.pxm(u[0]),q.pxm(u[1])];var p={localOffsetB:u,localAngleB:t,maxForce:r};p2.LockConstraint.call(this,v,s,p)};g.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);g.Physics.P2.LockConstraint.prototype.constructor=g.Physics.P2.LockConstraint;g.Physics.P2.PrismaticConstraint=function(v,t,s,u,r,p,q,w){if(u===undefined){u=true}if(r===undefined){r=[0,0]}if(p===undefined){p=[0,0]}if(q===undefined){q=[0,0]}if(w===undefined){w=Number.MAX_VALUE}this.game=v.game;this.world=v;r=[v.pxmi(r[0]),v.pxmi(r[1])];p=[v.pxmi(p[0]),v.pxmi(p[1])];var x={localAnchorA:r,localAnchorB:p,localAxisA:q,maxForce:w,disableRotationalLock:!u};p2.PrismaticConstraint.call(this,t,s,x)};g.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);g.Physics.P2.PrismaticConstraint.prototype.constructor=g.Physics.P2.PrismaticConstraint;g.Physics.P2.RevoluteConstraint=function(r,w,v,u,t,s,q){if(s===undefined){s=Number.MAX_VALUE}if(q===undefined){q=null}this.game=r.game;this.world=r;v=[r.pxmi(v[0]),r.pxmi(v[1])];t=[r.pxmi(t[0]),r.pxmi(t[1])];if(q){q=[r.pxmi(q[0]),r.pxmi(q[1])]}var p={worldPivot:q,localPivotA:v,localPivotB:t,maxForce:s};p2.RevoluteConstraint.call(this,w,u,p)};g.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);g.Physics.P2.RevoluteConstraint.prototype.constructor=g.Physics.P2.RevoluteConstraint;g.ImageCollection=function(q,u,s,p,t,v,r){if(s===undefined||s<=0){s=32}if(p===undefined||p<=0){p=32}if(t===undefined){t=0}if(v===undefined){v=0}this.name=q;this.firstgid=u|0;this.imageWidth=s|0;this.imageHeight=p|0;this.imageMargin=t|0;this.imageSpacing=v|0;this.properties=r||{};this.images=[];this.total=0};g.ImageCollection.prototype={containsImageIndex:function(p){return(p>=this.firstgid&&p<(this.firstgid+this.total))},addImage:function(p,q){this.images.push({gid:p,image:q});this.total++}};g.ImageCollection.prototype.constructor=g.ImageCollection;g.Tile=function(s,r,q,u,t,p){this.layer=s;this.index=r;this.x=q;this.y=u;this.rotation=0;this.flipped=false;this.worldX=q*t;this.worldY=u*p;this.width=t;this.height=p;this.centerX=Math.abs(t/2);this.centerY=Math.abs(p/2);this.alpha=1;this.properties={};this.scanned=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false;this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.collisionCallback=null;this.collisionCallbackContext=this};g.Tile.prototype={containsPoint:function(p,q){return !(p<this.worldX||q<this.worldY||p>this.right||q>this.bottom)},intersects:function(p,s,r,q){if(r<=this.worldX){return false}if(q<=this.worldY){return false}if(p>=this.worldX+this.width){return false}if(s>=this.worldY+this.height){return false}return true},setCollisionCallback:function(q,p){this.collisionCallback=q;this.collisionCallbackContext=p},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(r,q,p,s){this.collideLeft=r;this.collideRight=q;this.collideUp=p;this.collideDown=s;this.faceLeft=r;this.faceRight=q;this.faceTop=p;this.faceBottom=s},resetCollision:function(){this.collideLeft=false;this.collideRight=false;this.collideUp=false;this.collideDown=false;this.faceTop=false;this.faceBottom=false;this.faceLeft=false;this.faceRight=false},isInteresting:function(q,p){if(q&&p){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback)}else{if(q){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}else{if(p){return(this.faceTop||this.faceBottom||this.faceLeft||this.faceRight)}}}return false},copy:function(p){this.index=p.index;this.alpha=p.alpha;this.properties=p.properties;this.collideUp=p.collideUp;this.collideDown=p.collideDown;this.collideLeft=p.collideLeft;this.collideRight=p.collideRight;this.collisionCallback=p.collisionCallback;this.collisionCallbackContext=p.collisionCallbackContext}};g.Tile.prototype.constructor=g.Tile;Object.defineProperty(g.Tile.prototype,"collides",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown)}});Object.defineProperty(g.Tile.prototype,"canCollide",{get:function(){return(this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback)}});Object.defineProperty(g.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(g.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(g.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(g.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});g.Tilemap=function(r,s,v,q,t,p){this.game=r;this.key=s;var u=g.TilemapParser.parse(this.game,s,v,q,t,p);if(u===null){return}this.width=u.width;this.height=u.height;this.tileWidth=u.tileWidth;this.tileHeight=u.tileHeight;this.orientation=u.orientation;this.format=u.format;this.version=u.version;this.properties=u.properties;this.widthInPixels=u.widthInPixels;this.heightInPixels=u.heightInPixels;this.layers=u.layers;this.tilesets=u.tilesets;this.imagecollections=u.imagecollections;this.tiles=u.tiles;this.objects=u.objects;this.collideIndexes=[];this.collision=u.collision;this.images=u.images;this.enableDebug=false;this.currentLayer=0;this.debugMap=[];this._results=[];this._tempA=0;this._tempB=0};g.Tilemap.CSV=0;g.Tilemap.TILED_JSON=1;g.Tilemap.NORTH=0;g.Tilemap.EAST=1;g.Tilemap.SOUTH=2;g.Tilemap.WEST=3;g.Tilemap.prototype={create:function(r,s,p,u,q,t){if(t===undefined){t=this.game.world}this.width=s;this.height=p;this.setTileSize(u,q);this.layers.length=0;return this.createBlankLayer(r,s,p,u,q,t)},setTileSize:function(q,p){this.tileWidth=q;this.tileHeight=p;this.widthInPixels=this.width*q;this.heightInPixels=this.height*p},addTilesetImage:function(p,E,C,v,I,w,s){if(p===undefined){return null}if(C===undefined){C=this.tileWidth}if(v===undefined){v=this.tileHeight}if(I===undefined){I=0}if(w===undefined){w=0}if(s===undefined){s=0}if(C===0){C=32}if(v===0){v=32}var r=null;if(E===undefined||E===null){E=p}if(E instanceof g.BitmapData){r=E.canvas}else{if(!this.game.cache.checkImageKey(E)){console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+E+'"');return null}r=this.game.cache.getImage(E)}var D=this.getTilesetIndex(p);if(D===null&&this.format===g.Tilemap.TILED_JSON){console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+p+'"');return null}if(this.tilesets[D]){this.tilesets[D].setImage(r);return this.tilesets[D]}else{var B=new g.Tileset(p,s,C,v,I,w,{});B.setImage(r);this.tilesets.push(B);var q=this.tilesets.length-1;var A=I;var z=I;var u=0;var H=0;var F=0;for(var G=s;G<s+B.total;G++){this.tiles[G]=[A,z,q];A+=C+w;u++;if(u===B.total){break}H++;if(H===B.columns){A=I;z+=v+w;H=0;F++;if(F===B.rows){break}}}return B}return null},createFromObjects:function(q,v,B,r,x,w,A,p,s){if(x===undefined){x=true}if(w===undefined){w=false}if(A===undefined){A=this.game.world}if(p===undefined){p=g.Sprite}if(s===undefined){s=true}if(!this.objects[q]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+q);return}for(var u=0;u<this.objects[q].length;u++){var C=false;var t=this.objects[q][u];if(t.gid!==undefined&&typeof v==="number"&&t.gid===v){C=true}else{if(t.id!==undefined&&typeof v==="number"&&t.id===v){C=true}else{if(t.name!==undefined&&typeof v==="string"&&t.name===v){C=true}}}if(C){var z=new p(this.game,parseFloat(t.x,10),parseFloat(t.y,10),B,r);z.name=t.name;z.visible=t.visible;z.autoCull=w;z.exists=x;if(t.width){z.width=t.width}if(t.height){z.height=t.height}if(t.rotation){z.angle=t.rotation}if(s){z.y-=z.height}A.add(z);for(var y in t.properties){A.set(z,y,t.properties[y],false,false,0,true)}}}},createFromTiles:function(A,q,z,s,y,u){if(typeof A==="number"){A=[A]}if(q===undefined||q===null){q=[]}else{if(typeof q==="number"){q=[q]}}s=this.getLayer(s);if(y===undefined){y=this.game.world}if(u===undefined){u={}}if(u.customClass===undefined){u.customClass=g.Sprite}if(u.adjustY===undefined){u.adjustY=true}var p=this.layers[s].width;var B=this.layers[s].height;this.copy(0,0,p,B,s);if(this._results.length<2){return 0}var v=0;var x;for(var r=1,t=this._results.length;r<t;r++){if(A.indexOf(this._results[r].index)!==-1){x=new u.customClass(this.game,this._results[r].worldX,this._results[r].worldY,z);for(var w in u){x[w]=u[w]}y.add(x);v++}}if(q.length===1){for(r=0;r<A.length;r++){this.replace(A[r],q[0],0,0,p,B,s)}}else{if(q.length>1){for(r=0;r<A.length;r++){this.replace(A[r],q[r],0,0,p,B,s)}}}return v},createLayer:function(s,t,p,u){if(t===undefined){t=this.game.width}if(p===undefined){p=this.game.height}if(u===undefined){u=this.game.world}var r=s;if(typeof s==="string"){r=this.getLayerIndex(s)}if(r===null||r>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+r);return}if(t===undefined||t<=0){t=Math.min(this.game.width,this.layers[r].widthInPixels)}else{if(t>this.game.width){t=this.game.width}}if(p===undefined||p<=0){p=Math.min(this.game.height,this.layers[r].heightInPixels)}else{if(p>this.game.height){p=this.game.height}}if(this.enableDebug){console.group("Tilemap.createLayer");console.log("Name:",this.layers[r].name);console.log("Size:",t,"x",p);console.log("Tileset:",this.tilesets[0].name,"index:",r)}var q=u.add(new g.TilemapLayer(this.game,this,r,t,p));if(this.enableDebug){console.groupEnd()}return q},createBlankLayer:function(p,q,D,A,u,C){if(C===undefined){C=this.game.world}if(this.getLayerIndex(p)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists: "+p);return}var t={name:p,x:0,y:0,width:q,height:D,widthInPixels:q*A,heightInPixels:D*u,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:null};var E;var r=[];for(var v=0;v<D;v++){E=[];for(var z=0;z<q;z++){E.push(new g.Tile(t,-1,z,v,A,u))}r.push(E)}t.data=r;this.layers.push(t);this.currentLayer=this.layers.length-1;var B=t.widthInPixels;var s=t.heightInPixels;if(B>this.game.width){B=this.game.width}if(s>this.game.height){s=this.game.height}var r=new g.TilemapLayer(this.game,this,this.layers.length-1,B,s);r.name=p;return C.add(r)},getIndex:function(p,q){for(var r=0;r<p.length;r++){if(p[r].name===q){return r}}return null},getLayerIndex:function(p){return this.getIndex(this.layers,p)},getTilesetIndex:function(p){return this.getIndex(this.tilesets,p)},getImageIndex:function(p){return this.getIndex(this.images,p)},setTileIndexCallback:function(r,u,q,t){t=this.getLayer(t);if(typeof r==="number"){this.layers[t].callbacks[r]={callback:u,callbackContext:q}}else{for(var s=0,p=r.length;s<p;s++){this.layers[t].callbacks[r[s]]={callback:u,callbackContext:q}}}},setTileLocationCallback:function(q,w,u,p,v,r,t){t=this.getLayer(t);this.copy(q,w,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){this._results[s].setCollisionCallback(v,r)}},setCollision:function(r,p,t,q){if(p===undefined){p=true}if(q===undefined){q=true}t=this.getLayer(t);if(typeof r==="number"){return this.setCollisionByIndex(r,p,t,true)}else{if(Array.isArray(r)){for(var s=0;s<r.length;s++){this.setCollisionByIndex(r[s],p,t,false)}if(q){this.calculateFaces(t)}}}},setCollisionBetween:function(u,t,p,s,r){if(p===undefined){p=true}if(r===undefined){r=true}s=this.getLayer(s);if(u>t){return}for(var q=u;q<=t;q++){this.setCollisionByIndex(q,p,s,false)}if(r){this.calculateFaces(s)}},setCollisionByExclusion:function(s,q,u,r){if(q===undefined){q=true}if(r===undefined){r=true}u=this.getLayer(u);for(var t=0,p=this.tiles.length;t<p;t++){if(s.indexOf(t)===-1){this.setCollisionByIndex(t,q,u,false)}}if(r){this.calculateFaces(u)}},setCollisionByIndex:function(s,q,u,r){if(q===undefined){q=true}if(u===undefined){u=this.currentLayer}if(r===undefined){r=true}if(q){this.collideIndexes.push(s)}else{var t=this.collideIndexes.indexOf(s);if(t>-1){this.collideIndexes.splice(t,1)}}for(var w=0;w<this.layers[u].height;w++){for(var p=0;p<this.layers[u].width;p++){var v=this.layers[u].data[w][p];if(v&&v.index===s){if(q){v.setCollision(true,true,true,true)}else{v.resetCollision()}v.faceTop=q;v.faceBottom=q;v.faceLeft=q;v.faceRight=q}}}if(r){this.calculateFaces(u)}return u},getLayer:function(p){if(p===undefined){p=this.currentLayer}else{if(typeof p==="string"){p=this.getLayerIndex(p)}else{if(p instanceof g.TilemapLayer){p=p.index}}}return p},setPreventRecalculate:function(q){if(q===true&&this.preventingRecalculate!==true){this.preventingRecalculate=true;this.needToRecalculate={}}if(q===false&&this.preventingRecalculate===true){this.preventingRecalculate=false;for(var p in this.needToRecalculate){this.calculateFaces(p)}this.needToRecalculate=false}},calculateFaces:function(r){if(this.preventingRecalculate){this.needToRecalculate[r]=true;return}var t=null;var A=null;var p=null;var B=null;for(var u=0,q=this.layers[r].height;u<q;u++){for(var v=0,z=this.layers[r].width;v<z;v++){var s=this.layers[r].data[u][v];if(s){t=this.getTileAbove(r,v,u);A=this.getTileBelow(r,v,u);p=this.getTileLeft(r,v,u);B=this.getTileRight(r,v,u);if(s.collides){s.faceTop=true;s.faceBottom=true;s.faceLeft=true;s.faceRight=true}if(t&&t.collides){s.faceTop=false}if(A&&A.collides){s.faceBottom=false}if(p&&p.collides){s.faceLeft=false}if(B&&B.collides){s.faceRight=false}}}}},getTileAbove:function(q,p,r){if(r>0){return this.layers[q].data[r-1][p]}return null},getTileBelow:function(q,p,r){if(r<this.layers[q].height-1){return this.layers[q].data[r+1][p]}return null},getTileLeft:function(q,p,r){if(p>0){return this.layers[q].data[r][p-1]}return null},getTileRight:function(q,p,r){if(p<this.layers[q].width-1){return this.layers[q].data[r][p+1]}return null},setLayer:function(p){p=this.getLayer(p);if(this.layers[p]){this.currentLayer=p}},hasTile:function(p,r,q){q=this.getLayer(q);if(this.layers[q].data[r]===undefined||this.layers[q].data[r][p]===undefined){return false}return(this.layers[q].data[r][p].index>-1)},removeTile:function(p,s,q){q=this.getLayer(q);if(p>=0&&p<this.layers[q].width&&s>=0&&s<this.layers[q].height){if(this.hasTile(p,s,q)){var r=this.layers[q].data[s][p];this.layers[q].data[s][p]=new g.Tile(this.layers[q],-1,p,s,this.tileWidth,this.tileHeight);this.layers[q].dirty=true;this.calculateFaces(q);return r}}},removeTileWorldXY:function(p,t,s,q,r){r=this.getLayer(r);p=this.game.math.snapToFloor(p,s)/s;t=this.game.math.snapToFloor(t,q)/q;return this.removeTile(p,t,r)},putTile:function(s,p,t,r){if(s===null){return this.removeTile(p,t,r)}r=this.getLayer(r);if(p>=0&&p<this.layers[r].width&&t>=0&&t<this.layers[r].height){var q;if(s instanceof g.Tile){q=s.index;if(this.hasTile(p,t,r)){this.layers[r].data[t][p].copy(s)}else{this.layers[r].data[t][p]=new g.Tile(r,q,p,t,s.width,s.height)}}else{q=s;if(this.hasTile(p,t,r)){this.layers[r].data[t][p].index=q}else{this.layers[r].data[t][p]=new g.Tile(this.layers[r],q,p,t,this.tileWidth,this.tileHeight)}}if(this.collideIndexes.indexOf(q)>-1){this.layers[r].data[t][p].setCollision(true,true,true,true)}else{this.layers[r].data[t][p].resetCollision()}this.layers[r].dirty=true;this.calculateFaces(r);return this.layers[r].data[t][p]}return null},putTileWorldXY:function(s,p,u,t,q,r){r=this.getLayer(r);p=this.game.math.snapToFloor(p,t)/t;u=this.game.math.snapToFloor(u,q)/q;return this.putTile(s,p,u,r)},searchTileIndex:function(r,t,q,s){if(t===undefined){t=0}if(q===undefined){q=false}s=this.getLayer(s);var v=0;if(q){for(var u=this.layers[s].height-1;u>=0;u--){for(var p=this.layers[s].width-1;p>=0;p--){if(this.layers[s].data[u][p].index===r){if(v===t){return this.layers[s].data[u][p]}else{v++}}}}}else{for(var u=0;u<this.layers[s].height;u++){for(var p=0;p<this.layers[s].width;p++){if(this.layers[s].data[u][p].index===r){if(v===t){return this.layers[s].data[u][p]}else{v++}}}}}return null},getTile:function(p,s,r,q){if(q===undefined){q=false}r=this.getLayer(r);if(p>=0&&p<this.layers[r].width&&s>=0&&s<this.layers[r].height){if(this.layers[r].data[s][p].index===-1){if(q){return this.layers[r].data[s][p]}else{return null}}else{return this.layers[r].data[s][p]}}else{return null}},getTileWorldXY:function(p,u,t,r,s,q){if(t===undefined){t=this.tileWidth}if(r===undefined){r=this.tileHeight}s=this.getLayer(s);p=this.game.math.snapToFloor(p,t)/t;u=this.game.math.snapToFloor(u,r)/r;return this.getTile(p,u,s,q)},copy:function(r,v,u,q,t){t=this.getLayer(t);if(!this.layers[t]){this._results.length=0;return}if(r===undefined){r=0}if(v===undefined){v=0}if(u===undefined){u=this.layers[t].width}if(q===undefined){q=this.layers[t].height}if(r<0){r=0}if(v<0){v=0}if(u>this.layers[t].width){u=this.layers[t].width}if(q>this.layers[t].height){q=this.layers[t].height}this._results.length=0;this._results.push({x:r,y:v,width:u,height:q,layer:t});for(var p=v;p<v+q;p++){for(var s=r;s<r+u;s++){this._results.push(this.layers[t].data[p][s])}}return this._results},paste:function(p,v,u,t){if(p===undefined){p=0}if(v===undefined){v=0}t=this.getLayer(t);if(!u||u.length<2){return}var r=p-u[1].x;var q=v-u[1].y;for(var s=1;s<u.length;s++){this.layers[t].data[q+u[s].y][r+u[s].x].copy(u[s])}this.layers[t].dirty=true;this.calculateFaces(t)},swap:function(u,t,q,v,s,p,r){r=this.getLayer(r);this.copy(q,v,s,p,r);if(this._results.length<2){return}this._tempA=u;this._tempB=t;this._results.forEach(this.swapHandler,this);this.paste(q,v,this._results,r)},swapHandler:function(p){if(p.index===this._tempA){p.index=this._tempB}else{if(p.index===this._tempB){p.index=this._tempA}}},forEach:function(v,s,q,u,t,p,r){r=this.getLayer(r);this.copy(q,u,t,p,r);if(this._results.length<2){return}this._results.forEach(v,s);this.paste(q,u,this._results,r)},replace:function(v,r,q,w,u,p,t){t=this.getLayer(t);this.copy(q,w,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){if(this._results[s].index===v){this._results[s].index=r}}this.paste(q,w,this._results,t)},random:function(v,u,p,z,r){r=this.getLayer(r);this.copy(v,u,p,z,r);if(this._results.length<2){return}var s=[];for(var A=1;A<this._results.length;A++){if(this._results[A].index){var w=this._results[A].index;if(s.indexOf(w)===-1){s.push(w)}}}for(var q=1;q<this._results.length;q++){this._results[q].index=this.game.rnd.pick(s)}this.paste(v,u,this._results,r)},shuffle:function(q,z,w,p,v){v=this.getLayer(v);this.copy(q,z,w,p,v);if(this._results.length<2){return}var r=[];for(var u=1;u<this._results.length;u++){if(this._results[u].index){r.push(this._results[u].index)}}g.ArrayUtils.shuffle(r);for(var s=1;s<this._results.length;s++){this._results[s].index=r[s-1]}this.paste(q,z,this._results,v)},fill:function(r,q,v,u,p,t){t=this.getLayer(t);this.copy(q,v,u,p,t);if(this._results.length<2){return}for(var s=1;s<this._results.length;s++){this._results[s].index=r}this.paste(q,v,this._results,t)},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){var q="";var r=[""];for(var s=0;s<this.layers[this.currentLayer].height;s++){for(var p=0;p<this.layers[this.currentLayer].width;p++){q+="%c  ";if(this.layers[this.currentLayer].data[s][p]>1){if(this.debugMap[this.layers[this.currentLayer].data[s][p]]){r.push("background: "+this.debugMap[this.layers[this.currentLayer].data[s][p]])}else{r.push("background: #ffffff")}}else{r.push("background: rgb(0, 0, 0)")}}q+="\n"}r[0]=q;console.log.apply(console,r)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};g.Tilemap.prototype.constructor=g.Tilemap;Object.defineProperty(g.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(p){if(p!==this.currentLayer){this.setLayer(p)}}});g.TilemapLayer=function(q,t,r,s,p){s|=0;p|=0;g.Sprite.call(this,q,0,0);this.map=t;this.index=r;this.layer=t.layers[r];this.canvas=PIXI.CanvasPool.create(this,s,p);this.context=this.canvas.getContext("2d");this.setTexture(new PIXI.Texture(new PIXI.BaseTexture(this.canvas)));this.type=g.TILEMAPLAYER;this.physicsType=g.TILEMAPLAYER;this.renderSettings={enableScrollDelta:false,overdrawRatio:0.2,copyCanvas:null};this.debug=false;this.exists=true;this.debugSettings={missingImageFill:"rgb(255,255,255)",debuggedTileOverfill:"rgba(0,255,0,0.4)",forceFullRedraw:true,debugAlpha:0.5,facingEdgeStroke:"rgba(0,255,0,1)",collidingTileOverfill:"rgba(0,255,0,0.2)"};this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=true;this.rayStepRate=4;this._wrap=false;this._mc={scrollX:0,scrollY:0,renderWidth:0,renderHeight:0,tileWidth:t.tileWidth,tileHeight:t.tileHeight,cw:t.tileWidth,ch:t.tileHeight,tilesets:[]};this._scrollX=0;this._scrollY=0;this._results=[];if(!q.device.canvasBitBltShift){this.renderSettings.copyCanvas=g.TilemapLayer.ensureSharedCopyCanvas()}this.fixedToCamera=true};g.TilemapLayer.prototype=Object.create(g.Sprite.prototype);g.TilemapLayer.prototype.constructor=g.TilemapLayer;g.TilemapLayer.prototype.preUpdateCore=g.Component.Core.preUpdate;g.TilemapLayer.sharedCopyCanvas=null;g.TilemapLayer.ensureSharedCopyCanvas=function(){if(!this.sharedCopyCanvas){this.sharedCopyCanvas=PIXI.CanvasPool.create(this,2,2)}return this.sharedCopyCanvas};g.TilemapLayer.prototype.preUpdate=function(){return this.preUpdateCore()};g.TilemapLayer.prototype.postUpdate=function(){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y};g.TilemapLayer.prototype._renderCanvas=function(p){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderCanvas.call(this,p)};g.TilemapLayer.prototype._renderWebGL=function(p){if(this.fixedToCamera){this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x;this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y}this._scrollX=this.game.camera.view.x*this.scrollFactorX/this.scale.x;this._scrollY=this.game.camera.view.y*this.scrollFactorY/this.scale.y;this.render();PIXI.Sprite.prototype._renderWebGL.call(this,p)};g.TilemapLayer.prototype.destroy=function(){PIXI.CanvasPool.remove(this);g.Component.Destroy.prototype.destroy.call(this)};g.TilemapLayer.prototype.resize=function(q,p){this.canvas.width=q;this.canvas.height=p;this.texture.frame.resize(q,p);this.texture.width=q;this.texture.height=p;this.texture.crop.width=q;this.texture.crop.height=p;this.texture.baseTexture.width=q;this.texture.baseTexture.height=p;this.texture.baseTexture.dirty();this.texture.requiresUpdate=true;this.texture._updateUvs();this.dirty=true};g.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels*this.scale.x,this.layer.heightInPixels*this.scale.y)};g.TilemapLayer.prototype._fixX=function(p){if(this.scrollFactorX===1||(this.scrollFactorX===0&&this.position.x===0)){return p}if(this.scrollFactorX===0&&this.position.x!==0){return p-this.position.x}return this._scrollX+(p-(this._scrollX/this.scrollFactorX))};g.TilemapLayer.prototype._unfixX=function(p){if(this.scrollFactorX===1){return p}return(this._scrollX/this.scrollFactorX)+(p-this._scrollX)};g.TilemapLayer.prototype._fixY=function(p){if(this.scrollFactorY===1||(this.scrollFactorY===0&&this.position.y===0)){return p}if(this.scrollFactorY===0&&this.position.y!==0){return p-this.position.y}return this._scrollY+(p-(this._scrollY/this.scrollFactorY))};g.TilemapLayer.prototype._unfixY=function(p){if(this.scrollFactorY===1){return p}return(this._scrollY/this.scrollFactorY)+(p-this._scrollY)};g.TilemapLayer.prototype.getTileX=function(p){return Math.floor(this._fixX(p)/this._mc.tileWidth)};g.TilemapLayer.prototype.getTileY=function(p){return Math.floor(this._fixY(p)/this._mc.tileHeight)};g.TilemapLayer.prototype.getTileXY=function(q,r,p){p.x=this.getTileX(q);p.y=this.getTileY(r);return p};g.TilemapLayer.prototype.getRayCastTiles=function(A,s,p,x){if(!s){s=this.rayStepRate}if(p===undefined){p=false}if(x===undefined){x=false}var y=this.getTiles(A.x,A.y,A.width,A.height,p,x);if(y.length===0){return[]}var w=A.coordinatesOnLine(s);var q=[];for(var r=0;r<y.length;r++){for(var z=0;z<w.length;z++){var v=y[r];var u=w[z];if(v.containsPoint(u[0],u[1])){q.push(v);break}}}return q};g.TilemapLayer.prototype.getTiles=function(B,A,q,D,t,C){if(t===undefined){t=false}if(C===undefined){C=false}var r=!(t||C);B=this._fixX(B);A=this._fixY(A);var w=Math.floor(B/(this._mc.cw*this.scale.x));var v=Math.floor(A/(this._mc.ch*this.scale.y));var z=Math.ceil((B+q)/(this._mc.cw*this.scale.x))-w;var p=Math.ceil((A+D)/(this._mc.ch*this.scale.y))-v;while(this._results.length){this._results.pop()}for(var s=v;s<v+p;s++){for(var u=w;u<w+z;u++){var E=this.layer.data[s];if(E&&E[u]){if(r||E[u].isInteresting(t,C)){this._results.push(E[u])}}}}return this._results.slice()};g.TilemapLayer.prototype.resolveTileset=function(s){var p=this._mc.tilesets;if(s<2000){while(p.length<s){p.push(undefined)}}var q=this.map.tiles[s]&&this.map.tiles[s][2];if(q!==null){var r=this.map.tilesets[q];if(r&&r.containsTileIndex(s)){return(p[s]=r)}}return(p[s]=null)};g.TilemapLayer.prototype.resetTilesetCache=function(){var p=this._mc.tilesets;while(p.length){p.pop()}};g.TilemapLayer.prototype.setScale=function(s,r){s=s||1;r=r||s;for(var u=0;u<this.layer.data.length;u++){var t=this.layer.data[u];for(var p=0;p<t.length;p++){var q=t[p];q.width=this.map.tileWidth*s;q.height=this.map.tileHeight*r;q.worldX=q.x*q.width;q.worldY=q.y*q.height}}this.scale.setTo(s,r)};g.TilemapLayer.prototype.shiftCanvas=function(p,z,v){var q=p.canvas;var A=q.width-Math.abs(z);var t=q.height-Math.abs(v);var C=0;var B=0;var w=z;var u=v;if(z<0){C=-z;w=0}if(v<0){B=-v;u=0}var s=this.renderSettings.copyCanvas;if(s){if(s.width<A||s.height<t){s.width=A;s.height=t}var r=s.getContext("2d");r.clearRect(0,0,A,t);r.drawImage(q,C,B,A,t,0,0,A,t);p.clearRect(w,u,A,t);p.drawImage(s,0,0,A,t,w,u,A,t)}else{p.save();p.globalCompositeOperation="copy";p.drawImage(q,C,B,A,t,w,u,A,t);p.restore()}};g.TilemapLayer.prototype.renderRegion=function(J,I,s,E,N,w){var r=this.context;var H=this.layer.width;var F=this.layer.height;var Q=this._mc.tileWidth;var t=this._mc.tileHeight;var L=this._mc.tilesets;var K=NaN;if(!this._wrap){if(s<=N){s=Math.max(0,s);N=Math.min(H-1,N)}if(E<=w){E=Math.max(0,E);w=Math.min(F-1,w)}}var q=(s*Q)-J;var p=(E*t)-I;var D=(s+((1<<20)*H))%H;var B=(E+((1<<20)*F))%F;var P,O,A,z,G,M;for(z=B,M=w-E,O=p;M>=0;z++,M--,O+=t){if(z>=F){z-=F}var v=this.layer.data[z];for(A=D,G=N-s,P=q;G>=0;A++,G--,P+=Q){if(A>=H){A-=H}var R=v[A];if(!R||R.index<0){continue}var u=R.index;var C=L[u];if(C===undefined){C=this.resolveTileset(u)}if(R.alpha!==K&&!this.debug){r.globalAlpha=R.alpha;K=R.alpha}if(C){if(R.rotation||R.flipped){r.save();r.translate(P+R.centerX,O+R.centerY);r.rotate(R.rotation);if(R.flipped){r.scale(-1,1)}C.draw(r,-R.centerX,-R.centerY,u);r.restore()}else{C.draw(r,P,O,u)}}else{if(this.debugSettings.missingImageFill){r.fillStyle=this.debugSettings.missingImageFill;r.fillRect(P,O,Q,t)}}if(R.debug&&this.debugSettings.debuggedTileOverfill){r.fillStyle=this.debugSettings.debuggedTileOverfill;r.fillRect(P,O,Q,t)}}}};g.TilemapLayer.prototype.renderDeltaScroll=function(B,A){var E=this._mc.scrollX;var C=this._mc.scrollY;var x=this.canvas.width;var u=this.canvas.height;var v=this._mc.tileWidth;var r=this._mc.tileHeight;var t=0;var D=-v;var y=0;var q=-r;if(B<0){t=x+B;D=x-1}else{if(B>0){D=B}}if(A<0){y=u+A;q=u-1}else{if(A>0){q=A}}this.shiftCanvas(this.context,B,A);t=Math.floor((t+E)/v);D=Math.floor((D+E)/v);y=Math.floor((y+C)/r);q=Math.floor((q+C)/r);if(t<=D){this.context.clearRect(((t*v)-E),0,(D-t+1)*v,u);var s=Math.floor((0+C)/r);var p=Math.floor((u-1+C)/r);this.renderRegion(E,C,t,s,D,p)}if(y<=q){this.context.clearRect(0,((y*r)-C),x,(q-y+1)*r);var w=Math.floor((0+E)/v);var z=Math.floor((x-1+E)/v);this.renderRegion(E,C,w,y,z,q)}};g.TilemapLayer.prototype.renderFull=function(){var x=this._mc.scrollX;var w=this._mc.scrollY;var u=this.canvas.width;var s=this.canvas.height;var t=this._mc.tileWidth;var q=this._mc.tileHeight;var r=Math.floor(x/t);var y=Math.floor((u-1+x)/t);var v=Math.floor(w/q);var p=Math.floor((s-1+w)/q);this.context.clearRect(0,0,u,s);this.renderRegion(x,w,r,v,y,p)};g.TilemapLayer.prototype.render=function(){var p=false;if(!this.visible){return}if(this.dirty||this.layer.dirty){this.layer.dirty=false;p=true}var q=this.canvas.width;var w=this.canvas.height;var v=this._scrollX|0;var u=this._scrollY|0;var t=this._mc;var s=t.scrollX-v;var r=t.scrollY-u;if(!p&&s===0&&r===0&&t.renderWidth===q&&t.renderHeight===w){return}this.context.save();t.scrollX=v;t.scrollY=u;if(t.renderWidth!==q||t.renderHeight!==w){t.renderWidth=q;t.renderHeight=w}if(this.debug){this.context.globalAlpha=this.debugSettings.debugAlpha;if(this.debugSettings.forceFullRedraw){p=true}}if(!p&&this.renderSettings.enableScrollDelta&&(Math.abs(s)+Math.abs(r))<Math.min(q,w)){this.renderDeltaScroll(s,r)}else{this.renderFull()}if(this.debug){this.context.globalAlpha=1;this.renderDebug()}this.texture.baseTexture.dirty();this.dirty=false;this.context.restore();return true};g.TilemapLayer.prototype.renderDebug=function(){var J=this._mc.scrollX;var I=this._mc.scrollY;var s=this.context;var r=this.canvas.width;var z=this.canvas.height;var H=this.layer.width;var F=this.layer.height;var O=this._mc.tileWidth;var u=this._mc.tileHeight;var t=Math.floor(J/O);var L=Math.floor((r-1+J)/O);var E=Math.floor(I/u);var w=Math.floor((z-1+I)/u);var q=(t*O)-J;var p=(E*u)-I;var D=(t+((1<<20)*H))%H;var C=(E+((1<<20)*F))%F;var N,M,B,A,G,K;s.strokeStyle=this.debugSettings.facingEdgeStroke;for(A=C,K=w-E,M=p;K>=0;A++,K--,M+=u){if(A>=F){A-=F}var v=this.layer.data[A];for(B=D,G=L-t,N=q;G>=0;B++,G--,N+=O){if(B>=H){B-=H}var P=v[B];if(!P||P.index<0||!P.collides){continue}if(this.debugSettings.collidingTileOverfill){s.fillStyle=this.debugSettings.collidingTileOverfill;s.fillRect(N,M,this._mc.cw,this._mc.ch)}if(this.debugSettings.facingEdgeStroke){s.beginPath();if(P.faceTop){s.moveTo(N,M);s.lineTo(N+this._mc.cw,M)}if(P.faceBottom){s.moveTo(N,M+this._mc.ch);s.lineTo(N+this._mc.cw,M+this._mc.ch)}if(P.faceLeft){s.moveTo(N,M);s.lineTo(N,M+this._mc.ch)}if(P.faceRight){s.moveTo(N+this._mc.cw,M);s.lineTo(N+this._mc.cw,M+this._mc.ch)}s.closePath();s.stroke()}}}};Object.defineProperty(g.TilemapLayer.prototype,"wrap",{get:function(){return this._wrap},set:function(p){this._wrap=p;this.dirty=true}});Object.defineProperty(g.TilemapLayer.prototype,"scrollX",{get:function(){return this._scrollX},set:function(p){this._scrollX=p}});Object.defineProperty(g.TilemapLayer.prototype,"scrollY",{get:function(){return this._scrollY},set:function(p){this._scrollY=p}});Object.defineProperty(g.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(p){this._mc.cw=p|0;this.dirty=true}});Object.defineProperty(g.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(p){this._mc.ch=p|0;this.dirty=true}});g.TilemapParser={INSERT_NULL:false,parse:function(r,s,v,q,t,p){if(v===undefined){v=32}if(q===undefined){q=32}if(t===undefined){t=10}if(p===undefined){p=10}if(s===undefined){return this.getEmptyData()}if(s===null){return this.getEmptyData(v,q,t,p)}var u=r.cache.getTilemapData(s);if(u){if(u.format===g.Tilemap.CSV){return this.parseCSV(s,u.data,v,q)}else{if(!u.format||u.format===g.Tilemap.TILED_JSON){return this.parseTiledJSON(u.data)}}}else{console.warn("Phaser.TilemapParser.parse - No map data found for key "+s)}},parseCSV:function(A,t,z,u){var p=this.getEmptyData();t=t.trim();var r=[];var C=t.split("\n");var B=C.length;var q=0;for(var v=0;v<C.length;v++){r[v]=[];var s=C[v].split(",");for(var w=0;w<s.length;w++){r[v][w]=new g.Tile(p.layers[0],parseInt(s[w],10),w,v,z,u)}if(q===0){q=s.length}}p.format=g.Tilemap.CSV;p.name=A;p.width=q;p.height=B;p.tileWidth=z;p.tileHeight=u;p.widthInPixels=q*z;p.heightInPixels=B*u;p.layers[0].width=q;p.layers[0].height=B;p.layers[0].widthInPixels=p.widthInPixels;p.layers[0].heightInPixels=p.heightInPixels;p.layers[0].data=r;return p},getEmptyData:function(s,q,r,p){return{width:(r!==undefined&&r!==null)?r:0,height:(p!==undefined&&p!==null)?p:0,tileWidth:(s!==undefined&&s!==null)?s:0,tileHeight:(q!==undefined&&q!==null)?q:0,orientation:"orthogonal",version:"1",properties:{},widthInPixels:0,heightInPixels:0,layers:[{name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:true,properties:{},indexes:[],callbacks:[],bodies:[],data:[]}],images:[],objects:{},collision:{},tilesets:[],tiles:[]}},parseTiledJSON:function(af){if(af.orientation!=="orthogonal"){console.warn("TilemapParser.parseTiledJSON - Only orthogonal map types are supported in this version of Phaser");return null}var N={width:af.width,height:af.height,tileWidth:af.tilewidth,tileHeight:af.tileheight,orientation:af.orientation,format:g.Tilemap.TILED_JSON,version:af.version,properties:af.properties,widthInPixels:af.width*af.tilewidth,heightInPixels:af.height*af.tileheight};var X=[];for(var ai=0;ai<af.layers.length;ai++){if(af.layers[ai].type!=="tilelayer"){continue}var T=af.layers[ai];if(!T.compression&&T.encoding&&T.encoding==="base64"){var ad=window.atob(T.data);var I=ad.length;var D=new Array(I);for(var ah=0;ah<I;ah+=4){D[ah/4]=(ad.charCodeAt(ah)|ad.charCodeAt(ah+1)<<8|ad.charCodeAt(ah+2)<<16|ad.charCodeAt(ah+3)<<24)>>>0}T.data=D;delete T.encoding}else{if(T.compression){console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+T.name+"'");continue}}var s={name:T.name,x:T.x,y:T.y,width:T.width,height:T.height,widthInPixels:T.width*af.tilewidth,heightInPixels:T.height*af.tileheight,alpha:T.opacity,visible:T.visible,properties:{},indexes:[],callbacks:[],bodies:[]};if(T.properties){s.properties=T.properties}var S=0;var F=[];var L=[];var O,E,w,V;for(var Y=0,I=T.data.length;Y<I;Y++){O=0;E=false;V=T.data[Y];w=0;if(V>536870912){if(V>2147483648){V-=2147483648;w+=4}if(V>1073741824){V-=1073741824;w+=2}if(V>536870912){V-=536870912;w+=1}switch(w){case 5:O=Math.PI/2;break;case 6:O=Math.PI;break;case 3:O=3*Math.PI/2;break;case 4:O=0;E=true;break;case 7:O=Math.PI/2;E=true;break;case 2:O=Math.PI;E=true;break;case 1:O=3*Math.PI/2;E=true;break}}if(V>0){var z=new g.Tile(s,V,S,L.length,af.tilewidth,af.tileheight);z.rotation=O;z.flipped=E;if(w!==0){z.flippedVal=w}F.push(z)}else{if(g.TilemapParser.INSERT_NULL){F.push(null)}else{F.push(new g.Tile(s,-1,S,L.length,af.tilewidth,af.tileheight))}}S++;if(S===T.width){L.push(F);S=0;F=[]}}s.data=L;X.push(s)}N.layers=X;var r=[];for(var ai=0;ai<af.layers.length;ai++){if(af.layers[ai].type!=="imagelayer"){continue}var Z=af.layers[ai];var u={name:Z.name,image:Z.image,x:Z.x,y:Z.y,alpha:Z.opacity,visible:Z.visible,properties:{}};if(Z.properties){u.properties=Z.properties}r.push(u)}N.images=r;var aj=[];var J=[];var P=null;for(var ai=0;ai<af.tilesets.length;ai++){var K=af.tilesets[ai];if(K.image){var A=new g.Tileset(K.name,K.firstgid,K.tilewidth,K.tileheight,K.margin,K.spacing,K.properties);if(K.tileproperties){A.tileProperties=K.tileproperties}A.updateTileData(K.imagewidth,K.imageheight);aj.push(A)}else{var M=new g.ImageCollection(K.name,K.firstgid,K.tilewidth,K.tileheight,K.margin,K.spacing,K.properties);for(var q in K.tiles){var u=K.tiles[q].image;var V=K.firstgid+parseInt(q,10);M.addImage(V,u)}J.push(M)}if(P){P.lastgid=K.firstgid-1}P=K}N.tilesets=aj;N.imagecollections=J;var aa={};var ab={};function G(y,p){var v={};for(var t in p){var x=p[t];if(typeof y[x]!=="undefined"){v[x]=y[x]}}return v}for(var ai=0;ai<af.layers.length;ai++){if(af.layers[ai].type!=="objectgroup"){continue}var R=af.layers[ai];aa[R.name]=[];ab[R.name]=[];for(var W=0,I=R.objects.length;W<I;W++){if(R.objects[W].gid){var U={gid:R.objects[W].gid,name:R.objects[W].name,type:R.objects[W].hasOwnProperty("type")?R.objects[W].type:"",x:R.objects[W].x,y:R.objects[W].y,visible:R.objects[W].visible,properties:R.objects[W].properties};if(R.objects[W].rotation){U.rotation=R.objects[W].rotation}aa[R.name].push(U)}else{if(R.objects[W].polyline){var U={name:R.objects[W].name,type:R.objects[W].type,x:R.objects[W].x,y:R.objects[W].y,width:R.objects[W].width,height:R.objects[W].height,visible:R.objects[W].visible,properties:R.objects[W].properties};if(R.objects[W].rotation){U.rotation=R.objects[W].rotation}U.polyline=[];for(var ae=0;ae<R.objects[W].polyline.length;ae++){U.polyline.push([R.objects[W].polyline[ae].x,R.objects[W].polyline[ae].y])}ab[R.name].push(U);aa[R.name].push(U)}else{if(R.objects[W].polygon){var U=G(R.objects[W],["name","type","x","y","visible","rotation","properties"]);U.polygon=[];for(var ae=0;ae<R.objects[W].polygon.length;ae++){U.polygon.push([R.objects[W].polygon[ae].x,R.objects[W].polygon[ae].y])}aa[R.name].push(U)}else{if(R.objects[W].ellipse){var U=G(R.objects[W],["name","type","ellipse","x","y","width","height","visible","rotation","properties"]);aa[R.name].push(U)}else{var U=G(R.objects[W],["name","type","x","y","width","height","visible","rotation","properties"]);U.rectangle=true;aa[R.name].push(U)}}}}}}N.objects=aa;N.collision=ab;N.tiles=[];for(var ai=0;ai<N.tilesets.length;ai++){var K=N.tilesets[ai];var S=K.tileMargin;var Q=K.tileMargin;var ac=0;var C=0;var B=0;for(var Y=K.firstgid;Y<K.firstgid+K.total;Y++){N.tiles[Y]=[S,Q,ai];S+=K.tileWidth+K.tileSpacing;ac++;if(ac===K.total){break}C++;if(C===K.columns){S=K.tileMargin;Q+=K.tileHeight+K.tileSpacing;C=0;B++;if(B===K.rows){break}}}}var s;var z;var H;var K;for(var ai=0;ai<N.layers.length;ai++){s=N.layers[ai];K=null;for(var ah=0;ah<s.data.length;ah++){F=s.data[ah];for(var ag=0;ag<F.length;ag++){z=F[ag];if(z===null||z.index<0){continue}H=N.tiles[z.index][2];K=N.tilesets[H];if(K.tileProperties&&K.tileProperties[z.index-K.firstgid]){z.properties=g.Utils.mixin(K.tileProperties[z.index-K.firstgid],z.properties)}}}}return N}};g.Tileset=function(q,u,s,p,t,v,r){if(s===undefined||s<=0){s=32}if(p===undefined||p<=0){p=32}if(t===undefined){t=0}if(v===undefined){v=0}this.name=q;this.firstgid=u|0;this.tileWidth=s|0;this.tileHeight=p|0;this.tileMargin=t|0;this.tileSpacing=v|0;this.properties=r||{};this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};g.Tileset.prototype={draw:function(r,p,t,q){var s=(q-this.firstgid)<<1;if(s>=0&&(s+1)<this.drawCoords.length){r.drawImage(this.image,this.drawCoords[s],this.drawCoords[s+1],this.tileWidth,this.tileHeight,p,t,this.tileWidth,this.tileHeight)}},containsTileIndex:function(p){return(p>=this.firstgid&&p<(this.firstgid+this.total))},setImage:function(p){this.image=p;this.updateTileData(p.width,p.height)},setSpacing:function(p,q){this.tileMargin=p|0;this.tileSpacing=q|0;if(this.image){this.updateTileData(this.image.width,this.image.height)}},updateTileData:function(u,r){var t=(r-this.tileMargin*2+this.tileSpacing)/(this.tileHeight+this.tileSpacing);var v=(u-this.tileMargin*2+this.tileSpacing)/(this.tileWidth+this.tileSpacing);if(t%1!==0||v%1!==0){console.warn("Phaser.Tileset - "+this.name+" image tile area is not an even multiple of tile size")}t=Math.floor(t);v=Math.floor(v);if((this.rows&&this.rows!==t)||(this.columns&&this.columns!==v)){console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ")}this.rows=t;this.columns=v;this.total=t*v;this.drawCoords.length=0;var s=this.tileMargin;var q=this.tileMargin;for(var w=0;w<this.rows;w++){for(var p=0;p<this.columns;p++){this.drawCoords.push(s);this.drawCoords.push(q);s+=this.tileWidth+this.tileSpacing}s=this.tileMargin;q+=this.tileHeight+this.tileSpacing}}};g.Tileset.prototype.constructor=g.Tileset;g.Particle=function(q,p,t,r,s){g.Sprite.call(this,q,p,t,r,s);this.autoScale=false;this.scaleData=null;this._s=0;this.autoAlpha=false;this.alphaData=null;this._a=0};g.Particle.prototype=Object.create(g.Sprite.prototype);g.Particle.prototype.constructor=g.Particle;g.Particle.prototype.update=function(){if(this.autoScale){this._s--;if(this._s){this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y)}else{this.autoScale=false}}if(this.autoAlpha){this._a--;if(this._a){this.alpha=this.alphaData[this._a].v}else{this.autoAlpha=false}}};g.Particle.prototype.onEmit=function(){};g.Particle.prototype.setAlphaData=function(p){this.alphaData=p;this._a=p.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=true};g.Particle.prototype.setScaleData=function(p){this.scaleData=p;this._s=p.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=true};g.Particle.prototype.reset=function(p,r,q){g.Component.Reset.prototype.reset.call(this,p,r,q);this.alpha=1;this.scale.set(1);this.autoScale=false;this.autoAlpha=false;return this};g.Particles=function(p){this.game=p;this.emitters={};this.ID=0};g.Particles.prototype={add:function(p){this.emitters[p.name]=p;return p},remove:function(p){delete this.emitters[p.name]},update:function(){for(var p in this.emitters){if(this.emitters[p].exists){this.emitters[p].update()}}}};g.Particles.prototype.constructor=g.Particles;g.Particles.Arcade={};g.Particles.Arcade.Emitter=function(q,p,s,r){this.maxParticles=r||50;g.Group.call(this,q);this.name="emitter"+this.game.particles.ID++;this.type=g.EMITTER;this.physicsType=g.GROUP;this.area=new g.Rectangle(p,s,1,1);this.minParticleSpeed=new g.Point(-100,-100);this.maxParticleSpeed=new g.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=g.Particle;this.particleDrag=new g.Point();this.angularDrag=0;this.frequency=100;this.lifespan=2000;this.bounce=new g.Point();this.on=false;this.particleAnchor=new g.Point(0.5,0.5);this.blendMode=g.blendModes.NORMAL;this.emitX=p;this.emitY=s;this.autoScale=false;this.autoAlpha=false;this.particleBringToTop=false;this.particleSendToBack=false;this._minParticleScale=new g.Point(1,1);this._maxParticleScale=new g.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._flowQuantity=0;this._flowTotal=0;this._explode=true;this._frames=null};g.Particles.Arcade.Emitter.prototype=Object.create(g.Group.prototype);g.Particles.Arcade.Emitter.prototype.constructor=g.Particles.Arcade.Emitter;g.Particles.Arcade.Emitter.prototype.update=function(){if(this.on&&this.game.time.time>=this._timer){this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion;if(this._flowTotal!==0){if(this._flowQuantity>0){for(var p=0;p<this._flowQuantity;p++){if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false;break}}}}else{if(this.emitParticle()){this._counter++;if(this._flowTotal!==-1&&this._counter>=this._flowTotal){this.on=false}}}}else{if(this.emitParticle()){this._counter++;if(this._quantity>0&&this._counter>=this._quantity){this.on=false}}}}var p=this.children.length;while(p--){if(this.children[p].exists){this.children[p].update()}}};g.Particles.Arcade.Emitter.prototype.makeParticles=function(w,t,q,v,x){if(t===undefined){t=0}if(q===undefined){q=this.maxParticles}if(v===undefined){v=false}if(x===undefined){x=false}var s;var r=0;var p=w;var u=t;this._frames=t;if(q>this.maxParticles){this.maxParticles=q}while(r<q){if(Array.isArray(w)){p=this.game.rnd.pick(w)}if(Array.isArray(t)){u=this.game.rnd.pick(t)}s=new this.particleClass(this.game,0,0,p,u);this.game.physics.arcade.enable(s,false);if(v){s.body.checkCollision.any=true;s.body.checkCollision.none=false}else{s.body.checkCollision.none=true}s.body.collideWorldBounds=x;s.body.skipQuadTree=true;s.exists=false;s.visible=false;s.anchor.copyFrom(this.particleAnchor);this.add(s);r++}return this};g.Particles.Arcade.Emitter.prototype.kill=function(){this.on=false;this.alive=false;this.exists=false;return this};g.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=true;this.exists=true;return this};g.Particles.Arcade.Emitter.prototype.explode=function(q,p){this._flowTotal=0;this.start(true,q,0,p,false);return this};g.Particles.Arcade.Emitter.prototype.flow=function(t,s,r,q,p){if(r===undefined||r===0){r=1}if(q===undefined){q=-1}if(p===undefined){p=true}if(r>this.maxParticles){r=this.maxParticles}this._counter=0;this._flowQuantity=r;this._flowTotal=q;if(p){this.start(true,t,s,r);this._counter+=r;this.on=true;this._timer=this.game.time.time+s*this.game.time.slowMotion}else{this.start(false,t,s,r)}return this};g.Particles.Arcade.Emitter.prototype.start=function(r,u,t,s,p){if(r===undefined){r=true}if(u===undefined){u=0}if(t===undefined||t===null){t=250}if(s===undefined){s=0}if(p===undefined){p=false}if(s>this.maxParticles){s=this.maxParticles}this.revive();this.visible=true;this.lifespan=u;this.frequency=t;if(r||p){for(var q=0;q<s;q++){this.emitParticle()}}else{this.on=true;this._quantity=s;this._counter=0;this._timer=this.game.time.time+t*this.game.time.slowMotion}return this};g.Particles.Arcade.Emitter.prototype.emitParticle=function(w,v,z,p){if(w===undefined){w=null}if(v===undefined){v=null}var u=this.getFirstExists(false);if(u===null){return false}var q=this.game.rnd;if(z!==undefined&&p!==undefined){u.loadTexture(z,p)}else{if(z!==undefined){u.loadTexture(z)}}var s=this.emitX;var r=this.emitY;if(w!==null){s=w}else{if(this.width>1){s=q.between(this.left,this.right)}}if(v!==null){r=v}else{if(this.height>1){r=q.between(this.top,this.bottom)}}u.reset(s,r);u.angle=0;u.lifespan=this.lifespan;if(this.particleBringToTop){this.bringToTop(u)}else{if(this.particleSendToBack){this.sendToBack(u)}}if(this.autoScale){u.setScaleData(this.scaleData)}else{if(this.minParticleScale!==1||this.maxParticleScale!==1){u.scale.set(q.realInRange(this.minParticleScale,this.maxParticleScale))}else{if((this._minParticleScale.x!==this._maxParticleScale.x)||(this._minParticleScale.y!==this._maxParticleScale.y)){u.scale.set(q.realInRange(this._minParticleScale.x,this._maxParticleScale.x),q.realInRange(this._minParticleScale.y,this._maxParticleScale.y))}}}if(p===undefined){if(Array.isArray(this._frames)){u.frame=this.game.rnd.pick(this._frames)}else{u.frame=this._frames}}if(this.autoAlpha){u.setAlphaData(this.alphaData)}else{u.alpha=q.realInRange(this.minParticleAlpha,this.maxParticleAlpha)}u.blendMode=this.blendMode;var t=u.body;t.updateBounds();t.bounce.copyFrom(this.bounce);t.drag.copyFrom(this.particleDrag);t.velocity.x=q.between(this.minParticleSpeed.x,this.maxParticleSpeed.x);t.velocity.y=q.between(this.minParticleSpeed.y,this.maxParticleSpeed.y);t.angularVelocity=q.between(this.minRotation,this.maxRotation);t.gravity.y=this.gravity;t.angularDrag=this.angularDrag;u.onEmit();return true};g.Particles.Arcade.Emitter.prototype.destroy=function(){this.game.particles.remove(this);g.Group.prototype.destroy.call(this,true,false)};g.Particles.Arcade.Emitter.prototype.setSize=function(q,p){this.area.width=q;this.area.height=p;return this};g.Particles.Arcade.Emitter.prototype.setXSpeed=function(q,p){q=q||0;p=p||0;this.minParticleSpeed.x=q;this.maxParticleSpeed.x=p;return this};g.Particles.Arcade.Emitter.prototype.setYSpeed=function(q,p){q=q||0;p=p||0;this.minParticleSpeed.y=q;this.maxParticleSpeed.y=p;return this};g.Particles.Arcade.Emitter.prototype.setRotation=function(q,p){q=q||0;p=p||0;this.minRotation=q;this.maxRotation=p;return this};g.Particles.Arcade.Emitter.prototype.setAlpha=function(s,p,u,v,t){if(s===undefined){s=1}if(p===undefined){p=1}if(u===undefined){u=0}if(v===undefined){v=g.Easing.Linear.None}if(t===undefined){t=false}this.minParticleAlpha=s;this.maxParticleAlpha=p;this.autoAlpha=false;if(u>0&&s!==p){var q={v:s};var r=this.game.make.tween(q).to({v:p},u,v);r.yoyo(t);this.alphaData=r.generateData(60);this.alphaData.reverse();this.autoAlpha=true}return this};g.Particles.Arcade.Emitter.prototype.setScale=function(s,q,r,p,u,t,v){if(s===undefined){s=1}if(q===undefined){q=1}if(r===undefined){r=1}if(p===undefined){p=1}if(u===undefined){u=0}if(t===undefined){t=g.Easing.Linear.None}if(v===undefined){v=false}this.minParticleScale=1;this.maxParticleScale=1;this._minParticleScale.set(s,r);this._maxParticleScale.set(q,p);this.autoScale=false;if(u>0&&((s!==q)||(r!==p))){var x={x:s,y:r};var w=this.game.make.tween(x).to({x:q,y:p},u,t);w.yoyo(v);this.scaleData=w.generateData(60);this.scaleData.reverse();this.autoScale=true}return this};g.Particles.Arcade.Emitter.prototype.at=function(p){if(p.center){this.emitX=p.center.x;this.emitY=p.center.y}else{this.emitX=p.world.x+(p.anchor.x*p.width);this.emitY=p.world.y+(p.anchor.y*p.height)}return this};Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(p){this.area.width=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(p){this.area.height=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(p){this.emitX=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(p){this.emitY=p}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-(this.area.width/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+(this.area.width/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-(this.area.height/2))}});Object.defineProperty(g.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+(this.area.height/2))}});g.Weapon=function(p,q){g.Plugin.call(this,p,q);this.bullets=null;this.autoExpandBulletsGroup=false;this.autofire=false;this.shots=0;this.fireLimit=0;this.fireRate=100;this.fireRateVariance=0;this.fireFrom=new g.Rectangle(0,0,1,1);this.fireAngle=g.ANGLE_UP;this.bulletInheritSpriteSpeed=false;this.bulletAnimation="";this.bulletFrameRandom=false;this.bulletFrameCycle=false;this.bulletWorldWrap=false;this.bulletWorldWrapPadding=0;this.bulletAngleOffset=0;this.bulletAngleVariance=0;this.bulletSpeed=200;this.bulletSpeedVariance=0;this.bulletLifespan=0;this.bulletKillDistance=0;this.bulletGravity=new g.Point(0,0);this.bulletRotateToVelocity=false;this.bulletKey="";this.bulletFrame="";this._bulletClass=g.Bullet;this._bulletCollideWorldBounds=false;this._bulletKillType=g.Weapon.KILL_WORLD_BOUNDS;this._data={customBody:false,width:0,height:0,offsetX:0,offsetY:0};this.bounds=new g.Rectangle();this.bulletBounds=p.world.bounds;this.bulletFrames=[];this.bulletFrameIndex=0;this.anims={};this.onFire=new g.Signal();this.onKill=new g.Signal();this.onFireLimit=new g.Signal();this.trackedSprite=null;this.trackedPointer=null;this.trackRotation=false;this.trackOffset=new g.Point();this._nextFire=0;this._rotatedPoint=new g.Point()};g.Weapon.prototype=Object.create(g.Plugin.prototype);g.Weapon.prototype.constructor=g.Weapon;g.Weapon.KILL_NEVER=0;g.Weapon.KILL_LIFESPAN=1;g.Weapon.KILL_DISTANCE=2;g.Weapon.KILL_WEAPON_BOUNDS=3;g.Weapon.KILL_CAMERA_BOUNDS=4;g.Weapon.KILL_WORLD_BOUNDS=5;g.Weapon.KILL_STATIC_BOUNDS=6;g.Weapon.prototype.createBullets=function(r,p,s,q){if(r===undefined){r=1}if(q===undefined){q=this.game.world}if(!this.bullets){this.bullets=this.game.add.physicsGroup(g.Physics.ARCADE,q);this.bullets.classType=this._bulletClass}if(r!==0){if(r===-1){this.autoExpandBulletsGroup=true;r=1}this.bullets.createMultiple(r,p,s);this.bullets.setAll("data.bulletManager",this);this.bulletKey=p;this.bulletFrame=s}return this};g.Weapon.prototype.forEach=function(q,p){this.bullets.forEachExists(q,p,arguments);return this};g.Weapon.prototype.pauseAll=function(){this.bullets.setAll("body.enable",false);return this};g.Weapon.prototype.resumeAll=function(){this.bullets.setAll("body.enable",true);return this};g.Weapon.prototype.killAll=function(){this.bullets.callAllExists("kill",true);this.bullets.setAll("body.enable",true);return this};g.Weapon.prototype.resetShots=function(p){this.shots=0;if(p!==undefined){this.fireLimit=p}return this};g.Weapon.prototype.destroy=function(){this.parent.remove(this,false);this.bullets.destroy();this.game=null;this.parent=null;this.active=false;this.visible=false};g.Weapon.prototype.update=function(){if(this._bulletKillType===g.Weapon.KILL_WEAPON_BOUNDS){if(this.trackedSprite){this.trackedSprite.updateTransform();this.bounds.centerOn(this.trackedSprite.worldPosition.x,this.trackedSprite.worldPosition.y)}else{if(this.trackedPointer){this.bounds.centerOn(this.trackedPointer.worldX,this.trackedPointer.worldY)}}}if(this.autofire){this.fire()}};g.Weapon.prototype.trackSprite=function(r,p,s,q){if(p===undefined){p=0}if(s===undefined){s=0}if(q===undefined){q=false}this.trackedPointer=null;this.trackedSprite=r;this.trackRotation=q;this.trackOffset.set(p,s);return this};g.Weapon.prototype.trackPointer=function(q,p,r){if(q===undefined){q=this.game.input.activePointer}if(p===undefined){p=0}if(r===undefined){r=0}this.trackedPointer=q;this.trackedSprite=null;this.trackRotation=false;this.trackOffset.set(p,r);return this};g.Weapon.prototype.fire=function(C,B,w){if(this.game.time.now<this._nextFire||(this.fireLimit>0&&this.shots===this.fireLimit)){return false}var r=this.bulletSpeed;if(this.bulletSpeedVariance!==0){r+=g.Math.between(-this.bulletSpeedVariance,this.bulletSpeedVariance)}if(C){if(this.fireFrom.width>1){this.fireFrom.centerOn(C.x,C.y)}else{this.fireFrom.x=C.x;this.fireFrom.y=C.y}}else{if(this.trackedSprite){if(this.trackRotation){this._rotatedPoint.set(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y);this._rotatedPoint.rotate(this.trackedSprite.world.x,this.trackedSprite.world.y,this.trackedSprite.rotation);if(this.fireFrom.width>1){this.fireFrom.centerOn(this._rotatedPoint.x,this._rotatedPoint.y)}else{this.fireFrom.x=this._rotatedPoint.x;this.fireFrom.y=this._rotatedPoint.y}}else{if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedSprite.world.x+this.trackOffset.x,this.trackedSprite.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedSprite.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedSprite.world.y+this.trackOffset.y}}if(this.bulletInheritSpriteSpeed){r+=this.trackedSprite.body.speed}}else{if(this.trackedPointer){if(this.fireFrom.width>1){this.fireFrom.centerOn(this.trackedPointer.world.x+this.trackOffset.x,this.trackedPointer.world.y+this.trackOffset.y)}else{this.fireFrom.x=this.trackedPointer.world.x+this.trackOffset.x;this.fireFrom.y=this.trackedPointer.world.y+this.trackOffset.y}}}}var A=(this.fireFrom.width>1)?this.fireFrom.randomX:this.fireFrom.x;var z=(this.fireFrom.height>1)?this.fireFrom.randomY:this.fireFrom.y;var t=(this.trackRotation)?this.trackedSprite.angle:this.fireAngle;if(B!==undefined&&w!==undefined){t=this.game.math.radToDeg(Math.atan2(w-z,B-A))}if(this.bulletAngleVariance!==0){t+=g.Math.between(-this.bulletAngleVariance,this.bulletAngleVariance)}var s=0;var q=0;if(t===0||t===180){s=Math.cos(this.game.math.degToRad(t))*r}else{if(t===90||t===270){q=Math.sin(this.game.math.degToRad(t))*r}else{s=Math.cos(this.game.math.degToRad(t))*r;q=Math.sin(this.game.math.degToRad(t))*r}}var p=null;if(this.autoExpandBulletsGroup){p=this.bullets.getFirstExists(false,true,A,z,this.bulletKey,this.bulletFrame);p.data.bulletManager=this}else{p=this.bullets.getFirstExists(false)}if(p){p.reset(A,z);p.data.fromX=A;p.data.fromY=z;p.data.killType=this.bulletKillType;p.data.killDistance=this.bulletKillDistance;p.data.rotateToVelocity=this.bulletRotateToVelocity;if(this.bulletKillType===g.Weapon.KILL_LIFESPAN){p.lifespan=this.bulletLifespan}p.angle=t+this.bulletAngleOffset;if(this.bulletAnimation!==""){if(p.animations.getAnimation(this.bulletAnimation)===null){var u=this.anims[this.bulletAnimation];p.animations.add(u.name,u.frames,u.frameRate,u.loop,u.useNumericIndex)}p.animations.play(this.bulletAnimation)}else{if(this.bulletFrameCycle){p.frame=this.bulletFrames[this.bulletFrameIndex];this.bulletFrameIndex++;if(this.bulletFrameIndex>=this.bulletFrames.length){this.bulletFrameIndex=0}}else{if(this.bulletFrameRandom){p.frame=this.bulletFrames[Math.floor(Math.random()*this.bulletFrames.length)]}}}if(p.data.bodyDirty){if(this._data.customBody){p.body.setSize(this._data.width,this._data.height,this._data.offsetX,this._data.offsetY)}p.body.collideWorldBounds=this.bulletCollideWorldBounds;p.data.bodyDirty=false}p.body.velocity.set(s,q);p.body.gravity.set(this.bulletGravity.x,this.bulletGravity.y);if(this.bulletSpeedVariance!==0){var v=this.fireRate;v+=g.Math.between(-this.fireRateVariance,this.fireRateVariance);if(v<0){v=0}this._nextFire=this.game.time.now+v}else{this._nextFire=this.game.time.now+this.fireRate}this.shots++;this.onFire.dispatch(p,this,r);if(this.fireLimit>0&&this.shots===this.fireLimit){this.onFireLimit.dispatch(this,this.fireLimit)}}return p};g.Weapon.prototype.fireAtPointer=function(p){if(p===undefined){p=this.game.input.activePointer}return this.fire(null,p.worldX,p.worldY)};g.Weapon.prototype.fireAtSprite=function(p){return this.fire(null,p.world.x,p.world.y)};g.Weapon.prototype.fireAtXY=function(p,q){return this.fire(null,p,q)};g.Weapon.prototype.setBulletBodyOffset=function(r,q,p,s){if(p===undefined){p=0}if(s===undefined){s=0}this._data.customBody=true;this._data.width=r;this._data.height=q;this._data.offsetX=p;this._data.offsetY=s;this.bullets.callAll("body.setSize","body",r,q,p,s);this.bullets.setAll("data.bodyDirty",false);return this};g.Weapon.prototype.setBulletFrames=function(r,p,q,s){if(q===undefined){q=true}if(s===undefined){s=false}this.bulletFrames=g.ArrayUtils.numberArray(r,p);this.bulletFrameIndex=0;this.bulletFrameCycle=q;this.bulletFrameRandom=s;return this};g.Weapon.prototype.addBulletAnimation=function(s,t,r,q,p){this.anims[s]={name:s,frames:t,frameRate:r,loop:q,useNumericIndex:p};this.bullets.callAll("animations.add","animations",s,t,r,q,p);this.bulletAnimation=s;return this};g.Weapon.prototype.debug=function(p,r,q){if(p===undefined){p=16}if(r===undefined){r=32}if(q===undefined){q=false}this.game.debug.text("Weapon Plugin",p,r);this.game.debug.text("Bullets Alive: "+this.bullets.total+" - Total: "+this.bullets.length,p,r+24);if(q){this.bullets.forEachExists(this.game.debug.body,this.game.debug,"rgba(255, 0, 255, 0.8)")}};Object.defineProperty(g.Weapon.prototype,"bulletClass",{get:function(){return this._bulletClass},set:function(p){this._bulletClass=p;this.bullets.classType=this._bulletClass}});Object.defineProperty(g.Weapon.prototype,"bulletKillType",{get:function(){return this._bulletKillType},set:function(p){switch(p){case g.Weapon.KILL_STATIC_BOUNDS:case g.Weapon.KILL_WEAPON_BOUNDS:this.bulletBounds=this.bounds;break;case g.Weapon.KILL_CAMERA_BOUNDS:this.bulletBounds=this.game.camera.view;break;case g.Weapon.KILL_WORLD_BOUNDS:this.bulletBounds=this.game.world.bounds;break}this._bulletKillType=p}});Object.defineProperty(g.Weapon.prototype,"bulletCollideWorldBounds",{get:function(){return this._bulletCollideWorldBounds},set:function(p){this._bulletCollideWorldBounds=p;this.bullets.setAll("body.collideWorldBounds",p);this.bullets.setAll("data.bodyDirty",false)}});Object.defineProperty(g.Weapon.prototype,"x",{get:function(){return this.fireFrom.x},set:function(p){this.fireFrom.x=p}});Object.defineProperty(g.Weapon.prototype,"y",{get:function(){return this.fireFrom.y},set:function(p){this.fireFrom.y=p}});g.Bullet=function(q,p,t,r,s){g.Sprite.call(this,q,p,t,r,s);this.anchor.set(0.5);this.data={bulletManager:null,fromX:0,fromY:0,bodyDirty:true,rotateToVelocity:false,killType:0,killDistance:0}};g.Bullet.prototype=Object.create(g.Sprite.prototype);g.Bullet.prototype.constructor=g.Bullet;g.Bullet.prototype.kill=function(){this.alive=false;this.exists=false;this.visible=false;this.data.bulletManager.onKill.dispatch(this);return this};g.Bullet.prototype.update=function(){if(!this.exists){return}if(this.data.killType>g.Weapon.KILL_LIFESPAN){if(this.data.killType===g.Weapon.KILL_DISTANCE){if(this.game.physics.arcade.distanceToXY(this,this.data.fromX,this.data.fromY,true)>this.data.killDistance){this.kill()}}else{if(!this.data.bulletManager.bulletBounds.intersects(this)){this.kill()}}}if(this.data.rotateToVelocity){this.rotation=Math.atan2(this.body.velocity.y,this.body.velocity.x)}if(this.data.bulletManager.bulletWorldWrap){this.game.world.wrap(this,this.data.bulletManager.bulletWorldWrapPadding)}};g.Video=function(q,s,r){if(s===undefined){s=null}if(r===undefined){r=null}this.game=q;this.key=s;this.width=0;this.height=0;this.type=g.VIDEO;this.disableTextureUpload=false;this.touchLocked=false;this.onPlay=new g.Signal();this.onChangeSource=new g.Signal();this.onComplete=new g.Signal();this.onAccess=new g.Signal();this.onError=new g.Signal();this.onTimeout=new g.Signal();this.timeout=15000;this._timeOutID=null;this.video=null;this.videoStream=null;this.isStreaming=false;this.retryLimit=20;this.retry=0;this.retryInterval=500;this._retryID=null;this._codeMuted=false;this._muted=false;this._codePaused=false;this._paused=false;this._pending=false;this._autoplay=false;this._endCallback=null;this._playCallback=null;if(s&&this.game.cache.checkVideoKey(s)){var p=this.game.cache.getVideo(s);if(p.isBlob){this.createVideoFromBlob(p.data)}else{this.video=p.data}this.width=this.video.videoWidth;this.height=this.video.videoHeight}else{if(r){this.createVideoFromURL(r,false)}}if(this.video&&!r){this.baseTexture=new PIXI.BaseTexture(this.video);this.baseTexture.forceLoaded(this.width,this.height)}else{this.baseTexture=new PIXI.BaseTexture(g.Cache.DEFAULT.baseTexture.source);this.baseTexture.forceLoaded(this.width,this.height)}this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new g.Frame(0,0,0,this.width,this.height,"video");this.texture.setFrame(this.textureFrame);this.texture.valid=false;if(s!==null&&this.video){this.texture.valid=this.video.canplay}this.snapshot=null;if(g.BitmapData){this.snapshot=new g.BitmapData(this.game,"",this.width,this.height)}if(!this.game.device.cocoonJS&&(this.game.device.iOS||this.game.device.android)||(window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock)){this.setTouchLock()}else{if(p){p.locked=false}}};g.Video.prototype={connectToMediaStream:function(p,q){if(p&&q){this.video=p;this.videoStream=q;this.isStreaming=true;this.baseTexture.source=this.video;this.updateTexture(null,this.video.videoWidth,this.video.videoHeight);this.onAccess.dispatch(this)}return this},startMediaStream:function(s,r,p){if(s===undefined){s=false}if(r===undefined){r=null}if(p===undefined){p=null}if(!this.game.device.getUserMedia){this.onError.dispatch(this,"No getUserMedia");return false}if(this.videoStream!==null){if(this.videoStream.active){this.videoStream.active=false}else{this.videoStream.stop()}}this.removeVideoElement();this.video=document.createElement("video");this.video.setAttribute("autoplay","autoplay");if(r!==null){this.video.width=r}if(p!==null){this.video.height=p}this._timeOutID=window.setTimeout(this.getUserMediaTimeout.bind(this),this.timeout);try{navigator.getUserMedia({audio:s,video:true},this.getUserMediaSuccess.bind(this),this.getUserMediaError.bind(this))}catch(q){this.getUserMediaError(q)}return this},getUserMediaTimeout:function(){clearTimeout(this._timeOutID);this.onTimeout.dispatch(this)},getUserMediaError:function(p){clearTimeout(this._timeOutID);this.onError.dispatch(this,p)},getUserMediaSuccess:function(q){clearTimeout(this._timeOutID);this.videoStream=q;if(this.video.mozSrcObject!==undefined){this.video.mozSrcObject=q}else{this.video.src=(window.URL&&window.URL.createObjectURL(q))||q}var p=this;this.video.onloadeddata=function(){var r=10;function s(){if(r>0){if(p.video.videoWidth>0){var u=p.video.videoWidth;var t=p.video.videoHeight;if(isNaN(p.video.videoHeight)){t=u/(4/3)}p.video.play();p.isStreaming=true;p.baseTexture.source=p.video;p.updateTexture(null,u,t);p.onAccess.dispatch(p)}else{window.setTimeout(s,500)}}else{console.warn("Unable to connect to video stream. Webcam error?")}r--}s()}},createVideoFromBlob:function(p){var q=this;this.video=document.createElement("video");this.video.controls=false;this.video.setAttribute("autoplay","autoplay");this.video.addEventListener("loadeddata",function(r){q.updateTexture(r)},true);this.video.src=window.URL.createObjectURL(p);this.video.canplay=true;return this},createVideoFromURL:function(p,q){if(q===undefined){q=false}if(this.texture){this.texture.valid=false}this.video=document.createElement("video");this.video.controls=false;if(q){this.video.setAttribute("autoplay","autoplay")}this.video.src=p;this.video.canplay=true;this.video.load();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.key=p;return this},updateTexture:function(r,q,p){var s=false;if(q===undefined||q===null){q=this.video.videoWidth;s=true}if(p===undefined||p===null){p=this.video.videoHeight}this.width=q;this.height=p;if(this.baseTexture.source!==this.video){this.baseTexture.source=this.video}this.baseTexture.forceLoaded(q,p);this.texture.frame.resize(q,p);this.texture.width=q;this.texture.height=p;this.texture.valid=true;if(this.snapshot){this.snapshot.resize(q,p)}if(s&&this.key!==null){this.onChangeSource.dispatch(this,q,p);if(this._autoplay){this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate)}}},complete:function(){this.onComplete.dispatch(this)},play:function(p,q){if(p===undefined){p=false}if(q===undefined){q=1}if(this.game.sound.onMute){this.game.sound.onMute.add(this.setMute,this);this.game.sound.onUnMute.add(this.unsetMute,this);if(this.game.sound.mute){this.setMute()}}this.game.onPause.add(this.setPause,this);this.game.onResume.add(this.setResume,this);this._endCallback=this.complete.bind(this);this.video.addEventListener("ended",this._endCallback,true);this.video.addEventListener("webkitendfullscreen",this._endCallback,true);if(p){this.video.loop="loop"}else{this.video.loop=""}this.video.playbackRate=q;if(this.touchLocked){this._pending=true}else{this._pending=false;if(this.key!==null){if(this.video.readyState!==4){this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{this._playCallback=this.playHandler.bind(this);this.video.addEventListener("playing",this._playCallback,true)}}this.video.play();this.onPlay.dispatch(this,p,q)}return this},playHandler:function(){this.video.removeEventListener("playing",this._playCallback,true);this.updateTexture()},stop:function(){if(this.game.sound.onMute){this.game.sound.onMute.remove(this.setMute,this);this.game.sound.onUnMute.remove(this.unsetMute,this)}this.game.onPause.remove(this.setPause,this);this.game.onResume.remove(this.setResume,this);if(this.isStreaming){if(this.video.mozSrcObject){this.video.mozSrcObject.stop();this.video.src=null}else{this.video.src="";if(this.videoStream.active){this.videoStream.active=false}else{if(this.videoStream.getTracks){this.videoStream.getTracks().forEach(function(p){p.stop()})}else{this.videoStream.stop()}}}this.videoStream=null;this.isStreaming=false}else{this.video.removeEventListener("ended",this._endCallback,true);this.video.removeEventListener("webkitendfullscreen",this._endCallback,true);this.video.removeEventListener("playing",this._playCallback,true);if(this.touchLocked){this._pending=false}else{this.video.pause()}}return this},add:function(p){if(Array.isArray(p)){for(var q=0;q<p.length;q++){if(p[q]["loadTexture"]){p[q].loadTexture(this)}}}else{p.loadTexture(this)}return this},addToWorld:function(q,v,p,u,s,r){s=s||1;r=r||1;var t=this.game.add.image(q,v,this);t.anchor.set(p,u);t.scale.set(s,r);return t},render:function(){if(!this.disableTextureUpload&&this.playing){this.baseTexture.dirty()}},setMute:function(){if(this._muted){return}this._muted=true;this.video.muted=true},unsetMute:function(){if(!this._muted||this._codeMuted){return}this._muted=false;this.video.muted=false},setPause:function(){if(this._paused||this.touchLocked){return}this._paused=true;this.video.pause()},setResume:function(){if(!this._paused||this._codePaused||this.touchLocked){return}this._paused=false;if(!this.video.ended){this.video.play()}},changeSource:function(q,p){if(p===undefined){p=true}this.texture.valid=false;this.video.pause();this.retry=this.retryLimit;this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval);this.video.src=q;this.video.load();this._autoplay=p;if(!p){this.paused=true}return this},checkVideoProgress:function(){if(this.video.readyState===4){this.updateTexture()}else{this.retry--;if(this.retry>0){this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval)}else{console.warn("Phaser.Video: Unable to start downloading video in time",this.isStreaming)}}},setTouchLock:function(){this.game.input.touch.addTouchLockCallback(this.unlock,this);this.touchLocked=true},unlock:function(){this.touchLocked=false;this.video.play();this.onPlay.dispatch(this,this.loop,this.playbackRate);if(this.key){var p=this.game.cache.getVideo(this.key);if(p&&!p.isBlob){p.locked=false}}return true},grab:function(p,r,q){if(p===undefined){p=false}if(r===undefined){r=1}if(q===undefined){q=null}if(this.snapshot===null){console.warn("Video.grab cannot run because Phaser.BitmapData is unavailable");return}if(p){this.snapshot.cls()}this.snapshot.copy(this.video,0,0,this.width,this.height,0,0,this.width,this.height,0,0,0,1,1,r,q);return this.snapshot},removeVideoElement:function(){if(!this.video){return}if(this.video.parentNode){this.video.parentNode.removeChild(this.video)}while(this.video.hasChildNodes()){this.video.removeChild(this.video.firstChild)}this.video.removeAttribute("autoplay");this.video.removeAttribute("src");this.video=null},destroy:function(){this.stop();this.removeVideoElement();if(this.touchLocked){this.game.input.touch.removeTouchLockCallback(this.unlock,this)}if(this._retryID){window.clearTimeout(this._retryID)}}};Object.defineProperty(g.Video.prototype,"currentTime",{get:function(){return(this.video)?this.video.currentTime:0},set:function(p){this.video.currentTime=p}});Object.defineProperty(g.Video.prototype,"duration",{get:function(){return(this.video)?this.video.duration:0}});Object.defineProperty(g.Video.prototype,"progress",{get:function(){return(this.video)?(this.video.currentTime/this.video.duration):0}});Object.defineProperty(g.Video.prototype,"mute",{get:function(){return this._muted},set:function(p){p=p||null;if(p){if(this._muted){return}this._codeMuted=true;this.setMute()}else{if(!this._muted){return}this._codeMuted=false;this.unsetMute()}}});Object.defineProperty(g.Video.prototype,"paused",{get:function(){return this._paused},set:function(p){p=p||null;if(this.touchLocked){return}if(p){if(this._paused){return}this._codePaused=true;this.setPause()}else{if(!this._paused){return}this._codePaused=false;this.setResume()}}});Object.defineProperty(g.Video.prototype,"volume",{get:function(){return(this.video)?this.video.volume:1},set:function(p){if(p<0){p=0}else{if(p>1){p=1}}if(this.video){this.video.volume=p}}});Object.defineProperty(g.Video.prototype,"playbackRate",{get:function(){return(this.video)?this.video.playbackRate:1},set:function(p){if(this.video){this.video.playbackRate=p}}});Object.defineProperty(g.Video.prototype,"loop",{get:function(){return(this.video)?this.video.loop:false},set:function(p){if(p&&this.video){this.video.loop="loop"}else{if(this.video){this.video.loop=""}}}});Object.defineProperty(g.Video.prototype,"playing",{get:function(){return !(this.video.paused&&this.video.ended)}});g.Video.prototype.constructor=g.Video;if(PIXI.blendModes===undefined){PIXI.blendModes=g.blendModes}if(PIXI.scaleModes===undefined){PIXI.scaleModes=g.scaleModes}if(PIXI.Texture.emptyTexture===undefined){PIXI.Texture.emptyTexture=new PIXI.Texture(new PIXI.BaseTexture())}if(PIXI.DisplayObject._tempMatrix===undefined){PIXI.DisplayObject._tempMatrix=new PIXI.Matrix()}if(PIXI.RenderTexture.tempMatrix===undefined){PIXI.RenderTexture.tempMatrix=new PIXI.Matrix()}if(PIXI.Graphics&&PIXI.Graphics.POLY===undefined){PIXI.Graphics.POLY=g.POLYGON;PIXI.Graphics.RECT=g.RECTANGLE;PIXI.Graphics.CIRC=g.CIRCLE;PIXI.Graphics.ELIP=g.ELLIPSE;PIXI.Graphics.RREC=g.ROUNDEDRECTANGLE}PIXI.TextureSilentFail=true;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=g}exports.Phaser=g}else{if(typeof define!=="undefined"&&define.amd){define("Phaser",(function(){return k.Phaser=g})())}else{k.Phaser=g}}return g}).call(this);